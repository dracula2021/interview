<!DOCTYPE html>
<!-- saved from url=(0080)http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html -->
<html lang="en-US" class=" "><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    
    <title>ä¸€ã€ç¯å¢ƒæ­å»º | é¢è¯•æŒ‡å—</title>
    
    <link rel="icon" href="./dva_files/logo.png">
    <link rel="manifest" href="http://interview.poetries.top/manifest.json">
    <link rel="apple-touch-icon" href="http://interview.poetries.top/icons/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="http://interview.poetries.top/icons/safari-pinned-tab.svg" color="#3eaf7c">
    
    
    
    
    
    
    
    <link rel="preload" href="./dva_files/0.styles.a3a6df6c.css" as="style"><link rel="preload" href="./dva_files/app.25cf4eee.js.ä¸‹è½½" as="script"><link rel="preload" href="./dva_files/5.bc663a4c.js.ä¸‹è½½" as="script"><link rel="preload" href="./dva_files/4.1aaf03c6.js.ä¸‹è½½" as="script"><link rel="preload" href="./dva_files/12.ac0bc851.js.ä¸‹è½½" as="script"><link rel="preload" href="./dva_files/11.3e5297f1.js.ä¸‹è½½" as="script"><link rel="prefetch" href="./dva_files/1.d83c2af0.js.ä¸‹è½½"><link rel="prefetch" href="http://interview.poetries.top/assets/js/10.fdecf69b.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/100.df83f687.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/101.3986f029.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/102.1468be32.js"><link rel="prefetch" href="./dva_files/103.bfef2896.js.ä¸‹è½½"><link rel="prefetch" href="./dva_files/104.1731bbb1.js.ä¸‹è½½"><link rel="prefetch" href="./dva_files/105.710b118c.js.ä¸‹è½½"><link rel="prefetch" href="./dva_files/106.b955d37d.js.ä¸‹è½½"><link rel="prefetch" href="./dva_files/107.6f79a916.js.ä¸‹è½½"><link rel="prefetch" href="./dva_files/108.34ee5a8e.js.ä¸‹è½½"><link rel="prefetch" href="./dva_files/109.f6c05e4d.js.ä¸‹è½½"><link rel="prefetch" href="./dva_files/110.a375ddec.js.ä¸‹è½½"><link rel="prefetch" href="http://interview.poetries.top/assets/js/111.bcc5c187.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/112.afcfef56.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/113.2e7c6e37.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/114.9cfdb334.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/115.063815ec.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/116.4e29ee01.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/117.b106fd0d.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/118.e4e784f7.js"><link rel="prefetch" href="./dva_files/119.94fe014a.js.ä¸‹è½½"><link rel="prefetch" href="./dva_files/13.57028e74.js.ä¸‹è½½"><link rel="prefetch" href="./dva_files/14.043c3e8a.js.ä¸‹è½½"><link rel="prefetch" href="http://interview.poetries.top/assets/js/15.a6d0032e.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/16.6094fda8.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/17.f17aa05b.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/18.9732bfb3.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/19.2c38a6bb.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/20.92742304.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/21.28c8a661.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/22.3222a772.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/23.8192ecea.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/24.b5156b88.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/25.034d5e81.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/26.c78d8f63.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/27.cd94c89c.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/28.b2c8e24c.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/29.e9a30c2c.js"><link rel="prefetch" href="./dva_files/3.f5ea6e07.js.ä¸‹è½½"><link rel="prefetch" href="http://interview.poetries.top/assets/js/30.2bd67425.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/31.6333035e.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/32.1a34dfa0.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/33.b5863ac0.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/34.cababd6c.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/35.0b09d4a2.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/36.8f89ed73.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/37.38d590c3.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/38.4799c402.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/39.c9d13f25.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/40.21e1dcb8.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/41.16e0641a.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/42.9ce6fd83.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/43.8936e729.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/44.5ebdd233.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/45.ce59a54c.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/46.b6f1380b.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/47.5fe8aac4.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/48.a31741eb.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/49.16132e72.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/50.ca74d5c9.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/51.f21f79ee.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/52.6ff2b7c5.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/53.003482ca.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/54.136b1210.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/55.5d00c7ca.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/56.e5b5668d.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/57.9275f210.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/58.dcf3e81b.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/59.5cbf4407.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/6.f2ac32df.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/60.ecfb5f55.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/61.8356d65b.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/62.8ca03065.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/63.a0c06a04.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/64.406f4c0f.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/65.9d0c9d57.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/66.ca2ccee4.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/67.b01df864.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/68.e99acf6a.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/69.f7dbb3b1.js"><link rel="prefetch" href="./dva_files/7.26b183c1.js.ä¸‹è½½"><link rel="prefetch" href="http://interview.poetries.top/assets/js/70.b3199540.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/71.d7c346c6.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/72.6afb9cd3.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/73.80370c6b.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/74.eec2a38b.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/75.fdbda41f.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/76.c8a9acd3.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/77.02560728.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/78.f3bcf134.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/79.01333f71.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/8.b6777e86.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/80.a7dfb481.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/81.29a3aa15.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/82.9039f284.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/83.e29f794c.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/84.9aea4d6e.js"><link rel="prefetch" href="./dva_files/85.6fa07b30.js.ä¸‹è½½"><link rel="prefetch" href="http://interview.poetries.top/assets/js/86.b0a530f1.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/87.a2c892ff.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/88.2c0ab353.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/89.0a6986cd.js"><link rel="prefetch" href="./dva_files/9.7231fa75.js.ä¸‹è½½"><link rel="prefetch" href="http://interview.poetries.top/assets/js/90.80c04201.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/91.19846beb.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/92.09ef3493.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/93.8bad40d8.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/94.f0810e7b.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/95.3a648c4f.js"><link rel="prefetch" href="./dva_files/96.827e7cb2.js.ä¸‹è½½"><link rel="prefetch" href="./dva_files/97.cc180b8f.js.ä¸‹è½½"><link rel="prefetch" href="http://interview.poetries.top/assets/js/98.d2138442.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/99.7e99e846.js">
    <link rel="stylesheet" href="./dva_files/0.styles.a3a6df6c.css">
  <style type="text/css">.medium-zoom-overlay{position:fixed;top:0;right:0;bottom:0;left:0;opacity:0;transition:opacity .3s;will-change:opacity}.medium-zoom--opened .medium-zoom-overlay{cursor:pointer;cursor:zoom-out;opacity:1}.medium-zoom-image{cursor:pointer;cursor:zoom-in;transition:transform .3s cubic-bezier(.2,0,.2,1)!important}.medium-zoom-image--hidden{visibility:hidden}.medium-zoom-image--opened{position:relative;cursor:pointer;cursor:zoom-out;will-change:transform}</style>
  <meta name="description" content="å‰ç«¯é¢è¯•æŒ‡å—ï¼Œå‰ç«¯é¢è¯•é¢˜æ•´ç†ï¼ŒæŒ‰æ¨¡å—åˆ†ç±»æ•´ç†æ€»ç»“ï¼Œæ‰“é€ æœ€å…¨é¢çš„å‰ç«¯é¢è¯•é¢˜"><meta name="theme-color" content="#3eaf7c"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png"><meta name="msapplication-TileColor" content="#000000"></head>
  <body class="">
    <div id="app"><div class="theme-container"><header class="navbar" style="background: rgb(255, 255, 255);"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="http://interview.poetries.top/" class="home-link router-link-active"><img src="./åŸç†_files/logo.png" alt="é¢è¯•æŒ‡å—" class="logo"> <span class="site-name can-hide">é¢è¯•æŒ‡å—</span></a> <div class="links" style="background: rgb(255, 255, 255); max-width: 1771px;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value="" class="" placeholder=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div><a href="./index.html" class="nav-link">åŸºç¡€
    </a></div></div><div class="nav-item"><div><a href="./è¿›é˜¶.html" class="nav-link">âœ¨è¿›é˜¶
    </a></div></div><div class="nav-item"><div><a href="./ç²¾é€‰.html" class="nav-link">ğŸ‘ç²¾é€‰
    </a></div></div><div class="nav-item"><div><a href="./é«˜é¢‘.html" class="nav-link">ğŸ”¥é«˜é¢‘
    </a></div></div><div class="nav-item"><div><a href="./æŒ‡å—.html" class="nav-link">æŒ‡å—
    </a></div></div><div class="nav-item"><div><a href="./æ€§èƒ½.html" class="nav-link">æ€§èƒ½
    </a></div></div><div class="nav-item"><div><a href="./ç»¼åˆ.html" class="nav-link">ç»¼åˆ
    </a></div></div><div class="nav-item"><div><a href="./vue.html" class="nav-link">åŸç†
    </a></div></div><div class="nav-item"><div><a href="./æ‰‹å†™.html" class="nav-link">æ‰‹å†™
    </a></div></div><div class="nav-item"><div><a href="./è‡ªæ£€.html" class="nav-link">è‡ªæ£€
    </a></div></div><div class="nav-item"><div><a href="./é¢ç».html" class="nav-link">â­é¢ç»
    </a></div></div><div class="nav-item"><div><a href="./æ¯æ—¥ä¸€é¢˜.html" class="nav-link">ğŸ’¥æ¯æ—¥ä¸€é¢˜
    </a></div></div><div class="nav-item"><div><a href="./è®¾è®¡æ¨¡å¼.html" class="nav-link">è®¾è®¡æ¨¡å¼
  </a></div></div><div class="nav-item"><div><a href="http://interview.poetries.top/algorithm-interview/note/01-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E2%80%94%E2%80%94%E4%BB%8E0%E5%88%B01%E6%8E%8C%E6%8F%A1%E7%AE%97%E6%B3%95%E9%9D%A2%E8%AF%95%E9%9C%80%E8%A6%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%88%E4%B8%80%EF%BC%89.html" class="nav-link">
  </a></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æ‹“å±•é˜…è¯»" class="dropdown-title"><span class="title">æ‹“å±•é˜…è¯»</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display: none;"><li class="dropdown-item"><h4>ä¸“é¢˜</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-base-docs/compute-docs/Linux.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-mobile-docs/h5-docs/1-%E5%A4%A7%E5%8E%82%20H5%20%E5%BC%80%E5%8F%91%E6%A6%82%E8%BF%B0.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-css-inspiration-docs/css-docs/note/01-%E6%B5%8F%E8%A7%88%E5%99%A8.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-vue-docs/learn-vue-base/base/1-Vue%20CLI%203%20%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA%E5%9F%BA%E7%A1%80.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-react-docs/react-web-action/01-%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E7%9A%84%E5%9B%9B%E4%B8%AA%E6%97%B6%E4%BB%A3.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-micro-docs/docs/01-%E5%BE%AE%E5%89%8D%E7%AB%AF%E7%9A%84%E8%AF%9E%E7%94%9F.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-engineering-docs/docs/npm-script.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-nodejs-docs/nodejs-docs/base/01-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-ts-axios-docs/ts-axios/chapter1/" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-algorithm-docs/algorithm/prepare/01-%E5%A6%82%E4%BD%95%E7%B3%BB%E7%BB%9F%E9%AB%98%E6%95%88%E5%9C%B0%E5%AD%A6%E4%B9%A0%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="https://blog.poetries.top/browser-working-principle/guide/part1/lesson01.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
      æµè§ˆå™¨åŸç†
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li><li class="dropdown-subitem"><div><a href="https://blog.poetries.top/http-protocol/notes/base/01-HTTP%E7%9A%84%E5%89%8D%E4%B8%96%E4%BB%8A%E7%94%9F.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
      HTTPåŸºç¡€
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/docs/webpack.html" class="nav-link">webpack
  </a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/docs/npm-script.html" class="nav-link">npmå·¥ä½œæµ
  </a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/docs/canvas.html" class="nav-link">Canvas
  </a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/docs/Taro.html" class="nav-link">TaroåŸç†
  </a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-nodejs-docs/nodejs-docs/base/01-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
      Nodeå­¦ä¹ æŒ‡å—
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-vue-docs/vue-analysis/prepare/" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
      Vueæºç åˆ†æ
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li></ul></li><li class="dropdown-item"><h4>å…¶ä»–</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-blog-docs/blog-docs/javascript/-Ajax%E6%80%BB%E7%BB%93%E7%AF%87.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
      æ—¥å¸¸ç§¯ç´¯
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li><li class="dropdown-subitem"><div><a href="http://blog.poetries.top/archives/" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
      åšæ–‡
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="background: rgb(255, 255, 255);"><nav class="nav-links"><div class="nav-item"><div><a href="http://interview.poetries.top/docs/base.html" class="nav-link">åŸºç¡€
  </a></div></div><div class="nav-item"><div><a href="http://interview.poetries.top/docs/simply.html" class="nav-link">âœ¨è¿›é˜¶
  </a></div></div><div class="nav-item"><div><a href="http://interview.poetries.top/excellent-docs/1-HTML%E6%A8%A1%E5%9D%97.html" class="nav-link">ğŸ‘ç²¾é€‰
  </a></div></div><div class="nav-item"><div><a href="http://interview.poetries.top/docs/excellent.html" class="nav-link">ğŸ”¥é«˜é¢‘
  </a></div></div><div class="nav-item"><div><a href="http://interview.poetries.top/docs/guide.html" class="nav-link">æŒ‡å—
  </a></div></div><div class="nav-item"><div><a href="http://interview.poetries.top/docs/performance.html" class="nav-link">æ€§èƒ½
  </a></div></div><div class="nav-item"><div><a href="http://interview.poetries.top/docs/detail-expain.html" class="nav-link">ç»¼åˆ
  </a></div></div><div class="nav-item"><div><a href="http://interview.poetries.top/principle-docs/comprehensive/01-%E8%99%9A%E6%8B%9FDOM%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90.html" class="nav-link">åŸç†
  </a></div></div><div class="nav-item"><div><a href="http://interview.poetries.top/docs/handwritten.html" class="nav-link">æ‰‹å†™
  </a></div></div><div class="nav-item"><div><a href="http://interview.poetries.top/qa/1-%E5%89%8D%E7%AB%AF100%E9%A2%98%E8%87%AA%E6%A3%80.html" class="nav-link">è‡ªæ£€
  </a></div></div><div class="nav-item"><div><a href="http://interview.poetries.top/interview-exp/%E5%89%8D%E7%AB%AF%E9%9D%A2%E7%BB%8F%E6%B1%87%E6%80%BB.html" class="nav-link">â­é¢ç»
  </a></div></div><div class="nav-item"><div><a href="http://interview.poetries.top/days/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98.html" class="nav-link">ğŸ’¥æ¯æ—¥ä¸€é¢˜
  </a></div></div><div class="nav-item"><div><a href="http://interview.poetries.top/docs/design-pattern.html" class="nav-link">è®¾è®¡æ¨¡å¼
  </a></div></div><div class="nav-item"><div><a href="http://interview.poetries.top/algorithm-interview/note/01-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E2%80%94%E2%80%94%E4%BB%8E0%E5%88%B01%E6%8E%8C%E6%8F%A1%E7%AE%97%E6%B3%95%E9%9D%A2%E8%AF%95%E9%9C%80%E8%A6%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%88%E4%B8%80%EF%BC%89.html" class="nav-link">
  </a></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æ‹“å±•é˜…è¯»" class="dropdown-title"><span class="title">æ‹“å±•é˜…è¯»</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display: none;"><li class="dropdown-item"><h4>ä¸“é¢˜</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-base-docs/compute-docs/Linux.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-mobile-docs/h5-docs/1-%E5%A4%A7%E5%8E%82%20H5%20%E5%BC%80%E5%8F%91%E6%A6%82%E8%BF%B0.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-css-inspiration-docs/css-docs/note/01-%E6%B5%8F%E8%A7%88%E5%99%A8.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-vue-docs/learn-vue-base/base/1-Vue%20CLI%203%20%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA%E5%9F%BA%E7%A1%80.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-react-docs/react-web-action/01-%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E7%9A%84%E5%9B%9B%E4%B8%AA%E6%97%B6%E4%BB%A3.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-micro-docs/docs/01-%E5%BE%AE%E5%89%8D%E7%AB%AF%E7%9A%84%E8%AF%9E%E7%94%9F.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-engineering-docs/docs/npm-script.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-nodejs-docs/nodejs-docs/base/01-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-ts-axios-docs/ts-axios/chapter1/" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-algorithm-docs/algorithm/prepare/01-%E5%A6%82%E4%BD%95%E7%B3%BB%E7%BB%9F%E9%AB%98%E6%95%88%E5%9C%B0%E5%AD%A6%E4%B9%A0%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="https://blog.poetries.top/browser-working-principle/guide/part1/lesson01.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
      æµè§ˆå™¨åŸç†
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li><li class="dropdown-subitem"><div><a href="https://blog.poetries.top/http-protocol/notes/base/01-HTTP%E7%9A%84%E5%89%8D%E4%B8%96%E4%BB%8A%E7%94%9F.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
      HTTPåŸºç¡€
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/docs/webpack.html" class="nav-link">webpack
  </a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/docs/npm-script.html" class="nav-link">npmå·¥ä½œæµ
  </a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/docs/canvas.html" class="nav-link">Canvas
  </a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/docs/Taro.html" class="nav-link">TaroåŸç†
  </a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-nodejs-docs/nodejs-docs/base/01-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
      Nodeå­¦ä¹ æŒ‡å—
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-vue-docs/vue-analysis/prepare/" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
      Vueæºç åˆ†æ
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li></ul></li><li class="dropdown-item"><h4>å…¶ä»–</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-blog-docs/blog-docs/javascript/-Ajax%E6%80%BB%E7%BB%93%E7%AF%87.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
      æ—¥å¸¸ç§¯ç´¯
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li><li class="dropdown-subitem"><div><a href="http://blog.poetries.top/archives/" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
      åšæ–‡
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li></ul></li></ul></div></div> <!----></nav> <div style="padding-left:1.5rem;"><div class="qr"><img src="./dva_files/qr.ee193d28.jpg" alt="poetries" width="120" height="120" loading="lazy"> <p class="we-intro">
    å…³æ³¨å…¬ä¼—å·ï¼Œè·å–æ›´å¤šèµ„è®¯
  </p></div></div>
  <ul class="sidebar-links"><li><section class="sidebar-group depth-0">
    <p class="sidebar-heading"><span>Vue</span> <!----></p> 
    <ul class="sidebar-links sidebar-group-items"><li>
      <a href="./vue.html" class="sidebar-link">ä»æºç è§£è¯»Vueç”Ÿå‘½å‘¨æœŸ</a></li>
      <li><a href="./ç»„ä»¶çš„æœ¬è´¨.html" class="sidebar-link">ç»„ä»¶çš„æœ¬è´¨</a></li>
      <li><a href="./ç»„ä»¶è®¾è®¡.html" class="sidebar-link">æœ‰çŠ¶æ€ç»„ä»¶çš„è®¾è®¡</a></li>
      <li><a href="./è®¾è®¡vnode.html" class="sidebar-link">è®¾è®¡ VNode</a></li>
      <li><a href="./vnodeçš„hå‡½æ•°.html" class="sidebar-link">è¾…åŠ©åˆ›å»º VNode çš„ h å‡½æ•°</a></li>
      <li><a href="./è‡ªå®šä¹‰æ¸²æŸ“.html" class="sidebar-link">è‡ªå®šä¹‰æ¸²æŸ“å™¨å’Œå¼‚æ­¥æ¸²æŸ“</a></li>
      <li><a href="./æ¸²æŸ“å™¨çš„æŒ‚è½½.html" class="sidebar-link">æ¸²æŸ“å™¨ä¹‹æŒ‚è½½</a></li>
      <li><a href="./æ¸²æŸ“diff.html" class="sidebar-link">æ¸²æŸ“å™¨çš„æ ¸å¿ƒ Diff ç®—æ³•</a></li>
      <li><a href="./æ¸²æŸ“å™¨patch.html" class="sidebar-link">æ¸²æŸ“å™¨ä¹‹patch</a></li>
      <li><a href="./vueå“åº”å¼.html" class="sidebar-link">å›¾è§£ Vue å“åº”å¼åŸç†</a></li>
      <li><a href="./vueå¼‚æ­¥æ›´æ–°.html" class="sidebar-link">å›¾è§£ Vue å¼‚æ­¥æ›´æ–°</a></li>
      <li><a href="./vueè¿è¡Œæœºåˆ¶.html" class="sidebar-link">å‰–æ Vue å†…éƒ¨è¿è¡Œæœºåˆ¶</a></li>
      <li><a href="./æ¨¡æ‹Ÿå“åº”å¼.html" class="sidebar-link">vueå“åº”å¼åŸç†æ¨¡æ‹Ÿ</a></li>
      <li><a href="./vuex.html" class="sidebar-link">vueçŠ¶æ€ç®¡ç†ä¹‹vuex</a></li>
    </ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>React</span> <!----></p> 
      <ul class="sidebar-links sidebar-group-items">
        <li><a href="./react.html" class="sidebar-link">React</a></li>
        <li><a href="./dva.html" class="sidebar-link">Dvaæ€»ç»“</a></li>
        <li><a href="./MobX.html" class="sidebar-link">MobXæ€»ç»“</a></li>
        <li><a href="./redux.html" class="sidebar-link">æµ…æredux</a></li>
        <li><a href="./reduxä¸­é—´ä»¶.html" class="sidebar-link">Reduxä¹‹æµ…æä¸­é—´ä»¶</a></li>
        <li><a href="./reduxæºç .html" class="sidebar-link">Reduxä¹‹æºç åˆ†æ</a></li>
        <li><a href="./reduxå¼‚æ­¥action.html" class="sidebar-link">Reduxä¹‹å¼‚æ­¥ActionåŠæ“ä½œ</a></li>
      </ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Webpack</span> <!----></p> 
        <ul class="sidebar-links sidebar-group-items">
          <li><a href="./webpackæ‰“åŒ…åŸç†.html" class="sidebar-link">Webpack4æ‰“åŒ…æœºåˆ¶åŸç†è§£æ</a></li>
          <li><a href="./çƒ­æ›´æ–°.html" class="sidebar-link">webpackä¸­çš„HMRçƒ­æ›´æ–°åŸç†å‰–æ</a></li>
          <li><a href="./webpack4åŸç†.html" class="sidebar-link">ä»æºç çª¥æ¢Webpack4.xåŸç†</a></li>
          <li><a href="./å®ç°webpackæ‰“åŒ….html" class="sidebar-link">å®ç°webpackå°å‹æ‰“åŒ…å·¥å…·</a></li>
          <li><a href="./babelåŸç†.html" class="sidebar-link">BabelåŸç†åŠå…¶ä½¿ç”¨</a></li>
        </ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>ç»¼åˆ</span> <!----></p>
           <ul class="sidebar-links sidebar-group-items">
             <li><a href="./è™šæ‹ŸdomåŸç†.html" class="active sidebar-link">è™šæ‹ŸDOMåŸç†åˆ†æ</a></li>
             <li><a href="./settimeoutæŒ‡å—.html" class="active sidebar-link">setTimeout</a></li>
             <li class="sidebar-sub-header"><a href="./promise.html" class="sidebar-link">æµ…æPromiseåŸç†</a></li>
        <a href="./æµè§ˆå™¨å¦‚ä½•æ¸²æŸ“.html" class="sidebar-link">æµè§ˆå™¨æ¸²æŸ“åŸç†</a></li>
        <li><a href="./mvvm.html" class="sidebar-link">å‰ç«¯é¢è¯•ä¹‹MVVMæµ…æ</a></li>
        <li><a href="./ç»„ä»¶åŒ–.html" class="sidebar-link">å‰ç«¯é¢è¯•ä¹‹ç»„ä»¶åŒ–</a></li>
        <li><a href="./è™šæ‹Ÿdom1.html" class="sidebar-link">è™šæ‹ŸDOMï¼ˆä¸€ï¼‰</a></li>
        <li><a href="./è™šæ‹Ÿdom2.html" class="sidebar-link">è™šæ‹ŸDOMï¼ˆäºŒï¼‰</a></li>
        <li><a href="./performance.html" class="sidebar-link">å‰ç«¯æ€§èƒ½ä¹‹Performance</a></li>
      </ul></section></li></ul> 
 </aside> <main class="page"> <div id="container" class="theme-default-content pay-content"><div class="content__default"><h2 id="ä¸€ã€ç¯å¢ƒæ­å»º"><a href="http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html#%E4%B8%80%E3%80%81%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA" class="header-anchor">#</a> ä¸€ã€ç¯å¢ƒæ­å»º</h2> <div class="language- extra-class"><pre class="language-text"><code>$ npm install dva-cli -g

# åˆ›å»ºåº”ç”¨
$ dva new dva-quickstart

# å¯åŠ¨
$ npm start
</code></pre></div><blockquote><p>reacté¡¹ç›®çš„æ¨èç›®å½•ç»“æ„ï¼ˆå¦‚æœä½¿ç”¨dvaè„šæ‰‹æ¶åˆ›å»ºï¼Œåˆ™è‡ªåŠ¨ç”Ÿæˆå¦‚ä¸‹ï¼‰</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>|â”€â”€ /mock/             # æ•°æ®mockçš„æ¥å£æ–‡ä»¶  
|â”€â”€ /src/              # é¡¹ç›®æºç ç›®å½•ï¼ˆæˆ‘ä»¬å¼€å‘çš„ä¸»è¦å·¥ä½œåŒºåŸŸï¼‰   
|   |â”€â”€ /components/   # é¡¹ç›®ç»„ä»¶ï¼ˆç”¨äºè·¯ç”±ç»„ä»¶å†…å¼•ç”¨çš„å¯å¤ç”¨ç»„ä»¶ï¼‰   
|   |â”€â”€ /routes/       # è·¯ç”±ç»„ä»¶ï¼ˆé¡µé¢ç»´åº¦ï¼‰ 
|   |  |â”€â”€ route1.js  
|   |  |â”€â”€ route2.js   # æ ¹æ®router.jsä¸­çš„æ˜ å°„ï¼Œåœ¨ä¸åŒçš„urlä¸‹ï¼ŒæŒ‚è½½ä¸åŒçš„è·¯ç”±ç»„ä»¶
|   |  â””â”€â”€ route3.js    
|   |â”€â”€ /models/       # æ•°æ®æ¨¡å‹ï¼ˆå¯ä»¥ç†è§£ä¸ºstoreï¼Œç”¨äºå­˜å‚¨æ•°æ®ä¸æ–¹æ³•ï¼‰  
|   |  |â”€â”€ model1.js  
|   |  |â”€â”€ model2.js   # é€‰æ‹©åˆ†ç¦»ä¸ºå¤šä¸ªmodelæ¨¡å‹ï¼Œæ˜¯æ ¹æ®ä¸šåŠ¡å®ä½“è¿›è¡Œåˆ’åˆ†
|   |  â””â”€â”€ model3.js  
|   |â”€â”€ /services/     # æ•°æ®æ¥å£ï¼ˆå¤„ç†å‰å°é¡µé¢çš„ajaxè¯·æ±‚ï¼Œè½¬å‘åˆ°åå°ï¼‰   
|   |â”€â”€ /utils/        # å·¥å…·å‡½æ•°ï¼ˆå·¥å…·åº“ï¼Œå­˜å‚¨é€šç”¨å‡½æ•°ä¸é…ç½®å‚æ•°ï¼‰     
|   |â”€â”€ router.js       # è·¯ç”±é…ç½®ï¼ˆå®šä¹‰è·¯ç”±ä¸å¯¹åº”çš„è·¯ç”±ç»„ä»¶ï¼‰  
|   |â”€â”€ index.js       # å…¥å£æ–‡ä»¶  
|   |â”€â”€ index.less      
|   â””â”€â”€ index.html     
|â”€â”€ package.json       # é¡¹ç›®ä¿¡æ¯  
â””â”€â”€ proxy.config.js    # æ•°æ®mocké…ç½®
</code></pre></div><p><strong>ä½¿ç”¨ antd</strong></p> <div class="language- extra-class"><pre class="language-text"><code>npm i babel-plugin-import --save
</code></pre></div><blockquote><p><code>babel-plugin-import</code> æ˜¯ç”¨æ¥æŒ‰éœ€åŠ è½½ <code>antd</code> çš„è„šæœ¬å’Œæ ·å¼çš„</p></blockquote> <ul><li>ç¼–è¾‘ <code>.webpackrc</code>ï¼Œä½¿ <code>babel-plugin-import</code> æ’ä»¶ç”Ÿæ•ˆ</li></ul> <div class="language- extra-class"><pre class="language-text"><code>{
+  "extraBabelPlugins": [
+    ["import", { "libraryName": "antd", "libraryDirectory": "es", "style": "css" }]
+  ]
}
</code></pre></div><h2 id="äºŒã€åˆè¯†dva"><a href="http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html#%E4%BA%8C%E3%80%81%E5%88%9D%E8%AF%86dva" class="header-anchor">#</a> äºŒã€åˆè¯†Dva</h2> <h3 id="_2-1-dvaçš„ç‰¹æ€§"><a href="http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html#_2-1-dva%E7%9A%84%E7%89%B9%E6%80%A7" class="header-anchor">#</a> 2.1 Dvaçš„ç‰¹æ€§</h3> <div class="language- extra-class"><pre class="language-text"><code>dva = React-Router + Redux + Redux-saga
</code></pre></div><ul><li>ä»…æœ‰ 5 ä¸ª<code>API</code>ï¼Œä»…æœ‰5ä¸ªä¸»è¦çš„<code>api</code></li> <li>æ”¯æŒ <code>HMR</code>ï¼Œæ”¯æŒæ¨¡å—çš„çƒ­æ›´æ–°</li> <li>æ”¯æŒ <code>SSR (ServerSideRender)</code>ï¼Œæ”¯æŒæœåŠ¡å™¨ç«¯æ¸²æŸ“</li> <li>æ”¯æŒ <code>Mobile/ReactNative</code>ï¼Œæ”¯æŒç§»åŠ¨æ‰‹æœºç«¯çš„ä»£ç ç¼–å†™</li> <li>æ”¯æŒ<code>TypeScript</code></li> <li>æ”¯æŒè·¯ç”±å’Œ <code>Model</code> çš„åŠ¨æ€åŠ è½½</li></ul> <h3 id="_2-2-dvaçš„äº”ä¸ªapi"><a href="http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html#_2-2-dva%E7%9A%84%E4%BA%94%E4%B8%AAapi" class="header-anchor">#</a> 2.2 Dvaçš„äº”ä¸ªAPI</h3> <p><img src="./dva_files/43.png" alt="img" class="medium-zoom-image"></p> <h4 id="_2-2-1-app-dva-opts"><a href="http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html#_2-2-1-app-dva-opts" class="header-anchor">#</a> 2.2.1 app = dva(Opts)</h4> <blockquote><p><code>app = dva(Opts)</code>ï¼šåˆ›å»ºåº”ç”¨ï¼Œè¿”å› <code>dva</code> å®ä¾‹ã€‚(æ³¨ï¼šdva æ”¯æŒå¤šå®ä¾‹)**</p></blockquote> <p>åœ¨<code>opts</code>å¯ä»¥é…ç½®æ‰€æœ‰çš„<code>hooks</code></p> <div class="language- extra-class"><pre class="language-text"><code>const app = dva({
     history,
     initialState,
     onError,
     onAction,
     onStateChange,
     onReducer,
     onEffect,
     onHmr,
     extraReducers,
     extraEnhancers,
});
</code></pre></div><blockquote><p>hooksåŒ…å«å¦‚ä¸‹é…ç½®é¡¹</p></blockquote> <p>1ã€ <code>onError((err, dispatch) =&gt; {})</code></p> <ul><li><code>effect</code> æ‰§è¡Œé”™è¯¯æˆ– <code>subscription</code> é€šè¿‡<code>done</code> ä¸»åŠ¨æŠ›é”™æ—¶è§¦å‘ï¼Œå¯ç”¨äºç®¡ç†å…¨å±€å‡ºé”™çŠ¶æ€</li> <li>æ³¨æ„ï¼š<code>subscription</code> å¹¶æ²¡æœ‰åŠ  <code>try...catch</code>ï¼Œæ‰€ä»¥æœ‰é”™è¯¯æ—¶éœ€é€šè¿‡ç¬¬äºŒä¸ªå‚æ•° <code>done</code> ä¸»åŠ¨æŠ›é”™</li></ul> <div class="language- extra-class"><pre class="language-text"><code>app.model({
  subscriptions: {
    setup({ dispatch }, done) {
      done(e)
    },
  },
})
</code></pre></div><p>2ã€ <code>onAction(fn | fn[])</code></p> <blockquote><p>åœ¨<code>action</code>è¢«<code>dispatch</code>æ—¶è§¦å‘ï¼Œç”¨äºæ³¨å†Œ <code>redux</code> ä¸­é—´ä»¶ã€‚æ”¯æŒå‡½æ•°æˆ–å‡½æ•°æ•°ç»„æ ¼å¼</p></blockquote> <ul><li>ä¾‹å¦‚æˆ‘ä»¬è¦é€šè¿‡ <code>redux-logger</code> æ‰“å°æ—¥å¿—</li></ul> <div class="language- extra-class"><pre class="language-text"><code>import createLogger from 'redux-logger';
const app = dva({
  onAction: createLogger(opts),
})
</code></pre></div><p>3ã€ <code>onStateChange(fn)</code></p> <blockquote><p><code>state</code> æ”¹å˜æ—¶è§¦å‘ï¼Œå¯ç”¨äºåŒæ­¥ state åˆ° <code>localStorage</code>ï¼ŒæœåŠ¡å™¨ç«¯ç­‰</p></blockquote> <p>4ã€ <code>onReducer(fn)</code></p> <blockquote><p>å°è£… <code>reducer</code> æ‰§è¡Œï¼Œæ¯”å¦‚å€ŸåŠ© <code>redux-undo</code> å®ç° <code>redo/undo</code></p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>import undoable from 'redux-undo';
const app = dva({
  onReducer: reducer =&gt; {
    return (state, action) =&gt; {
      const undoOpts = {};
      const newState = undoable(reducer, undoOpts)(state, action);
      // ç”±äº dva åŒæ­¥äº† routing æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦æŠŠè¿™éƒ¨åˆ†è¿˜åŸ
      return { ...newState, routing: newState.present.routing };
    },
  },
})
</code></pre></div><p>5ã€ <code>onEffect(fn)</code></p> <blockquote><p>å°è£… <code>effect</code> æ‰§è¡Œã€‚æ¯”å¦‚ <code>dva-loading</code> åŸºäºæ­¤å®ç°äº†è‡ªåŠ¨å¤„ç† <code>loading</code> çŠ¶æ€</p></blockquote> <p>6ã€ <code>onHmr(fn)</code></p> <blockquote><p>çƒ­æ›¿æ¢ç›¸å…³ï¼Œç›®å‰ç”¨äº <code>babel-plugin-dva-hmr</code></p></blockquote> <p>7ã€ <code>extraReducers</code></p> <blockquote><p>æŒ‡å®šé¢å¤–çš„ <code>reducer</code>ï¼Œæ¯”å¦‚ <code>redux-form</code> éœ€è¦æŒ‡å®šé¢å¤–çš„ <code>form reducer</code></p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>import { reducer as formReducer } from 'redux-form'
const app = dva({
  extraReducers: {
    form: formReducer,
  },
})
</code></pre></div><blockquote><p>è¿™é‡Œæ¯”è¾ƒå¸¸ç”¨çš„æ˜¯ï¼Œ<code>history</code>çš„é…ç½®ï¼Œä¸€èˆ¬é»˜è®¤çš„æ˜¯<code>hashHistory</code>ï¼Œå¦‚æœè¦é…ç½® <code>history</code>ä¸º <code>browserHistory</code>ï¼Œå¯ä»¥è¿™æ ·</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>import createHistory from 'history/createBrowserHistory';
const app = dva({
  history: createHistory(),
});
</code></pre></div><blockquote><div class="language- extra-class"><pre class="language-text"><code>initialState`ï¼šæŒ‡å®šåˆå§‹æ•°æ®ï¼Œä¼˜å…ˆçº§é«˜äº `model` ä¸­çš„ `state`ï¼Œé»˜è®¤æ˜¯ `{}`ï¼Œä½†æ˜¯åŸºæœ¬ä¸Šéƒ½åœ¨`modal`é‡Œé¢è®¾ç½®ç›¸åº”çš„`state
</code></pre></div></blockquote> <h4 id="_2-2-2-app-use-hooks"><a href="http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html#_2-2-2-app-use-hooks" class="header-anchor">#</a> 2.2.2 app.use(Hooks)</h4> <blockquote><p>app.use(Hooks)ï¼šé…ç½® hooks æˆ–è€…æ³¨å†Œæ’ä»¶</p></blockquote> <p>è¿™é‡Œæœ€å¸¸è§çš„å°±æ˜¯<code>dva-loading</code>æ’ä»¶çš„é…ç½®</p> <div class="language- extra-class"><pre class="language-text"><code>import createLoading from 'dva-loading';
...
app.use(createLoading(opts));
</code></pre></div><blockquote><p>ä½†æ˜¯ä¸€èˆ¬å¯¹äºå…¨å±€çš„<code>loading</code>æˆ‘ä»¬ä¼šæ ¹æ®ä¸šåŠ¡çš„ä¸åŒæ¥æ˜¾ç¤ºç›¸åº”ä¸åŒçš„<code>loading</code>å›¾æ ‡ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦æ¥é€‰æ‹©æ³¨å†Œç›¸åº”çš„æ’ä»¶</p></blockquote> <h4 id="_2-2-3-app-model-modelobject"><a href="http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html#_2-2-3-app-model-modelobject" class="header-anchor">#</a> 2.2.3 app.model(ModelObject)</h4> <blockquote><p><code>app.model(ModelObject)</code>ï¼šè¿™ä¸ªæ˜¯ä½ æ•°æ®é€»è¾‘å¤„ç†ï¼Œæ•°æ®æµåŠ¨çš„åœ°æ–¹</p></blockquote> <p><img src="./dva_files/44.png" alt="img" class="medium-zoom-image"></p> <h4 id="_2-2-4-app-unmodel-namespace"><a href="http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html#_2-2-4-app-unmodel-namespace" class="header-anchor">#</a> 2.2.4 app.unmodel(namespace)</h4> <blockquote><p>å–æ¶ˆ <code>model</code> æ³¨å†Œï¼Œæ¸…ç† <code>reducers</code>,<code>effects</code> å’Œ <code>subscriptions</code>ã€‚<code>subscription</code> å¦‚æœæ²¡æœ‰è¿”å› <code>unlisten</code> å‡½æ•°ï¼Œä½¿ç”¨ <code>app.unmodel</code> ä¼šç»™äºˆè­¦å‘Š</p></blockquote> <h4 id="_2-2-5-app-router-function"><a href="http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html#_2-2-5-app-router-function" class="header-anchor">#</a> 2.2.5 app.router(Function)</h4> <blockquote><p>æ³¨å†Œè·¯ç”±è¡¨ï¼Œè¿™ä¸€æ“ä½œæ­¥éª¤åœ¨dvaä¸­ä¹Ÿå¾ˆé‡è¦</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>// æ³¨å†Œè·¯ç”±
app.router(require('./router'))


// è·¯ç”±æ–‡ä»¶
import { Router, Route } from 'dva/router';
import IndexPage from './routes/IndexPage'
import TodoList from './routes/TodoList'

function RouterConfig({ history }) {
  return (
    &lt;Router history={history}&gt;
        &lt;Route path="/" component={IndexPage} /&gt;
        &lt;Route path='/todoList' components={TodoList}/&gt;
    &lt;/Router&gt;
  )
}
export default RouterConfig
</code></pre></div><blockquote><p>å¦‚æœæˆ‘ä»¬æƒ³è§£å†³ç»„ä»¶åŠ¨æ€åŠ è½½é—®é¢˜ï¼Œæˆ‘ä»¬çš„è·¯ç”±æ–‡ä»¶ä¹Ÿå¯ä»¥æŒ‰ç…§ä¸‹é¢çš„å†™æ³•æ¥å†™</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>import { Router, Switch, Route } from 'dva/router'
import dynamic from 'dva/dynamic'

function RouterConfig({ history, app }) {
  const IndexPage = dynamic({
    app,
    component: () =&gt; import('./routes/IndexPage'),
  })

  const Users = dynamic({
    app,
    models: () =&gt; [import('./models/users')],
    component: () =&gt; import('./routes/Users'),
  })

  return (
    &lt;Router history={history}&gt;
      &lt;Switch&gt;
        &lt;Route exact path="/" component={IndexPage} /&gt;
        &lt;Route exact path="/users" component={Users} /&gt;
      &lt;/Switch&gt;
    &lt;/Router&gt;
  )
}

export default RouterConfig
</code></pre></div><blockquote><p>å…¶ä¸­<code>dynamic(opts)</code> ä¸­<code>opt</code>åŒ…å«ä¸‰ä¸ªé…ç½®é¡¹ï¼š</p></blockquote> <ul><li><code>app</code>: <code>dva</code> å®ä¾‹ï¼ŒåŠ è½½ <code>models</code> æ—¶éœ€è¦</li> <li><code>models</code>: è¿”å› <code>Promise</code> æ•°ç»„çš„å‡½æ•°ï¼Œ<code>Promise</code>è¿”å› dva model`</li> <li><code>component</code>ï¼šè¿”å› <code>Promise</code>çš„å‡½æ•°ï¼Œ<code>Promise</code>è¿”å› <code>React Component</code></li></ul> <h4 id="_2-2-6-app-start"><a href="http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html#_2-2-6-app-start" class="header-anchor">#</a> 2.2.6 app.start</h4> <blockquote><p>å¯åŠ¨åº”ç”¨ï¼Œå³å°†æˆ‘ä»¬çš„åº”ç”¨è·‘èµ·æ¥</p></blockquote> <h3 id="_2-3-dvaä¹ä¸ªæ¦‚å¿µ"><a href="http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html#_2-3-dva%E4%B9%9D%E4%B8%AA%E6%A6%82%E5%BF%B5" class="header-anchor">#</a> 2.3 Dvaä¹ä¸ªæ¦‚å¿µ</h3> <h4 id="_2-3-1-state"><a href="http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html#_2-3-1-state" class="header-anchor">#</a> 2.3.1 State</h4> <blockquote><p>åˆå§‹å€¼ï¼Œæˆ‘ä»¬åœ¨ <code>dva()</code> åˆå§‹åŒ–çš„æ—¶å€™å’Œåœ¨ modal é‡Œé¢çš„ <code>state</code> å¯¹å…¶ä¸¤å¤„è¿›è¡Œå®šä¹‰ï¼Œå…¶ä¸­ modal ä¸­çš„ä¼˜å…ˆçº§ä½äºä¼ ç»™ <code>dva()</code> çš„ <code>opts.initialState</code></p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>// dva()åˆå§‹åŒ–
const app = dva({
  initialState: { count: 1 },
});

// modal()å®šä¹‰äº‹ä»¶
app.model({
  namespace: 'count',
  state: 0,
});
</code></pre></div><h4 id="_2-3-2-action"><a href="http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html#_2-3-2-action" class="header-anchor">#</a> 2.3.2 Action</h4> <blockquote><p>è¡¨ç¤ºæ“ä½œäº‹ä»¶ï¼Œå¯ä»¥æ˜¯åŒæ­¥ï¼Œä¹Ÿå¯ä»¥æ˜¯å¼‚æ­¥</p></blockquote> <ul><li><code>action</code> çš„æ ¼å¼å¦‚ä¸‹ï¼Œå®ƒéœ€è¦æœ‰ä¸€ä¸ª <code>type</code>ï¼Œè¡¨ç¤ºè¿™ä¸ª <code>action</code> è¦è§¦å‘ä»€ä¹ˆæ“ä½œï¼›<code>payload</code> åˆ™è¡¨ç¤ºè¿™ä¸ª <code>action</code> å°†è¦ä¼ é€’çš„æ•°æ®</li></ul> <div class="language- extra-class"><pre class="language-text"><code>{
  type: String,
  payload: data,
}
</code></pre></div><blockquote><p>æˆ‘ä»¬é€šè¿‡ dispatch æ–¹æ³•æ¥å‘é€ä¸€ä¸ª action</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>dispatch({ type: 'todos/add', payload: 'Learn Dva' });
</code></pre></div><blockquote><p>å…¶å®æˆ‘ä»¬å¯ä»¥æ„å»ºä¸€ä¸ªAction åˆ›å»ºå‡½æ•°ï¼Œå¦‚ä¸‹</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>function addTodo(text) {
  return {
    type: ADD_TODO,
    text
  }
}

//æˆ‘ä»¬ç›´æ¥dispatch(addTodo()),å°±å‘é€äº†ä¸€ä¸ªactionã€‚
dispatch(addTodo())
</code></pre></div><h4 id="_2-3-3-model"><a href="http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html#_2-3-3-model" class="header-anchor">#</a> 2.3.3 Model</h4> <blockquote><p><code>model</code> æ˜¯ <code>dva</code> ä¸­æœ€é‡è¦çš„æ¦‚å¿µï¼Œ<code>Model</code> é <code>MVC</code> ä¸­çš„ <code>M</code>ï¼Œè€Œæ˜¯é¢†åŸŸæ¨¡å‹ï¼Œç”¨äºæŠŠæ•°æ®ç›¸å…³çš„é€»è¾‘èšåˆåˆ°ä¸€èµ·ï¼Œå‡ ä¹æ‰€æœ‰çš„æ•°æ®ï¼Œé€»è¾‘éƒ½åœ¨è¿™è¾¹è¿›è¡Œå¤„ç†åˆ†å‘</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>import queryString from 'query-string'
import * as todoService from '../services/todo'

export default {
  namespace: 'todo',
  state: {
    list: []
  },
  reducers: {
    save(state, { payload: { list } }) {
      return { ...state, list }
    }
  },
  effects: {
    *addTodo({ payload: value }, { call, put, select }) {
      // æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚
      const data = yield call(todoService.query, value)
      console.log(data)
      let tempList = yield select(state =&gt; state.todo.list)
      let list = []
      list = list.concat(tempList)
      const tempObj = {}
      tempObj.title = value
      tempObj.id = list.length
      tempObj.finished = false
      list.push(tempObj)
      yield put({ type: 'save', payload: { list }})
    },
    *toggle({ payload: index }, { call, put, select }) {
      // æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚
      const data = yield call(todoService.query, index)
      let tempList = yield select(state =&gt; state.todo.list)
      let list = []
      list = list.concat(tempList)
      let obj = list[index]
      obj.finished = !obj.finished
      yield put({ type: 'save', payload: { list } })
    },
    *delete({ payload: index }, { call, put, select }) {
      const data = yield call(todoService.query, index)
      let tempList = yield select(state =&gt; state.todo.list)
      let list = []
      list = list.concat(tempList)
      list.splice(index, 1)
      yield put({ type: 'save', payload: { list } })
    },
    *modify({ payload: { value, index } }, { call, put, select }) {
      const data = yield call(todoService.query, value)
      let tempList = yield select(state =&gt; state.todo.list)
      let list = []
      list = list.concat(tempList)
      let obj = list[index]
      obj.title = value
      yield put({ type: 'save', payload: { list } })
    }
  },
  subscriptions: {
    setup({ dispatch, history }) {
      // ç›‘å¬è·¯ç”±çš„å˜åŒ–ï¼Œè¯·æ±‚é¡µé¢æ•°æ®
      return history.listen(({ pathname, search }) =&gt; {
        const query = queryString.parse(search)
        let list = []
        if (pathname === 'todoList') {
          dispatch({ type: 'save', payload: {list} })
        }
      })
    }
  }
}
</code></pre></div><blockquote><p><code>model</code>å¯¹è±¡ä¸­åŒ…å«5ä¸ªé‡è¦çš„å±æ€§</p></blockquote> <p><strong>state</strong></p> <blockquote><p>è¿™é‡Œçš„ state è·Ÿæˆ‘ä»¬åˆšåˆšè®²çš„ state çš„æ¦‚å¿µæ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡å¥¹çš„ä¼˜å…ˆçº§æ¯”åˆå§‹åŒ–çš„ä½ï¼Œä½†æ˜¯åŸºæœ¬ä¸Šé¡¹ç›®ä¸­çš„ state éƒ½æ˜¯åœ¨è¿™é‡Œå®šä¹‰çš„</p></blockquote> <p><strong>namespace</strong></p> <blockquote><div class="language- extra-class"><pre class="language-text"><code>model` çš„å‘½åç©ºé—´ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä»–åœ¨å…¨å±€ `state` ä¸Šçš„å±æ€§ï¼Œåªèƒ½ç”¨å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬å‘é€åœ¨å‘é€ `action` åˆ°ç›¸åº”çš„ `reducer` æ—¶ï¼Œå°±ä¼šéœ€è¦ç”¨åˆ° `namespace
</code></pre></div></blockquote> <p><strong>Reducer</strong></p> <blockquote><p>ä»¥<code>key/value</code> æ ¼å¼å®šä¹‰ <code>reducer</code>ï¼Œç”¨äºå¤„ç†åŒæ­¥æ“ä½œï¼Œå”¯ä¸€å¯ä»¥ä¿®æ”¹ <code>state</code> çš„åœ°æ–¹ã€‚ç”± <code>action</code> è§¦å‘ã€‚å…¶å®ä¸€ä¸ªçº¯å‡½æ•°</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>namespace: 'todo',
  state: {
    list: []
  },
  // reducers å†™æ³•
  reducers: {
    save(state, { payload: { list } }) {
      return { ...state, list }
    }
 }
</code></pre></div><p><strong>Effect</strong></p> <blockquote><p>ç”¨äºå¤„ç†å¼‚æ­¥æ“ä½œå’Œä¸šåŠ¡é€»è¾‘ï¼Œä¸ç›´æ¥ä¿®æ”¹ <code>state</code>ï¼Œç®€å•çš„æ¥è¯´ï¼Œå°±æ˜¯è·å–ä»æœåŠ¡ç«¯è·å–æ•°æ®ï¼Œå¹¶ä¸”å‘èµ·ä¸€ä¸ª <code>action</code>äº¤ç»™<code>reducer</code> çš„åœ°æ–¹</p></blockquote> <p>å…¶ä¸­å®ƒç”¨åˆ°äº†<code>redux-saga</code>ï¼Œé‡Œé¢æœ‰å‡ ä¸ªå¸¸ç”¨çš„å‡½æ•°ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>// effects å†™æ³•
effects: {
    *addTodo({ payload: value }, { call, put, select }) {
      // æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚
      const data = yield call(todoService.query, value)
      console.log(data)
      let tempList = yield select(state =&gt; state.todo.list)
      let list = []
      list = list.concat(tempList)
      const tempObj = {}
      tempObj.title = value
      tempObj.id = list.length
      tempObj.finished = false
      list.push(tempObj)
      yield put({ type: 'save', payload: { list }})
    },
    *toggle({ payload: index }, { call, put, select }) {
      // æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚
      const data = yield call(todoService.query, index)
      let tempList = yield select(state =&gt; state.todo.list)
      let list = []
      list = list.concat(tempList)
      let obj = list[index]
      obj.finished = !obj.finished
      yield put({ type: 'save', payload: { list } })
    },
    *delete({ payload: index }, { call, put, select }) {
      const data = yield call(todoService.query, index)
      let tempList = yield select(state =&gt; state.todo.list)
      let list = []
      list = list.concat(tempList)
      list.splice(index, 1)
      yield put({ type: 'save', payload: { list } })
    },
    *modify({ payload: { value, index } }, { call, put, select }) {
      const data = yield call(todoService.query, value)
      let tempList = yield select(state =&gt; state.todo.list)
      let list = []
      list = list.concat(tempList)
      let obj = list[index]
      obj.title = value
      yield put({ type: 'save', payload: { list } })
    }
}
</code></pre></div><p><img src="./dva_files/1505342-9ecb8ba2d8fd3ec2.png" alt="img" class="medium-zoom-image"></p> <blockquote><p>åœ¨é¡¹ç›®ä¸­æœ€ä¸»è¦çš„ä¼šç”¨åˆ°çš„æ˜¯ <code>put</code> ä¸ <code>call</code></p></blockquote> <p><strong>Subscription</strong></p> <blockquote><ul><li>ä»¥ <code>key/value</code> æ ¼å¼å®šä¹‰ <code>subscription</code>ï¼Œ<code>subscription</code> æ˜¯è®¢é˜…ï¼Œç”¨äºè®¢é˜…ä¸€ä¸ªæ•°æ®æºï¼Œç„¶åæ ¹æ®éœ€è¦ dispatch ç›¸åº”çš„ action</li> <li><code>subscription</code> æ˜¯è®¢é˜…ï¼Œç”¨äºè®¢é˜…ä¸€ä¸ªæ•°æ®æºï¼Œç„¶åæ ¹æ®éœ€è¦ <code>dispatch</code> ç›¸åº”çš„<code>action</code>ã€‚åœ¨ <code>app.start()</code> æ—¶è¢«æ‰§è¡Œï¼Œæ•°æ®æºå¯ä»¥æ˜¯å½“å‰çš„æ—¶é—´ã€å½“å‰é¡µé¢çš„<code>url</code>ã€æœåŠ¡å™¨çš„ <code>websocket</code> è¿æ¥ã€<code>history</code>è·¯ç”±å˜åŒ–ç­‰ç­‰ã€‚</li></ul></blockquote> <ul><li><strong>æ³¨æ„</strong>ï¼šå¦‚æœè¦ä½¿ç”¨ <code>app.unmodel()</code>ï¼Œ<code>subscription</code> å¿…é¡»è¿”å› <code>unlisten</code> æ–¹æ³•ï¼Œç”¨äºå–æ¶ˆæ•°æ®è®¢é˜…</li></ul> <div class="language- extra-class"><pre class="language-text"><code>// subscriptions å†™æ³•
subscriptions: {
    setup({ dispatch, history }) {
      // ç›‘å¬è·¯ç”±çš„å˜åŒ–ï¼Œè¯·æ±‚é¡µé¢æ•°æ®
      return history.listen(({ pathname, search }) =&gt; {
        const query = queryString.parse(search)
        let list = []
        if (pathname === 'todoList') {
          dispatch({ type: 'save', payload: {list} })
        }
      })
    }
  }
</code></pre></div><h4 id="_2-3-4-router"><a href="http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html#_2-3-4-router" class="header-anchor">#</a> 2.3.4 Router</h4> <blockquote><div class="language- extra-class"><pre class="language-text"><code>Router` è¡¨ç¤ºè·¯ç”±é…ç½®ä¿¡æ¯ï¼Œé¡¹ç›®ä¸­çš„ `router.js
</code></pre></div></blockquote> <div class="language- extra-class"><pre class="language-text"><code>export default function({ history }){
  return(
    &lt;Router history={history}&gt;
      &lt;Route path="/" component={App} /&gt;
    &lt;/Router&gt;
  );
}
</code></pre></div><p><strong>RouteComponent</strong></p> <blockquote><p><code>RouteComponent</code> è¡¨ç¤º<code>Router</code> é‡ŒåŒ¹é…è·¯å¾„çš„ <code>Component</code>ï¼Œé€šå¸¸ä¼šç»‘å®š<code>model</code>çš„æ•°æ®ã€‚å¦‚ä¸‹:</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>import { connect } from 'dva';

function App() {
  return &lt;div&gt;App&lt;/div&gt;;
}

function mapStateToProps(state) {
  return { todos: state.todos };
}

export default connect(mapStateToProps)(App);
</code></pre></div><h3 id="_2-4-æ•´ä½“æ¶æ„"><a href="http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html#_2-4-%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84" class="header-anchor">#</a> 2.4 æ•´ä½“æ¶æ„</h3> <p><img src="./dva_files/45.png" alt="img" class="medium-zoom-image"></p> <ul><li>é¦–å…ˆæˆ‘ä»¬æ ¹æ® <code>url</code> è®¿é—®ç›¸å…³çš„ <code>Route-Component</code>ï¼Œåœ¨ç»„ä»¶ä¸­æˆ‘ä»¬é€šè¿‡ <code>dispatch</code>å‘é€ <code>action</code> åˆ° <code>model</code> é‡Œé¢çš„ <code>effect</code> æˆ–è€…ç›´æ¥ <code>Reducer</code></li> <li>å½“æˆ‘ä»¬å°†<code>action</code>å‘é€ç»™<code>Effect</code>ï¼ŒåŸºæœ¬ä¸Šæ˜¯å–æœåŠ¡å™¨ä¸Šé¢è¯·æ±‚æ•°æ®çš„ï¼ŒæœåŠ¡å™¨è¿”å›æ•°æ®ä¹‹åï¼Œ<code>effect</code> ä¼šå‘é€ç›¸åº”çš„ <code>action</code>ç»™ <code>reducer</code>ï¼Œç”±å”¯ä¸€èƒ½æ”¹å˜ <code>state</code>çš„ <code>reducer</code> æ”¹å˜ <code>state</code> ï¼Œç„¶åé€šè¿‡<code>connect</code>é‡æ–°æ¸²æŸ“ç»„ä»¶ã€‚</li> <li>å½“æˆ‘ä»¬å°†<code>action</code>å‘é€ç»™<code>reducer</code>ï¼Œé‚£ç›´æ¥ç”± <code>reducer</code> æ”¹å˜ <code>state</code>ï¼Œç„¶åé€šè¿‡<code>connect</code>é‡æ–°æ¸²æŸ“ç»„ä»¶</li></ul> <h3 id="_2-5-dvaå›¾è§£"><a href="http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html#_2-5-dva%E5%9B%BE%E8%A7%A3" class="header-anchor">#</a> 2.5 Dvaå›¾è§£</h3> <p><strong>å›¾è§£ä¸€ï¼šåŠ å…¥Saga</strong></p> <blockquote><div class="language- extra-class"><pre class="language-text"><code>React` åªè´Ÿè´£é¡µé¢æ¸²æŸ“, è€Œä¸è´Ÿè´£é¡µé¢é€»è¾‘, é¡µé¢é€»è¾‘å¯ä»¥ä»ä¸­å•ç‹¬æŠ½å–å‡ºæ¥, å˜æˆ `store
</code></pre></div></blockquote> <p><img src="./dva_files/46.png" alt="img" class="medium-zoom-image"></p> <blockquote><p>ä½¿ç”¨ <code>Middleware</code> æ‹¦æˆª <code>action</code>, è¿™æ ·ä¸€æ¥å¼‚æ­¥çš„ç½‘ç»œæ“ä½œä¹Ÿå°±å¾ˆæ–¹ä¾¿äº†, åšæˆä¸€ä¸ª <code>Middleware</code>å°±è¡Œäº†, è¿™é‡Œä½¿ç”¨<code>redux-saga</code> è¿™ä¸ªç±»åº“</p></blockquote> <ul><li>ç‚¹å‡»åˆ›å»º <code>Todo</code>çš„æŒ‰é’®, å‘èµ·ä¸€ä¸ª <code>type == addTodo</code> çš„ <code>action</code></li> <li><code>saga</code> æ‹¦æˆªè¿™ä¸ª <code>action</code>, å‘èµ· <code>http</code> è¯·æ±‚, å¦‚æœè¯·æ±‚æˆåŠŸ, åˆ™ç»§ç»­å‘ <code>reducer</code> å‘ä¸€ä¸ª <code>type == addTodoSucc</code> çš„ <code>action</code>, æç¤ºåˆ›å»ºæˆåŠŸ, åä¹‹åˆ™å‘é€ <code>type == addTodoFail</code> çš„<code>action</code> å³å¯</li></ul> <p><strong>å›¾è§£äºŒï¼šDvaè¡¨ç¤ºæ³•</strong></p> <p><img src="./dva_files/47.png" alt="img" class="medium-zoom-image"></p> <blockquote><p>dvaåšäº† 3 ä»¶å¾ˆé‡è¦çš„äº‹æƒ…</p></blockquote> <ul><li>æŠŠ <code>store</code>åŠ <code>saga</code> ç»Ÿä¸€ä¸ºä¸€ä¸ª <code>model</code> çš„æ¦‚å¿µ, å†™åœ¨ä¸€ä¸ª js æ–‡ä»¶é‡Œé¢</li> <li>å¢åŠ äº†ä¸€ä¸ª <code>Subscriptions</code>, ç”¨äºæ”¶é›†å…¶ä»–æ¥æºçš„ <code>action</code>, eg: é”®ç›˜æ“ä½œ</li> <li><code>model</code> å†™æ³•å¾ˆç®€çº¦, ç±»ä¼¼äº <code>DSL</code> æˆ–è€… <code>RoR</code></li></ul> <h2 id="ä¸‰ã€è®¡æ•°å™¨ä¾‹å­"><a href="http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html#%E4%B8%89%E3%80%81%E8%AE%A1%E6%95%B0%E5%99%A8%E4%BE%8B%E5%AD%90" class="header-anchor">#</a> ä¸‰ã€è®¡æ•°å™¨ä¾‹å­</h2> <div class="language- extra-class"><pre class="language-text"><code>$ dva new myapp
</code></pre></div><p><strong>ç›®å½•ç»“æ„ä»‹ç»</strong></p> <div class="language- extra-class"><pre class="language-text"><code>.
â”œâ”€â”€ mock    // mockæ•°æ®æ–‡ä»¶å¤¹
â”œâ”€â”€ node_modules // ç¬¬ä¸‰æ–¹çš„ä¾èµ–
â”œâ”€â”€ public  // å­˜æ”¾å…¬å…±publicæ–‡ä»¶çš„æ–‡ä»¶å¤¹
â”œâ”€â”€ src  // æœ€é‡è¦çš„æ–‡ä»¶å¤¹ï¼Œç¼–å†™ä»£ç éƒ½åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹
â”‚   â”œâ”€â”€ assets // å¯ä»¥æ”¾å›¾ç‰‡ç­‰å…¬å…±èµ„æº
â”‚   â”œâ”€â”€ components // å°±æ˜¯reactä¸­çš„æœ¨å¶ç»„ä»¶
â”‚   â”œâ”€â”€ models // dvaæœ€é‡è¦çš„æ–‡ä»¶å¤¹ï¼Œæ‰€æœ‰çš„æ•°æ®äº¤äº’åŠé€»è¾‘éƒ½å†™åœ¨è¿™é‡Œ
â”‚   â”œâ”€â”€ routes // å°±æ˜¯reactä¸­çš„æ™ºèƒ½ç»„ä»¶ï¼Œä¸è¦è¢«æ–‡ä»¶å¤¹åå­—è¯¯å¯¼ã€‚
â”‚   â”œâ”€â”€ services // æ”¾è¯·æ±‚å€Ÿå£æ–¹æ³•çš„æ–‡ä»¶å¤¹
â”‚   â”œâ”€â”€ utils // è‡ªå·±çš„å·¥å…·æ–¹æ³•å¯ä»¥æ”¾åœ¨è¿™è¾¹
â”‚   â”œâ”€â”€ index.css // å…¥å£æ–‡ä»¶æ ·å¼
â”‚   â”œâ”€â”€ index.ejs // ejsæ¨¡æ¿å¼•æ“
â”‚   â”œâ”€â”€ index.js // å…¥å£æ–‡ä»¶
â”‚   â””â”€â”€ router.js // é¡¹ç›®çš„è·¯ç”±æ–‡ä»¶
â”œâ”€â”€ .eslintrc // bowerå®‰è£…ç›®å½•çš„é…ç½®
â”œâ”€â”€ .editorconfig // ä¿è¯ä»£ç åœ¨ä¸åŒç¼–è¾‘å™¨å¯è§†åŒ–çš„å·¥å…·
â”œâ”€â”€ .gitignore // gitä¸Šä¼ æ—¶å¿½ç•¥çš„æ–‡ä»¶
â”œâ”€â”€ .roadhogrc.js // é¡¹ç›®çš„é…ç½®æ–‡ä»¶ï¼Œé…ç½®æ¥å£è½¬å‘ï¼Œcss_moduleç­‰éƒ½åœ¨è¿™è¾¹ã€‚
â”œâ”€â”€ .roadhogrc.mock.js // é¡¹ç›®çš„é…ç½®æ–‡ä»¶
â””â”€â”€ package.json // å½“å‰æ•´ä¸€ä¸ªé¡¹ç›®çš„ä¾èµ–
</code></pre></div><p><strong>é¦–å…ˆæ˜¯å‰ç«¯çš„é¡µé¢ï¼Œæˆ‘ä»¬ä½¿ç”¨ class å½¢å¼æ¥åˆ›å»ºç»„ä»¶ï¼ŒåŸä¾‹å­ä¸­æ˜¯ä½¿ç”¨æ— çŠ¶æ€æ¥åˆ›å»ºçš„ã€‚react åˆ›å»ºç»„ä»¶çš„å„ç§æ–¹å¼ï¼Œå¤§å®¶å¯ä»¥çœ‹<a href="http://www.cnblogs.com/wonyun/p/5930333.html" target="_blank" rel="noopener noreferrer">Reactåˆ›å»ºç»„ä»¶çš„ä¸‰ç§æ–¹å¼åŠå…¶åŒºåˆ«<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong></p> <blockquote><p>æˆ‘ä»¬å…ˆä¿®æ”¹<code>route/IndexPage.js</code></p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>import React from 'react';
import { connect } from 'dva';
import styles from './IndexPage.css';

class IndexPage extends React.Component {
  render() {
    const { dispatch } = this.props;

    return (
      &lt;div className={styles.normal}&gt;
        &lt;div className={styles.record}&gt;Highest Record: 1&lt;/div&gt;
        &lt;div className={styles.current}&gt;2&lt;/div&gt;
        &lt;div className={styles.button}&gt;
          &lt;button onClick={() =&gt; {}}&gt;+&lt;/button&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    );
  }
}

export default connect()(IndexPage);
</code></pre></div><blockquote><p>åŒæ—¶ä¿®æ”¹æ ·å¼<code>routes/IndexPage.css</code></p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>.normal {
  width: 200px;
  margin: 100px auto;
  padding: 20px;
  border: 1px solid #ccc;
  box-shadow: 0 0 20px #ccc;
}
.record {
  border-bottom: 1px solid #ccc;
  padding-bottom: 8px;
  color: #ccc;
}
.current {
  text-align: center;
  font-size: 40px;
  padding: 40px 0;
}
.button {
  text-align: center;
  button {
    width: 100px;
    height: 40px;
    background: #aaa;
    color: #fff;
  }
}
</code></pre></div><blockquote><p>åœ¨ <code>model</code> å¤„ç†<code>state</code>ï¼Œåœ¨é¡µé¢é‡Œé¢è¾“å‡º <code>model</code> ä¸­çš„ <code>state</code></p></blockquote> <ul><li>é¦–å…ˆæˆ‘ä»¬åœ¨index.jsä¸­å°†<code>models/example.js</code>ï¼Œå³å°†modelä¸‹ä¸€è¡Œçš„çš„æ³¨é‡Šæ‰“å¼€</li></ul> <div class="language- extra-class"><pre class="language-text"><code>import dva from 'dva';
import './index.css';

// 1. Initialize
const app = dva();

// 2. Plugins
// app.use({});

// 3. Model
app.model(require('./models/example')); // æ‰“å¼€æ³¨é‡Š

// 4. Router
app.router(require('./router'));

// 5. Start
app.start('#root');
</code></pre></div><blockquote><p>æ¥ä¸‹æ¥æˆ‘ä»¬è¿›å…¥ <code>models/example.js</code>ï¼Œå°†<code>namespace</code> åå­—æ”¹ä¸º <code>count</code>ï¼Œ<code>state</code>å¯¹è±¡åŠ ä¸Š <code>record</code> ä¸ <code>current</code> å±æ€§ã€‚å¦‚ä¸‹</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>export default {
  namespace: 'count',
  state: {
    record: 0,
    current: 0,
  },
  ...
};
</code></pre></div><blockquote><p>æ¥ç€æˆ‘ä»¬æ¥åˆ° <code>routes/indexpage.js</code> é¡µé¢ï¼Œé€šè¿‡çš„ <code>mapStateToProps</code>å¼•å…¥ç›¸å…³çš„ <code>state</code></p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>import React from 'react';
import { connect } from 'dva';
import styles from './IndexPage.css';

class IndexPage extends React.Component {
  render() {
    const { dispatch, count } = this.props;
    
    return (
      &lt;div className={styles.normal}&gt;
        &lt;div className={styles.record}&gt;
         Highest Record: {count.record} // å°†countçš„recordè¾“å‡º
        &lt;/div&gt;
        &lt;div className={styles.current}&gt;
         {count.current}
        &lt;/div&gt;
        &lt;div className={styles.button}&gt;
          &lt;button onClick={() =&gt; {} } &gt;
                 +
          &lt;/button&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    );
  }
}

function mapStateToProps(state) {
  return { count: state.count };
} // è·å–state

export default connect(mapStateToProps)(IndexPage);
</code></pre></div><blockquote><p>é€šè¿‡ <code>+</code> å‘é€ <code>action</code>ï¼Œé€šè¿‡ <code>reducer</code> æ”¹å˜ç›¸åº”çš„ <code>state</code></p></blockquote> <ul><li>é¦–å…ˆæˆ‘ä»¬åœ¨ <code>models/example.js</code>ï¼Œå†™ç›¸åº”çš„ <code>reducer</code></li></ul> <div class="language- extra-class"><pre class="language-text"><code>export default {
  ...
  reducers: {
    add1(state) {
      const newCurrent = state.current + 1;
      return { ...state,
        record: newCurrent &gt; state.record ? newCurrent : state.record,
        current: newCurrent,
      };
    },
    minus(state) {
      return { ...state, current: state.current - 1 };
    },
  },
};
</code></pre></div><blockquote><p>åœ¨é¡µé¢çš„æ¨¡æ¿ <code>routes/IndexPage.js</code> ä¸­ <code>+</code> å·ç‚¹å‡»çš„æ—¶å€™ï¼Œ<code>dispatch</code>ä¸€ä¸ª <code>action</code></p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>import React from 'react';
import { connect } from 'dva';
import styles from './IndexPage.css';

class IndexPage extends React.Component {
  render() {
    const { dispatch, count } = this.props;
    return (
      &lt;div className={styles.normal}&gt;
        &lt;div className={styles.record}&gt;Highest Record: {count.record}&lt;/div&gt;
        &lt;div className={styles.current}&gt;{count.current}&lt;/div&gt;
        &lt;div className={styles.button}&gt;
          &lt;button 
+            onClick={() =&gt; { dispatch({ type: 'count/add1' });}
          }&gt;+&lt;/button&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    );
  }
}
function mapStateToProps(state) {
  return { count: state.count };
}

export default connect(mapStateToProps)(IndexPage);
</code></pre></div><blockquote><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥ä½¿ç”¨ <code>effect</code> æ¨¡æ‹Ÿä¸€ä¸ªæ•°æ®æ¥å£è¯·æ±‚ï¼Œè¿”å›ä¹‹åï¼Œé€šè¿‡ <code>yield put()</code> æ”¹å˜ç›¸åº”çš„ <code>state</code></p></blockquote> <ul><li>é¦–å…ˆæˆ‘ä»¬æ›¿æ¢ç›¸åº”çš„ <code>models/example.js</code> çš„ <code>effect</code></li></ul> <div class="language- extra-class"><pre class="language-text"><code>effects: {
    *add(action, { call, put }) {
      yield call(delay, 1000);
      yield put({ type: 'minus' });
    },
},
</code></pre></div><blockquote><p>è¿™é‡Œçš„ <code>delay</code>ï¼Œæ˜¯æˆ‘è¿™è¾¹å†™çš„ä¸€ä¸ªå»¶æ—¶çš„å‡½æ•°ï¼Œæˆ‘ä»¬åœ¨ <code>utils</code> é‡Œé¢ç¼–å†™ä¸€ä¸ª <code>utils.js</code> ï¼Œä¸€èˆ¬è¯·æ±‚æ¥å£çš„å‡½æ•°éƒ½ä¼šå†™åœ¨ <code>servers</code> æ–‡ä»¶å¤¹ä¸­</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>export function delay(timeout) {
  return new Promise((resolve) =&gt; {
    setTimeout(resolve, timeout);
  });
}
</code></pre></div><blockquote><p>è®¢é˜…è®¢é˜…é”®ç›˜äº‹ä»¶ï¼Œä½¿ç”¨ <code>subscriptions</code>ï¼Œå½“ç”¨æˆ·æŒ‰ä½ <code>command+up</code> æ—¶å€™è§¦å‘æ·»åŠ æ•°å­—çš„ <code>action</code></p></blockquote> <ul><li>åœ¨ <code>models/example.js</code> ä¸­ä½œå¦‚ä¸‹ä¿®æ”¹</li></ul> <div class="language- extra-class"><pre class="language-text"><code>+import key from 'keymaster';
...
app.model({
  namespace: 'count',
+ subscriptions: {
+   keyboardWatcher({ dispatch }) {
+     key('âŒ˜+up, ctrl+up', () =&gt; { dispatch({type:'add'}) });
+   },
+ },
});
</code></pre></div><ul><li>åœ¨è¿™é‡Œä½ éœ€è¦å®‰è£… <code>keymaster</code> è¿™ä¸ªä¾èµ–</li></ul> <div class="language- extra-class"><pre class="language-text"><code>npm install keymaster --save
</code></pre></div><ul><li>ç°åœ¨ä½ å¯ä»¥æŒ‰ä½ <code>command+up</code> å°±å¯ä»¥ä½¿ <code>current</code> åŠ 1</li></ul> <h2 id="å››ã€dvaå®è·µ"><a href="http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html#%E5%9B%9B%E3%80%81dva%E5%AE%9E%E8%B7%B5" class="header-anchor">#</a> å››ã€Dvaå®è·µ</h2> <h3 id="_4-1-æŠ½ç¦»model"><a href="http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html#_4-1-%E6%8A%BD%E7%A6%BBmodel" class="header-anchor">#</a> 4.1 æŠ½ç¦»Model</h3> <blockquote><p>æŠ½ç¦»<code>Model</code>ï¼Œæ ¹æ®è®¾è®¡é¡µé¢éœ€æ±‚ï¼Œè®¾è®¡ç›¸åº”çš„<code>Model</code></p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>// models/users.js
// version1: ä»æ•°æ®ç»´åº¦æŠ½å–ï¼Œæ›´é€‚ç”¨äºæ— çŠ¶æ€çš„æ•°æ®
// version2: ä»ä¸šåŠ¡çŠ¶æ€æŠ½å–ï¼Œå°†æ•°æ®ä¸ç»„ä»¶çš„ä¸šåŠ¡çŠ¶æ€ç»Ÿä¸€æŠ½ç¦»æˆä¸€ä¸ªmodel
// æ–°å¢éƒ¨åˆ†ä¸ºåœ¨æ•°æ®ç»´åº¦åŸºç¡€ä¸Šï¼Œæ”¹ä¸ºä»ä¸šåŠ¡çŠ¶æ€æŠ½å–è€Œæ·»åŠ çš„ä»£ç 
export default {
  namespace: 'users',
  state: {
    list: [],
    total: null,
+   loading: false, // æ§åˆ¶åŠ è½½çŠ¶æ€
+   current: null, // å½“å‰åˆ†é¡µä¿¡æ¯
+   currentItem: {}, // å½“å‰æ“ä½œçš„ç”¨æˆ·å¯¹è±¡
+   modalVisible: false, // å¼¹å‡ºçª—çš„æ˜¾ç¤ºçŠ¶æ€
+   modalType: 'create', // å¼¹å‡ºçª—çš„ç±»å‹ï¼ˆæ·»åŠ ç”¨æˆ·ï¼Œç¼–è¾‘ç”¨æˆ·ï¼‰
  },

    // å¼‚æ­¥æ“ä½œ
    effects: {
        *query(){},
        *create(){},
        *'delete'(){},   // å› ä¸ºdeleteæ˜¯å…³é”®å­—ï¼Œç‰¹æ®Šå¤„ç†
        *update(){},
    },

    // æ›¿æ¢çŠ¶æ€æ ‘
    reducers: {
+       showLoading(){}, // æ§åˆ¶åŠ è½½çŠ¶æ€çš„ reducer
+       showModel(){}, // æ§åˆ¶ Model æ˜¾ç¤ºçŠ¶æ€çš„ reducer
+       hideModel(){},
        querySuccess(){},
        createSuccess(){},
        deleteSuccess(){},
        updateSuccess(){},
    }
}
</code></pre></div><h3 id="_4-2-è®¾è®¡ç»„ä»¶"><a href="http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html#_4-2-%E8%AE%BE%E8%AE%A1%E7%BB%84%E4%BB%B6" class="header-anchor">#</a> 4.2 è®¾è®¡ç»„ä»¶</h3> <blockquote><p>å…ˆè®¾ç½®å®¹å™¨ç»„ä»¶çš„è®¿é—®è·¯å¾„ï¼Œå†åˆ›å»ºç»„ä»¶æ–‡ä»¶</p></blockquote> <h4 id="_4-2-1-å®¹å™¨ç»„ä»¶"><a href="http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html#_4-2-1-%E5%AE%B9%E5%99%A8%E7%BB%84%E4%BB%B6" class="header-anchor">#</a> 4.2.1 å®¹å™¨ç»„ä»¶</h4> <blockquote><p>å…·æœ‰ç›‘å¬æ•°æ®è¡Œä¸ºçš„ç»„ä»¶ï¼ŒèŒè´£æ˜¯ç»‘å®šç›¸å…³è”çš„ model æ•°æ®ï¼ŒåŒ…å«å­ç»„ä»¶ï¼›ä¼ å…¥çš„æ•°æ®æ¥æºäºmodel</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>import React, { Component, PropTypes } from 'react';

// dva çš„ connect æ–¹æ³•å¯ä»¥å°†ç»„ä»¶å’Œæ•°æ®å…³è”åœ¨ä¸€èµ·
import { connect } from 'dva';

// ç»„ä»¶æœ¬èº«
const MyComponent = (props)=&gt;{};

// propTypeså±æ€§ï¼Œç”¨äºé™åˆ¶propsçš„ä¼ å…¥æ•°æ®ç±»å‹
MyComponent.propTypes = {};

// å£°æ˜æ¨¡å‹ä¼ é€’å‡½æ•°ï¼Œç”¨äºå»ºç«‹ç»„ä»¶å’Œæ•°æ®çš„æ˜ å°„å…³ç³»
// å®é™…è¡¨ç¤º å°†ModelAè¿™ä¸€ä¸ªæ•°æ®æ¨¡å‹ï¼Œç»‘å®šåˆ°å½“å‰çš„ç»„ä»¶ä¸­ï¼Œåˆ™åœ¨å½“å‰ç»„ä»¶ä¸­ï¼Œéšæ—¶å¯ä»¥å–åˆ°ModelAçš„æœ€æ–°å€¼
// å¯ä»¥ç»‘å®šå¤šä¸ªModel
function mapStateToProps({ModelA}) {
  return {ModelA};
}

// å…³è” model
// æ­£å¼è°ƒç”¨æ¨¡å‹ä¼ é€’å‡½æ•°ï¼Œå®Œæˆæ¨¡å‹ç»‘å®š
export default connect(mapStateToProps)(MyComponent);
</code></pre></div><h4 id="_4-2-2-å±•ç¤ºç»„ä»¶"><a href="http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html#_4-2-2-%E5%B1%95%E7%A4%BA%E7%BB%84%E4%BB%B6" class="header-anchor">#</a> 4.2.2 å±•ç¤ºç»„ä»¶</h4> <blockquote><p>å±•ç¤ºé€šè¿‡ <code>props</code> ä¼ é€’åˆ°ç»„ä»¶å†…éƒ¨æ•°æ®ï¼›ä¼ å…¥çš„æ•°æ®æ¥æºäºå®¹å™¨ç»„ä»¶å‘å±•ç¤ºç»„ä»¶çš„<code>props</code></p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>import React, { Component, PropTypes } from 'react';

// ç»„ä»¶æœ¬èº«
// æ‰€éœ€è¦çš„æ•°æ®é€šè¿‡ Container Component é€šè¿‡ props ä¼ é€’ä¸‹æ¥
const MyComponent = (props)=&gt;{}
MyComponent.propTypes = {};

// å¹¶ä¸ä¼šç›‘å¬æ•°æ®
export default MyComponent;
</code></pre></div><h4 id="_4-2-3-è®¾ç½®è·¯ç”±"><a href="http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html#_4-2-3-%E8%AE%BE%E7%BD%AE%E8%B7%AF%E7%94%B1" class="header-anchor">#</a> 4.2.3 è®¾ç½®è·¯ç”±</h4> <div class="language- extra-class"><pre class="language-text"><code>// .src/router.js
import React, { PropTypes } from 'react';
import { Router, Route } from 'dva/router';
import Users from './routes/Users';

export default function({ history }) {
  return (
    &lt;Router history={history}&gt;
      &lt;Route path="/users" component={Users} /&gt;
    &lt;/Router&gt;
  );
};
</code></pre></div><p><strong>å®¹å™¨ç»„ä»¶é›å½¢</strong></p> <div class="language- extra-class"><pre class="language-text"><code>// .src/routes/Users.jsx
import React, { PropTypes } from 'react';

function Users() {
  return (
    &lt;div&gt;User Router Component&lt;/div&gt;
  );
}

export default Users;
</code></pre></div><h4 id="_4-2-4-è®¾è®¡å®¹å™¨ç»„ä»¶"><a href="http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html#_4-2-4-%E8%AE%BE%E8%AE%A1%E5%AE%B9%E5%99%A8%E7%BB%84%E4%BB%B6" class="header-anchor">#</a> 4.2.4 è®¾è®¡å®¹å™¨ç»„ä»¶</h4> <blockquote><p>è‡ªé¡¶å‘ä¸‹çš„è®¾è®¡æ–¹æ³•ï¼šå…ˆè®¾è®¡å®¹å™¨ç»„ä»¶ï¼Œå†é€æ­¥ç»†åŒ–å†…éƒ¨çš„å±•ç¤ºå®¹å™¨</p></blockquote> <p>ç»„ä»¶çš„å®šä¹‰æ–¹å¼</p> <div class="language- extra-class"><pre class="language-text"><code>// æ–¹æ³•ä¸€ï¼š es6 çš„å†™æ³•ï¼Œå½“ç»„ä»¶è®¾è®¡reactç”Ÿå‘½å‘¨æœŸæ—¶ï¼Œå¯é‡‡ç”¨è¿™ç§å†™æ³•
// å…·æœ‰ç”Ÿå‘½å‘¨æœŸçš„ç»„ä»¶ï¼Œå¯ä»¥åœ¨æ¥æ”¶åˆ°ä¼ å…¥æ•°æ®å˜åŒ–æ—¶ï¼Œè‡ªå®šä¹‰æ‰§è¡Œæ–¹æ³•ï¼Œæœ‰è‡ªå·±çš„è¡Œä¸ºæ¨¡å¼
// æ¯”å¦‚åœ¨ç»„ä»¶ç”Ÿæˆåè°ƒç”¨xxè¯·æ±‚(componentDidMount)ã€å¯ä»¥è‡ªå·±å†³å®šè¦ä¸è¦æ›´æ–°æ¸²æŸ“(shouldComponentUpdate)ç­‰
class App extends React.Component({});

// æ–¹æ³•äºŒï¼š stateless çš„å†™æ³•ï¼Œå®šä¹‰æ— çŠ¶æ€ç»„ä»¶
// æ— çŠ¶æ€ç»„ä»¶ï¼Œä»…ä»…æ ¹æ®ä¼ å…¥çš„æ•°æ®æ›´æ–°ï¼Œä¿®æ”¹è‡ªå·±çš„æ¸²æŸ“å†…å®¹
const App = (props) =&gt; ({});
</code></pre></div><p>å®¹å™¨ç»„ä»¶ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>// ./src/routes/Users.jsx
import React, { Component, PropTypes } from 'react';

// å¼•å…¥å±•ç¤ºç»„ä»¶ ï¼ˆæš‚æ—¶éƒ½æ²¡å®ç°ï¼‰
import UserList from '../components/Users/UserList';
import UserSearch from '../components/Users/UserSearch';
import UserModal from '../components/Users/UserModal';

// å¼•å…¥cssæ ·å¼è¡¨
import styles from './style.less'

function Users() {

  // å‘userListPropsä¸­ä¼ å…¥é™æ€æ•°æ®
  const userSearchProps = {};
  const userListProps = {
    total: 3,
    current: 1,
    loading: false,
    dataSource: [
      {
        name: 'å¼ ä¸‰',
        age: 23,
        address: 'æˆéƒ½',
      },
      {
        name: 'æå››',
        age: 24,
        address: 'æ­å·',
      },
      {
        name: 'ç‹äº”',
        age: 25,
        address: 'ä¸Šæµ·',
      },
    ],
  };
  const userModalProps = {};

  return (
    &lt;div className={styles.normal}&gt;
      {/* ç”¨æˆ·ç­›é€‰æœç´¢æ¡† */}
      &lt;UserSearch {...userSearchProps} /&gt;
      {/* ç”¨æˆ·ä¿¡æ¯å±•ç¤ºåˆ—è¡¨ */}
      &lt;UserList {...userListProps} /&gt;
      {/* æ·»åŠ ç”¨æˆ· &amp; ä¿®æ”¹ç”¨æˆ·å¼¹å‡ºçš„æµ®å±‚ */}
      &lt;UserModal {...userModalProps} /&gt;
    &lt;/div&gt;
  );
}

// å¾ˆå…³é”®çš„å¯¹å¤–è¾“å‡ºexportï¼›ä½¿å¤–éƒ¨å¯é€šè¿‡importå¼•ç”¨ä½¿ç”¨æ­¤ç»„ä»¶
export default Users;
</code></pre></div><p>å±•ç¤ºç»„ä»¶UserList</p> <div class="language- extra-class"><pre class="language-text"><code>// ./src/components/Users/UserList.jsx
import React, { Component, PropTypes } from 'react';

// é‡‡ç”¨antdçš„UIç»„ä»¶
import { Table, message, Popconfirm } from 'antd';

// é‡‡ç”¨ stateless çš„å†™æ³•
const UserList = ({
    total,
    current,
    loading,
    dataSource,
}) =&gt; {
  const columns = [{
    title: 'å§“å',
    dataIndex: 'name',
    key: 'name',
    render: (text) =&gt; &lt;a href="#"&gt;{text}&lt;/a&gt;,
  }, {
    title: 'å¹´é¾„',
    dataIndex: 'age',
    key: 'age',
  }, {
    title: 'ä½å€',
    dataIndex: 'address',
    key: 'address',
  }, {
    title: 'æ“ä½œ',
    key: 'operation',
    render: (text, record) =&gt; (
      &lt;p&gt;
        &lt;a onClick={()=&gt;{}}&gt;ç¼–è¾‘&lt;/a&gt;
         
        &lt;Popconfirm title="ç¡®å®šè¦åˆ é™¤å—ï¼Ÿ" onConfirm={()=&gt;{}}&gt;
          &lt;a&gt;åˆ é™¤&lt;/a&gt;
        &lt;/Popconfirm&gt;
      &lt;/p&gt;
    ),
  }];

  // å®šä¹‰åˆ†é¡µå¯¹è±¡
  const pagination = {
    total,
    current,
    pageSize: 10,
    onChange: ()=&gt;{},
  };


  // æ­¤å¤„çš„Tableæ ‡ç­¾ä½¿ç”¨äº†antdç»„ä»¶ï¼Œä¼ å…¥çš„å‚æ•°æ ¼å¼æ˜¯ç”±antdç»„ä»¶åº“æœ¬èº«å†³å®šçš„
  // æ­¤å¤–è¿˜éœ€è¦åœ¨index.jsä¸­å¼•å…¥antd  import 'antd/dist/antd.css'
  return (
    &lt;div&gt;
      &lt;Table
        columns={columns}
        dataSource={dataSource}
        loading={loading}
        rowKey={record =&gt; record.id}
        pagination={pagination}
      /&gt;
    &lt;/div&gt;
  );
}

export default UserList;
</code></pre></div><h3 id="_4-3-æ·»åŠ reducer"><a href="http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html#_4-3-%E6%B7%BB%E5%8A%A0reducer" class="header-anchor">#</a> 4.3 æ·»åŠ Reducer</h3> <blockquote><p>åœ¨æ•´ä¸ªåº”ç”¨ä¸­ï¼Œåªæœ‰<code>model</code>ä¸­çš„<code>reducer</code>å‡½æ•°å¯ä»¥ç›´æ¥ä¿®æ”¹è‡ªå·±æ‰€åœ¨<code>model</code>çš„<code>state</code>å‚æ•°ï¼Œå…¶ä½™éƒ½æ˜¯éæ³•æ“ä½œï¼›
å¹¶ä¸”å¿…é¡»ä½¿ç”¨<code>return {...state}</code>çš„å½¢å¼è¿›è¡Œä¿®æ”¹</p></blockquote> <h4 id="_4-3-1-ç¬¬ä¸€æ­¥-å®ç°reducerå‡½æ•°"><a href="http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html#_4-3-1-%E7%AC%AC%E4%B8%80%E6%AD%A5-%E5%AE%9E%E7%8E%B0reducer%E5%87%BD%E6%95%B0" class="header-anchor">#</a> 4.3.1 ç¬¬ä¸€æ­¥ï¼šå®ç°reducerå‡½æ•°</h4> <div class="language- extra-class"><pre class="language-text"><code>// models/users.js
// ä½¿ç”¨é™æ€æ•°æ®è¿”å›ï¼ŒæŠŠuserListä¸­çš„é™æ€æ•°æ®ç§»åˆ°æ­¤å¤„
// querySuccessè¿™ä¸ªactionçš„ä½œç”¨åœ¨äºï¼Œä¿®æ”¹äº†modelçš„æ•°æ®
export default {
  namespace: 'users',
  stateï¼š {}ï¼Œ
  subscriptions: {},
  effects: {},
  reducers: {
    querySuccess(state){
        const mock = {
          total: 3,
          current: 1,
          loading: false,
          list: [
            {
              id: 1,
              name: 'å¼ ä¸‰',
              age: 23,
              address: 'æˆéƒ½',
            },
            {
              id: 2,
              name: 'æå››',
              age: 24,
              address: 'æ­å·',
            },
            {
              id: 3,
              name: 'ç‹äº”',
              age: 25,
              address: 'ä¸Šæµ·',
            },
          ]
        };
        // return çš„å†…å®¹æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ¶µç›–åŸstateä¸­çš„æ‰€æœ‰å±æ€§ï¼Œä»¥å®ç°â€œæ›´æ–°æ›¿æ¢â€çš„æ•ˆæœ
        return {...state, ...mock, loading: false};
      }
  }
}
</code></pre></div><h4 id="_4-3-2-ç¬¬äºŒæ­¥-å…³è”modelä¸­çš„æ•°æ®æº"><a href="http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html#_4-3-2-%E7%AC%AC%E4%BA%8C%E6%AD%A5-%E5%85%B3%E8%81%94model%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E6%BA%90" class="header-anchor">#</a> 4.3.2 ç¬¬äºŒæ­¥ï¼šå…³è”Modelä¸­çš„æ•°æ®æº</h4> <div class="language- extra-class"><pre class="language-text"><code>// routes/Users.jsx

import React, { PropTypes } from 'react';

// æœ€åç”¨åˆ°äº†connectå‡½æ•°ï¼Œéœ€è¦åœ¨å¤´éƒ¨é¢„å…ˆå¼•å…¥connect
import { connect } from 'dva';

function Users({ location, dispatch, users }) {

  const {
    loading, list, total, current,
    currentItem, modalVisible, modalType
    } = users;

  const userSearchProps={};

  // ä½¿ç”¨ä¼ å…¥çš„æ•°æ®æºï¼Œè¿›è¡Œæ•°æ®æ¸²æŸ“
  const userListProps={
    dataSource: list,
    total,
    loading,
    current,
  };
  const userModalProps={};

  return (
    &lt;div className={styles.normal}&gt;
      {/* ç”¨æˆ·ç­›é€‰æœç´¢æ¡† */}
      &lt;UserSearch {...userSearchProps} /&gt;
      {/* ç”¨æˆ·ä¿¡æ¯å±•ç¤ºåˆ—è¡¨ */}
      &lt;UserList {...userListProps} /&gt;
      {/* æ·»åŠ ç”¨æˆ· &amp; ä¿®æ”¹ç”¨æˆ·å¼¹å‡ºçš„æµ®å±‚ */}
      &lt;UserModal {...userModalProps} /&gt;
    &lt;/div&gt;
  );
}

// å£°æ˜ç»„ä»¶çš„propsç±»å‹
Users.propTypes = {
  users: PropTypes.object,
};

// æŒ‡å®šè®¢é˜…æ•°æ®ï¼Œå¹¶ä¸”å…³è”åˆ°usersä¸­
function mapStateToProps({ users }) {
  return {users};
}

// å»ºç«‹æ•°æ®å…³è”å…³ç³»
export default connect(mapStateToProps)(Users);
</code></pre></div><h4 id="_4-3-3-ç¬¬ä¸‰æ­¥-é€šè¿‡å‘èµ·action-åœ¨ç»„ä»¶ä¸­è·å–modelä¸­çš„æ•°æ®"><a href="http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html#_4-3-3-%E7%AC%AC%E4%B8%89%E6%AD%A5-%E9%80%9A%E8%BF%87%E5%8F%91%E8%B5%B7action-%E5%9C%A8%E7%BB%84%E4%BB%B6%E4%B8%AD%E8%8E%B7%E5%8F%96model%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE" class="header-anchor">#</a> 4.3.3 ç¬¬ä¸‰æ­¥ï¼šé€šè¿‡å‘èµ·Actionï¼Œåœ¨ç»„ä»¶ä¸­è·å–Modelä¸­çš„æ•°æ®</h4> <div class="language- extra-class"><pre class="language-text"><code>// models/users.js
// åœ¨ç»„ä»¶ç”Ÿæˆåå‘å‡ºactionï¼Œç¤ºä¾‹ï¼š
componentDidMount() {
  this.props.dispatch({
    type: 'model/action',     // typeå¯¹åº”actionçš„åå­—
  });
}

// åœ¨æœ¬æ¬¡å®è·µä¸­ï¼Œåœ¨è®¿é—®/users/è·¯ç”±æ—¶ï¼Œå°±æ˜¯æˆ‘ä»¬è·å–ç”¨æˆ·æ•°æ®çš„æ—¶æœº
// å› æ­¤æŠŠdispatchç§»è‡³subscriptionä¸­
// subcriptionï¼Œè®¢é˜…(æˆ–æ˜¯ç›‘å¬)ä¸€ä¸ªæ•°æ®æºï¼Œç„¶åæ ¹æ®æ¡ä»¶dispatchå¯¹åº”çš„action
// æ•°æ®æºå¯ä»¥æ˜¯å½“å‰çš„æ—¶é—´ã€æœåŠ¡å™¨çš„ websocket è¿æ¥ã€keyboard è¾“å…¥ã€geolocation å˜åŒ–ã€history è·¯ç”±å˜åŒ–ç­‰ç­‰  
// æ­¤å¤„è®¢é˜…çš„æ•°æ®æºå°±æ˜¯è·¯ç”±ä¿¡æ¯ï¼Œå½“è·¯ç”±ä¸º/usersï¼Œåˆ™æ´¾å‘'querySuccess'è¿™ä¸ªeffectsæ–¹æ³•
subscriptions: {
    setup({ dispatch, history }) {
      history.listen(location =&gt; {
        if (location.pathname === '/users') {
          dispatch({
            type: 'querySuccess',
            payload: {}
          });
        }
      });
    },
  },
</code></pre></div><h4 id="_4-3-4-ç¬¬å››æ­¥-åœ¨index-jsä¸­æ·»åŠ models"><a href="http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html#_4-3-4-%E7%AC%AC%E5%9B%9B%E6%AD%A5-%E5%9C%A8index-js%E4%B8%AD%E6%B7%BB%E5%8A%A0models" class="header-anchor">#</a> 4.3.4 ç¬¬å››æ­¥ï¼š åœ¨index.jsä¸­æ·»åŠ models</h4> <div class="language- extra-class"><pre class="language-text"><code>// modelå¿…é¡»åœ¨æ­¤å®Œæˆæ³¨å†Œï¼Œæ‰èƒ½å…¨å±€æœ‰æ•ˆ
// index.js
app.model(require('./models/users.js'));
</code></pre></div><h4 id="_4-4-æ·»åŠ effects"><a href="http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html#_4-4-%E6%B7%BB%E5%8A%A0effects" class="header-anchor">#</a> 4.4 æ·»åŠ Effects</h4> <blockquote><div class="language- extra-class"><pre class="language-text"><code>Effects`çš„ä½œç”¨åœ¨äºå¤„ç†å¼‚æ­¥å‡½æ•°ï¼Œæ§åˆ¶æ•°æ®æµç¨‹ã€‚
å› ä¸ºåœ¨çœŸå®åœºæ™¯ä¸­ï¼Œæ•°æ®éƒ½æ¥è‡ªæœåŠ¡å™¨ï¼Œéœ€è¦åœ¨å‘èµ·å¼‚æ­¥è¯·æ±‚è·å¾—è¿”å›å€¼åå†è®¾ç½®æ•°æ®ï¼Œæ›´æ–°`state`ã€‚
å› æ­¤æˆ‘ä»¬å¾€å¾€åœ¨`Effects`ä¸­è°ƒç”¨`reducer
</code></pre></div></blockquote> <div class="language- extra-class"><pre class="language-text"><code>export default {
  namespace: 'users',
  stateï¼š {}ï¼Œ
  subscriptions: {},
  effects: {
    // æ·»åŠ effectså‡½æ•°
    // callä¸putæ˜¯dvaçš„å‡½æ•°
    // callè°ƒç”¨æ‰§è¡Œä¸€ä¸ªå‡½æ•°
    // putåˆ™æ˜¯dispatchæ‰§è¡Œä¸€ä¸ªaction
    // selectç”¨äºè®¿é—®å…¶ä»–model
    *query({ payload }, { select, call, put }) {
        yield put({ type: 'showLoading' });
        const { data } = yield call(query);
        if (data) {
          yield put({
            type: 'querySuccess',
            payload: {
              list: data.data,
              total: data.page.total,
              current: data.page.current
            }
          });
        }
      },
    },
  reducers: {}
}



// æ·»åŠ è¯·æ±‚å¤„ç†   åŒ…å«äº†ä¸€ä¸ªajaxè¯·æ±‚
// models/users.js
import request from '../utils/request';
import qs from 'qs';
async function query(params) {
  return request(`/api/users?${qs.stringify(params)}`);
}
</code></pre></div><h4 id="_4-5-æŠŠè¯·æ±‚å¤„ç†åˆ†ç¦»åˆ°serviceä¸­"><a href="http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html#_4-5-%E6%8A%8A%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86%E5%88%86%E7%A6%BB%E5%88%B0service%E4%B8%AD" class="header-anchor">#</a> 4.5 æŠŠè¯·æ±‚å¤„ç†åˆ†ç¦»åˆ°serviceä¸­</h4> <blockquote><p>ç”¨æ„åœ¨äºåˆ†ç¦»(å¯å¤ç”¨çš„)ajaxè¯·æ±‚</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>// services/users.js
import request from '../utils/request';
import qs from 'qs';
export async function query(params) {
  return request(`/api/users?${qs.stringify(params)}`);
}

// åœ¨modelsä¸­å¼•ç”¨
// models/users.js
import {query} from '../services/users';
</code></pre></div><h2 id="äº”ã€ä½¿ç”¨dvaæ¡†æ¶å’Œç›´æ¥ä½¿ç”¨reduxå†™æ³•çš„åŒºåˆ«"><a href="http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html#%E4%BA%94%E3%80%81%E4%BD%BF%E7%94%A8dva%E6%A1%86%E6%9E%B6%E5%92%8C%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8redux%E5%86%99%E6%B3%95%E7%9A%84%E5%8C%BA%E5%88%AB" class="header-anchor">#</a> äº”ã€ä½¿ç”¨dvaæ¡†æ¶å’Œç›´æ¥ä½¿ç”¨reduxå†™æ³•çš„åŒºåˆ«</h2> <h3 id="_5-1-ä½¿ç”¨-redux"><a href="http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html#_5-1-%E4%BD%BF%E7%94%A8-redux" class="header-anchor">#</a> 5.1 ä½¿ç”¨ redux</h3> <div class="language- extra-class"><pre class="language-text"><code>// action.js

export const REQUEST_TODO = 'REQUEST_TODO';
export const RESPONSE_TODO = 'RESPONSE_TODO';

const request = count =&gt; ({type: REQUEST_TODO, payload: {loading: true, count}});

const response = count =&gt; ({type: RESPONSE_TODO, payload: {loading: false, count}});

export const fetch = count =&gt; {
  return (dispatch) =&gt; {
    dispatch(request(count));

    return new Promise(resolve =&gt; {
      setTimeout(() =&gt; {
        resolve(count + 1);
      }, 1000)
    }).then(data =&gt; {
      dispatch(response(data))
    })
  }
}
//reducer.js
import { REQUEST_TODO, RESPONSE_TODO } from './actions';

export default (state = {
  loading: false,
  count: 0
}, action) =&gt; {
  switch (action.type) {
    case REQUEST_TODO:
      return {...state, ...action.payload};
    case RESPONSE_TODO:
      return {...state, ...action.payload};
    default:
      return state;
  }
}
// app.js
import React from 'react';
import { bindActionCreators } from 'redux';
import { connect } from 'react-redux';

import * as actions from './actions';

const App = ({fetch, count, loading}) =&gt; {
  return (
    &lt;div&gt;
      {loading ? &lt;div&gt;loading...&lt;/div&gt; : &lt;div&gt;{count}&lt;/div&gt;}
      &lt;button onClick={() =&gt; fetch(count)}&gt;add&lt;/button&gt;
    &lt;/div&gt;
  )
}

function mapStateToProps(state) {
  return state;
}

function mapDispatchToProps(dispatch) {
  return bindActionCreators(actions, dispatch)
}

export default connect(mapStateToProps, mapDispatchToProps)(App)
//index.js
import { render } from 'react-dom';
import { createStore, applyMiddleware } from 'redux';
import { Provider } from 'react-redux'
import thunkMiddleware from 'redux-thunk';

import reducer from './app/reducer';
import App from './app/app';

const store = createStore(reducer, applyMiddleware(thunkMiddleware));

render(
  &lt;Provider store={store}&gt;
    &lt;App/&gt;
  &lt;/Provider&gt;
  ,
  document.getElementById('app')
)
</code></pre></div><h3 id="_5-2-ä½¿ç”¨dva"><a href="http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html#_5-2-%E4%BD%BF%E7%94%A8dva" class="header-anchor">#</a> 5.2 ä½¿ç”¨dva</h3> <div class="language- extra-class"><pre class="language-text"><code>// model.js
export default {
  namespace: 'demo',
  state: {
    loading: false,
    count: 0
  },
  reducers: {
    request(state, payload) {
      return {...state, ...payload};
    },
    response(state, payload) {
      return {...state, ...payload};
    }
  },
  effects: {
    *'fetch'(action, {put, call}) {
      yield put({type: 'request', loading: true});

      let count = yield call((count) =&gt; {
        return new Promise(resolve =&gt; {
          setTimeout(() =&gt; {
            resolve(count + 1);
          }, 1000);
        });
      }, action.count);

      yield put({
        type: 'response',
        loading: false,
        count
      });
    }
  }
}
//app.js

import React from 'react'
import { connect } from 'dva';

const App = ({fetch, count, loading}) =&gt; {
  return (
    &lt;div&gt;
      {loading ? &lt;div&gt;loading...&lt;/div&gt; : &lt;div&gt;{count}&lt;/div&gt;}
      &lt;button onClick={() =&gt; fetch(count)}&gt;add&lt;/button&gt;
    &lt;/div&gt;
  )
}

function mapStateToProps(state) {
  return state.demo;
}

function mapDispatchToProps(dispatch) {
  return {
    fetch(count){
      dispatch({type: 'demo/fetch', count});
    }
  }
}

export default connect(mapStateToProps, mapDispatchToProps)(App)
// index.js
import dva from 'dva';
import model from './model';
import App from './app';

const app = dva();

app.use({});

app.model(model);

app.router(() =&gt; &lt;App /&gt;);

app.start();
</code></pre></div><ul><li>ä½¿ç”¨ <code>redux</code> éœ€è¦æ‹†åˆ†å‡º<code>action</code>æ¨¡å—å’Œ<code>reducer</code>æ¨¡å—</li> <li><code>dva</code>å°†<code>action</code>å’Œ<code>reducer</code>å°è£…åˆ°<code>model</code>ä¸­ï¼Œå¼‚æ­¥æµç¨‹é‡‡ç”¨<code>Generator</code>å¤„ç†</li></ul> <h2 id="å…­ã€ä½¿ç”¨axiosç»Ÿä¸€å¤„ç†"><a href="http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html#%E5%85%AD%E3%80%81%E4%BD%BF%E7%94%A8axios%E7%BB%9F%E4%B8%80%E5%A4%84%E7%90%86" class="header-anchor">#</a> å…­ã€ä½¿ç”¨axiosç»Ÿä¸€å¤„ç†</h2> <h3 id="_6-1-ç¤ºä¾‹ä»£ç "><a href="http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html#_6-1-%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81" class="header-anchor">#</a> 6.1 ç¤ºä¾‹ä»£ç </h3> <div class="language- extra-class"><pre class="language-text"><code>// request.js
import axios from 'axios';
import NProgress from 'nprogress';
import { notification, message } from 'antd';
import { routerRedux } from 'dva/router';
import store from '../index';

/**
 * ä¸€ã€åŠŸèƒ½ï¼š
 * 1. ç»Ÿä¸€æ‹¦æˆªhttpé”™è¯¯è¯·æ±‚ç ï¼›
 * 2. ç»Ÿä¸€æ‹¦æˆªä¸šåŠ¡é”™è¯¯ä»£ç ï¼›
 * 3. ç»Ÿä¸€è®¾ç½®è¯·æ±‚å‰ç¼€
 * |-- æ¯ä¸ª http åŠ å‰ç¼€ baseURL = /api/v1ï¼Œä»é…ç½®æ–‡ä»¶ä¸­è·å– apiPrefix
 * 4. é…ç½®å¼‚æ­¥è¯·æ±‚è¿‡æ¸¡çŠ¶æ€ï¼šæ˜¾ç¤ºè“è‰²åŠ è½½æ¡è¡¨ç¤ºæ­£åœ¨è¯·æ±‚ä¸­ï¼Œé¿å…ç»™ç”¨æˆ·é¡µé¢å‡æ­»çš„ä¸å¥½ä½“éªŒã€‚
 * |-- ä½¿ç”¨ NProgress å·¥å…·åº“ã€‚
 * 
 * äºŒã€å¼•åŒ…ï¼š
 * |-- axiosï¼šhttp è¯·æ±‚å·¥å…·åº“
 * |-- NProgressï¼šå¼‚æ­¥è¯·æ±‚è¿‡åº¦æ¡ï¼Œåœ¨æµè§ˆå™¨ä¸»ä½“éƒ¨åˆ†é¡¶éƒ¨æ˜¾ç¤ºè“è‰²å°æ¡
 * |-- notificationï¼šAntdç»„ä»¶ &gt; å¤„ç†é”™è¯¯å“åº”ç æç¤ºä¿¡æ¯
 * |-- routerReduxï¼šdva/routerå¯¹è±¡ï¼Œç”¨äºè·¯ç”±è·³è½¬ï¼Œé”™è¯¯å“åº”ç è·³è½¬ç›¸åº”é¡µé¢
 * |-- storeï¼šdvaä¸­å¯¹è±¡ï¼Œä½¿ç”¨é‡Œé¢çš„ dispatch å¯¹è±¡ï¼Œç”¨äºè§¦å‘è·¯ç”±è·³è½¬
 */

// è®¾ç½®å…¨å±€å‚æ•°ï¼Œå¦‚å“åº”è¶…å¸‚æ—¶é—´ï¼Œè¯·æ±‚å‰ç¼€ç­‰ã€‚
axios.defaults.timeout = 5000
axios.defaults.baseURL = '/api/v1';
axios.defaults.withCredentials = true;

// çŠ¶æ€ç é”™è¯¯ä¿¡æ¯
const codeMessage = {
  200: 'æœåŠ¡å™¨æˆåŠŸè¿”å›è¯·æ±‚çš„æ•°æ®ã€‚',
  201: 'æ–°å»ºæˆ–ä¿®æ”¹æ•°æ®æˆåŠŸã€‚',
  202: 'ä¸€ä¸ªè¯·æ±‚å·²ç»è¿›å…¥åå°æ’é˜Ÿï¼ˆå¼‚æ­¥ä»»åŠ¡ï¼‰ã€‚',
  204: 'åˆ é™¤æ•°æ®æˆåŠŸã€‚',
  400: 'å‘å‡ºçš„è¯·æ±‚æœ‰é”™è¯¯ï¼ŒæœåŠ¡å™¨æ²¡æœ‰è¿›è¡Œæ–°å»ºæˆ–ä¿®æ”¹æ•°æ®çš„æ“ä½œã€‚',
  401: 'ç”¨æˆ·æ²¡æœ‰æƒé™ï¼ˆä»¤ç‰Œã€ç”¨æˆ·åã€å¯†ç é”™è¯¯ï¼‰ã€‚',
  403: 'ç”¨æˆ·å¾—åˆ°æˆæƒï¼Œä½†æ˜¯è®¿é—®æ˜¯è¢«ç¦æ­¢çš„ã€‚',
  404: 'å‘å‡ºçš„è¯·æ±‚é’ˆå¯¹çš„æ˜¯ä¸å­˜åœ¨çš„è®°å½•ï¼ŒæœåŠ¡å™¨æ²¡æœ‰è¿›è¡Œæ“ä½œã€‚',
  406: 'è¯·æ±‚çš„æ ¼å¼ä¸å¯å¾—ã€‚',
  410: 'è¯·æ±‚çš„èµ„æºè¢«æ°¸ä¹…åˆ é™¤ï¼Œä¸”ä¸ä¼šå†å¾—åˆ°çš„ã€‚',
  422: 'å½“åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå‘ç”Ÿä¸€ä¸ªéªŒè¯é”™è¯¯ã€‚',
  500: 'æœåŠ¡å™¨å‘ç”Ÿé”™è¯¯ï¼Œè¯·æ£€æŸ¥æœåŠ¡å™¨ã€‚',
  502: 'ç½‘å…³é”™è¯¯ã€‚',
  503: 'æœåŠ¡ä¸å¯ç”¨ï¼ŒæœåŠ¡å™¨æš‚æ—¶è¿‡è½½æˆ–ç»´æŠ¤ã€‚',
  504: 'ç½‘å…³è¶…æ—¶ã€‚',
};

// æ·»åŠ ä¸€ä¸ªè¯·æ±‚æ‹¦æˆªå™¨ï¼Œç”¨äºè®¾ç½®è¯·æ±‚è¿‡æ¸¡çŠ¶æ€
axios.interceptors.request.use((config) =&gt; {
  // è¯·æ±‚å¼€å§‹ï¼Œè“è‰²è¿‡æ¸¡æ»šåŠ¨æ¡å¼€å§‹å‡ºç°
  NProgress.start();
  return config;
}, (error) =&gt; {
  return Promise.reject(error);
});

// æ·»åŠ ä¸€ä¸ªè¿”å›æ‹¦æˆªå™¨
axios.interceptors.response.use((response) =&gt; {
  // è¯·æ±‚ç»“æŸï¼Œè“è‰²è¿‡æ¸¡æ»šåŠ¨æ¡æ¶ˆå¤±
  NProgress.done();
  return response;
}, (error) =&gt; {
  // è¯·æ±‚ç»“æŸï¼Œè“è‰²è¿‡æ¸¡æ»šåŠ¨æ¡æ¶ˆå¤±
  // å³ä½¿å‡ºç°å¼‚å¸¸ï¼Œä¹Ÿè¦è°ƒç”¨å…³é—­æ–¹æ³•ï¼Œå¦åˆ™ä¸€ç›´å¤„äºåŠ è½½çŠ¶æ€å¾ˆå¥‡æ€ª
  NProgress.done();
  return Promise.reject(error);
});

export default function request (opt) {
  // è°ƒç”¨ axios apiï¼Œç»Ÿä¸€æ‹¦æˆª
  return axios(opt)
    .then((response) =&gt; 
      // &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; è¯·æ±‚æˆåŠŸ &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
      console.log(`ã€${opt.method} ${opt.url}ã€‘è¯·æ±‚æˆåŠŸï¼Œå“åº”æ•°æ®ï¼š%o`, response);

      // æ‰“å°ä¸šåŠ¡é”™è¯¯æç¤º
      if (response.data &amp;&amp; response.data.code != '0000') {
        message.error(response.data.message);
      }

      return { ...response.data };
    })
    .catch((error) =&gt; {
      // &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; è¯·æ±‚å¤±è´¥ &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
      // è¯·æ±‚é…ç½®å‘ç”Ÿçš„é”™è¯¯
      if (!error.response) {
        return console.log('Error', error.message);
      }

      // å“åº”æ—¶çŠ¶æ€ç å¤„ç† 
      const status = error.response.status;
      const errortext = codeMessage[status] || error.response.statusText;
      
      notification.error({
        message: `è¯·æ±‚é”™è¯¯ ${status}`,
        description: errortext,
      });
      
      // å­˜åœ¨è¯·æ±‚ï¼Œä½†æ˜¯æœåŠ¡å™¨çš„è¿”å›ä¸€ä¸ªçŠ¶æ€ç ï¼Œå®ƒä»¬éƒ½åœ¨2xxä¹‹å¤–
      const { dispatch } = store;

      if (status === 401) {
        dispatch(routerRedux.push('/user/login'));
      } else if (status === 403) {
        dispatch(routerRedux.push('/exception/403'));
      } else if (status &lt;= 504 &amp;&amp; status &gt;= 500) {
        dispatch(routerRedux.push('/exception/500'));
      } else if (status &gt;= 404 &amp;&amp; status &lt; 422) {
        dispatch(routerRedux.push('/exception/404'));
      }

      // å¼€å‘æ—¶ä½¿ç”¨ï¼Œä¸Šçº¿æ—¶åˆ é™¤
      console.log(`ã€${opt.method} ${opt.url}ã€‘è¯·æ±‚å¤±è´¥ï¼Œå“åº”æ•°æ®ï¼š%o`, error.response);

      return { code: status, message: errortext }; 
    });
}
</code></pre></div><h3 id="_6-2-æ˜ç¡®å“åº”ä½“"><a href="http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html#_6-2-%E6%98%8E%E7%A1%AE%E5%93%8D%E5%BA%94%E4%BD%93" class="header-anchor">#</a> 6.2 æ˜ç¡®å“åº”ä½“</h3> <blockquote><p>ä»¥å¾®ä¿¡å°ç¨‹åºä¸ºä¾‹ï¼Œè¯·æ±‚å“åº”æ•°æ®åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š</p></blockquote> <ul><li>ç½‘ç»œè¯·æ±‚æ˜¯å¦æˆåŠŸï¼›</li> <li>ä¸šåŠ¡åœºæ™¯å€¼ã€‚å³ä¾¿ç½‘ç»œè¯·æ±‚æˆåŠŸäº†ï¼Œä¸šåŠ¡å¤„ç†ä¸Šå¯èƒ½æœ‰æ—¶ä¹Ÿä¼šå‡ºé”™ï¼Œæ¯”å¦‚æ ¡éªŒä¸é€šè¿‡</li></ul> <p>æˆ‘ä»¬åœ¨æ‹¦æˆªå“åº”æ—¶è¦åˆ†åˆ«å¯¹è¿™ä¸¤éƒ¨åˆ†è¿›è¡Œå¤„ç†</p> <div class="language- extra-class"><pre class="language-text"><code>response = {
  status: 200,                // ç½‘ç»œè¯·æ±‚çŠ¶æ€ã€‚
  statusText: 'xxx',
  data: {
    code: '1001',             // ä¸šåŠ¡è¯·æ±‚çŠ¶æ€ã€‚è¿™é‡Œ '0000' è¡¨ç¤ºä¸šåŠ¡æ²¡é—®é¢˜ï¼Œå…¶å®ƒéƒ½æœ‰é—®é¢˜
    message: 'yyy',
    data: {  },
  }
}
</code></pre></div><h3 id="_6-3-ä¾èµ–åŒ…åˆ†æ"><a href="http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html#_6-3-%E4%BE%9D%E8%B5%96%E5%8C%85%E5%88%86%E6%9E%90" class="header-anchor">#</a> 6.3 ä¾èµ–åŒ…åˆ†æ</h3> <div class="language- extra-class"><pre class="language-text"><code>import axios from 'axios';
import NProgress from 'nprogress';
import { notification, message } from 'antd';
import { routerRedux } from 'dva/router';
import store from '../index';
</code></pre></div><blockquote><p><code>import store from '../index';</code>è¿™æ˜¯ <code>dva</code> ä¸­å¯¼å‡ºçš„å¯¹è±¡ã€‚å³ä¸‹é¢ä»£ç æœ€ç»ˆå¯¼å‡ºçš„ <code>app._store</code>ï¼Œå¼•å…¥å®ƒæ˜¯å› ä¸º <code>dispatch</code> å¯¹è±¡åœ¨é‡Œé¢ï¼Œæˆ‘ä»¬éœ€è¦ dispatch å¯¹è±¡è¿›è¡Œè·¯ç”±è·³è½¬</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>// index.js
import dva from 'dva';
import { message } from 'antd';
import { createBrowserHistory as createHistory } from 'history';

// 1. Initialize
const app = dva({
  history: createHistory(),
});

// 2. Plugins
app.use(createLoading());

// 3. Model
app.model(require('./models/app/global').default);

// 4. Router
app.router(require('./router').default);

// 5. Start
app.start('#root');

export default app._store;
</code></pre></div><h3 id="_6-4-axios-å…¨å±€é…ç½®"><a href="http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html#_6-4-axios-%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE" class="header-anchor">#</a> 6.4 axios å…¨å±€é…ç½®</h3> <div class="language- extra-class"><pre class="language-text"><code>// è®¾ç½®å…¨å±€å‚æ•°ï¼Œå¦‚å“åº”è¶…å¸‚æ—¶é—´ï¼Œè¯·æ±‚å‰ç¼€ç­‰ã€‚
axios.defaults.timeout = 5000
axios.defaults.baseURL = '/api/v1';
axios.defaults.withCredentials = true;
</code></pre></div><blockquote><p>axios å¯ä»¥è®¾ç½®å¾ˆå¤šå…¨å±€é…ç½®ï¼Œå…·ä½“å¯å‚é˜… https://segmentfault.com/a/1190000008470355</p></blockquote> <h3 id="_6-5-åŠ è½½-nprogress-è¿‡æ¸¡ç»„ä»¶"><a href="http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html#_6-5-%E5%8A%A0%E8%BD%BD-nprogress-%E8%BF%87%E6%B8%A1%E7%BB%84%E4%BB%B6" class="header-anchor">#</a> 6.5 åŠ è½½ NProgress è¿‡æ¸¡ç»„ä»¶</h3> <div class="language- extra-class"><pre class="language-text"><code>/ æ·»åŠ ä¸€ä¸ªè¯·æ±‚æ‹¦æˆªå™¨ï¼Œç”¨äºè®¾ç½®è¯·æ±‚è¿‡æ¸¡çŠ¶æ€
axios.interceptors.request.use((config) =&gt; {
  // è¯·æ±‚å¼€å§‹ï¼Œè“è‰²è¿‡æ¸¡æ»šåŠ¨æ¡å¼€å§‹å‡ºç°
  NProgress.start();
  return config;
}, (error) =&gt; {
  return Promise.reject(error);
});

// æ·»åŠ ä¸€ä¸ªè¿”å›æ‹¦æˆªå™¨
axios.interceptors.response.use((response) =&gt; {
  // è¯·æ±‚ç»“æŸï¼Œè“è‰²è¿‡æ¸¡æ»šåŠ¨æ¡æ¶ˆå¤±
  NProgress.done();
  return response;
}, (error) =&gt; {
  // è¯·æ±‚ç»“æŸï¼Œè“è‰²è¿‡æ¸¡æ»šåŠ¨æ¡æ¶ˆå¤±
  // å³ä½¿å‡ºç°å¼‚å¸¸ï¼Œä¹Ÿè¦è°ƒç”¨å…³é—­æ–¹æ³•ï¼Œå¦åˆ™ä¸€ç›´å¤„äºåŠ è½½çŠ¶æ€å¾ˆå¥‡æ€ª
  NProgress.done();
  return Promise.reject(error);
});
</code></pre></div><blockquote><p><code>NProgress</code> çš„ä½¿ç”¨ä¸»è¦æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œå½“è°ƒç”¨ <code>NProgress.start();</code> æ—¶åœ¨æµè§ˆå™¨é¡¶éƒ¨å°±ä¼šå‡ºç°è“è‰²å°æ¡ï¼Œå½“è°ƒç”¨ <code>NProgress.done();</code> è“è‰²å°æ¡å°±ä¼šæ¶ˆå¤±ã€‚æˆ‘ä»¬åˆ†åˆ«åœ¨è¯·æ±‚å¼€å§‹å’Œæ¥æ”¶åˆ°å“åº”è°ƒç”¨è¿™ä¸¤ä¸ªæ–¹æ³•</p></blockquote> <p><img src="./dva_files/6693922-948c3efcfeeaf4fd.gif" alt="img" class="medium-zoom-image"></p> <h3 id="_6-6-ç½‘ç»œè¯·æ±‚æˆåŠŸå¤„ç†"><a href="http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html#_6-6-%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E6%88%90%E5%8A%9F%E5%A4%84%E7%90%86" class="header-anchor">#</a> 6.6 ç½‘ç»œè¯·æ±‚æˆåŠŸå¤„ç†</h3> <div class="language- extra-class"><pre class="language-text"><code>.then((response) =&gt; 
      // &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; è¯·æ±‚æˆåŠŸ &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
      console.log(`ã€${opt.method} ${opt.url}ã€‘è¯·æ±‚æˆåŠŸï¼Œå“åº”æ•°æ®ï¼š%o`, response);

      // æ‰“å°ä¸šåŠ¡é”™è¯¯æç¤º
      if (response.data &amp;&amp; response.data.code != '0000') {
        message.error(response.data.message);
      }

      return { ...response.data };
    })
</code></pre></div><blockquote><p>ç½‘ç»œè¯·æ±‚çŠ¶æ€ç ä¸º <code>200-300</code> è¡¨ç¤ºæˆåŠŸï¼Œæ­¤æ—¶è¿˜åº”è¯¥åˆ¤æ–­ä¸šåŠ¡å¤„ç†æ˜¯å¦æˆåŠŸã€‚è¿™ä¸ªæ ¹æ®å…·ä½“é¡¹ç›®å…·ä½“è§„å®šï¼Œæ¯”å¦‚å¾®ä¿¡å°ç¨‹åºæœ‰ä¸€å¥—åœºæ™¯å€¼ã€‚åœ¨å®é™…é¡¹ç›®ä¸­å¯ä»¥è‡ªè¡Œè§„å®š <code>code = '0000'</code> ä¸šåŠ¡å¤„ç†å®Œå…¨æ²¡é—®é¢˜ï¼Œ<code>code = '1111'</code>æ ¡éªŒä¸é€šè¿‡ï¼Œ<code>code = '2222'</code> æ•°æ®åº“å‡ºé”™ç­‰ç­‰ã€‚</p></blockquote> <ul><li>æœ€ååˆ«å¿˜äº†è¦è¿”å›å…·ä½“å¯¹è±¡ <code>{ ...response.data }</code></li></ul> <h3 id="_6-7-ç½‘ç»œè¯·æ±‚å¤±è´¥å¤„ç†"><a href="http://interview.poetries.top/principle-docs/react/02-Dva%E6%80%BB%E7%BB%93.html#_6-7-%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%A4%B1%E8%B4%A5%E5%A4%84%E7%90%86" class="header-anchor">#</a> 6.7 ç½‘ç»œè¯·æ±‚å¤±è´¥å¤„ç†</h3> <div class="language- extra-class"><pre class="language-text"><code>// çŠ¶æ€ç é”™è¯¯ä¿¡æ¯
const codeMessage = {
  200: 'æœåŠ¡å™¨æˆåŠŸè¿”å›è¯·æ±‚çš„æ•°æ®ã€‚',
  201: 'æ–°å»ºæˆ–ä¿®æ”¹æ•°æ®æˆåŠŸã€‚',
  202: 'ä¸€ä¸ªè¯·æ±‚å·²ç»è¿›å…¥åå°æ’é˜Ÿï¼ˆå¼‚æ­¥ä»»åŠ¡ï¼‰ã€‚',
  204: 'åˆ é™¤æ•°æ®æˆåŠŸã€‚',
  400: 'å‘å‡ºçš„è¯·æ±‚æœ‰é”™è¯¯ï¼ŒæœåŠ¡å™¨æ²¡æœ‰è¿›è¡Œæ–°å»ºæˆ–ä¿®æ”¹æ•°æ®çš„æ“ä½œã€‚',
  401: 'ç”¨æˆ·æ²¡æœ‰æƒé™ï¼ˆä»¤ç‰Œã€ç”¨æˆ·åã€å¯†ç é”™è¯¯ï¼‰ã€‚',
  403: 'ç”¨æˆ·å¾—åˆ°æˆæƒï¼Œä½†æ˜¯è®¿é—®æ˜¯è¢«ç¦æ­¢çš„ã€‚',
  404: 'å‘å‡ºçš„è¯·æ±‚é’ˆå¯¹çš„æ˜¯ä¸å­˜åœ¨çš„è®°å½•ï¼ŒæœåŠ¡å™¨æ²¡æœ‰è¿›è¡Œæ“ä½œã€‚',
  406: 'è¯·æ±‚çš„æ ¼å¼ä¸å¯å¾—ã€‚',
  410: 'è¯·æ±‚çš„èµ„æºè¢«æ°¸ä¹…åˆ é™¤ï¼Œä¸”ä¸ä¼šå†å¾—åˆ°çš„ã€‚',
  422: 'å½“åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå‘ç”Ÿä¸€ä¸ªéªŒè¯é”™è¯¯ã€‚',
  500: 'æœåŠ¡å™¨å‘ç”Ÿé”™è¯¯ï¼Œè¯·æ£€æŸ¥æœåŠ¡å™¨ã€‚',
  502: 'ç½‘å…³é”™è¯¯ã€‚',
  503: 'æœåŠ¡ä¸å¯ç”¨ï¼ŒæœåŠ¡å™¨æš‚æ—¶è¿‡è½½æˆ–ç»´æŠ¤ã€‚',
  504: 'ç½‘å…³è¶…æ—¶ã€‚',
};

// ...........

.catch((error) =&gt; {
      // &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; è¯·æ±‚å¤±è´¥ &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
      // è¯·æ±‚é…ç½®å‘ç”Ÿçš„é”™è¯¯
      if (!error.response) {
        return console.log('Error', error.message);
      }

      // å“åº”æ—¶çŠ¶æ€ç å¤„ç† 
      const status = error.response.status;
      const errortext = codeMessage[status] || error.response.statusText;
      
      notification.error({
        message: `è¯·æ±‚é”™è¯¯ ${status}`,
        description: errortext,
      });
      
      // å­˜åœ¨è¯·æ±‚ï¼Œä½†æ˜¯æœåŠ¡å™¨çš„è¿”å›ä¸€ä¸ªçŠ¶æ€ç ï¼Œå®ƒä»¬éƒ½åœ¨2xxä¹‹å¤–
      const { dispatch } = store;

      if (status === 401) {
        dispatch(routerRedux.push('/user/login'));
      } else if (status === 403) {
        dispatch(routerRedux.push('/exception/403'));
      } else if (status &lt;= 504 &amp;&amp; status &gt;= 500) {
        dispatch(routerRedux.push('/exception/500'));
      } else if (status &gt;= 404 &amp;&amp; status &lt; 422) {
        dispatch(routerRedux.push('/exception/404'));
      }

      // å¼€å‘æ—¶ä½¿ç”¨ï¼Œä¸Šçº¿æ—¶åˆ é™¤
      console.log(`ã€${opt.method} ${opt.url}ã€‘è¯·æ±‚å¤±è´¥ï¼Œå“åº”æ•°æ®ï¼š%o`, error.response);

      return { code: status, message: errortext }; 
    });
</code></pre></div><ul><li>ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œé¦–å…ˆéœ€è¦æ ¹æ® <code>status</code> æ‰“å°æç¤ºæ¶ˆæ¯ï¼Œå‘Šè¯‰ç”¨æˆ·ä¸ºä»€ä¹ˆè¯·æ±‚å¤±è´¥ã€‚å¦‚å“åº”ç ä¸º <code>401</code>ï¼Œé‚£ä¹ˆæç¤ºç”¨æˆ·çš„æ–‡å­—å°±ä¼šæ˜¯ ç”¨æˆ·æ²¡æœ‰æƒé™ï¼ˆä»¤ç‰Œã€ç”¨æˆ·åã€å¯†ç é”™è¯¯ï¼‰</li> <li>å¦‚æœæ˜¯ <code>401</code> é”™è¯¯ï¼Œè¡¨ç¤ºç”¨æˆ·æ²¡æœ‰æƒé™è®¿é—®æˆ–è€…ç”¨æˆ·åå¯†ç è¾“å…¥é”™è¯¯ï¼Œåº”è¯¥è·³è½¬åˆ°ç™»å½•é¡µé¢ï¼š`dispatch(routerRedux.push('/user/login'));</li></ul></div> </body></html>