<!DOCTYPE html>
<!-- saved from url=(0049)http://interview.poetries.top/docs/excellent.html -->
<html lang="en-US" class=" "><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    
    <title>é«˜é¢‘è€ƒç‚¹ | é¢è¯•æŒ‡å—</title>
    
    <link rel="icon" href="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/logo.png">
    <link rel="manifest" href="http://interview.poetries.top/manifest.json">
    <link rel="apple-touch-icon" href="http://interview.poetries.top/icons/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="http://interview.poetries.top/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <link rel="preload" href="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/0.styles.a3a6df6c.css" as="style"><link rel="preload" href="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/app.545cb75b.js.ä¸‹è½½" as="script"><link rel="preload" href="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/5.bc663a4c.js.ä¸‹è½½" as="script"><link rel="preload" href="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/4.1aaf03c6.js.ä¸‹è½½" as="script"><link rel="preload" href="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/41.16e0641a.js.ä¸‹è½½" as="script"><link rel="preload" href="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/11.3e5297f1.js.ä¸‹è½½" as="script"><link rel="prefetch" href="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/1.d83c2af0.js.ä¸‹è½½"><link rel="prefetch" href="http://interview.poetries.top/assets/js/10.fdecf69b.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/100.df83f687.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/101.3986f029.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/102.1468be32.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/103.bfef2896.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/104.1731bbb1.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/105.710b118c.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/106.b955d37d.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/107.6f79a916.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/108.34ee5a8e.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/109.f6c05e4d.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/110.a375ddec.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/111.bcc5c187.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/112.afcfef56.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/113.2e7c6e37.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/114.9cfdb334.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/115.063815ec.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/116.4e29ee01.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/117.b106fd0d.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/118.e4e784f7.js"><link rel="prefetch" href="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/119.94fe014a.js.ä¸‹è½½"><link rel="prefetch" href="http://interview.poetries.top/assets/js/12.ac0bc851.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/13.57028e74.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/14.043c3e8a.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/15.a6d0032e.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/16.6094fda8.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/17.f17aa05b.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/18.9732bfb3.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/19.2c38a6bb.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/20.92742304.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/21.28c8a661.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/22.3222a772.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/23.8192ecea.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/24.b5156b88.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/25.034d5e81.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/26.c78d8f63.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/27.cd94c89c.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/28.b2c8e24c.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/29.e9a30c2c.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/3.f5ea6e07.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/30.2bd67425.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/31.6333035e.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/32.1a34dfa0.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/33.b5863ac0.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/34.cababd6c.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/35.0b09d4a2.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/36.8f89ed73.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/37.38d590c3.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/38.4799c402.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/39.f28d21e8.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/40.21e1dcb8.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/42.9ce6fd83.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/43.8936e729.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/44.5ebdd233.js"><link rel="prefetch" href="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/45.ce59a54c.js.ä¸‹è½½"><link rel="prefetch" href="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/46.b6f1380b.js.ä¸‹è½½"><link rel="prefetch" href="http://interview.poetries.top/assets/js/47.5fe8aac4.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/48.a31741eb.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/49.16132e72.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/50.ca74d5c9.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/51.f21f79ee.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/52.6ff2b7c5.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/53.003482ca.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/54.136b1210.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/55.5d00c7ca.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/56.cfa533e2.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/57.9275f210.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/58.dcf3e81b.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/59.5cbf4407.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/6.f2ac32df.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/60.ecfb5f55.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/61.8356d65b.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/62.8ca03065.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/63.a0c06a04.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/64.406f4c0f.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/65.9d0c9d57.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/66.ca2ccee4.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/67.b01df864.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/68.e99acf6a.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/69.f7dbb3b1.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/7.26b183c1.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/70.b3199540.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/71.d7c346c6.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/72.6afb9cd3.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/73.80370c6b.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/74.eec2a38b.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/75.fdbda41f.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/76.c8a9acd3.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/77.02560728.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/78.7a518fe7.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/79.01333f71.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/8.b6777e86.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/80.a7dfb481.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/81.29a3aa15.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/82.9039f284.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/83.e29f794c.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/84.9aea4d6e.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/85.6fa07b30.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/86.b0a530f1.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/87.a2c892ff.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/88.2c0ab353.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/89.0a6986cd.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/9.7231fa75.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/90.80c04201.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/91.19846beb.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/92.09ef3493.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/93.8bad40d8.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/94.f0810e7b.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/95.3a648c4f.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/96.827e7cb2.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/97.cc180b8f.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/98.d2138442.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/99.7e99e846.js">
    <link rel="stylesheet" href="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/0.styles.a3a6df6c.css">
  <style type="text/css">.medium-zoom-overlay{position:fixed;top:0;right:0;bottom:0;left:0;opacity:0;transition:opacity .3s;will-change:opacity}.medium-zoom--opened .medium-zoom-overlay{cursor:pointer;cursor:zoom-out;opacity:1}.medium-zoom-image{cursor:pointer;cursor:zoom-in;transition:transform .3s cubic-bezier(.2,0,.2,1)!important}.medium-zoom-image--hidden{visibility:hidden}.medium-zoom-image--opened{position:relative;cursor:pointer;cursor:zoom-out;will-change:transform}</style><script charset="utf-8" src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/119.94fe014a.js.ä¸‹è½½"></script><script charset="utf-8" src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/1.d83c2af0.js.ä¸‹è½½"></script><script charset="utf-8" src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/45.ce59a54c.js.ä¸‹è½½"></script><script charset="utf-8" src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/46.b6f1380b.js.ä¸‹è½½"></script><meta name="description" content="å‰ç«¯é¢è¯•æŒ‡å—ï¼Œå‰ç«¯é¢è¯•é¢˜æ•´ç†ï¼ŒæŒ‰æ¨¡å—åˆ†ç±»æ•´ç†æ€»ç»“ï¼Œæ‰“é€ æœ€å…¨é¢çš„å‰ç«¯é¢è¯•é¢˜"><meta name="theme-color" content="#3eaf7c"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png"><meta name="msapplication-TileColor" content="#000000"></head>
  <body class="" style="">
    <div id="app"><div class="theme-container"><header class="navbar" style="background: rgb(255, 255, 255);"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="http://interview.poetries.top/" class="home-link router-link-active"><img src="./åŸç†_files/logo.png" alt="é¢è¯•æŒ‡å—" class="logo"> <span class="site-name can-hide">é¢è¯•æŒ‡å—</span></a> <div class="links" style="background: rgb(255, 255, 255); max-width: 1771px;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value="" class="" placeholder=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div><a href="./index.html" class="nav-link">åŸºç¡€
    </a></div></div><div class="nav-item"><div><a href="./è¿›é˜¶.html" class="nav-link">âœ¨è¿›é˜¶
    </a></div></div><div class="nav-item"><div><a href="./ç²¾é€‰.html" class="nav-link">ğŸ‘ç²¾é€‰
    </a></div></div><div class="nav-item"><div><a href="./é«˜é¢‘.html" class="nav-link">ğŸ”¥é«˜é¢‘
    </a></div></div><div class="nav-item"><div><a href="./æŒ‡å—.html" class="nav-link">æŒ‡å—
    </a></div></div><div class="nav-item"><div><a href="./æ€§èƒ½.html" class="nav-link">æ€§èƒ½
    </a></div></div><div class="nav-item"><div><a href="./ç»¼åˆ.html" class="nav-link">ç»¼åˆ
    </a></div></div><div class="nav-item"><div><a href="./åŸç†.html" class="nav-link">åŸç†
    </a></div></div><div class="nav-item"><div><a href="./æ‰‹å†™.html" class="nav-link">æ‰‹å†™
    </a></div></div><div class="nav-item"><div><a href="./è‡ªæ£€.html" class="nav-link">è‡ªæ£€
    </a></div></div><div class="nav-item"><div><a href="./é¢ç».html" class="nav-link">â­é¢ç»
    </a></div></div><div class="nav-item"><div><a href="./æ¯æ—¥ä¸€é¢˜.html" class="nav-link">ğŸ’¥æ¯æ—¥ä¸€é¢˜
    </a></div></div><div class="nav-item"><div><a href="./è®¾è®¡æ¨¡å¼.html" class="nav-link">è®¾è®¡æ¨¡å¼
  </a></div></div><div class="nav-item"><div><a href="http://interview.poetries.top/algorithm-interview/note/01-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E2%80%94%E2%80%94%E4%BB%8E0%E5%88%B01%E6%8E%8C%E6%8F%A1%E7%AE%97%E6%B3%95%E9%9D%A2%E8%AF%95%E9%9C%80%E8%A6%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%88%E4%B8%80%EF%BC%89.html" class="nav-link">
  </a></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æ‹“å±•é˜…è¯»" class="dropdown-title"><span class="title">æ‹“å±•é˜…è¯»</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display: none;"><li class="dropdown-item"><h4>ä¸“é¢˜</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-base-docs/compute-docs/Linux.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-mobile-docs/h5-docs/1-%E5%A4%A7%E5%8E%82%20H5%20%E5%BC%80%E5%8F%91%E6%A6%82%E8%BF%B0.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-css-inspiration-docs/css-docs/note/01-%E6%B5%8F%E8%A7%88%E5%99%A8.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-vue-docs/learn-vue-base/base/1-Vue%20CLI%203%20%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA%E5%9F%BA%E7%A1%80.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-react-docs/react-web-action/01-%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E7%9A%84%E5%9B%9B%E4%B8%AA%E6%97%B6%E4%BB%A3.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-micro-docs/docs/01-%E5%BE%AE%E5%89%8D%E7%AB%AF%E7%9A%84%E8%AF%9E%E7%94%9F.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-engineering-docs/docs/npm-script.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-nodejs-docs/nodejs-docs/base/01-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-ts-axios-docs/ts-axios/chapter1/" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-algorithm-docs/algorithm/prepare/01-%E5%A6%82%E4%BD%95%E7%B3%BB%E7%BB%9F%E9%AB%98%E6%95%88%E5%9C%B0%E5%AD%A6%E4%B9%A0%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="https://blog.poetries.top/browser-working-principle/guide/part1/lesson01.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
      æµè§ˆå™¨åŸç†
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li><li class="dropdown-subitem"><div><a href="https://blog.poetries.top/http-protocol/notes/base/01-HTTP%E7%9A%84%E5%89%8D%E4%B8%96%E4%BB%8A%E7%94%9F.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
      HTTPåŸºç¡€
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/docs/webpack.html" class="nav-link">webpack
  </a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/docs/npm-script.html" class="nav-link">npmå·¥ä½œæµ
  </a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/docs/canvas.html" class="nav-link">Canvas
  </a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/docs/Taro.html" class="nav-link">TaroåŸç†
  </a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-nodejs-docs/nodejs-docs/base/01-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
      Nodeå­¦ä¹ æŒ‡å—
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-vue-docs/vue-analysis/prepare/" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
      Vueæºç åˆ†æ
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li></ul></li><li class="dropdown-item"><h4>å…¶ä»–</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-blog-docs/blog-docs/javascript/-Ajax%E6%80%BB%E7%BB%93%E7%AF%87.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
      æ—¥å¸¸ç§¯ç´¯
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li><li class="dropdown-subitem"><div><a href="http://blog.poetries.top/archives/" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
      åšæ–‡
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="background: rgb(255, 255, 255);"><nav class="nav-links"><div class="nav-item"><div><a href="http://interview.poetries.top/docs/base.html" class="nav-link">åŸºç¡€
  </a></div></div><div class="nav-item"><div><a href="http://interview.poetries.top/docs/simply.html" class="nav-link">âœ¨è¿›é˜¶
  </a></div></div><div class="nav-item"><div><a href="http://interview.poetries.top/excellent-docs/1-HTML%E6%A8%A1%E5%9D%97.html" class="nav-link">ğŸ‘ç²¾é€‰
  </a></div></div><div class="nav-item"><div><a href="http://interview.poetries.top/docs/excellent.html" class="nav-link router-link-exact-active router-link-active" aria-current="page">ğŸ”¥é«˜é¢‘
  </a></div></div><div class="nav-item"><div><a href="http://interview.poetries.top/docs/guide.html" class="nav-link">æŒ‡å—
  </a></div></div><div class="nav-item"><div><a href="http://interview.poetries.top/docs/performance.html" class="nav-link">æ€§èƒ½
  </a></div></div><div class="nav-item"><div><a href="http://interview.poetries.top/docs/detail-expain.html" class="nav-link">ç»¼åˆ
  </a></div></div><div class="nav-item"><div><a href="http://interview.poetries.top/principle-docs/comprehensive/01-%E8%99%9A%E6%8B%9FDOM%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90.html" class="nav-link">åŸç†
  </a></div></div><div class="nav-item"><div><a href="http://interview.poetries.top/docs/handwritten.html" class="nav-link">æ‰‹å†™
  </a></div></div><div class="nav-item"><div><a href="http://interview.poetries.top/qa/1-%E5%89%8D%E7%AB%AF100%E9%A2%98%E8%87%AA%E6%A3%80.html" class="nav-link">è‡ªæ£€
  </a></div></div><div class="nav-item"><div><a href="http://interview.poetries.top/interview-exp/%E5%89%8D%E7%AB%AF%E9%9D%A2%E7%BB%8F%E6%B1%87%E6%80%BB.html" class="nav-link">â­é¢ç»
  </a></div></div><div class="nav-item"><div><a href="http://interview.poetries.top/days/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98.html" class="nav-link">ğŸ’¥æ¯æ—¥ä¸€é¢˜
  </a></div></div><div class="nav-item"><div><a href="http://interview.poetries.top/docs/design-pattern.html" class="nav-link">è®¾è®¡æ¨¡å¼
  </a></div></div><div class="nav-item"><div><a href="http://interview.poetries.top/algorithm-interview/note/01-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E2%80%94%E2%80%94%E4%BB%8E0%E5%88%B01%E6%8E%8C%E6%8F%A1%E7%AE%97%E6%B3%95%E9%9D%A2%E8%AF%95%E9%9C%80%E8%A6%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%88%E4%B8%80%EF%BC%89.html" class="nav-link">
  </a></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æ‹“å±•é˜…è¯»" class="dropdown-title"><span class="title">æ‹“å±•é˜…è¯»</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display: none;"><li class="dropdown-item"><h4>ä¸“é¢˜</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-base-docs/compute-docs/Linux.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-mobile-docs/h5-docs/1-%E5%A4%A7%E5%8E%82%20H5%20%E5%BC%80%E5%8F%91%E6%A6%82%E8%BF%B0.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-css-inspiration-docs/css-docs/note/01-%E6%B5%8F%E8%A7%88%E5%99%A8.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-vue-docs/learn-vue-base/base/1-Vue%20CLI%203%20%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA%E5%9F%BA%E7%A1%80.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-react-docs/react-web-action/01-%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E7%9A%84%E5%9B%9B%E4%B8%AA%E6%97%B6%E4%BB%A3.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-micro-docs/docs/01-%E5%BE%AE%E5%89%8D%E7%AB%AF%E7%9A%84%E8%AF%9E%E7%94%9F.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-engineering-docs/docs/npm-script.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-nodejs-docs/nodejs-docs/base/01-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-ts-axios-docs/ts-axios/chapter1/" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-algorithm-docs/algorithm/prepare/01-%E5%A6%82%E4%BD%95%E7%B3%BB%E7%BB%9F%E9%AB%98%E6%95%88%E5%9C%B0%E5%AD%A6%E4%B9%A0%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="https://blog.poetries.top/browser-working-principle/guide/part1/lesson01.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
      æµè§ˆå™¨åŸç†
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li><li class="dropdown-subitem"><div><a href="https://blog.poetries.top/http-protocol/notes/base/01-HTTP%E7%9A%84%E5%89%8D%E4%B8%96%E4%BB%8A%E7%94%9F.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
      HTTPåŸºç¡€
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/docs/webpack.html" class="nav-link">webpack
  </a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/docs/npm-script.html" class="nav-link">npmå·¥ä½œæµ
  </a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/docs/canvas.html" class="nav-link">Canvas
  </a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/docs/Taro.html" class="nav-link">TaroåŸç†
  </a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-nodejs-docs/nodejs-docs/base/01-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
      Nodeå­¦ä¹ æŒ‡å—
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-vue-docs/vue-analysis/prepare/" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
      Vueæºç åˆ†æ
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li></ul></li><li class="dropdown-item"><h4>å…¶ä»–</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-blog-docs/blog-docs/javascript/-Ajax%E6%80%BB%E7%BB%93%E7%AF%87.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
      æ—¥å¸¸ç§¯ç´¯
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li><li class="dropdown-subitem"><div><a href="http://blog.poetries.top/archives/" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
      åšæ–‡
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li></ul></li></ul></div></div> <!----></nav> <div style="padding-left:1.5rem;"><div class="qr"><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/qr.ee193d28.jpg" alt="poetries" width="120" height="120" loading="lazy"> <p class="we-intro">
    å…³æ³¨å…¬ä¼—å·ï¼Œè·å–æ›´å¤šèµ„è®¯
  </p></div></div> <ul class="sidebar-links"><li><a href="http://interview.poetries.top/docs/base.html" class="sidebar-link">åŸºç¡€</a></li><li><a href="http://interview.poetries.top/docs/simply.html" class="sidebar-link">è¿›é˜¶</a></li><li><a href="http://interview.poetries.top/docs/excellent.html" class="active sidebar-link" aria-current="page">é«˜é¢‘</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_1-typeof%E7%B1%BB%E5%9E%8B%E5%88%A4%E6%96%AD" class="sidebar-link">1 typeofç±»å‹åˆ¤æ–­</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_2-%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2" class="sidebar-link">2 ç±»å‹è½¬æ¢</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_3-this" class="sidebar-link">3 This</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_4-%E5%92%8C-%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB" class="sidebar-link">4 == å’Œ === æœ‰ä»€ä¹ˆåŒºåˆ«</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_5-%E9%97%AD%E5%8C%85" class="sidebar-link">5 é—­åŒ…</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_6-%E6%B7%B1%E6%B5%85%E6%8B%B7%E8%B4%9D" class="sidebar-link">6 æ·±æµ…æ‹·è´</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_7-%E5%8E%9F%E5%9E%8B" class="sidebar-link">7 åŸå‹</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_8-var%E3%80%81let-%E5%8F%8A-const-%E5%8C%BA%E5%88%AB" class="sidebar-link">8 varã€let åŠ const åŒºåˆ«</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_9-%E5%8E%9F%E5%9E%8B%E7%BB%A7%E6%89%BF%E5%92%8C-class-%E7%BB%A7%E6%89%BF" class="sidebar-link">9 åŸå‹ç»§æ‰¿å’Œ Class ç»§æ‰¿</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_10-%E6%A8%A1%E5%9D%97%E5%8C%96" class="sidebar-link">10 æ¨¡å—åŒ–</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_11-%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E6%B4%81%E7%89%88%E7%9A%84promise" class="sidebar-link">11 å®ç°ä¸€ä¸ªç®€æ´ç‰ˆçš„promise</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_12-event-loop" class="sidebar-link">12 Event Loop</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_12-1-%E8%BF%9B%E7%A8%8B%E4%B8%8E%E7%BA%BF%E7%A8%8B" class="sidebar-link">12.1 è¿›ç¨‹ä¸çº¿ç¨‹</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_12-2-%E6%89%A7%E8%A1%8C%E6%A0%88" class="sidebar-link">12.2 æ‰§è¡Œæ ˆ</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_12-3-%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84-event-loop" class="sidebar-link">12.3 æµè§ˆå™¨ä¸­çš„ Event Loop</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_12-4-node-%E4%B8%AD%E7%9A%84-event-loop" class="sidebar-link">12.4 Node ä¸­çš„ Event loop</a></li></ul></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_13-%E6%89%8B%E5%86%99-call%E3%80%81apply-%E5%8F%8A-bind-%E5%87%BD%E6%95%B0" class="sidebar-link">13 æ‰‹å†™ callã€apply åŠ bind å‡½æ•°</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_14-new" class="sidebar-link">14 new</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_15-instanceof-%E7%9A%84%E5%8E%9F%E7%90%86" class="sidebar-link">15 instanceof çš„åŸç†</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_16-%E4%B8%BA%E4%BB%80%E4%B9%88-0-1-0-2-0-3" class="sidebar-link">16 ä¸ºä»€ä¹ˆ 0.1 + 0.2 != 0.3</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_17-%E4%BA%8B%E4%BB%B6%E6%9C%BA%E5%88%B6" class="sidebar-link">17 äº‹ä»¶æœºåˆ¶</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_17-1-%E4%BA%8B%E4%BB%B6%E8%A7%A6%E5%8F%91%E4%B8%89%E9%98%B6%E6%AE%B5" class="sidebar-link">17.1 äº‹ä»¶è§¦å‘ä¸‰é˜¶æ®µ</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_17-2-%E6%B3%A8%E5%86%8C%E4%BA%8B%E4%BB%B6" class="sidebar-link">17.2 æ³¨å†Œäº‹ä»¶</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_17-3-%E4%BA%8B%E4%BB%B6%E4%BB%A3%E7%90%86" class="sidebar-link">17.3 äº‹ä»¶ä»£ç†</a></li></ul></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_18-%E8%B7%A8%E5%9F%9F" class="sidebar-link">18 è·¨åŸŸ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_18-1-jsonp" class="sidebar-link">18.1 JSONP</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_18-2-cors" class="sidebar-link">18.2 CORS</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_18-3-document-domain" class="sidebar-link">18.3 document.domain</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_18-4-postmessage" class="sidebar-link">18.4 postMessage</a></li></ul></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_19-%E5%AD%98%E5%82%A8" class="sidebar-link">19 å­˜å‚¨</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_20-%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6" class="sidebar-link">20 æµè§ˆå™¨ç¼“å­˜æœºåˆ¶</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_20-1-%E7%BC%93%E5%AD%98%E4%BD%8D%E7%BD%AE" class="sidebar-link">20.1 ç¼“å­˜ä½ç½®</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_20-2-%E7%BC%93%E5%AD%98%E7%AD%96%E7%95%A5" class="sidebar-link">20.2 ç¼“å­˜ç­–ç•¥</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_20-2-1-%E5%BC%BA%E7%BC%93%E5%AD%98" class="sidebar-link">20.2.1 å¼ºç¼“å­˜</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_20-2-2-%E5%8D%8F%E5%95%86%E7%BC%93%E5%AD%98" class="sidebar-link">20.2.2 åå•†ç¼“å­˜</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_20-3-%E5%AE%9E%E9%99%85%E5%9C%BA%E6%99%AF%E5%BA%94%E7%94%A8%E7%BC%93%E5%AD%98%E7%AD%96%E7%95%A5" class="sidebar-link">20.3 å®é™…åœºæ™¯åº”ç”¨ç¼“å­˜ç­–ç•¥</a></li></ul></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_21-%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E5%8E%9F%E7%90%86" class="sidebar-link">21 æµè§ˆå™¨æ¸²æŸ“åŸç†</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_21-1-%E6%B8%B2%E6%9F%93%E8%BF%87%E7%A8%8B" class="sidebar-link">21.1 æ¸²æŸ“è¿‡ç¨‹</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_21-2-%E4%B8%BA%E4%BB%80%E4%B9%88%E6%93%8D%E4%BD%9C-dom-%E6%85%A2" class="sidebar-link">21.2 ä¸ºä»€ä¹ˆæ“ä½œ DOM æ…¢</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_21-3-%E4%BB%80%E4%B9%88%E6%83%85%E5%86%B5%E9%98%BB%E5%A1%9E%E6%B8%B2%E6%9F%93" class="sidebar-link">21.3 ä»€ä¹ˆæƒ…å†µé˜»å¡æ¸²æŸ“</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_21-4-%E9%87%8D%E7%BB%98-repaint-%E5%92%8C%E5%9B%9E%E6%B5%81-reflow" class="sidebar-link">21.4 é‡ç»˜ï¼ˆRepaintï¼‰å’Œå›æµï¼ˆReflowï¼‰</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_21-5-%E5%87%8F%E5%B0%91%E9%87%8D%E7%BB%98%E5%92%8C%E5%9B%9E%E6%B5%81" class="sidebar-link">21.5 å‡å°‘é‡ç»˜å’Œå›æµ</a></li></ul></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_22-%E5%AE%89%E5%85%A8%E9%98%B2%E8%8C%83" class="sidebar-link">22 å®‰å…¨é˜²èŒƒ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_22-1-xss" class="sidebar-link">22.1 XSS</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_22-2-csrf" class="sidebar-link">22.2 CSRF</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_22-3-%E7%82%B9%E5%87%BB%E5%8A%AB%E6%8C%81" class="sidebar-link">22.3 ç‚¹å‡»åŠ«æŒ</a></li></ul></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_23-%E4%BB%8E-v8-%E4%B8%AD%E7%9C%8B-js-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96" class="sidebar-link">23 ä» V8 ä¸­çœ‹ JS æ€§èƒ½ä¼˜åŒ–</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_23-1-%E6%B5%8B%E8%AF%95%E6%80%A7%E8%83%BD%E5%B7%A5%E5%85%B7" class="sidebar-link">23.1 æµ‹è¯•æ€§èƒ½å·¥å…·</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_23-2-js-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96" class="sidebar-link">23.2 JS æ€§èƒ½ä¼˜åŒ–</a></li></ul></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_24-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96" class="sidebar-link">24 æ€§èƒ½ä¼˜åŒ–</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_24-1-%E5%9B%BE%E7%89%87%E4%BC%98%E5%8C%96" class="sidebar-link">24.1 å›¾ç‰‡ä¼˜åŒ–</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_24-2-%E5%9B%BE%E7%89%87%E5%8A%A0%E8%BD%BD%E4%BC%98%E5%8C%96" class="sidebar-link">24.2 å›¾ç‰‡åŠ è½½ä¼˜åŒ–</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_24-3-dns-%E9%A2%84%E8%A7%A3%E6%9E%90" class="sidebar-link">24.3 DNS é¢„è§£æ</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_24-4-%E8%8A%82%E6%B5%81" class="sidebar-link">24.4 èŠ‚æµ</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_24-5-%E9%98%B2%E6%8A%96" class="sidebar-link">24.5 é˜²æŠ–</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_24-6-%E9%A2%84%E5%8A%A0%E8%BD%BD" class="sidebar-link">24.6 é¢„åŠ è½½</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_24-7-%E9%A2%84%E6%B8%B2%E6%9F%93" class="sidebar-link">24.7 é¢„æ¸²æŸ“</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_24-8-%E6%87%92%E6%89%A7%E8%A1%8C" class="sidebar-link">24.8 æ‡’æ‰§è¡Œ</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_24-9-%E6%87%92%E5%8A%A0%E8%BD%BD" class="sidebar-link">24.9 æ‡’åŠ è½½</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_24-10-cdn" class="sidebar-link">24.10 CDN</a></li></ul></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_25-webpack-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96" class="sidebar-link">25 Webpack æ€§èƒ½ä¼˜åŒ–</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_25-1-%E5%87%8F%E5%B0%91-webpack-%E6%89%93%E5%8C%85%E6%97%B6%E9%97%B4" class="sidebar-link">25.1 å‡å°‘ Webpack æ‰“åŒ…æ—¶é—´</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_25-2-%E5%87%8F%E5%B0%91-webpack-%E6%89%93%E5%8C%85%E5%90%8E%E7%9A%84%E6%96%87%E4%BB%B6%E4%BD%93%E7%A7%AF" class="sidebar-link">25.2 å‡å°‘ Webpack æ‰“åŒ…åçš„æ–‡ä»¶ä½“ç§¯</a></li></ul></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_26-%E5%AE%9E%E7%8E%B0%E5%B0%8F%E5%9E%8B%E6%89%93%E5%8C%85%E5%B7%A5%E5%85%B7" class="sidebar-link">26 å®ç°å°å‹æ‰“åŒ…å·¥å…·</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_27-mvvm-%E8%99%9A%E6%8B%9Fdom-%E5%89%8D%E7%AB%AF%E8%B7%AF%E7%94%B1" class="sidebar-link">27 MVVM/è™šæ‹ŸDOM/å‰ç«¯è·¯ç”±</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_27-1-mvvm" class="sidebar-link">27.1 MVVM</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_27-2-virtual-dom" class="sidebar-link">27.2 Virtual DOM</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_27-3-%E8%B7%AF%E7%94%B1%E5%8E%9F%E7%90%86" class="sidebar-link">27.3 è·¯ç”±åŸç†</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_27-4-vue-%E5%92%8C-react-%E4%B9%8B%E9%97%B4%E7%9A%84%E5%8C%BA%E5%88%AB" class="sidebar-link">27.4 Vue å’Œ React ä¹‹é—´çš„åŒºåˆ«</a></li></ul></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_28-vue%E5%B8%B8%E8%80%83%E7%9F%A5%E8%AF%86%E7%82%B9" class="sidebar-link">28 Vueå¸¸è€ƒçŸ¥è¯†ç‚¹</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_28-1-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E9%92%A9%E5%AD%90%E5%87%BD%E6%95%B0" class="sidebar-link">28.1 ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_28-2-%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1" class="sidebar-link">28.2 ç»„ä»¶é€šä¿¡</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_28-3-extend-%E8%83%BD%E5%81%9A%E4%BB%80%E4%B9%88" class="sidebar-link">28.3 extend èƒ½åšä»€ä¹ˆ</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_28-4-mixin-%E5%92%8C-mixins-%E5%8C%BA%E5%88%AB" class="sidebar-link">28.4 mixin å’Œ mixins åŒºåˆ«</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_28-5-computed-%E5%92%8C-watch-%E5%8C%BA%E5%88%AB" class="sidebar-link">28.5 computed å’Œ watch åŒºåˆ«</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_28-6-keep-alive-%E7%BB%84%E4%BB%B6%E6%9C%89%E4%BB%80%E4%B9%88%E4%BD%9C%E7%94%A8" class="sidebar-link">28.6 keep-alive ç»„ä»¶æœ‰ä»€ä¹ˆä½œç”¨</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_28-7-v-show-%E4%B8%8E-v-if-%E5%8C%BA%E5%88%AB" class="sidebar-link">28.7 v-show ä¸ v-if åŒºåˆ«</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_28-8-%E7%BB%84%E4%BB%B6%E4%B8%AD-data-%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E5%AF%B9%E8%B1%A1" class="sidebar-link">28.8 ç»„ä»¶ä¸­ data ä»€ä¹ˆæ—¶å€™å¯ä»¥ä½¿ç”¨å¯¹è±¡</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_28-9-%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86" class="sidebar-link">28.9 å“åº”å¼åŸç†</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_28-9-1-object-defineproperty-%E7%9A%84%E7%BC%BA%E9%99%B7" class="sidebar-link">28.9.1 Object.defineProperty çš„ç¼ºé™·</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_28-9-2-%E7%BC%96%E8%AF%91%E8%BF%87%E7%A8%8B" class="sidebar-link">28.9.2 ç¼–è¯‘è¿‡ç¨‹</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_28-9-3-nexttick-%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90" class="sidebar-link">28.9.3 NextTick åŸç†åˆ†æ</a></li></ul></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_29-react%E5%B8%B8%E8%80%83%E7%9F%A5%E8%AF%86%E7%82%B9" class="sidebar-link">29 Reactå¸¸è€ƒçŸ¥è¯†ç‚¹</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_29-1-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F" class="sidebar-link">29.1 ç”Ÿå‘½å‘¨æœŸ</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_29-2-setstate" class="sidebar-link">29.2 setState</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_29-3-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96" class="sidebar-link">29.3 æ€§èƒ½ä¼˜åŒ–</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_29-4-%E9%80%9A%E4%BF%A1" class="sidebar-link">29.4 é€šä¿¡</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_29-5-hoc-%E6%98%AF%E4%BB%80%E4%B9%88-%E7%9B%B8%E6%AF%94-mixins-%E6%9C%89%E4%BB%80%E4%B9%88%E4%BC%98%E7%82%B9" class="sidebar-link">29.5 HOC æ˜¯ä»€ä¹ˆï¼Ÿç›¸æ¯” mixins æœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿ</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_29-6-%E4%BA%8B%E4%BB%B6%E6%9C%BA%E5%88%B6" class="sidebar-link">29.6 äº‹ä»¶æœºåˆ¶</a></li></ul></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_30-%E7%9B%91%E6%8E%A7" class="sidebar-link">30 ç›‘æ§</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_30-1-%E9%A1%B5%E9%9D%A2%E5%9F%8B%E7%82%B9" class="sidebar-link">30.1 é¡µé¢åŸ‹ç‚¹</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_30-2-%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7" class="sidebar-link">30.2 æ€§èƒ½ç›‘æ§</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_30-3-%E5%BC%82%E5%B8%B8%E7%9B%91%E6%8E%A7" class="sidebar-link">30.3 å¼‚å¸¸ç›‘æ§</a></li></ul></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_31-tcp-udp" class="sidebar-link">31 TCP/UDP</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_31-1-udp" class="sidebar-link">31.1 UDP</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_31-2-tcp" class="sidebar-link">31.2 TCP</a></li></ul></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_32-http-tls" class="sidebar-link">32 HTTP/TLS</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_32-1-http-%E8%AF%B7%E6%B1%82%E4%B8%AD%E7%9A%84%E5%86%85%E5%AE%B9" class="sidebar-link">32.1 HTTP è¯·æ±‚ä¸­çš„å†…å®¹</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_32-2-tls" class="sidebar-link">32.2 TLS</a></li></ul></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_33-http2-0" class="sidebar-link">33 HTTP2.0</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_33-1-http-2" class="sidebar-link">33.1 HTTP/2</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_33-2-%E4%BA%8C%E8%BF%9B%E5%88%B6%E4%BC%A0%E8%BE%93" class="sidebar-link">33.2 äºŒè¿›åˆ¶ä¼ è¾“</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_33-3-%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8" class="sidebar-link">33.3 å¤šè·¯å¤ç”¨</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_33-4-header-%E5%8E%8B%E7%BC%A9" class="sidebar-link">33.4 Header å‹ç¼©</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_33-5-%E6%9C%8D%E5%8A%A1%E7%AB%AF-push" class="sidebar-link">33.5 æœåŠ¡ç«¯ Push</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_33-6-http-3" class="sidebar-link">33.6  HTTP/3</a></li></ul></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_34-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F" class="sidebar-link">34 è®¾è®¡æ¨¡å¼</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_34-1-%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F" class="sidebar-link">34.1 å·¥å‚æ¨¡å¼</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_34-2-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F" class="sidebar-link">34.2 å•ä¾‹æ¨¡å¼</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_34-3-%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F" class="sidebar-link">34.3 é€‚é…å™¨æ¨¡å¼</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_34-4-%E8%A3%85%E9%A5%B0%E6%A8%A1%E5%BC%8F" class="sidebar-link">34.4 è£…é¥°æ¨¡å¼</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_34-5-%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F" class="sidebar-link">34.5 ä»£ç†æ¨¡å¼</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_34-6-%E5%8F%91%E5%B8%83-%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F" class="sidebar-link">34.6 å‘å¸ƒ-è®¢é˜…æ¨¡å¼</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_34-7-%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F" class="sidebar-link">34.7 å¤–è§‚æ¨¡å¼</a></li></ul></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_35-%E5%B8%B8%E8%A7%81%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84" class="sidebar-link">35 å¸¸è§æ•°æ®ç»“æ„</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_35-1-%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6" class="sidebar-link">35.1 æ—¶é—´å¤æ‚åº¦</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_35-2-%E6%A0%88" class="sidebar-link">35.2 æ ˆ</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_35-3-%E5%BA%94%E7%94%A8" class="sidebar-link">35.3 åº”ç”¨</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_35-4-%E9%98%9F%E5%88%97" class="sidebar-link">35.4 é˜Ÿåˆ—</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_35-5-%E9%93%BE%E8%A1%A8" class="sidebar-link">35.5 é“¾è¡¨</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_35-6-%E6%A0%91" class="sidebar-link">35.6 æ ‘</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_35-7-avl-%E6%A0%91" class="sidebar-link">35.7 AVL æ ‘</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_35-8-trie" class="sidebar-link">35.8 Trie</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_35-9-%E5%B9%B6%E6%9F%A5%E9%9B%86" class="sidebar-link">35.9 å¹¶æŸ¥é›†</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_35-10-%E5%A0%86" class="sidebar-link">35.10 å †</a></li></ul></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_36-%E5%B8%B8%E8%80%83%E7%AE%97%E6%B3%95%E9%A2%98%E8%A7%A3%E6%9E%90" class="sidebar-link">36 å¸¸è€ƒç®—æ³•é¢˜è§£æ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_36-1-%E4%BD%8D%E8%BF%90%E7%AE%97" class="sidebar-link">36.1 ä½è¿ç®—</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_36-2-%E6%8E%92%E5%BA%8F" class="sidebar-link">36.2 æ’åº</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_36-2-1-%E5%86%92%E6%B3%A1%E6%8E%92%E5%BA%8F" class="sidebar-link">36.2.1 å†’æ³¡æ’åº</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_36-2-2-%E6%8F%92%E5%85%A5%E6%8E%92%E5%BA%8F" class="sidebar-link">36.2.2 æ’å…¥æ’åº</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_36-2-3-%E9%80%89%E6%8B%A9%E6%8E%92%E5%BA%8F" class="sidebar-link">36.2.3 é€‰æ‹©æ’åº</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_36-2-4-%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F" class="sidebar-link">36.2.4 å½’å¹¶æ’åº</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_36-2-5-%E5%BF%AB%E6%8E%92" class="sidebar-link">36.2.5 å¿«æ’</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_36-2-6-%E5%A0%86%E6%8E%92%E5%BA%8F" class="sidebar-link">36.2.6 å †æ’åº</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_36-3-%E9%93%BE%E8%A1%A8" class="sidebar-link">36.3 é“¾è¡¨</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_36-4-%E6%A0%91" class="sidebar-link">36.4 æ ‘</a></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_36-5-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92" class="sidebar-link">36.5 åŠ¨æ€è§„åˆ’</a></li></ul></li><li class="sidebar-sub-header"><a href="http://interview.poetries.top/docs/excellent.html#_37-css%E5%B8%B8%E8%80%83%E9%9D%A2%E8%AF%95%E9%A2%98%E8%A7%A3%E6%9E%90" class="sidebar-link">37 csså¸¸è€ƒé¢è¯•é¢˜è§£æ</a></li></ul></li><li><a href="http://interview.poetries.top/docs/guide.html" class="sidebar-link">æŒ‡å—</a></li><li><a href="http://interview.poetries.top/docs/performance.html" class="sidebar-link">æ€§èƒ½</a></li><li><a href="http://interview.poetries.top/docs/qa.html" class="sidebar-link">è‡ªæ£€</a></li><li><a href="http://interview.poetries.top/docs/detail-expain.html" class="sidebar-link">ç»¼åˆ</a></li><li><a href="http://interview.poetries.top/docs/handwritten.html" class="sidebar-link">æ‰‹å†™</a></li><li><a href="http://interview.poetries.top/docs/design-pattern.html" class="sidebar-link">è®¾è®¡æ¨¡å¼</a></li></ul> </aside> <main class="page"> <div id="container" class="theme-default-content pay-content"><div class="content__default"><h1 id="é«˜é¢‘è€ƒç‚¹"><a href="http://interview.poetries.top/docs/excellent.html#%E9%AB%98%E9%A2%91%E8%80%83%E7%82%B9" class="header-anchor">#</a> é«˜é¢‘è€ƒç‚¹</h1> <h2 id="_1-typeofç±»å‹åˆ¤æ–­"><a href="http://interview.poetries.top/docs/excellent.html#_1-typeof%E7%B1%BB%E5%9E%8B%E5%88%A4%E6%96%AD" class="header-anchor">#</a> 1 typeofç±»å‹åˆ¤æ–­</h2> <blockquote><p><code>typeof</code> æ˜¯å¦èƒ½æ­£ç¡®åˆ¤æ–­ç±»å‹ï¼Ÿ<code>instanceof</code> èƒ½æ­£ç¡®åˆ¤æ–­å¯¹è±¡çš„åŸç†æ˜¯ä»€ä¹ˆ</p></blockquote> <ul><li><code>typeof</code> å¯¹äºåŸå§‹ç±»å‹æ¥è¯´ï¼Œé™¤äº† <code>null</code> éƒ½å¯ä»¥æ˜¾ç¤ºæ­£ç¡®çš„ç±»å‹</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">typeof</span> <span class="token number">1</span> <span class="token comment">// 'number'</span>
<span class="token keyword">typeof</span> <span class="token string">'1'</span> <span class="token comment">// 'string'</span>
<span class="token keyword">typeof</span> <span class="token keyword">undefined</span> <span class="token comment">// 'undefined'</span>
<span class="token keyword">typeof</span> <span class="token boolean">true</span> <span class="token comment">// 'boolean'</span>
<span class="token keyword">typeof</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 'symbol'</span>
</code></pre></div><blockquote><p><code>typeof</code> å¯¹äºå¯¹è±¡æ¥è¯´ï¼Œé™¤äº†å‡½æ•°éƒ½ä¼šæ˜¾ç¤º <code>object</code>ï¼Œæ‰€ä»¥è¯´ <code>typeof</code> å¹¶ä¸èƒ½å‡†ç¡®åˆ¤æ–­å˜é‡åˆ°åº•æ˜¯ä»€ä¹ˆç±»å‹</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">typeof</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 'object'</span>
<span class="token keyword">typeof</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 'object'</span>
<span class="token keyword">typeof</span> console<span class="token punctuation">.</span>log <span class="token comment">// 'function'</span>
</code></pre></div><blockquote><p>å¦‚æœæˆ‘ä»¬æƒ³åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡çš„æ­£ç¡®ç±»å‹ï¼Œè¿™æ—¶å€™å¯ä»¥è€ƒè™‘ä½¿ç”¨ <code>instanceof</code>ï¼Œå› ä¸ºå†…éƒ¨æœºåˆ¶æ˜¯é€šè¿‡åŸå‹é“¾æ¥åˆ¤æ–­çš„</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">Person</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
p1 <span class="token keyword">instanceof</span> <span class="token class-name">Person</span> <span class="token comment">// true</span>

<span class="token keyword">var</span> str <span class="token operator">=</span> <span class="token string">'hello world'</span>
str <span class="token keyword">instanceof</span> <span class="token class-name">String</span> <span class="token comment">// false</span>

<span class="token keyword">var</span> str1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">)</span>
str1 <span class="token keyword">instanceof</span> <span class="token class-name">String</span> <span class="token comment">// true</span>
</code></pre></div><blockquote><p>å¯¹äºåŸå§‹ç±»å‹æ¥è¯´ï¼Œä½ æƒ³ç›´æ¥é€šè¿‡ <code>instanceof</code>æ¥åˆ¤æ–­ç±»å‹æ˜¯ä¸è¡Œçš„</p></blockquote> <h2 id="_2-ç±»å‹è½¬æ¢"><a href="http://interview.poetries.top/docs/excellent.html#_2-%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2" class="header-anchor">#</a> 2 ç±»å‹è½¬æ¢</h2> <blockquote><p>é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“ï¼Œåœ¨ <code>JS</code> ä¸­ç±»å‹è½¬æ¢åªæœ‰ä¸‰ç§æƒ…å†µï¼Œåˆ†åˆ«æ˜¯ï¼š</p></blockquote> <ul><li>è½¬æ¢ä¸ºå¸ƒå°”å€¼</li> <li>è½¬æ¢ä¸ºæ•°å­—</li> <li>è½¬æ¢ä¸ºå­—ç¬¦ä¸²</li></ul> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/1.png" alt="" class="medium-zoom-image"></p> <p><strong>è½¬Boolean</strong></p> <blockquote><p>åœ¨æ¡ä»¶åˆ¤æ–­æ—¶ï¼Œé™¤äº† <code>undefined</code>ï¼Œ<code>null</code>ï¼Œ <code>false</code>ï¼Œ <code>NaN</code>ï¼Œ <code>''</code>ï¼Œ <code>0</code>ï¼Œ <code>-0</code>ï¼Œå…¶ä»–æ‰€æœ‰å€¼éƒ½è½¬ä¸º <code>true</code>ï¼ŒåŒ…æ‹¬æ‰€æœ‰å¯¹è±¡</p></blockquote> <p><strong>å¯¹è±¡è½¬åŸå§‹ç±»å‹</strong></p> <blockquote><p>å¯¹è±¡åœ¨è½¬æ¢ç±»å‹çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨å†…ç½®çš„ <code>[[ToPrimitive]]</code> å‡½æ•°ï¼Œå¯¹äºè¯¥å‡½æ•°æ¥è¯´ï¼Œç®—æ³•é€»è¾‘ä¸€èˆ¬æ¥è¯´å¦‚ä¸‹</p></blockquote> <ul><li>å¦‚æœå·²ç»æ˜¯åŸå§‹ç±»å‹äº†ï¼Œé‚£å°±ä¸éœ€è¦è½¬æ¢äº†</li> <li>è°ƒç”¨ <code>x.valueOf()</code>ï¼Œå¦‚æœè½¬æ¢ä¸ºåŸºç¡€ç±»å‹ï¼Œå°±è¿”å›è½¬æ¢çš„å€¼</li> <li>è°ƒç”¨ <code>x.toString()</code>ï¼Œå¦‚æœè½¬æ¢ä¸ºåŸºç¡€ç±»å‹ï¼Œå°±è¿”å›è½¬æ¢çš„å€¼</li> <li>å¦‚æœéƒ½æ²¡æœ‰è¿”å›åŸå§‹ç±»å‹ï¼Œå°±ä¼šæŠ¥é”™</li></ul> <blockquote><p>å½“ç„¶ä½ ä¹Ÿå¯ä»¥é‡å†™ <code>Symbol.toPrimitive</code>ï¼Œè¯¥æ–¹æ³•åœ¨è½¬åŸå§‹ç±»å‹æ—¶è°ƒç”¨ä¼˜å…ˆçº§æœ€é«˜ã€‚</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'1'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>toPrimitive<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">2</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token number">1</span> <span class="token operator">+</span> a <span class="token comment">// =&gt; 3</span>
</code></pre></div><p><strong>å››åˆ™è¿ç®—ç¬¦</strong></p> <blockquote><p>å®ƒæœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š</p></blockquote> <ul><li>è¿ç®—ä¸­å…¶ä¸­ä¸€æ–¹ä¸ºå­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆå°±ä¼šæŠŠå¦ä¸€æ–¹ä¹Ÿè½¬æ¢ä¸ºå­—ç¬¦ä¸²</li> <li>å¦‚æœä¸€æ–¹ä¸æ˜¯å­—ç¬¦ä¸²æˆ–è€…æ•°å­—ï¼Œé‚£ä¹ˆä¼šå°†å®ƒè½¬æ¢ä¸ºæ•°å­—æˆ–è€…å­—ç¬¦ä¸²</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token number">1</span> <span class="token operator">+</span> <span class="token string">'1'</span> <span class="token comment">// '11'</span>
<span class="token boolean">true</span> <span class="token operator">+</span> <span class="token boolean">true</span> <span class="token comment">// 2</span>
<span class="token number">4</span> <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token comment">// "41,2,3"</span>
</code></pre></div><ul><li>å¯¹äºç¬¬ä¸€è¡Œä»£ç æ¥è¯´ï¼Œè§¦å‘ç‰¹ç‚¹ä¸€ï¼Œæ‰€ä»¥å°†æ•°å­— <code>1</code> è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œå¾—åˆ°ç»“æœ <code>'11'</code></li> <li>å¯¹äºç¬¬äºŒè¡Œä»£ç æ¥è¯´ï¼Œè§¦å‘ç‰¹ç‚¹äºŒï¼Œæ‰€ä»¥å°† <code>true</code> è½¬ä¸ºæ•°å­— <code>1</code></li> <li>å¯¹äºç¬¬ä¸‰è¡Œä»£ç æ¥è¯´ï¼Œè§¦å‘ç‰¹ç‚¹äºŒï¼Œæ‰€ä»¥å°†æ•°ç»„é€šè¿‡ <code>toString</code>è½¬ä¸ºå­—ç¬¦ä¸² <code>1,2,3</code>ï¼Œå¾—åˆ°ç»“æœ <code>41,2,3</code></li></ul> <blockquote><p>å¦å¤–å¯¹äºåŠ æ³•è¿˜éœ€è¦æ³¨æ„è¿™ä¸ªè¡¨è¾¾å¼ <code>'a' + + 'b'</code></p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>'a' + + 'b' // -&gt; "aNaN"
</code></pre></div><ul><li>å› ä¸º <code>+ 'b'</code> ç­‰äº <code>NaN</code>ï¼Œæ‰€ä»¥ç»“æœä¸º <code>"aNaN"</code>ï¼Œä½ å¯èƒ½ä¹Ÿä¼šåœ¨ä¸€äº›ä»£ç ä¸­çœ‹åˆ°è¿‡ <code>+ '1'</code>çš„å½¢å¼æ¥å¿«é€Ÿè·å– <code>number</code> ç±»å‹ã€‚</li> <li>é‚£ä¹ˆå¯¹äºé™¤äº†åŠ æ³•çš„è¿ç®—ç¬¦æ¥è¯´ï¼Œåªè¦å…¶ä¸­ä¸€æ–¹æ˜¯æ•°å­—ï¼Œé‚£ä¹ˆå¦ä¸€æ–¹å°±ä¼šè¢«è½¬ä¸ºæ•°å­—</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token number">4</span> <span class="token operator">*</span> <span class="token string">'3'</span> <span class="token comment">// 12</span>
<span class="token number">4</span> <span class="token operator">*</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 0</span>
<span class="token number">4</span> <span class="token operator">*</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token comment">// NaN</span>
</code></pre></div><p><strong>æ¯”è¾ƒè¿ç®—ç¬¦</strong></p> <ul><li>å¦‚æœæ˜¯å¯¹è±¡ï¼Œå°±é€šè¿‡ <code>toPrimitive</code> è½¬æ¢å¯¹è±¡</li> <li>å¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œå°±é€šè¿‡ <code>unicode</code> å­—ç¬¦ç´¢å¼•æ¥æ¯”è¾ƒ</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'1'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
a <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token comment">// true</span>
</code></pre></div><blockquote><p>åœ¨ä»¥ä¸Šä»£ç ä¸­ï¼Œå› ä¸º <code>a</code> æ˜¯å¯¹è±¡ï¼Œæ‰€ä»¥ä¼šé€šè¿‡ <code>valueOf</code> è½¬æ¢ä¸ºåŸå§‹ç±»å‹å†æ¯”è¾ƒå€¼ã€‚</p></blockquote> <h2 id="_3-this"><a href="http://interview.poetries.top/docs/excellent.html#_3-this" class="header-anchor">#</a> 3 This</h2> <blockquote><p>æˆ‘ä»¬å…ˆæ¥çœ‹å‡ ä¸ªå‡½æ•°è°ƒç”¨çš„åœºæ™¯</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  foo<span class="token operator">:</span> foo
<span class="token punctuation">}</span>
obj<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>å¯¹äºç›´æ¥è°ƒç”¨ <code>foo</code> æ¥è¯´ï¼Œä¸ç®¡ <code>foo</code> å‡½æ•°è¢«æ”¾åœ¨äº†ä»€ä¹ˆåœ°æ–¹ï¼Œ<code>this</code> ä¸€å®šæ˜¯<code>window</code></li> <li>å¯¹äº <code>obj.foo()</code> æ¥è¯´ï¼Œæˆ‘ä»¬åªéœ€è¦è®°ä½ï¼Œè°è°ƒç”¨äº†å‡½æ•°ï¼Œè°å°±æ˜¯ <code>this</code>ï¼Œæ‰€ä»¥åœ¨è¿™ä¸ªåœºæ™¯ä¸‹ <code>foo</code> å‡½æ•°ä¸­çš„ <code>this</code> å°±æ˜¯ <code>obj</code> å¯¹è±¡</li> <li>å¯¹äº <code>new</code> çš„æ–¹å¼æ¥è¯´ï¼Œ<code>this</code> è¢«æ°¸è¿œç»‘å®šåœ¨äº† <code>c</code> ä¸Šé¢ï¼Œä¸ä¼šè¢«ä»»ä½•æ–¹å¼æ”¹å˜ <code>this</code></li></ul> <blockquote><p>è¯´å®Œäº†ä»¥ä¸Šå‡ ç§æƒ…å†µï¼Œå…¶å®å¾ˆå¤šä»£ç ä¸­çš„ <code>this</code> åº”è¯¥å°±æ²¡ä»€ä¹ˆé—®é¢˜äº†ï¼Œä¸‹é¢è®©æˆ‘ä»¬çœ‹çœ‹ç®­å¤´å‡½æ•°ä¸­çš„ <code>this</code></p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>é¦–å…ˆç®­å¤´å‡½æ•°å…¶å®æ˜¯æ²¡æœ‰ <code>this</code> çš„ï¼Œç®­å¤´å‡½æ•°ä¸­çš„ <code>this</code> åªå–å†³åŒ…è£¹ç®­å¤´å‡½æ•°çš„ç¬¬ä¸€ä¸ªæ™®é€šå‡½æ•°çš„ <code>this</code>ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå› ä¸ºåŒ…è£¹ç®­å¤´å‡½æ•°çš„ç¬¬ä¸€ä¸ªæ™®é€šå‡½æ•°æ˜¯ <code>a</code>ï¼Œæ‰€ä»¥æ­¤æ—¶çš„ <code>this</code> æ˜¯ <code>window</code>ã€‚å¦å¤–å¯¹ç®­å¤´å‡½æ•°ä½¿ç”¨ <code>bind</code>è¿™ç±»å‡½æ•°æ˜¯æ— æ•ˆçš„ã€‚</li> <li>æœ€åç§æƒ…å†µä¹Ÿå°±æ˜¯ <code>bind</code> è¿™äº›æ”¹å˜ä¸Šä¸‹æ–‡çš„ <code>API</code> äº†ï¼Œå¯¹äºè¿™äº›å‡½æ•°æ¥è¯´ï¼Œ<code>this</code> å–å†³äºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå¦‚æœç¬¬ä¸€ä¸ªå‚æ•°ä¸ºç©ºï¼Œé‚£ä¹ˆå°±æ˜¯ <code>window</code>ã€‚</li> <li>é‚£ä¹ˆè¯´åˆ° <code>bind</code>ï¼Œä¸çŸ¥é“å¤§å®¶æ˜¯å¦è€ƒè™‘è¿‡ï¼Œå¦‚æœå¯¹ä¸€ä¸ªå‡½æ•°è¿›è¡Œå¤šæ¬¡ <code>bind</code>ï¼Œé‚£ä¹ˆä¸Šä¸‹æ–‡ä¼šæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">let</span> <span class="token function-variable function">fn</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; ?</span>
</code></pre></div><blockquote><p>å¦‚æœä½ è®¤ä¸ºè¾“å‡ºç»“æœæ˜¯ <code>a</code>ï¼Œé‚£ä¹ˆä½ å°±é”™äº†ï¼Œå…¶å®æˆ‘ä»¬å¯ä»¥æŠŠä¸Šè¿°ä»£ç è½¬æ¢æˆå¦ä¸€ç§å½¢å¼</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// fn.bind().bind(a) ç­‰äº</span>
<span class="token keyword">let</span> <span class="token function-variable function">fn2</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">fn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">fn2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>å¯ä»¥ä»ä¸Šè¿°ä»£ç ä¸­å‘ç°ï¼Œä¸ç®¡æˆ‘ä»¬ç»™å‡½æ•° <code>bind</code> å‡ æ¬¡ï¼Œ<code>fn</code> ä¸­çš„ <code>this</code> æ°¸è¿œç”±ç¬¬ä¸€æ¬¡ <code>bind</code> å†³å®šï¼Œæ‰€ä»¥ç»“æœæ°¸è¿œæ˜¯ <code>window</code></p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'poetries'</span> <span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; 'poetries'</span>
</code></pre></div><blockquote><p>ä»¥ä¸Šå°±æ˜¯ <code>this</code> çš„è§„åˆ™äº†ï¼Œä½†æ˜¯å¯èƒ½ä¼šå‘ç”Ÿå¤šä¸ªè§„åˆ™åŒæ—¶å‡ºç°çš„æƒ…å†µï¼Œè¿™æ—¶å€™ä¸åŒçš„è§„åˆ™ä¹‹é—´ä¼šæ ¹æ®ä¼˜å…ˆçº§æœ€é«˜çš„æ¥å†³å®š <code>this</code> æœ€ç»ˆæŒ‡å‘å“ªé‡Œã€‚</p></blockquote> <blockquote><p>é¦–å…ˆï¼Œ<code>new</code> çš„æ–¹å¼ä¼˜å…ˆçº§æœ€é«˜ï¼Œæ¥ä¸‹æ¥æ˜¯ <code>bind</code> è¿™äº›å‡½æ•°ï¼Œç„¶åæ˜¯ <code>obj.foo()</code> è¿™ç§è°ƒç”¨æ–¹å¼ï¼Œæœ€åæ˜¯ <code>foo</code> è¿™ç§è°ƒç”¨æ–¹å¼ï¼ŒåŒæ—¶ï¼Œç®­å¤´å‡½æ•°çš„ <code>this</code> ä¸€æ—¦è¢«ç»‘å®šï¼Œå°±ä¸ä¼šå†è¢«ä»»ä½•æ–¹å¼æ‰€æ”¹å˜ã€‚</p></blockquote> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/2.png" alt="image.png" class="medium-zoom-image"></p> <h2 id="_4-å’Œ-æœ‰ä»€ä¹ˆåŒºåˆ«"><a href="http://interview.poetries.top/docs/excellent.html#_4-%E5%92%8C-%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB" class="header-anchor">#</a> 4 == å’Œ === æœ‰ä»€ä¹ˆåŒºåˆ«</h2> <blockquote><p>å¯¹äº <code>==</code> æ¥è¯´ï¼Œå¦‚æœå¯¹æ¯”åŒæ–¹çš„ç±»å‹ä¸ä¸€æ ·çš„è¯ï¼Œå°±ä¼šè¿›è¡Œç±»å‹è½¬æ¢</p></blockquote> <p><strong>å‡å¦‚æˆ‘ä»¬éœ€è¦å¯¹æ¯” x å’Œ y æ˜¯å¦ç›¸åŒï¼Œå°±ä¼šè¿›è¡Œå¦‚ä¸‹åˆ¤æ–­æµç¨‹</strong></p> <ol><li>é¦–å…ˆä¼šåˆ¤æ–­ä¸¤è€…ç±»å‹æ˜¯å¦ç›¸åŒã€‚ç›¸åŒçš„è¯å°±æ˜¯æ¯”å¤§å°äº†</li> <li>ç±»å‹ä¸ç›¸åŒçš„è¯ï¼Œé‚£ä¹ˆå°±ä¼šè¿›è¡Œç±»å‹è½¬æ¢</li> <li>ä¼šå…ˆåˆ¤æ–­æ˜¯å¦åœ¨å¯¹æ¯” <code>null</code> å’Œ <code>undefined</code>ï¼Œæ˜¯çš„è¯å°±ä¼šè¿”å› <code>true</code></li> <li>åˆ¤æ–­ä¸¤è€…ç±»å‹æ˜¯å¦ä¸º <code>string</code> å’Œ <code>number</code>ï¼Œæ˜¯çš„è¯å°±ä¼šå°†å­—ç¬¦ä¸²è½¬æ¢ä¸º <code>number</code></li></ol> <div class="language- extra-class"><pre class="language-text"><code>1 == '1'
      â†“
1 ==  1
</code></pre></div><ol start="5"><li>åˆ¤æ–­å…¶ä¸­ä¸€æ–¹æ˜¯å¦ä¸º <code>boolean</code>ï¼Œæ˜¯çš„è¯å°±ä¼šæŠŠ <code>boolean</code> è½¬ä¸º <code>number</code> å†è¿›è¡Œåˆ¤æ–­</li></ol> <div class="language- extra-class"><pre class="language-text"><code>'1' == true
        â†“
'1' ==  1
        â†“
 1  ==  1
</code></pre></div><ol start="6"><li>åˆ¤æ–­å…¶ä¸­ä¸€æ–¹æ˜¯å¦ä¸º <code>object</code> ä¸”å¦ä¸€æ–¹ä¸º <code>string</code>ã€<code>number</code> æˆ–è€… <code>symbol</code>ï¼Œæ˜¯çš„è¯å°±ä¼šæŠŠ <code>object</code> è½¬ä¸ºåŸå§‹ç±»å‹å†è¿›è¡Œåˆ¤æ–­</li></ol> <div class="language- extra-class"><pre class="language-text"><code>'1' == { name: 'yck' }
        â†“
'1' == '[object Object]'
</code></pre></div><p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/3.png" alt="image.png" class="medium-zoom-image"></p> <blockquote><p>å¯¹äº <code>===</code> æ¥è¯´å°±ç®€å•å¤šäº†ï¼Œå°±æ˜¯åˆ¤æ–­ä¸¤è€…ç±»å‹å’Œå€¼æ˜¯å¦ç›¸åŒ</p></blockquote> <h2 id="_5-é—­åŒ…"><a href="http://interview.poetries.top/docs/excellent.html#_5-%E9%97%AD%E5%8C%85" class="header-anchor">#</a> 5 é—­åŒ…</h2> <blockquote><p>é—­åŒ…çš„å®šä¹‰å…¶å®å¾ˆç®€å•ï¼šå‡½æ•° <code>A</code> å†…éƒ¨æœ‰ä¸€ä¸ªå‡½æ•° <code>B</code>ï¼Œå‡½æ•° <code>B</code> å¯ä»¥è®¿é—®åˆ°å‡½æ•° <code>A</code> ä¸­çš„å˜é‡ï¼Œé‚£ä¹ˆå‡½æ•° <code>B</code> å°±æ˜¯é—­åŒ…</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token constant">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">1</span>
  window<span class="token punctuation">.</span><span class="token function-variable function">B</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token constant">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token constant">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>
</code></pre></div><p><strong>é—­åŒ…å­˜åœ¨çš„æ„ä¹‰å°±æ˜¯è®©æˆ‘ä»¬å¯ä»¥é—´æ¥è®¿é—®å‡½æ•°å†…éƒ¨çš„å˜é‡</strong></p> <blockquote><p>ç»å…¸é¢è¯•é¢˜ï¼Œå¾ªç¯ä¸­ä½¿ç”¨é—­åŒ…è§£å†³ <code>var</code> å®šä¹‰å‡½æ•°çš„é—®é¢˜</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> i <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><blockquote><p>é¦–å…ˆå› ä¸º <code>setTimeout</code> æ˜¯ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œæ‰€ä»¥ä¼šå…ˆæŠŠå¾ªç¯å…¨éƒ¨æ‰§è¡Œå®Œæ¯•ï¼Œè¿™æ—¶å€™ <code>i</code>å°±æ˜¯ <code>6</code> äº†ï¼Œæ‰€ä»¥ä¼šè¾“å‡ºä¸€å † <code>6</code></p></blockquote> <p><strong>è§£å†³åŠæ³•æœ‰ä¸‰ç§</strong></p> <ol><li>ç¬¬ä¸€ç§æ˜¯ä½¿ç”¨é—­åŒ…çš„æ–¹å¼</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">j</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> j <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆä½¿ç”¨äº†ç«‹å³æ‰§è¡Œå‡½æ•°å°† <code>i</code> ä¼ å…¥å‡½æ•°å†…éƒ¨ï¼Œè¿™ä¸ªæ—¶å€™å€¼å°±è¢«å›ºå®šåœ¨äº†å‚æ•° <code>j</code> ä¸Šé¢ä¸ä¼šæ”¹å˜ï¼Œå½“ä¸‹æ¬¡æ‰§è¡Œ <code>timer</code> è¿™ä¸ªé—­åŒ…çš„æ—¶å€™ï¼Œå°±å¯ä»¥ä½¿ç”¨å¤–éƒ¨å‡½æ•°çš„å˜é‡ <code>j</code>ï¼Œä»è€Œè¾¾åˆ°ç›®çš„</p></blockquote> <ol start="2"><li>ç¬¬äºŒç§å°±æ˜¯ä½¿ç”¨ <code>setTimeout</code> çš„ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°ä¼šè¢«å½“æˆ <code>timer</code> å‡½æ•°çš„å‚æ•°ä¼ å…¥</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span>
    <span class="token keyword">function</span> <span class="token function">timer</span><span class="token punctuation">(</span><span class="token parameter">j</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    i <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">,</span>
    i
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>ç¬¬ä¸‰ç§å°±æ˜¯ä½¿ç”¨ <code>let</code> å®šä¹‰ <code>i</code> äº†æ¥è§£å†³é—®é¢˜äº†ï¼Œè¿™ä¸ªä¹Ÿæ˜¯æœ€ä¸ºæ¨èçš„æ–¹å¼</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> i <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_6-æ·±æµ…æ‹·è´"><a href="http://interview.poetries.top/docs/excellent.html#_6-%E6%B7%B1%E6%B5%85%E6%8B%B7%E8%B4%9D" class="header-anchor">#</a> 6 æ·±æµ…æ‹·è´</h2> <p><strong>æµ…æ‹·è´</strong></p> <blockquote><p>é¦–å…ˆå¯ä»¥é€šè¿‡ <code>Object.assign</code> æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¾ˆå¤šäººè®¤ä¸ºè¿™ä¸ªå‡½æ•°æ˜¯ç”¨æ¥æ·±æ‹·è´çš„ã€‚å…¶å®å¹¶ä¸æ˜¯ï¼Œ<code>Object.assign</code> åªä¼šæ‹·è´æ‰€æœ‰çš„å±æ€§å€¼åˆ°æ–°çš„å¯¹è±¡ä¸­ï¼Œå¦‚æœå±æ€§å€¼æ˜¯å¯¹è±¡çš„è¯ï¼Œæ‹·è´çš„æ˜¯åœ°å€ï¼Œæ‰€ä»¥å¹¶ä¸æ˜¯æ·±æ‹·è´</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>
  age<span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span>
a<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>age<span class="token punctuation">)</span> <span class="token comment">// 1</span>
</code></pre></div><blockquote><p>å¦å¤–æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡å±•å¼€è¿ç®—ç¬¦ <code>...</code> æ¥å®ç°æµ…æ‹·è´</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>
  age<span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>a <span class="token punctuation">}</span>
a<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>age<span class="token punctuation">)</span> <span class="token comment">// 1</span>
</code></pre></div><blockquote><p>é€šå¸¸æµ…æ‹·è´å°±èƒ½è§£å†³å¤§éƒ¨åˆ†é—®é¢˜äº†ï¼Œä½†æ˜¯å½“æˆ‘ä»¬é‡åˆ°å¦‚ä¸‹æƒ…å†µå°±å¯èƒ½éœ€è¦ä½¿ç”¨åˆ°æ·±æ‹·è´äº†</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>
  age<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  jobs<span class="token operator">:</span> <span class="token punctuation">{</span>
    first<span class="token operator">:</span> <span class="token string">'FE'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>a <span class="token punctuation">}</span>
a<span class="token punctuation">.</span>jobs<span class="token punctuation">.</span>first <span class="token operator">=</span> <span class="token string">'native'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>jobs<span class="token punctuation">.</span>first<span class="token punctuation">)</span> <span class="token comment">// native</span>
</code></pre></div><blockquote><p>æµ…æ‹·è´åªè§£å†³äº†ç¬¬ä¸€å±‚çš„é—®é¢˜ï¼Œå¦‚æœæ¥ä¸‹å»çš„å€¼ä¸­è¿˜æœ‰å¯¹è±¡çš„è¯ï¼Œé‚£ä¹ˆå°±åˆå›åˆ°æœ€å¼€å§‹çš„è¯é¢˜äº†ï¼Œä¸¤è€…äº«æœ‰ç›¸åŒçš„åœ°å€ã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°±å¾—ä½¿ç”¨æ·±æ‹·è´äº†ã€‚</p></blockquote> <p><strong>æ·±æ‹·è´</strong></p> <blockquote><p>è¿™ä¸ªé—®é¢˜é€šå¸¸å¯ä»¥é€šè¿‡ <code>JSON.parse(JSON.stringify(object))</code> æ¥è§£å†³ã€‚</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>
  age<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  jobs<span class="token operator">:</span> <span class="token punctuation">{</span>
    first<span class="token operator">:</span> <span class="token string">'FE'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>
a<span class="token punctuation">.</span>jobs<span class="token punctuation">.</span>first <span class="token operator">=</span> <span class="token string">'native'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>jobs<span class="token punctuation">.</span>first<span class="token punctuation">)</span> <span class="token comment">// FE</span>
</code></pre></div><p><strong>ä½†æ˜¯è¯¥æ–¹æ³•ä¹Ÿæ˜¯æœ‰å±€é™æ€§çš„</strong>ï¼š</p> <ul><li>ä¼šå¿½ç•¥ <code>undefined</code></li> <li>ä¼šå¿½ç•¥ <code>symbol</code></li> <li>ä¸èƒ½åºåˆ—åŒ–å‡½æ•°</li> <li>ä¸èƒ½è§£å†³å¾ªç¯å¼•ç”¨çš„å¯¹è±¡</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  b<span class="token operator">:</span> <span class="token punctuation">{</span>
    c<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    d<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
obj<span class="token punctuation">.</span>c <span class="token operator">=</span> obj<span class="token punctuation">.</span>b
obj<span class="token punctuation">.</span>e <span class="token operator">=</span> obj<span class="token punctuation">.</span>a
obj<span class="token punctuation">.</span>b<span class="token punctuation">.</span>c <span class="token operator">=</span> obj<span class="token punctuation">.</span>c
obj<span class="token punctuation">.</span>b<span class="token punctuation">.</span>d <span class="token operator">=</span> obj<span class="token punctuation">.</span>b
obj<span class="token punctuation">.</span>b<span class="token punctuation">.</span>e <span class="token operator">=</span> obj<span class="token punctuation">.</span>b<span class="token punctuation">.</span>c
<span class="token keyword">let</span> newObj <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newObj<span class="token punctuation">)</span>

</code></pre></div><blockquote><p>æ›´å¤šè¯¦æƒ… https://www.jianshu.com/p/2d8a26b3958f</p></blockquote> <h2 id="_7-åŸå‹"><a href="http://interview.poetries.top/docs/excellent.html#_7-%E5%8E%9F%E5%9E%8B" class="header-anchor">#</a> 7 åŸå‹</h2> <blockquote><p>åŸå‹é“¾å°±æ˜¯å¤šä¸ªå¯¹è±¡é€šè¿‡ <code>__proto__</code> çš„æ–¹å¼è¿æ¥äº†èµ·æ¥ã€‚ä¸ºä»€ä¹ˆ <code>obj</code> å¯ä»¥è®¿é—®åˆ° <code>valueOf</code> å‡½æ•°ï¼Œå°±æ˜¯å› ä¸º <code>obj</code> é€šè¿‡åŸå‹é“¾æ‰¾åˆ°äº† <code>valueOf</code> å‡½æ•°</p></blockquote> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/1(1).png" alt="" class="medium-zoom-image"></p> <ul><li><code>Object</code> æ˜¯æ‰€æœ‰å¯¹è±¡çš„çˆ¸çˆ¸ï¼Œæ‰€æœ‰å¯¹è±¡éƒ½å¯ä»¥é€šè¿‡ <code>__proto__</code>æ‰¾åˆ°å®ƒ</li> <li><code>Function</code> æ˜¯æ‰€æœ‰å‡½æ•°çš„çˆ¸çˆ¸ï¼Œæ‰€æœ‰å‡½æ•°éƒ½å¯ä»¥é€šè¿‡ <code>__proto__</code> æ‰¾åˆ°å®ƒ</li> <li>å‡½æ•°çš„ <code>prototype</code> æ˜¯ä¸€ä¸ªå¯¹è±¡</li> <li>å¯¹è±¡çš„<code>__proto__</code> å±æ€§æŒ‡å‘åŸå‹ï¼Œ <code>__proto__</code> å°†å¯¹è±¡å’ŒåŸå‹è¿æ¥èµ·æ¥ç»„æˆäº†åŸå‹é“¾</li></ul> <h2 id="_8-varã€let-åŠ-const-åŒºåˆ«"><a href="http://interview.poetries.top/docs/excellent.html#_8-var%E3%80%81let-%E5%8F%8A-const-%E5%8C%BA%E5%88%AB" class="header-anchor">#</a> 8 varã€let åŠ const åŒºåˆ«</h2> <blockquote><p>æ¶‰åŠé¢è¯•é¢˜ï¼šä»€ä¹ˆæ˜¯æå‡ï¼Ÿä»€ä¹ˆæ˜¯æš‚æ—¶æ€§æ­»åŒºï¼Ÿvarã€let åŠ const åŒºåˆ«ï¼Ÿ</p></blockquote> <ul><li>å‡½æ•°æå‡ä¼˜å…ˆäºå˜é‡æå‡ï¼Œå‡½æ•°æå‡ä¼šæŠŠæ•´ä¸ªå‡½æ•°æŒªåˆ°ä½œç”¨åŸŸé¡¶éƒ¨ï¼Œå˜é‡æå‡åªä¼šæŠŠå£°æ˜æŒªåˆ°ä½œç”¨åŸŸé¡¶éƒ¨</li> <li><code>var</code> å­˜åœ¨æå‡ï¼Œæˆ‘ä»¬èƒ½åœ¨å£°æ˜ä¹‹å‰ä½¿ç”¨ã€‚<code>let</code>ã€<code>const</code> å› ä¸ºæš‚æ—¶æ€§æ­»åŒºçš„åŸå› ï¼Œä¸èƒ½åœ¨å£°æ˜å‰ä½¿ç”¨</li> <li><code>var</code> åœ¨å…¨å±€ä½œç”¨åŸŸä¸‹å£°æ˜å˜é‡ä¼šå¯¼è‡´å˜é‡æŒ‚è½½åœ¨ <code>window</code>ä¸Šï¼Œå…¶ä»–ä¸¤è€…ä¸ä¼š</li> <li><code>let</code> å’Œ <code>const</code> ä½œç”¨åŸºæœ¬ä¸€è‡´ï¼Œä½†æ˜¯åè€…å£°æ˜çš„å˜é‡ä¸èƒ½å†æ¬¡èµ‹å€¼</li></ul> <h2 id="_9-åŸå‹ç»§æ‰¿å’Œ-class-ç»§æ‰¿"><a href="http://interview.poetries.top/docs/excellent.html#_9-%E5%8E%9F%E5%9E%8B%E7%BB%A7%E6%89%BF%E5%92%8C-class-%E7%BB%A7%E6%89%BF" class="header-anchor">#</a> 9 åŸå‹ç»§æ‰¿å’Œ Class ç»§æ‰¿</h2> <blockquote><p>æ¶‰åŠé¢è¯•é¢˜ï¼šåŸå‹å¦‚ä½•å®ç°ç»§æ‰¿ï¼Ÿ<code>Class</code> å¦‚ä½•å®ç°ç»§æ‰¿ï¼Ÿ<code>Class</code> æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ</p></blockquote> <p>é¦–å…ˆå…ˆæ¥è®²ä¸‹ <code>class</code>ï¼Œå…¶å®åœ¨ <code>JS</code>ä¸­å¹¶ä¸å­˜åœ¨ç±»ï¼Œ<code>class</code> åªæ˜¯è¯­æ³•ç³–ï¼Œæœ¬è´¨è¿˜æ˜¯å‡½æ•°</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
Person <span class="token keyword">instanceof</span> <span class="token class-name">Function</span> <span class="token comment">// true</span>
</code></pre></div><p><strong>ç»„åˆç»§æ‰¿</strong></p> <blockquote><p>ç»„åˆç»§æ‰¿æ˜¯æœ€å¸¸ç”¨çš„ç»§æ‰¿æ–¹å¼</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>val <span class="token operator">=</span> value
<span class="token punctuation">}</span>
<span class="token class-name">Parent</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getValue</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>val<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">Parent</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token class-name">Child</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> child <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

child<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>
child <span class="token keyword">instanceof</span> <span class="token class-name">Parent</span> <span class="token comment">// true</span>
</code></pre></div><ul><li>ä»¥ä¸Šç»§æ‰¿çš„æ–¹å¼æ ¸å¿ƒæ˜¯åœ¨å­ç±»çš„æ„é€ å‡½æ•°ä¸­é€šè¿‡ <code>Parent.call(this)</code> ç»§æ‰¿çˆ¶ç±»çš„å±æ€§ï¼Œç„¶åæ”¹å˜å­ç±»çš„åŸå‹ä¸º <code>new Parent()</code> æ¥ç»§æ‰¿çˆ¶ç±»çš„å‡½æ•°ã€‚</li> <li>è¿™ç§ç»§æ‰¿æ–¹å¼ä¼˜ç‚¹åœ¨äºæ„é€ å‡½æ•°å¯ä»¥ä¼ å‚ï¼Œä¸ä¼šä¸çˆ¶ç±»å¼•ç”¨å±æ€§å…±äº«ï¼Œå¯ä»¥å¤ç”¨çˆ¶ç±»çš„å‡½æ•°ï¼Œä½†æ˜¯ä¹Ÿå­˜åœ¨ä¸€ä¸ªç¼ºç‚¹å°±æ˜¯åœ¨ç»§æ‰¿çˆ¶ç±»å‡½æ•°çš„æ—¶å€™è°ƒç”¨äº†çˆ¶ç±»æ„é€ å‡½æ•°ï¼Œå¯¼è‡´å­ç±»çš„åŸå‹ä¸Šå¤šäº†ä¸éœ€è¦çš„çˆ¶ç±»å±æ€§ï¼Œå­˜åœ¨å†…å­˜ä¸Šçš„æµªè´¹</li></ul> <p><strong>å¯„ç”Ÿç»„åˆç»§æ‰¿</strong></p> <blockquote><p>è¿™ç§ç»§æ‰¿æ–¹å¼å¯¹ç»„åˆç»§æ‰¿è¿›è¡Œäº†ä¼˜åŒ–ï¼Œç»„åˆç»§æ‰¿ç¼ºç‚¹åœ¨äºç»§æ‰¿çˆ¶ç±»å‡½æ•°æ—¶è°ƒç”¨äº†æ„é€ å‡½æ•°ï¼Œæˆ‘ä»¬åªéœ€è¦ä¼˜åŒ–æ‰è¿™ç‚¹å°±è¡Œäº†</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>val <span class="token operator">=</span> value
<span class="token punctuation">}</span>
<span class="token class-name">Parent</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getValue</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>val<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">Parent</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token class-name">Child</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Parent</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  constructor<span class="token operator">:</span> <span class="token punctuation">{</span>
    value<span class="token operator">:</span> Child<span class="token punctuation">,</span>
    enumerable<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    writable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    configurable<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> child <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

child<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>
child <span class="token keyword">instanceof</span> <span class="token class-name">Parent</span> <span class="token comment">// true</span>
</code></pre></div><blockquote><p>ä»¥ä¸Šç»§æ‰¿å®ç°çš„æ ¸å¿ƒå°±æ˜¯å°†çˆ¶ç±»çš„åŸå‹èµ‹å€¼ç»™äº†å­ç±»ï¼Œå¹¶ä¸”å°†æ„é€ å‡½æ•°è®¾ç½®ä¸ºå­ç±»ï¼Œè¿™æ ·æ—¢è§£å†³äº†æ— ç”¨çš„çˆ¶ç±»å±æ€§é—®é¢˜ï¼Œè¿˜èƒ½æ­£ç¡®çš„æ‰¾åˆ°å­ç±»çš„æ„é€ å‡½æ•°ã€‚</p></blockquote> <p><strong>Class ç»§æ‰¿</strong></p> <blockquote><p>ä»¥ä¸Šä¸¤ç§ç»§æ‰¿æ–¹å¼éƒ½æ˜¯é€šè¿‡åŸå‹å»è§£å†³çš„ï¼Œåœ¨ ES6 ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ class å»å®ç°ç»§æ‰¿ï¼Œå¹¶ä¸”å®ç°èµ·æ¥å¾ˆç®€å•</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>val <span class="token operator">=</span> value
  <span class="token punctuation">}</span>
  <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>val<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">Parent</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>val <span class="token operator">=</span> value
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> child <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
child<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>
child <span class="token keyword">instanceof</span> <span class="token class-name">Parent</span> <span class="token comment">// true</span>
</code></pre></div><blockquote><p><code>class</code> å®ç°ç»§æ‰¿çš„æ ¸å¿ƒåœ¨äºä½¿ç”¨ <code>extends</code> è¡¨æ˜ç»§æ‰¿è‡ªå“ªä¸ªçˆ¶ç±»ï¼Œå¹¶ä¸”åœ¨å­ç±»æ„é€ å‡½æ•°ä¸­å¿…é¡»è°ƒç”¨ <code>super</code>ï¼Œå› ä¸ºè¿™æ®µä»£ç å¯ä»¥çœ‹æˆ <code>Parent.call(this, value)</code>ã€‚</p></blockquote> <h2 id="_10-æ¨¡å—åŒ–"><a href="http://interview.poetries.top/docs/excellent.html#_10-%E6%A8%A1%E5%9D%97%E5%8C%96" class="header-anchor">#</a> 10 æ¨¡å—åŒ–</h2> <blockquote><p>æ¶‰åŠé¢è¯•é¢˜ï¼šä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ¨¡å—åŒ–ï¼Ÿéƒ½æœ‰å“ªå‡ ç§æ–¹å¼å¯ä»¥å®ç°æ¨¡å—åŒ–ï¼Œå„æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ</p></blockquote> <p>ä½¿ç”¨ä¸€ä¸ªæŠ€æœ¯è‚¯å®šæ˜¯æœ‰åŸå› çš„ï¼Œé‚£ä¹ˆä½¿ç”¨æ¨¡å—åŒ–å¯ä»¥ç»™æˆ‘ä»¬å¸¦æ¥ä»¥ä¸‹å¥½å¤„</p> <ul><li>è§£å†³å‘½åå†²çª</li> <li>æä¾›å¤ç”¨æ€§</li> <li>æé«˜ä»£ç å¯ç»´æŠ¤æ€§</li></ul> <p><strong>ç«‹å³æ‰§è¡Œå‡½æ•°</strong></p> <blockquote><p>åœ¨æ—©æœŸï¼Œä½¿ç”¨ç«‹å³æ‰§è¡Œå‡½æ•°å®ç°æ¨¡å—åŒ–æ˜¯å¸¸è§çš„æ‰‹æ®µï¼Œé€šè¿‡å‡½æ•°ä½œç”¨åŸŸè§£å†³äº†å‘½åå†²çªã€æ±¡æŸ“å…¨å±€ä½œç”¨åŸŸçš„é—®é¢˜</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>(function(globalVariable){
   globalVariable.test = function() {}
   // ... å£°æ˜å„ç§å˜é‡ã€å‡½æ•°éƒ½ä¸ä¼šæ±¡æŸ“å…¨å±€ä½œç”¨åŸŸ
})(globalVariable)
</code></pre></div><p><strong>AMD å’Œ CMD</strong></p> <blockquote><p>é‰´äºç›®å‰è¿™ä¸¤ç§å®ç°æ–¹å¼å·²ç»å¾ˆå°‘è§åˆ°ï¼Œæ‰€ä»¥ä¸å†å¯¹å…·ä½“ç‰¹æ€§ç»†èŠï¼Œåªéœ€è¦äº†è§£è¿™ä¸¤è€…æ˜¯å¦‚ä½•ä½¿ç”¨çš„ã€‚</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// AMD</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'./a'</span><span class="token punctuation">,</span> <span class="token string">'./b'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// åŠ è½½æ¨¡å—å®Œæ¯•å¯ä»¥ä½¿ç”¨</span>
  a<span class="token punctuation">.</span><span class="token function">do</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  b<span class="token punctuation">.</span><span class="token function">do</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// CMD</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">require<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// åŠ è½½æ¨¡å—</span>
  <span class="token comment">// å¯ä»¥æŠŠ require å†™åœ¨å‡½æ•°ä½“çš„ä»»æ„åœ°æ–¹å®ç°å»¶è¿ŸåŠ è½½</span>
  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./a'</span><span class="token punctuation">)</span>
  a<span class="token punctuation">.</span><span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>CommonJS</strong></p> <blockquote><p><code>CommonJS</code> æœ€æ—©æ˜¯ <code>Node</code> åœ¨ä½¿ç”¨ï¼Œç›®å‰ä¹Ÿä»ç„¶å¹¿æ³›ä½¿ç”¨ï¼Œæ¯”å¦‚åœ¨ <code>Webpack</code> ä¸­ä½ å°±èƒ½è§åˆ°å®ƒï¼Œå½“ç„¶ç›®å‰åœ¨ <code>Node</code> ä¸­çš„æ¨¡å—ç®¡ç†å·²ç»å’Œ <code>CommonJS</code>æœ‰ä¸€äº›åŒºåˆ«äº†</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// a.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    a<span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
<span class="token comment">// or</span>
exports<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">1</span>

<span class="token comment">// b.js</span>
<span class="token keyword">var</span> module <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./a.js'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>a <span class="token comment">// -&gt; log 1</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>ar module <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./a.js'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>a
<span class="token comment">// è¿™é‡Œå…¶å®å°±æ˜¯åŒ…è£…äº†ä¸€å±‚ç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œè¿™æ ·å°±ä¸ä¼šæ±¡æŸ“å…¨å±€å˜é‡äº†ï¼Œ</span>
<span class="token comment">// é‡è¦çš„æ˜¯ module è¿™é‡Œï¼Œmodule æ˜¯ Node ç‹¬æœ‰çš„ä¸€ä¸ªå˜é‡</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    a<span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
<span class="token comment">// module åŸºæœ¬å®ç°</span>
<span class="token keyword">var</span> module <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token string">'xxxx'</span><span class="token punctuation">,</span> <span class="token comment">// æˆ‘æ€»å¾—çŸ¥é“æ€ä¹ˆå»æ‰¾åˆ°ä»–å§</span>
  exports<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// exports å°±æ˜¯ä¸ªç©ºå¯¹è±¡</span>
<span class="token punctuation">}</span>
<span class="token comment">// è¿™ä¸ªæ˜¯ä¸ºä»€ä¹ˆ exports å’Œ module.exports ç”¨æ³•ç›¸ä¼¼çš„åŸå› </span>
<span class="token keyword">var</span> exports <span class="token operator">=</span> module<span class="token punctuation">.</span>exports
<span class="token keyword">var</span> <span class="token function-variable function">load</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¯¼å‡ºçš„ä¸œè¥¿</span>
    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span>
    module<span class="token punctuation">.</span>exports <span class="token operator">=</span> a
    <span class="token keyword">return</span> module<span class="token punctuation">.</span>exports
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// ç„¶åå½“æˆ‘ require çš„æ—¶å€™å»æ‰¾åˆ°ç‹¬ç‰¹çš„</span>
<span class="token comment">// idï¼Œç„¶åå°†è¦ä½¿ç”¨çš„ä¸œè¥¿ç”¨ç«‹å³æ‰§è¡Œå‡½æ•°åŒ…è£…ä¸‹ï¼Œover</span>
</code></pre></div><blockquote><p>å¦å¤–è™½ç„¶ <code>exports</code> å’Œ <code>module.exports</code> ç”¨æ³•ç›¸ä¼¼ï¼Œä½†æ˜¯ä¸èƒ½å¯¹ <code>exports</code> ç›´æ¥èµ‹å€¼ã€‚å› ä¸º <code>var exports = module.exports</code> è¿™å¥ä»£ç è¡¨æ˜äº† <code>exports</code> å’Œ <code>module.exports</code>äº«æœ‰ç›¸åŒåœ°å€ï¼Œé€šè¿‡æ”¹å˜å¯¹è±¡çš„å±æ€§å€¼ä¼šå¯¹ä¸¤è€…éƒ½èµ·æ•ˆï¼Œä½†æ˜¯å¦‚æœç›´æ¥å¯¹ <code>exports</code> èµ‹å€¼å°±ä¼šå¯¼è‡´ä¸¤è€…ä¸å†æŒ‡å‘åŒä¸€ä¸ªå†…å­˜åœ°å€ï¼Œä¿®æ”¹å¹¶ä¸ä¼šå¯¹ <code>module.exports</code> èµ·æ•ˆ</p></blockquote> <p><strong>ES Module</strong></p> <blockquote><p><code>ES Module</code> æ˜¯åŸç”Ÿå®ç°çš„æ¨¡å—åŒ–æ–¹æ¡ˆï¼Œä¸ <code>CommonJS</code> æœ‰ä»¥ä¸‹å‡ ä¸ªåŒºåˆ«</p></blockquote> <ol><li><code>CommonJS</code> æ”¯æŒåŠ¨æ€å¯¼å…¥ï¼Œä¹Ÿå°±æ˜¯ <code>require(${path}/xx.js)</code>ï¼Œåè€…ç›®å‰ä¸æ”¯æŒï¼Œä½†æ˜¯å·²æœ‰ææ¡ˆ</li> <li><code>CommonJS</code> æ˜¯åŒæ­¥å¯¼å…¥ï¼Œå› ä¸ºç”¨äºæœåŠ¡ç«¯ï¼Œæ–‡ä»¶éƒ½åœ¨æœ¬åœ°ï¼ŒåŒæ­¥å¯¼å…¥å³ä½¿å¡ä½ä¸»çº¿ç¨‹å½±å“ä¹Ÿä¸å¤§ã€‚è€Œåè€…æ˜¯å¼‚æ­¥å¯¼å…¥ï¼Œå› ä¸ºç”¨äºæµè§ˆå™¨ï¼Œéœ€è¦ä¸‹è½½æ–‡ä»¶ï¼Œå¦‚æœä¹Ÿé‡‡ç”¨åŒæ­¥å¯¼å…¥ä¼šå¯¹æ¸²æŸ“æœ‰å¾ˆå¤§å½±å“</li> <li><code>CommonJS</code> åœ¨å¯¼å‡ºæ—¶éƒ½æ˜¯å€¼æ‹·è´ï¼Œå°±ç®—å¯¼å‡ºçš„å€¼å˜äº†ï¼Œå¯¼å…¥çš„å€¼ä¹Ÿä¸ä¼šæ”¹å˜ï¼Œæ‰€ä»¥å¦‚æœæƒ³æ›´æ–°å€¼ï¼Œå¿…é¡»é‡æ–°å¯¼å…¥ä¸€æ¬¡ã€‚ä½†æ˜¯ <code>ES Module</code> é‡‡ç”¨å®æ—¶ç»‘å®šçš„æ–¹å¼ï¼Œå¯¼å…¥å¯¼å‡ºçš„å€¼éƒ½æŒ‡å‘åŒä¸€ä¸ªå†…å­˜åœ°å€ï¼Œæ‰€ä»¥å¯¼å…¥å€¼ä¼šè·Ÿéšå¯¼å‡ºå€¼å˜åŒ–</li> <li><code>ES Module</code> ä¼šç¼–è¯‘æˆ <code>require/exports</code>æ¥æ‰§è¡Œçš„</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// å¼•å…¥æ¨¡å— API</span>
<span class="token keyword">import</span> <span class="token constant">XXX</span> <span class="token keyword">from</span> <span class="token string">'./a.js'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">XXX</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./a.js'</span>
<span class="token comment">// å¯¼å‡ºæ¨¡å— API</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><h2 id="_11-å®ç°ä¸€ä¸ªç®€æ´ç‰ˆçš„promise"><a href="http://interview.poetries.top/docs/excellent.html#_11-%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E6%B4%81%E7%89%88%E7%9A%84promise" class="header-anchor">#</a> 11 å®ç°ä¸€ä¸ªç®€æ´ç‰ˆçš„promise</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ä¸‰ä¸ªå¸¸é‡ç”¨äºè¡¨ç¤ºçŠ¶æ€</span>
<span class="token keyword">const</span> <span class="token constant">PENDING</span> <span class="token operator">=</span> <span class="token string">'pending'</span>
<span class="token keyword">const</span> <span class="token constant">RESOLVED</span> <span class="token operator">=</span> <span class="token string">'resolved'</span>
<span class="token keyword">const</span> <span class="token constant">REJECTED</span> <span class="token operator">=</span> <span class="token string">'rejected'</span>

<span class="token keyword">function</span> <span class="token function">MyPromise</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> that <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token constant">PENDING</span>

    <span class="token comment">// value å˜é‡ç”¨äºä¿å­˜ resolve æˆ–è€… reject ä¸­ä¼ å…¥çš„å€¼</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">null</span>

    <span class="token comment">// ç”¨äºä¿å­˜ then ä¸­çš„å›è°ƒï¼Œå› ä¸ºå½“æ‰§è¡Œå®Œ Promise æ—¶çŠ¶æ€å¯èƒ½è¿˜æ˜¯ç­‰å¾…ä¸­ï¼Œè¿™æ—¶å€™åº”è¯¥æŠŠ then ä¸­çš„å›è°ƒä¿å­˜èµ·æ¥ç”¨äºçŠ¶æ€æ”¹å˜æ—¶ä½¿ç”¨</span>
    that<span class="token punctuation">.</span>resolvedCallbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    that<span class="token punctuation">.</span>rejectedCallbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>


    <span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token comment">// é¦–å…ˆä¸¤ä¸ªå‡½æ•°éƒ½å¾—åˆ¤æ–­å½“å‰çŠ¶æ€æ˜¯å¦ä¸ºç­‰å¾…ä¸­</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>that<span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            that<span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token constant">RESOLVED</span>
            that<span class="token punctuation">.</span>value <span class="token operator">=</span> value

            <span class="token comment">// éå†å›è°ƒæ•°ç»„å¹¶æ‰§è¡Œ</span>
            that<span class="token punctuation">.</span>resolvedCallbacks<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token operator">=&gt;</span><span class="token function">cb</span><span class="token punctuation">(</span>that<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>that<span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            that<span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token constant">REJECTED</span>
            that<span class="token punctuation">.</span>value <span class="token operator">=</span> value
            that<span class="token punctuation">.</span>rejectedCallbacks<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token operator">=&gt;</span><span class="token function">cb</span><span class="token punctuation">(</span>that<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// å®Œæˆä»¥ä¸Šä¸¤ä¸ªå‡½æ•°ä»¥åï¼Œæˆ‘ä»¬å°±è¯¥å®ç°å¦‚ä½•æ‰§è¡Œ Promise ä¸­ä¼ å…¥çš„å‡½æ•°äº†</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token function">fn</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token function">cach</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// æœ€åæˆ‘ä»¬æ¥å®ç°è¾ƒä¸ºå¤æ‚çš„ then å‡½æ•°</span>
<span class="token class-name">MyPromise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">then</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> that <span class="token operator">=</span> <span class="token keyword">this</span>

  <span class="token comment">// åˆ¤æ–­ä¸¤ä¸ªå‚æ•°æ˜¯å¦ä¸ºå‡½æ•°ç±»å‹ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªå‚æ•°æ˜¯å¯é€‰å‚æ•°</span>
  onFulfilled <span class="token operator">=</span> <span class="token keyword">typeof</span> onFulfilled <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">?</span> <span class="token function-variable function">onFulfilled</span> <span class="token operator">:</span> <span class="token parameter">v</span><span class="token operator">=&gt;</span>v
  onRejected <span class="token operator">=</span> <span class="token keyword">typeof</span> onRejected <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">?</span> <span class="token function-variable function">onRejected</span> <span class="token operator">:</span> <span class="token parameter">e</span><span class="token operator">=&gt;</span><span class="token keyword">throw</span> e

  <span class="token comment">// å½“çŠ¶æ€ä¸æ˜¯ç­‰å¾…æ€æ—¶ï¼Œå°±å»æ‰§è¡Œç›¸å¯¹åº”çš„å‡½æ•°ã€‚å¦‚æœçŠ¶æ€æ˜¯ç­‰å¾…æ€çš„è¯ï¼Œå°±å¾€å›è°ƒå‡½æ•°ä¸­ push å‡½æ•°</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>resolvedCallbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>onFulfilled<span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>rejectedCallbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>onRejected<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token constant">RESOLVED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">onFulfilled</span><span class="token punctuation">(</span>that<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token constant">REJECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">onRejected</span><span class="token punctuation">(</span>that<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="_12-event-loop"><a href="http://interview.poetries.top/docs/excellent.html#_12-event-loop" class="header-anchor">#</a> 12 Event Loop</h2> <h3 id="_12-1-è¿›ç¨‹ä¸çº¿ç¨‹"><a href="http://interview.poetries.top/docs/excellent.html#_12-1-%E8%BF%9B%E7%A8%8B%E4%B8%8E%E7%BA%BF%E7%A8%8B" class="header-anchor">#</a> 12.1 è¿›ç¨‹ä¸çº¿ç¨‹</h3> <blockquote><p>æ¶‰åŠé¢è¯•é¢˜ï¼šè¿›ç¨‹ä¸çº¿ç¨‹åŒºåˆ«ï¼Ÿ<code>JS</code> å•çº¿ç¨‹å¸¦æ¥çš„å¥½å¤„ï¼Ÿ</p></blockquote> <ul><li><code>JS</code> æ˜¯å•çº¿ç¨‹æ‰§è¡Œçš„ï¼Œä½†æ˜¯ä½ æ˜¯å¦ç–‘æƒ‘è¿‡ä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Ÿ</li> <li>è®²åˆ°çº¿ç¨‹ï¼Œé‚£ä¹ˆè‚¯å®šä¹Ÿå¾—è¯´ä¸€ä¸‹è¿›ç¨‹ã€‚æœ¬è´¨ä¸Šæ¥è¯´ï¼Œä¸¤ä¸ªåè¯éƒ½æ˜¯ <code>CPU</code> å·¥ä½œæ—¶é—´ç‰‡çš„ä¸€ä¸ªæè¿°ã€‚</li> <li>è¿›ç¨‹æè¿°äº† <code>CPU</code> åœ¨è¿è¡ŒæŒ‡ä»¤åŠåŠ è½½å’Œä¿å­˜ä¸Šä¸‹æ–‡æ‰€éœ€çš„æ—¶é—´ï¼Œæ”¾åœ¨åº”ç”¨ä¸Šæ¥è¯´å°±ä»£è¡¨äº†ä¸€ä¸ªç¨‹åºã€‚çº¿ç¨‹æ˜¯è¿›ç¨‹ä¸­çš„æ›´å°å•ä½ï¼Œæè¿°äº†æ‰§è¡Œä¸€æ®µæŒ‡ä»¤æ‰€éœ€çš„æ—¶é—´</li></ul> <blockquote><p>æŠŠè¿™äº›æ¦‚å¿µæ‹¿åˆ°æµè§ˆå™¨ä¸­æ¥è¯´ï¼Œå½“ä½ æ‰“å¼€ä¸€ä¸ª <code>Tab</code> é¡µæ—¶ï¼Œå…¶å®å°±æ˜¯åˆ›å»ºäº†ä¸€ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œæ¯”å¦‚æ¸²æŸ“çº¿ç¨‹ã€<code>JS</code> å¼•æ“çº¿ç¨‹ã€<code>HTTP</code> è¯·æ±‚çº¿ç¨‹ç­‰ç­‰ã€‚å½“ä½ å‘èµ·ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œå…¶å®å°±æ˜¯åˆ›å»ºäº†ä¸€ä¸ªçº¿ç¨‹ï¼Œå½“è¯·æ±‚ç»“æŸåï¼Œè¯¥çº¿ç¨‹å¯èƒ½å°±ä¼šè¢«é”€æ¯</p></blockquote> <ul><li>ä¸Šæ–‡è¯´åˆ°äº† <code>JS</code> å¼•æ“çº¿ç¨‹å’Œæ¸²æŸ“çº¿ç¨‹ï¼Œå¤§å®¶åº”è¯¥éƒ½çŸ¥é“ï¼Œåœ¨ <code>JS</code> è¿è¡Œçš„æ—¶å€™å¯èƒ½ä¼šé˜»æ­¢ <code>UI</code> æ¸²æŸ“ï¼Œè¿™è¯´æ˜äº†ä¸¤ä¸ªçº¿ç¨‹æ˜¯äº’æ–¥çš„ã€‚è¿™å…¶ä¸­çš„åŸå› æ˜¯å› ä¸º JS å¯ä»¥ä¿®æ”¹ <code>DOM</code>ï¼Œå¦‚æœåœ¨ <code>JS</code> æ‰§è¡Œçš„æ—¶å€™ <code>UI</code> çº¿ç¨‹è¿˜åœ¨å·¥ä½œï¼Œå°±å¯èƒ½å¯¼è‡´ä¸èƒ½å®‰å…¨çš„æ¸²æŸ“ <code>UI</code>ã€‚è¿™å…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªå•çº¿ç¨‹çš„å¥½å¤„ï¼Œå¾—ç›Šäº <code>JS</code> æ˜¯å•çº¿ç¨‹è¿è¡Œçš„ï¼Œå¯ä»¥è¾¾åˆ°èŠ‚çœå†…å­˜ï¼ŒèŠ‚çº¦ä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶é—´ï¼Œæ²¡æœ‰é”çš„é—®é¢˜çš„å¥½å¤„</li></ul> <h3 id="_12-2-æ‰§è¡Œæ ˆ"><a href="http://interview.poetries.top/docs/excellent.html#_12-2-%E6%89%A7%E8%A1%8C%E6%A0%88" class="header-anchor">#</a> 12.2 æ‰§è¡Œæ ˆ</h3> <blockquote><p>æ¶‰åŠé¢è¯•é¢˜ï¼šä»€ä¹ˆæ˜¯æ‰§è¡Œæ ˆï¼Ÿ</p></blockquote> <p>å¯ä»¥æŠŠæ‰§è¡Œæ ˆè®¤ä¸ºæ˜¯ä¸€ä¸ªå­˜å‚¨å‡½æ•°è°ƒç”¨çš„æ ˆç»“æ„ï¼Œéµå¾ªå…ˆè¿›åå‡ºçš„åŸåˆ™</p> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/102.png" alt="" class="medium-zoom-image"></p> <blockquote><p>å½“å¼€å§‹æ‰§è¡Œ <code>JS</code> ä»£ç æ—¶ï¼Œé¦–å…ˆä¼šæ‰§è¡Œä¸€ä¸ª <code>main</code> å‡½æ•°ï¼Œç„¶åæ‰§è¡Œæˆ‘ä»¬çš„ä»£ç ã€‚æ ¹æ®å…ˆè¿›åå‡ºçš„åŸåˆ™ï¼Œåæ‰§è¡Œçš„å‡½æ•°ä¼šå…ˆå¼¹å‡ºæ ˆï¼Œåœ¨å›¾ä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥å‘ç°ï¼Œ<code>foo</code> å‡½æ•°åæ‰§è¡Œï¼Œå½“æ‰§è¡Œå®Œæ¯•åå°±ä»æ ˆä¸­å¼¹å‡ºäº†</p></blockquote> <p>åœ¨å¼€å‘ä¸­ï¼Œå¤§å®¶ä¹Ÿå¯ä»¥åœ¨æŠ¥é”™ä¸­æ‰¾åˆ°æ‰§è¡Œæ ˆçš„ç—•è¿¹</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/2(1).png" alt="" class="medium-zoom-image"></p> <blockquote><p>å¤§å®¶å¯ä»¥åœ¨ä¸Šå›¾æ¸…æ™°çš„çœ‹åˆ°æŠ¥é”™åœ¨ <code>foo</code> å‡½æ•°ï¼Œ<code>foo</code> å‡½æ•°åˆæ˜¯åœ¨ <code>bar</code> å‡½æ•°ä¸­è°ƒç”¨çš„</p></blockquote> <p>å½“æˆ‘ä»¬ä½¿ç”¨é€’å½’çš„æ—¶å€™ï¼Œå› ä¸ºæ ˆå¯å­˜æ”¾çš„å‡½æ•°æ˜¯æœ‰é™åˆ¶çš„ï¼Œä¸€æ—¦å­˜æ”¾äº†è¿‡å¤šçš„å‡½æ•°ä¸”æ²¡æœ‰å¾—åˆ°é‡Šæ”¾çš„è¯ï¼Œå°±ä¼šå‡ºç°çˆ†æ ˆçš„é—®é¢˜</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/1(1).png" alt="" class="medium-zoom-image"></p> <h3 id="_12-3-æµè§ˆå™¨ä¸­çš„-event-loop"><a href="http://interview.poetries.top/docs/excellent.html#_12-3-%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84-event-loop" class="header-anchor">#</a> 12.3 æµè§ˆå™¨ä¸­çš„ Event Loop</h3> <blockquote><p>æ¶‰åŠé¢è¯•é¢˜ï¼šå¼‚æ­¥ä»£ç æ‰§è¡Œé¡ºåºï¼Ÿè§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯ <code>Event Loop</code> ï¼Ÿ</p></blockquote> <blockquote><p>ä¼—æ‰€å‘¨çŸ¥ <code>JS</code> æ˜¯é—¨éé˜»å¡å•çº¿ç¨‹è¯­è¨€ï¼Œå› ä¸ºåœ¨æœ€åˆ <code>JS</code> å°±æ˜¯ä¸ºäº†å’Œæµè§ˆå™¨äº¤äº’è€Œè¯ç”Ÿçš„ã€‚å¦‚æœ <code>JS</code> æ˜¯é—¨å¤šçº¿ç¨‹çš„è¯­è¨€è¯ï¼Œæˆ‘ä»¬åœ¨å¤šä¸ªçº¿ç¨‹ä¸­å¤„ç† <code>DOM</code> å°±å¯èƒ½ä¼šå‘ç”Ÿé—®é¢˜ï¼ˆä¸€ä¸ªçº¿ç¨‹ä¸­æ–°åŠ èŠ‚ç‚¹ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä¸­åˆ é™¤èŠ‚ç‚¹ï¼‰</p></blockquote> <ul><li><code>JS</code> åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ä¼šäº§ç”Ÿæ‰§è¡Œç¯å¢ƒï¼Œè¿™äº›æ‰§è¡Œç¯å¢ƒä¼šè¢«é¡ºåºçš„åŠ å…¥åˆ°æ‰§è¡Œæ ˆä¸­ã€‚å¦‚æœé‡åˆ°å¼‚æ­¥çš„ä»£ç ï¼Œä¼šè¢«æŒ‚èµ·å¹¶åŠ å…¥åˆ° <code>Task</code>ï¼ˆæœ‰å¤šç§ <code>task</code>ï¼‰ é˜Ÿåˆ—ä¸­ã€‚ä¸€æ—¦æ‰§è¡Œæ ˆä¸ºç©ºï¼Œ<code>Event</code> <code>Loop</code> å°±ä¼šä» <code>Task</code> é˜Ÿåˆ—ä¸­æ‹¿å‡ºéœ€è¦æ‰§è¡Œçš„ä»£ç å¹¶æ”¾å…¥æ‰§è¡Œæ ˆä¸­æ‰§è¡Œï¼Œæ‰€ä»¥æœ¬è´¨ä¸Šæ¥è¯´ <code>JS</code> ä¸­çš„å¼‚æ­¥è¿˜æ˜¯åŒæ­¥è¡Œä¸º</li></ul> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/4.png" alt="" class="medium-zoom-image"></p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script start'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script end'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>ä¸åŒçš„ä»»åŠ¡æºä¼šè¢«åˆ†é…åˆ°ä¸åŒçš„ <code>Task</code> é˜Ÿåˆ—ä¸­ï¼Œä»»åŠ¡æºå¯ä»¥åˆ†ä¸º å¾®ä»»åŠ¡ï¼ˆ<code>microtask</code>ï¼‰ å’Œ å®ä»»åŠ¡ï¼ˆ<code>macrotask</code>ï¼‰ã€‚åœ¨ <code>ES6</code> è§„èŒƒä¸­ï¼Œ<code>microtask</code> ç§°ä¸º <code>jobs</code>ï¼Œ<code>macrotask</code> ç§°ä¸º <code>task</code></p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script start'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Promise'</span><span class="token punctuation">)</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script end'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// script start =&gt; Promise =&gt; script end =&gt; promise1 =&gt; promise2 =&gt; setTimeout</span>
</code></pre></div><blockquote><p>ä»¥ä¸Šä»£ç è™½ç„¶ <code>setTimeout</code> å†™åœ¨ <code>Promise</code> ä¹‹å‰ï¼Œä½†æ˜¯å› ä¸º <code>Promise</code> å±äºå¾®ä»»åŠ¡è€Œ <code>setTimeout</code> å±äºå®ä»»åŠ¡</p></blockquote> <p><strong>å¾®ä»»åŠ¡</strong></p> <ul><li><code>process.nextTick</code></li> <li><code>promise</code></li> <li><code>Object.observe</code></li> <li><code>MutationObserver</code></li></ul> <p><strong>å®ä»»åŠ¡</strong></p> <ul><li><code>script</code></li> <li><code>setTimeout</code></li> <li><code>setInterval</code></li> <li><code>setImmediate</code></li> <li><code>I/O</code></li> <li><code>UI rendering</code></li></ul> <blockquote><p>å®ä»»åŠ¡ä¸­åŒ…æ‹¬äº† <code>script</code> ï¼Œæµè§ˆå™¨ä¼šå…ˆæ‰§è¡Œä¸€ä¸ªå®ä»»åŠ¡ï¼Œæ¥ä¸‹æ¥æœ‰å¼‚æ­¥ä»£ç çš„è¯å°±å…ˆæ‰§è¡Œå¾®ä»»åŠ¡</p></blockquote> <p><strong>æ‰€ä»¥æ­£ç¡®çš„ä¸€æ¬¡ Event loop é¡ºåºæ˜¯è¿™æ ·çš„</strong></p> <ul><li>æ‰§è¡ŒåŒæ­¥ä»£ç ï¼Œè¿™å±äºå®ä»»åŠ¡</li> <li>æ‰§è¡Œæ ˆä¸ºç©ºï¼ŒæŸ¥è¯¢æ˜¯å¦æœ‰å¾®ä»»åŠ¡éœ€è¦æ‰§è¡Œ</li> <li>æ‰§è¡Œæ‰€æœ‰å¾®ä»»åŠ¡</li> <li>å¿…è¦çš„è¯æ¸²æŸ“ UI</li> <li>ç„¶åå¼€å§‹ä¸‹ä¸€è½® <code>Event loop</code>ï¼Œæ‰§è¡Œå®ä»»åŠ¡ä¸­çš„å¼‚æ­¥ä»£ç </li></ul> <blockquote><p>é€šè¿‡ä¸Šè¿°çš„ <code>Event loop</code> é¡ºåºå¯çŸ¥ï¼Œå¦‚æœå®ä»»åŠ¡ä¸­çš„å¼‚æ­¥ä»£ç æœ‰å¤§é‡çš„è®¡ç®—å¹¶ä¸”éœ€è¦æ“ä½œ <code>DOM</code> çš„è¯ï¼Œä¸ºäº†æ›´å¿«çš„å“åº”ç•Œé¢å“åº”ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ“ä½œ <code>DOM</code> æ”¾å…¥å¾®ä»»åŠ¡ä¸­</p></blockquote> <h3 id="_12-4-node-ä¸­çš„-event-loop"><a href="http://interview.poetries.top/docs/excellent.html#_12-4-node-%E4%B8%AD%E7%9A%84-event-loop" class="header-anchor">#</a> 12.4 Node ä¸­çš„ Event loop</h3> <ul><li><code>Node</code> ä¸­çš„ <code>Event loop</code> å’Œæµè§ˆå™¨ä¸­çš„ä¸ç›¸åŒã€‚</li> <li><code>Node</code> çš„ <code>Event loop</code> åˆ†ä¸º<code>6</code>ä¸ªé˜¶æ®µï¼Œå®ƒä»¬ä¼šæŒ‰ç…§é¡ºåºåå¤è¿è¡Œ</li></ul> <div class="language- extra-class"><pre class="language-text"><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”Œâ”€&gt;â”‚        timers         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚     I/O callbacks     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚     idle, prepare     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   incoming:   â”‚
â”‚  â”‚         poll          â”‚&lt;â”€â”€connectionsâ”€â”€â”€     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   data, etc.  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”‚        check          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â””â”€â”€â”¤    close callbacks    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div><p><strong>timer</strong></p> <ul><li><code>timers</code> é˜¶æ®µä¼šæ‰§è¡Œ <code>setTimeout</code> å’Œ <code>setInterval</code></li> <li>ä¸€ä¸ª timer æŒ‡å®šçš„æ—¶é—´å¹¶ä¸æ˜¯å‡†ç¡®æ—¶é—´ï¼Œè€Œæ˜¯åœ¨è¾¾åˆ°è¿™ä¸ªæ—¶é—´åå°½å¿«æ‰§è¡Œå›è°ƒï¼Œå¯èƒ½ä¼šå› ä¸ºç³»ç»Ÿæ­£åœ¨æ‰§è¡Œåˆ«çš„äº‹åŠ¡è€Œå»¶è¿Ÿ</li></ul> <p><strong>I/O</strong></p> <ul><li><code>I/O</code> é˜¶æ®µä¼šæ‰§è¡Œé™¤äº† <code>close</code> äº‹ä»¶ï¼Œå®šæ—¶å™¨å’Œ <code>setImmediate</code> çš„å›è°ƒ</li></ul> <p><strong>poll</strong></p> <ul><li><p><code>poll</code> é˜¶æ®µå¾ˆé‡è¦ï¼Œè¿™ä¸€é˜¶æ®µä¸­ï¼Œç³»ç»Ÿä¼šåšä¸¤ä»¶äº‹æƒ…</p> <ul><li>æ‰§è¡Œåˆ°ç‚¹çš„å®šæ—¶å™¨</li> <li>æ‰§è¡Œ <code>poll</code> é˜Ÿåˆ—ä¸­çš„äº‹ä»¶</li></ul></li> <li><p>å¹¶ä¸”å½“ <code>poll</code> ä¸­æ²¡æœ‰å®šæ—¶å™¨çš„æƒ…å†µä¸‹ï¼Œä¼šå‘ç°ä»¥ä¸‹ä¸¤ä»¶äº‹æƒ…</p> <ul><li>å¦‚æœ <code>poll</code> é˜Ÿåˆ—ä¸ä¸ºç©ºï¼Œä¼šéå†å›è°ƒé˜Ÿåˆ—å¹¶åŒæ­¥æ‰§è¡Œï¼Œç›´åˆ°é˜Ÿåˆ—ä¸ºç©ºæˆ–è€…ç³»ç»Ÿé™åˆ¶</li> <li>å¦‚æœ <code>poll</code> é˜Ÿåˆ—ä¸ºç©ºï¼Œä¼šæœ‰ä¸¤ä»¶äº‹å‘ç”Ÿ</li> <li>å¦‚æœæœ‰ <code>setImmediate</code> éœ€è¦æ‰§è¡Œï¼Œ<code>poll</code> é˜¶æ®µä¼šåœæ­¢å¹¶ä¸”è¿›å…¥åˆ° <code>check</code> é˜¶æ®µæ‰§è¡Œ <code>setImmediate</code></li> <li>å¦‚æœæ²¡æœ‰ <code>setImmediate</code> éœ€è¦æ‰§è¡Œï¼Œä¼šç­‰å¾…å›è°ƒè¢«åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­å¹¶ç«‹å³æ‰§è¡Œå›è°ƒ</li> <li>å¦‚æœæœ‰åˆ«çš„å®šæ—¶å™¨éœ€è¦è¢«æ‰§è¡Œï¼Œä¼šå›åˆ° <code>timer</code> é˜¶æ®µæ‰§è¡Œå›è°ƒã€‚</li></ul></li></ul> <p><strong>check</strong></p> <ul><li><code>check</code> é˜¶æ®µæ‰§è¡Œ <code>setImmediate</code></li></ul> <p><strong>close callbacks</strong></p> <ul><li><code>close callbacks</code> é˜¶æ®µæ‰§è¡Œ <code>close</code> äº‹ä»¶</li> <li>å¹¶ä¸”åœ¨ <code>Node</code> ä¸­ï¼Œæœ‰äº›æƒ…å†µä¸‹çš„å®šæ—¶å™¨æ‰§è¡Œé¡ºåºæ˜¯éšæœºçš„</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setImmediate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setImmediate'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// è¿™é‡Œå¯èƒ½ä¼šè¾“å‡º setTimeoutï¼ŒsetImmediate</span>
<span class="token comment">// å¯èƒ½ä¹Ÿä¼šç›¸åçš„è¾“å‡ºï¼Œè¿™å–å†³äºæ€§èƒ½</span>
<span class="token comment">// å› ä¸ºå¯èƒ½è¿›å…¥ event loop ç”¨äº†ä¸åˆ° 1 æ¯«ç§’ï¼Œè¿™æ—¶å€™ä¼šæ‰§è¡Œ setImmediate</span>
<span class="token comment">// å¦åˆ™ä¼šæ‰§è¡Œ setTimeout</span>
</code></pre></div><blockquote><p>ä¸Šé¢ä»‹ç»çš„éƒ½æ˜¯ <code>macrotask</code> çš„æ‰§è¡Œæƒ…å†µï¼Œ<code>microtask</code> ä¼šåœ¨ä»¥ä¸Šæ¯ä¸ªé˜¶æ®µå®Œæˆåç«‹å³æ‰§è¡Œ</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timer1'</span><span class="token punctuation">)</span>

    Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise1'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timer2'</span><span class="token punctuation">)</span>

    Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise2'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment">// ä»¥ä¸Šä»£ç åœ¨æµè§ˆå™¨å’Œ node ä¸­æ‰“å°æƒ…å†µæ˜¯ä¸åŒçš„</span>
<span class="token comment">// æµè§ˆå™¨ä¸­ä¸€å®šæ‰“å° timer1, promise1, timer2, promise2</span>
<span class="token comment">// node ä¸­å¯èƒ½æ‰“å° timer1, timer2, promise1, promise2</span>
<span class="token comment">// ä¹Ÿå¯èƒ½æ‰“å° timer1, promise1, timer2, promise2</span>
</code></pre></div><blockquote><p><code>Node</code> ä¸­çš„ <code>process.nextTick</code> ä¼šå…ˆäºå…¶ä»– <code>microtask</code> æ‰§è¡Œ</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"timer1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"promise1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"nextTick"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// nextTick, timer1, promise1</span>
</code></pre></div><blockquote><p>å¯¹äº <code>microtask</code> æ¥è¯´ï¼Œå®ƒä¼šåœ¨ä»¥ä¸Šæ¯ä¸ªé˜¶æ®µå®Œæˆå‰æ¸…ç©º <code>microtask</code> é˜Ÿåˆ—ï¼Œä¸‹å›¾ä¸­çš„ <code>Tick</code> å°±ä»£è¡¨äº† <code>microtask</code></p></blockquote> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/5.png" alt="" class="medium-zoom-image"></p> <h2 id="_13-æ‰‹å†™-callã€apply-åŠ-bind-å‡½æ•°"><a href="http://interview.poetries.top/docs/excellent.html#_13-%E6%89%8B%E5%86%99-call%E3%80%81apply-%E5%8F%8A-bind-%E5%87%BD%E6%95%B0" class="header-anchor">#</a> 13 æ‰‹å†™ callã€apply åŠ bind å‡½æ•°</h2> <blockquote><p>é¦–å…ˆä»ä»¥ä¸‹å‡ ç‚¹æ¥è€ƒè™‘å¦‚ä½•å®ç°è¿™å‡ ä¸ªå‡½æ•°</p></blockquote> <ul><li>ä¸ä¼ å…¥ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆä¸Šä¸‹æ–‡é»˜è®¤ä¸º <code>window</code></li> <li>æ”¹å˜äº† <code>this</code> æŒ‡å‘ï¼Œè®©æ–°çš„å¯¹è±¡å¯ä»¥æ‰§è¡Œè¯¥å‡½æ•°ï¼Œå¹¶èƒ½æ¥å—å‚æ•°</li></ul> <p><strong>å®ç° call</strong></p> <ul><li>é¦–å…ˆ <code>context</code>ä¸ºå¯é€‰å‚æ•°ï¼Œå¦‚æœä¸ä¼ çš„è¯é»˜è®¤ä¸Šä¸‹æ–‡ä¸º <code>window</code></li> <li>æ¥ä¸‹æ¥ç»™ <code>context</code> åˆ›å»ºä¸€ä¸ª <code>fn</code> å±æ€§ï¼Œå¹¶å°†å€¼è®¾ç½®ä¸ºéœ€è¦è°ƒç”¨çš„å‡½æ•°</li> <li>å› ä¸º <code>call</code> å¯ä»¥ä¼ å…¥å¤šä¸ªå‚æ•°ä½œä¸ºè°ƒç”¨å‡½æ•°çš„å‚æ•°ï¼Œæ‰€ä»¥éœ€è¦å°†å‚æ•°å‰¥ç¦»å‡ºæ¥</li> <li>ç„¶åè°ƒç”¨å‡½æ•°å¹¶å°†å¯¹è±¡ä¸Šçš„å‡½æ•°åˆ é™¤</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">myCall</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token keyword">this</span> <span class="token operator">!==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'Error'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  context <span class="token operator">=</span> context <span class="token operator">||</span> window
  context<span class="token punctuation">.</span>fn <span class="token operator">=</span> <span class="token keyword">this</span>
  <span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>arguments<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span>
  <span class="token keyword">delete</span> context<span class="token punctuation">.</span>fn
  <span class="token keyword">return</span> result
<span class="token punctuation">}</span>
</code></pre></div><p><strong>applyå®ç°</strong></p> <blockquote><p><code>apply</code> çš„å®ç°ä¹Ÿç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äºå¯¹å‚æ•°çš„å¤„ç†</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">myApply</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token keyword">this</span> <span class="token operator">!==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'Error'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  context <span class="token operator">=</span> context <span class="token operator">||</span> window
  context<span class="token punctuation">.</span>fn <span class="token operator">=</span> <span class="token keyword">this</span>
  <span class="token keyword">let</span> result
  <span class="token comment">// å¤„ç†å‚æ•°å’Œ call æœ‰åŒºåˆ«</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>arguments<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    result <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>arguments<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    result <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">delete</span> context<span class="token punctuation">.</span>fn
  <span class="token keyword">return</span> result
<span class="token punctuation">}</span>
</code></pre></div><p><strong>bind çš„å®ç°</strong></p> <blockquote><p><code>bind</code> çš„å®ç°å¯¹æ¯”å…¶ä»–ä¸¤ä¸ªå‡½æ•°ç•¥å¾®åœ°å¤æ‚äº†ä¸€ç‚¹ï¼Œå› ä¸º <code>bind</code> éœ€è¦è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œéœ€è¦åˆ¤æ–­ä¸€äº›è¾¹ç•Œé—®é¢˜ï¼Œä»¥ä¸‹æ˜¯ <code>bind</code> çš„å®ç°</p></blockquote> <ul><li><code>bind</code> è¿”å›äº†ä¸€ä¸ªå‡½æ•°ï¼Œå¯¹äºå‡½æ•°æ¥è¯´æœ‰ä¸¤ç§æ–¹å¼è°ƒç”¨ï¼Œä¸€ç§æ˜¯ç›´æ¥è°ƒç”¨ï¼Œä¸€ç§æ˜¯é€šè¿‡ <code>new</code> çš„æ–¹å¼ï¼Œæˆ‘ä»¬å…ˆæ¥è¯´ç›´æ¥è°ƒç”¨çš„æ–¹å¼</li> <li>å¯¹äºç›´æ¥è°ƒç”¨æ¥è¯´ï¼Œè¿™é‡Œé€‰æ‹©äº† <code>apply</code> çš„æ–¹å¼å®ç°ï¼Œä½†æ˜¯å¯¹äºå‚æ•°éœ€è¦æ³¨æ„ä»¥ä¸‹æƒ…å†µï¼šå› ä¸º <code>bind</code> å¯ä»¥å®ç°ç±»ä¼¼è¿™æ ·çš„ä»£ç  <code>f.bind(obj, 1)(2)</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†ä¸¤è¾¹çš„å‚æ•°æ‹¼æ¥èµ·æ¥ï¼Œäºæ˜¯å°±æœ‰äº†è¿™æ ·çš„å®ç° <code>args.concat(...arguments)</code></li> <li>æœ€åæ¥è¯´é€šè¿‡ <code>new</code> çš„æ–¹å¼ï¼Œåœ¨ä¹‹å‰çš„ç« èŠ‚ä¸­æˆ‘ä»¬å­¦ä¹ è¿‡å¦‚ä½•åˆ¤æ–­ <code>this</code>ï¼Œå¯¹äº <code>new</code> çš„æƒ…å†µæ¥è¯´ï¼Œä¸ä¼šè¢«ä»»ä½•æ–¹å¼æ”¹å˜ <code>this</code>ï¼Œæ‰€ä»¥å¯¹äºè¿™ç§æƒ…å†µæˆ‘ä»¬éœ€è¦å¿½ç•¥ä¼ å…¥çš„ <code>this</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">myBind</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token keyword">this</span> <span class="token operator">!==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'Error'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> _this <span class="token operator">=</span> <span class="token keyword">this</span>
  <span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>arguments<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token comment">// è¿”å›ä¸€ä¸ªå‡½æ•°</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token constant">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å› ä¸ºè¿”å›äº†ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ new F()ï¼Œæ‰€ä»¥éœ€è¦åˆ¤æ–­</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">F</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">_this</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">,</span> <span class="token operator">...</span>arguments<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">_this</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> args<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token operator">...</span>arguments<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_14-new"><a href="http://interview.poetries.top/docs/excellent.html#_14-new" class="header-anchor">#</a> 14 new</h2> <blockquote><p>æ¶‰åŠé¢è¯•é¢˜ï¼š<code>new</code> çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿé€šè¿‡ <code>new</code>çš„æ–¹å¼åˆ›å»ºå¯¹è±¡å’Œé€šè¿‡å­—é¢é‡åˆ›å»ºæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p></blockquote> <p><strong>åœ¨è°ƒç”¨ new çš„è¿‡ç¨‹ä¸­ä¼šå‘ç”Ÿå››ä»¶äº‹æƒ…</strong></p> <ul><li>æ–°ç”Ÿæˆäº†ä¸€ä¸ªå¯¹è±¡</li> <li>é“¾æ¥åˆ°åŸå‹</li> <li>ç»‘å®š <code>this</code></li> <li>è¿”å›æ–°å¯¹è±¡</li></ul> <blockquote><p>æ ¹æ®ä»¥ä¸Šå‡ ä¸ªè¿‡ç¨‹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è¯•ç€æ¥è‡ªå·±å®ç°ä¸€ä¸ª new</p></blockquote> <ul><li>åˆ›å»ºä¸€ä¸ªç©ºå¯¹è±¡</li> <li>è·å–æ„é€ å‡½æ•°</li> <li>è®¾ç½®ç©ºå¯¹è±¡çš„åŸå‹</li> <li>ç»‘å®š <code>this</code> å¹¶æ‰§è¡Œæ„é€ å‡½æ•°</li> <li>ç¡®ä¿è¿”å›å€¼ä¸ºå¯¹è±¡</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">let</span> Con <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span>
  obj<span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> <span class="token class-name">Con</span><span class="token punctuation">.</span>prototype
  <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">Con</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
  <span class="token keyword">return</span> result <span class="token keyword">instanceof</span> <span class="token class-name">Object</span> <span class="token operator">?</span> result <span class="token operator">:</span> obj
<span class="token punctuation">}</span>
</code></pre></div><ul><li>å¯¹äºå¯¹è±¡æ¥è¯´ï¼Œå…¶å®éƒ½æ˜¯é€šè¿‡ <code>new</code> äº§ç”Ÿçš„ï¼Œæ— è®ºæ˜¯ <code>function Foo()</code> è¿˜æ˜¯ <code>let a = { b : 1 }</code>ã€‚</li> <li>å¯¹äºåˆ›å»ºä¸€ä¸ªå¯¹è±¡æ¥è¯´ï¼Œæ›´æ¨èä½¿ç”¨å­—é¢é‡çš„æ–¹å¼åˆ›å»ºå¯¹è±¡ï¼ˆæ— è®ºæ€§èƒ½ä¸Šè¿˜æ˜¯å¯è¯»æ€§ï¼‰ã€‚å› ä¸ºä½ ä½¿ç”¨ <code>new Object()</code> çš„æ–¹å¼åˆ›å»ºå¯¹è±¡éœ€è¦é€šè¿‡ä½œç”¨åŸŸé“¾ä¸€å±‚å±‚æ‰¾åˆ° <code>Object</code>ï¼Œä½†æ˜¯ä½ ä½¿ç”¨å­—é¢é‡çš„æ–¹å¼å°±æ²¡è¿™ä¸ªé—®é¢˜</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token comment">// function å°±æ˜¯ä¸ªè¯­æ³•ç³–</span>
<span class="token comment">// å†…éƒ¨ç­‰åŒäº new Function()</span>
<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">{</span> b<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span>
<span class="token comment">// è¿™ä¸ªå­—é¢é‡å†…éƒ¨ä¹Ÿæ˜¯ä½¿ç”¨äº† new Object()</span>
</code></pre></div><h2 id="_15-instanceof-çš„åŸç†"><a href="http://interview.poetries.top/docs/excellent.html#_15-instanceof-%E7%9A%84%E5%8E%9F%E7%90%86" class="header-anchor">#</a> 15 instanceof çš„åŸç†</h2> <blockquote><p>æ¶‰åŠé¢è¯•é¢˜ï¼š<code>instanceof</code> çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</p></blockquote> <p><code>instanceof</code> å¯ä»¥æ­£ç¡®çš„åˆ¤æ–­å¯¹è±¡çš„ç±»å‹ï¼Œå› ä¸ºå†…éƒ¨æœºåˆ¶æ˜¯é€šè¿‡åˆ¤æ–­å¯¹è±¡çš„åŸå‹é“¾ä¸­æ˜¯ä¸æ˜¯èƒ½æ‰¾åˆ°ç±»å‹çš„ <code>prototype</code></p> <p><strong>å®ç°ä¸€ä¸‹ instanceof</strong></p> <ul><li>é¦–å…ˆè·å–ç±»å‹çš„åŸå‹</li> <li>ç„¶åè·å¾—å¯¹è±¡çš„åŸå‹</li> <li>ç„¶åä¸€ç›´å¾ªç¯åˆ¤æ–­å¯¹è±¡çš„åŸå‹æ˜¯å¦ç­‰äºç±»å‹çš„åŸå‹ï¼Œç›´åˆ°å¯¹è±¡åŸå‹ä¸º <code>null</code>ï¼Œå› ä¸ºåŸå‹é“¾æœ€ç»ˆä¸º <code>null</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">myInstanceof</span><span class="token punctuation">(</span><span class="token parameter">left<span class="token punctuation">,</span> right</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> prototype <span class="token operator">=</span> right<span class="token punctuation">.</span>prototype
  left <span class="token operator">=</span> left<span class="token punctuation">.</span>__proto__
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>left <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">||</span> left <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>prototype <span class="token operator">===</span> left<span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span>
    left <span class="token operator">=</span> left<span class="token punctuation">.</span>__proto__
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_16-ä¸ºä»€ä¹ˆ-0-1-0-2-0-3"><a href="http://interview.poetries.top/docs/excellent.html#_16-%E4%B8%BA%E4%BB%80%E4%B9%88-0-1-0-2-0-3" class="header-anchor">#</a> 16 ä¸ºä»€ä¹ˆ 0.1 + 0.2 != 0.3</h2> <blockquote><p>æ¶‰åŠé¢è¯•é¢˜ï¼šä¸ºä»€ä¹ˆ <code>0.1 + 0.2 != 0.3</code>ï¼Ÿå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ</p></blockquote> <p><strong>åŸå› </strong>ï¼Œå› ä¸º <code>JS</code> é‡‡ç”¨ <code>IEEE 754</code>åŒç²¾åº¦ç‰ˆæœ¬ï¼ˆ<code>64</code>ä½ï¼‰ï¼Œå¹¶ä¸”åªè¦é‡‡ç”¨ <code>IEEE 754</code>çš„è¯­è¨€éƒ½æœ‰è¯¥é—®é¢˜</p> <blockquote><p>æˆ‘ä»¬éƒ½çŸ¥é“è®¡ç®—æœºæ˜¯é€šè¿‡äºŒè¿›åˆ¶æ¥å­˜å‚¨ä¸œè¥¿çš„ï¼Œé‚£ä¹ˆ <code>0.1</code> åœ¨äºŒè¿›åˆ¶ä¸­ä¼šè¡¨ç¤ºä¸º</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// (0011) è¡¨ç¤ºå¾ªç¯</span>
<span class="token number">0.1</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token operator">^</span><span class="token operator">-</span><span class="token number">4</span> <span class="token operator">*</span> <span class="token number">1.10011</span><span class="token punctuation">(</span><span class="token number">0011</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œ<code>0.1</code> åœ¨äºŒè¿›åˆ¶ä¸­æ˜¯æ— é™å¾ªç¯çš„ä¸€äº›æ•°å­—ï¼Œå…¶å®ä¸åªæ˜¯ <code>0.1</code>ï¼Œå…¶å®å¾ˆå¤šåè¿›åˆ¶å°æ•°ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºéƒ½æ˜¯æ— é™å¾ªç¯çš„ã€‚è¿™æ ·å…¶å®æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯ <code>JS</code>é‡‡ç”¨çš„æµ®ç‚¹æ•°æ ‡å‡†å´ä¼šè£å‰ªæ‰æˆ‘ä»¬çš„æ•°å­—ã€‚</p></blockquote> <p><strong>IEEE 754 åŒç²¾åº¦ç‰ˆæœ¬ï¼ˆ64ä½ï¼‰å°† 64 ä½åˆ†ä¸ºäº†ä¸‰æ®µ</strong></p> <ul><li>ç¬¬ä¸€ä½ç”¨æ¥è¡¨ç¤ºç¬¦å·</li> <li>æ¥ä¸‹å»çš„ <code>11</code> ä½ç”¨æ¥è¡¨ç¤ºæŒ‡æ•°</li> <li>å…¶ä»–çš„ä½æ•°ç”¨æ¥è¡¨ç¤ºæœ‰æ•ˆä½ï¼Œä¹Ÿå°±æ˜¯ç”¨äºŒè¿›åˆ¶è¡¨ç¤º <code>0.1</code> ä¸­çš„ <code>10011(0011)</code></li></ul> <blockquote><p>é‚£ä¹ˆè¿™äº›å¾ªç¯çš„æ•°å­—è¢«è£å‰ªäº†ï¼Œå°±ä¼šå‡ºç°ç²¾åº¦ä¸¢å¤±çš„é—®é¢˜ï¼Œä¹Ÿå°±é€ æˆäº† <code>0.1</code> ä¸å†æ˜¯ <code>0.1</code> äº†ï¼Œè€Œæ˜¯å˜æˆäº† <code>0.100000000000000002</code></p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>0.100000000000000002 === 0.1 // true
</code></pre></div><blockquote><p>é‚£ä¹ˆåŒæ ·çš„ï¼Œ<code>0.2</code> åœ¨äºŒè¿›åˆ¶ä¹Ÿæ˜¯æ— é™å¾ªç¯çš„ï¼Œè¢«è£å‰ªåä¹Ÿå¤±å»äº†ç²¾åº¦å˜æˆäº† <code>0.200000000000000002</code></p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>0.200000000000000002 === 0.2 // true
</code></pre></div><blockquote><p>æ‰€ä»¥è¿™ä¸¤è€…ç›¸åŠ ä¸ç­‰äº <code>0.3</code> è€Œæ˜¯ <code>0.300000000000000004</code></p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>0.1 + 0.2 === 0.30000000000000004 // true
</code></pre></div><blockquote><p>é‚£ä¹ˆå¯èƒ½ä½ åˆä¼šæœ‰ä¸€ä¸ªç–‘é—®ï¼Œæ—¢ç„¶ <code>0.1</code> ä¸æ˜¯ <code>0.1</code>ï¼Œé‚£ä¸ºä»€ä¹ˆ <code>console.log(0.1)</code> å´æ˜¯æ­£ç¡®çš„å‘¢ï¼Ÿ</p></blockquote> <blockquote><p>å› ä¸ºåœ¨è¾“å…¥å†…å®¹çš„æ—¶å€™ï¼ŒäºŒè¿›åˆ¶è¢«è½¬æ¢ä¸ºäº†åè¿›åˆ¶ï¼Œåè¿›åˆ¶åˆè¢«è½¬æ¢ä¸ºäº†å­—ç¬¦ä¸²ï¼Œåœ¨è¿™ä¸ªè½¬æ¢çš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†å–è¿‘ä¼¼å€¼çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥æ‰“å°å‡ºæ¥çš„å…¶å®æ˜¯ä¸€ä¸ªè¿‘ä¼¼å€¼ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç æ¥éªŒè¯</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>console.log(0.100000000000000002) // 0.1
</code></pre></div><p><strong>è§£å†³</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">parseFloat</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0.1</span> <span class="token operator">+</span> <span class="token number">0.2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0.3</span> <span class="token comment">// true</span>
</code></pre></div><h2 id="_17-äº‹ä»¶æœºåˆ¶"><a href="http://interview.poetries.top/docs/excellent.html#_17-%E4%BA%8B%E4%BB%B6%E6%9C%BA%E5%88%B6" class="header-anchor">#</a> 17 äº‹ä»¶æœºåˆ¶</h2> <blockquote><p>æ¶‰åŠé¢è¯•é¢˜ï¼šäº‹ä»¶çš„è§¦å‘è¿‡ç¨‹æ˜¯æ€ä¹ˆæ ·çš„ï¼ŸçŸ¥é“ä»€ä¹ˆæ˜¯äº‹ä»¶ä»£ç†å˜›ï¼Ÿ</p></blockquote> <h3 id="_17-1-äº‹ä»¶è§¦å‘ä¸‰é˜¶æ®µ"><a href="http://interview.poetries.top/docs/excellent.html#_17-1-%E4%BA%8B%E4%BB%B6%E8%A7%A6%E5%8F%91%E4%B8%89%E9%98%B6%E6%AE%B5" class="header-anchor">#</a> 17.1 äº‹ä»¶è§¦å‘ä¸‰é˜¶æ®µ</h3> <p><strong>äº‹ä»¶è§¦å‘æœ‰ä¸‰ä¸ªé˜¶æ®µ</strong>ï¼š</p> <ul><li><code>window</code>å¾€äº‹ä»¶è§¦å‘å¤„ä¼ æ’­ï¼Œé‡åˆ°æ³¨å†Œçš„æ•è·äº‹ä»¶ä¼šè§¦å‘</li> <li>ä¼ æ’­åˆ°äº‹ä»¶è§¦å‘å¤„æ—¶è§¦å‘æ³¨å†Œçš„äº‹ä»¶</li> <li>ä»äº‹ä»¶è§¦å‘å¤„å¾€ <code>window</code> ä¼ æ’­ï¼Œé‡åˆ°æ³¨å†Œçš„å†’æ³¡äº‹ä»¶ä¼šè§¦å‘</li></ul> <blockquote><p>äº‹ä»¶è§¦å‘ä¸€èˆ¬æ¥è¯´ä¼šæŒ‰ç…§ä¸Šé¢çš„é¡ºåºè¿›è¡Œï¼Œä½†æ˜¯ä¹Ÿæœ‰ç‰¹ä¾‹ï¼Œå¦‚æœç»™ä¸€ä¸ª <code>body</code> ä¸­çš„å­èŠ‚ç‚¹åŒæ—¶æ³¨å†Œå†’æ³¡å’Œæ•è·äº‹ä»¶ï¼Œäº‹ä»¶è§¦å‘ä¼šæŒ‰ç…§æ³¨å†Œçš„é¡ºåºæ‰§è¡Œ</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ä»¥ä¸‹ä¼šå…ˆæ‰“å°å†’æ³¡ç„¶åæ˜¯æ•è·</span>
node<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>
  <span class="token string">'click'</span><span class="token punctuation">,</span>
  <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'å†’æ³¡'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token boolean">false</span>
<span class="token punctuation">)</span>
node<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>
  <span class="token string">'click'</span><span class="token punctuation">,</span>
  <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æ•è· '</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token boolean">true</span>
<span class="token punctuation">)</span>
</code></pre></div><h3 id="_17-2-æ³¨å†Œäº‹ä»¶"><a href="http://interview.poetries.top/docs/excellent.html#_17-2-%E6%B3%A8%E5%86%8C%E4%BA%8B%E4%BB%B6" class="header-anchor">#</a> 17.2 æ³¨å†Œäº‹ä»¶</h3> <blockquote><p>é€šå¸¸æˆ‘ä»¬ä½¿ç”¨ <code>addEventListener</code> æ³¨å†Œäº‹ä»¶ï¼Œè¯¥å‡½æ•°çš„ç¬¬ä¸‰ä¸ªå‚æ•°å¯ä»¥æ˜¯å¸ƒå°”å€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡ã€‚å¯¹äºå¸ƒå°”å€¼ <code>useCapture</code> å‚æ•°æ¥è¯´ï¼Œè¯¥å‚æ•°é»˜è®¤å€¼ä¸º <code>false</code> ï¼Œ<code>useCapture</code> å†³å®šäº†æ³¨å†Œçš„äº‹ä»¶æ˜¯æ•è·äº‹ä»¶è¿˜æ˜¯å†’æ³¡äº‹ä»¶ã€‚å¯¹äºå¯¹è±¡å‚æ•°æ¥è¯´ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‡ ä¸ªå±æ€§</p></blockquote> <ul><li><code>capture</code>ï¼šå¸ƒå°”å€¼ï¼Œå’Œ <code>useCapture</code> ä½œç”¨ä¸€æ ·</li> <li><code>once</code>ï¼šå¸ƒå°”å€¼ï¼Œå€¼ä¸º <code>true</code> è¡¨ç¤ºè¯¥å›è°ƒåªä¼šè°ƒç”¨ä¸€æ¬¡ï¼Œè°ƒç”¨åä¼šç§»é™¤ç›‘å¬</li> <li><code>passive</code>ï¼šå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ°¸è¿œä¸ä¼šè°ƒç”¨ <code>preventDefault</code></li></ul> <blockquote><p>ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœæˆ‘ä»¬åªå¸Œæœ›äº‹ä»¶åªè§¦å‘åœ¨ç›®æ ‡ä¸Šï¼Œè¿™æ—¶å€™å¯ä»¥ä½¿ç”¨ <code>stopPropagation</code>æ¥é˜»æ­¢äº‹ä»¶çš„è¿›ä¸€æ­¥ä¼ æ’­ã€‚é€šå¸¸æˆ‘ä»¬è®¤ä¸º <code>stopPropagation</code> æ˜¯ç”¨æ¥é˜»æ­¢äº‹ä»¶å†’æ³¡çš„ï¼Œå…¶å®è¯¥å‡½æ•°ä¹Ÿå¯ä»¥é˜»æ­¢æ•è·äº‹ä»¶<code>ã€‚stopImmediatePropagation</code>åŒæ ·ä¹Ÿèƒ½å®ç°é˜»æ­¢äº‹ä»¶ï¼Œä½†æ˜¯è¿˜èƒ½é˜»æ­¢è¯¥äº‹ä»¶ç›®æ ‡æ‰§è¡Œåˆ«çš„æ³¨å†Œäº‹ä»¶ã€‚</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>node<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>
  <span class="token string">'click'</span><span class="token punctuation">,</span>
  <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    event<span class="token punctuation">.</span><span class="token function">stopImmediatePropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'å†’æ³¡'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token boolean">false</span>
<span class="token punctuation">)</span>
<span class="token comment">// ç‚¹å‡» node åªä¼šæ‰§è¡Œä¸Šé¢çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¸ä¼šæ‰§è¡Œ</span>
node<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>
  <span class="token string">'click'</span><span class="token punctuation">,</span>
  <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æ•è· '</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token boolean">true</span>
<span class="token punctuation">)</span>
</code></pre></div><h3 id="_17-3-äº‹ä»¶ä»£ç†"><a href="http://interview.poetries.top/docs/excellent.html#_17-3-%E4%BA%8B%E4%BB%B6%E4%BB%A3%E7%90%86" class="header-anchor">#</a> 17.3 äº‹ä»¶ä»£ç†</h3> <blockquote><p>å¦‚æœä¸€ä¸ªèŠ‚ç‚¹ä¸­çš„å­èŠ‚ç‚¹æ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼Œé‚£ä¹ˆå­èŠ‚ç‚¹éœ€è¦æ³¨å†Œäº‹ä»¶çš„è¯åº”è¯¥æ³¨å†Œåœ¨çˆ¶èŠ‚ç‚¹ä¸Š</p></blockquote> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ul<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
	<span class="token keyword">let</span> ul <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#ul'</span><span class="token punctuation">)</span>
	ul<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>äº‹ä»¶ä»£ç†çš„æ–¹å¼ç›¸è¾ƒäºç›´æ¥ç»™ç›®æ ‡æ³¨å†Œäº‹ä»¶æ¥è¯´ï¼Œæœ‰ä»¥ä¸‹ä¼˜ç‚¹</strong>ï¼š</p> <ul><li>èŠ‚çœå†…å­˜</li> <li>ä¸éœ€è¦ç»™å­èŠ‚ç‚¹æ³¨é”€äº‹ä»¶</li></ul> <h2 id="_18-è·¨åŸŸ"><a href="http://interview.poetries.top/docs/excellent.html#_18-%E8%B7%A8%E5%9F%9F" class="header-anchor">#</a> 18 è·¨åŸŸ</h2> <blockquote><p>æ¶‰åŠé¢è¯•é¢˜ï¼šä»€ä¹ˆæ˜¯è·¨åŸŸï¼Ÿä¸ºä»€ä¹ˆæµè§ˆå™¨è¦ä½¿ç”¨åŒæºç­–ç•¥ï¼Ÿä½ æœ‰å‡ ç§æ–¹å¼å¯ä»¥è§£å†³è·¨åŸŸé—®é¢˜ï¼Ÿäº†è§£é¢„æ£€è¯·æ±‚å˜›ï¼Ÿ</p></blockquote> <ul><li>å› ä¸ºæµè§ˆå™¨å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œæœ‰åŒæºç­–ç•¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœåè®®ã€åŸŸåæˆ–è€…ç«¯å£æœ‰ä¸€ä¸ªä¸åŒå°±æ˜¯è·¨åŸŸï¼Œ<code>Ajax</code> è¯·æ±‚ä¼šå¤±è´¥ã€‚</li> <li>é‚£ä¹ˆæ˜¯å‡ºäºä»€ä¹ˆå®‰å…¨è€ƒè™‘æ‰ä¼šå¼•å…¥è¿™ç§æœºåˆ¶å‘¢ï¼Ÿ å…¶å®ä¸»è¦æ˜¯ç”¨æ¥é˜²æ­¢ <code>CSRF</code> æ”»å‡»çš„ã€‚ç®€å•ç‚¹è¯´ï¼Œ<code>CSRF</code> æ”»å‡»æ˜¯åˆ©ç”¨ç”¨æˆ·çš„ç™»å½•æ€å‘èµ·æ¶æ„è¯·æ±‚ã€‚</li> <li>ä¹Ÿå°±æ˜¯è¯´ï¼Œæ²¡æœ‰åŒæºç­–ç•¥çš„æƒ…å†µä¸‹ï¼Œ<code>A</code> ç½‘ç«™å¯ä»¥è¢«ä»»æ„å…¶ä»–æ¥æºçš„ <code>Ajax</code> è®¿é—®åˆ°å†…å®¹ã€‚å¦‚æœä½ å½“å‰ <code>A</code> ç½‘ç«™è¿˜å­˜åœ¨ç™»å½•æ€ï¼Œé‚£ä¹ˆå¯¹æ–¹å°±å¯ä»¥é€šè¿‡ <code>Ajax</code> è·å¾—ä½ çš„ä»»ä½•ä¿¡æ¯ã€‚å½“ç„¶è·¨åŸŸå¹¶ä¸èƒ½å®Œå…¨é˜»æ­¢ <code>CSRF</code>ã€‚</li></ul> <blockquote><p>ç„¶åæˆ‘ä»¬æ¥è€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼Œè¯·æ±‚è·¨åŸŸäº†ï¼Œé‚£ä¹ˆè¯·æ±‚åˆ°åº•å‘å‡ºå»æ²¡æœ‰ï¼Ÿ è¯·æ±‚å¿…ç„¶æ˜¯å‘å‡ºå»äº†ï¼Œä½†æ˜¯æµè§ˆå™¨æ‹¦æˆªäº†å“åº”ã€‚ä½ å¯èƒ½ä¼šç–‘é—®æ˜æ˜é€šè¿‡è¡¨å•çš„æ–¹å¼å¯ä»¥å‘èµ·è·¨åŸŸè¯·æ±‚ï¼Œä¸ºä»€ä¹ˆ <code>Ajax</code>å°±ä¸ä¼šã€‚å› ä¸ºå½’æ ¹ç»“åº•ï¼Œè·¨åŸŸæ˜¯ä¸ºäº†é˜»æ­¢ç”¨æˆ·è¯»å–åˆ°å¦ä¸€ä¸ªåŸŸåä¸‹çš„å†…å®¹ï¼Œ<code>Ajax</code> å¯ä»¥è·å–å“åº”ï¼Œæµè§ˆå™¨è®¤ä¸ºè¿™ä¸å®‰å…¨ï¼Œæ‰€ä»¥æ‹¦æˆªäº†å“åº”ã€‚ä½†æ˜¯è¡¨å•å¹¶ä¸ä¼šè·å–æ–°çš„å†…å®¹ï¼Œæ‰€ä»¥å¯ä»¥å‘èµ·è·¨åŸŸè¯·æ±‚ã€‚åŒæ—¶ä¹Ÿè¯´æ˜äº†è·¨åŸŸå¹¶ä¸èƒ½å®Œå…¨é˜»æ­¢ <code>CSRF</code>ï¼Œå› ä¸ºè¯·æ±‚æ¯•ç«Ÿæ˜¯å‘å‡ºå»äº†ã€‚</p></blockquote> <p>æ¥ä¸‹æ¥æˆ‘ä»¬å°†æ¥å­¦ä¹ å‡ ç§å¸¸è§çš„æ–¹å¼æ¥è§£å†³è·¨åŸŸçš„é—®é¢˜</p> <h3 id="_18-1-jsonp"><a href="http://interview.poetries.top/docs/excellent.html#_18-1-jsonp" class="header-anchor">#</a> 18.1 JSONP</h3> <blockquote><p><code>JSONP</code> çš„åŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯åˆ©ç”¨ <code>&lt;script&gt;</code> æ ‡ç­¾æ²¡æœ‰è·¨åŸŸé™åˆ¶çš„æ¼æ´ã€‚é€šè¿‡ <code>&lt;script&gt;</code>æ ‡ç­¾æŒ‡å‘ä¸€ä¸ªéœ€è¦è®¿é—®çš„åœ°å€å¹¶æä¾›ä¸€ä¸ªå›è°ƒå‡½æ•°æ¥æ¥æ”¶æ•°æ®å½“éœ€è¦é€šè®¯æ—¶</p></blockquote> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://domain/api?param1=a&amp;param2=b&amp;callback=jsonp<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">function</span> <span class="token function">jsonp</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>    

</code></pre></div><blockquote><p><code>JSONP</code> ä½¿ç”¨ç®€å•ä¸”å…¼å®¹æ€§ä¸é”™ï¼Œä½†æ˜¯åªé™äº <code>get</code> è¯·æ±‚ã€‚</p></blockquote> <blockquote><p>åœ¨å¼€å‘ä¸­å¯èƒ½ä¼šé‡åˆ°å¤šä¸ª <code>JSONP</code> è¯·æ±‚çš„å›è°ƒå‡½æ•°åæ˜¯ç›¸åŒçš„ï¼Œè¿™æ—¶å€™å°±éœ€è¦è‡ªå·±å°è£…ä¸€ä¸ª <code>JSONP</code>ï¼Œä»¥ä¸‹æ˜¯ç®€å•å®ç°</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">jsonp</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> jsonpCallback<span class="token punctuation">,</span> success</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span>
  script<span class="token punctuation">.</span>src <span class="token operator">=</span> url
  script<span class="token punctuation">.</span>async <span class="token operator">=</span> <span class="token boolean">true</span>
  script<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'text/javascript'</span>
  window<span class="token punctuation">[</span>jsonpCallback<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    success <span class="token operator">&amp;&amp;</span> <span class="token function">success</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">jsonp</span><span class="token punctuation">(</span><span class="token string">'http://xxx'</span><span class="token punctuation">,</span> <span class="token string">'callback'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_18-2-cors"><a href="http://interview.poetries.top/docs/excellent.html#_18-2-cors" class="header-anchor">#</a> 18.2 CORS</h3> <ul><li><code>CORS</code> éœ€è¦æµè§ˆå™¨å’Œåç«¯åŒæ—¶æ”¯æŒã€‚<code>IE 8</code> å’Œ <code>9</code> éœ€è¦é€šè¿‡ <code>XDomainRequest</code> æ¥å®ç°ã€‚</li> <li>æµè§ˆå™¨ä¼šè‡ªåŠ¨è¿›è¡Œ <code>CORS</code> é€šä¿¡ï¼Œå®ç° <code>CORS</code> é€šä¿¡çš„å…³é”®æ˜¯åç«¯ã€‚åªè¦åç«¯å®ç°äº† <code>CORS</code>ï¼Œå°±å®ç°äº†è·¨åŸŸã€‚</li> <li>æœåŠ¡ç«¯è®¾ç½® <code>Access-Control-Allow-Origin</code> å°±å¯ä»¥å¼€å¯ <code>CORS</code>ã€‚ è¯¥å±æ€§è¡¨ç¤ºå“ªäº›åŸŸåå¯ä»¥è®¿é—®èµ„æºï¼Œå¦‚æœè®¾ç½®é€šé…ç¬¦åˆ™è¡¨ç¤ºæ‰€æœ‰ç½‘ç«™éƒ½å¯ä»¥è®¿é—®èµ„æºã€‚
è™½ç„¶è®¾ç½® <code>CORS</code>å’Œå‰ç«¯æ²¡ä»€ä¹ˆå…³ç³»ï¼Œä½†æ˜¯é€šè¿‡è¿™ç§æ–¹å¼è§£å†³è·¨åŸŸé—®é¢˜çš„è¯ï¼Œä¼šåœ¨å‘é€è¯·æ±‚æ—¶å‡ºç°ä¸¤ç§æƒ…å†µï¼Œåˆ†åˆ«ä¸ºç®€å•è¯·æ±‚å’Œå¤æ‚è¯·æ±‚ã€‚</li></ul> <p><strong>ç®€å•è¯·æ±‚</strong></p> <blockquote><p>ä»¥ <code>Ajax</code> ä¸ºä¾‹ï¼Œå½“æ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ—¶ï¼Œä¼šè§¦å‘ç®€å•è¯·æ±‚</p></blockquote> <ol><li>ä½¿ç”¨ä¸‹åˆ—æ–¹æ³•ä¹‹ä¸€ï¼š</li></ol> <ul><li><code>GET</code></li> <li><code>HEAD</code></li> <li><code>POST</code></li></ul> <ol start="2"><li><code>Content-Type</code> çš„å€¼ä»…é™äºä¸‹åˆ—ä¸‰è€…ä¹‹ä¸€ï¼š</li></ol> <ul><li>text/plain</li> <li><code>multipart/form-data</code></li> <li><code>application/x-www-form-urlencoded</code></li></ul> <blockquote><p>è¯·æ±‚ä¸­çš„ä»»æ„ <code>XMLHttpRequestUpload</code> å¯¹è±¡å‡æ²¡æœ‰æ³¨å†Œä»»ä½•äº‹ä»¶ç›‘å¬å™¨ï¼› <code>XMLHttpRequestUpload</code> å¯¹è±¡å¯ä»¥ä½¿ç”¨ <code>XMLHttpRequest.upload</code> å±æ€§è®¿é—®</p></blockquote> <p><strong>å¤æ‚è¯·æ±‚</strong></p> <blockquote><p>å¯¹äºå¤æ‚è¯·æ±‚æ¥è¯´ï¼Œé¦–å…ˆä¼šå‘èµ·ä¸€ä¸ªé¢„æ£€è¯·æ±‚ï¼Œè¯¥è¯·æ±‚æ˜¯ <code>option</code> æ–¹æ³•çš„ï¼Œé€šè¿‡è¯¥è¯·æ±‚æ¥çŸ¥é“æœåŠ¡ç«¯æ˜¯å¦å…è®¸è·¨åŸŸè¯·æ±‚ã€‚</p></blockquote> <p>å¯¹äºé¢„æ£€è¯·æ±‚æ¥è¯´ï¼Œå¦‚æœä½ ä½¿ç”¨è¿‡ <code>Node</code> æ¥è®¾ç½® <code>CORS</code> çš„è¯ï¼Œå¯èƒ½ä¼šé‡åˆ°è¿‡è¿™ä¹ˆä¸€ä¸ªå‘ã€‚</p> <p>ä»¥ä¸‹ä»¥ <code>express</code>æ¡†æ¶ä¸¾ä¾‹</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Allow-Origin'</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Allow-Methods'</span><span class="token punctuation">,</span> <span class="token string">'PUT, GET, POST, DELETE, OPTIONS'</span><span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span>
    <span class="token string">'Access-Control-Allow-Headers'</span><span class="token punctuation">,</span>
    <span class="token string">'Origin, X-Requested-With, Content-Type, Accept, Authorization, Access-Control-Allow-Credentials'</span>
  <span class="token punctuation">)</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>è¯¥è¯·æ±‚ä¼šéªŒè¯ä½ çš„ <code>Authorization</code> å­—æ®µï¼Œæ²¡æœ‰çš„è¯å°±ä¼šæŠ¥é”™ã€‚</li> <li>å½“å‰ç«¯å‘èµ·äº†å¤æ‚è¯·æ±‚åï¼Œä½ ä¼šå‘ç°å°±ç®—ä½ ä»£ç æ˜¯æ­£ç¡®çš„ï¼Œè¿”å›ç»“æœä¹Ÿæ°¸è¿œæ˜¯æŠ¥é”™çš„ã€‚å› ä¸ºé¢„æ£€è¯·æ±‚ä¹Ÿä¼šè¿›å…¥å›è°ƒä¸­ï¼Œä¹Ÿä¼šè§¦å‘ <code>next</code> æ–¹æ³•ï¼Œå› ä¸ºé¢„æ£€è¯·æ±‚å¹¶ä¸åŒ…å« <code>Authorization</code> å­—æ®µï¼Œæ‰€ä»¥æœåŠ¡ç«¯ä¼šæŠ¥é”™ã€‚</li></ul> <blockquote><p>æƒ³è§£å†³è¿™ä¸ªé—®é¢˜å¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨å›è°ƒä¸­è¿‡æ»¤ <code>option</code> æ–¹æ³•å³å¯</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>res<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">204</span>
res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Length'</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span>
res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_18-3-document-domain"><a href="http://interview.poetries.top/docs/excellent.html#_18-3-document-domain" class="header-anchor">#</a> 18.3 document.domain</h3> <ul><li>è¯¥æ–¹å¼åªèƒ½ç”¨äºä¸»åŸŸåç›¸åŒçš„æƒ…å†µä¸‹ï¼Œæ¯”å¦‚ <code>a.test.com</code> å’Œ <code>b.test.com</code> é€‚ç”¨äºè¯¥æ–¹å¼ã€‚</li> <li>åªéœ€è¦ç»™é¡µé¢æ·»åŠ  <code>document.domain = 'test.com'</code> è¡¨ç¤ºä¸»åŸŸåéƒ½ç›¸åŒå°±å¯ä»¥å®ç°è·¨åŸŸ</li></ul> <h3 id="_18-4-postmessage"><a href="http://interview.poetries.top/docs/excellent.html#_18-4-postmessage" class="header-anchor">#</a> 18.4 postMessage</h3> <blockquote><p>è¿™ç§æ–¹å¼é€šå¸¸ç”¨äºè·å–åµŒå…¥é¡µé¢ä¸­çš„ç¬¬ä¸‰æ–¹é¡µé¢æ•°æ®ã€‚ä¸€ä¸ªé¡µé¢å‘é€æ¶ˆæ¯ï¼Œå¦ä¸€ä¸ªé¡µé¢åˆ¤æ–­æ¥æºå¹¶æ¥æ”¶æ¶ˆæ¯</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// å‘é€æ¶ˆæ¯ç«¯</span>
window<span class="token punctuation">.</span>parent<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token string">'http://test.com'</span><span class="token punctuation">)</span>
<span class="token comment">// æ¥æ”¶æ¶ˆæ¯ç«¯</span>
<span class="token keyword">var</span> mc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MessageChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
mc<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> origin <span class="token operator">=</span> event<span class="token punctuation">.</span>origin <span class="token operator">||</span> event<span class="token punctuation">.</span>originalEvent<span class="token punctuation">.</span>origin
  <span class="token keyword">if</span> <span class="token punctuation">(</span>origin <span class="token operator">===</span> <span class="token string">'http://test.com'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'éªŒè¯é€šè¿‡'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="_19-å­˜å‚¨"><a href="http://interview.poetries.top/docs/excellent.html#_19-%E5%AD%98%E5%82%A8" class="header-anchor">#</a> 19 å­˜å‚¨</h2> <blockquote><p>æ¶‰åŠé¢è¯•é¢˜ï¼šæœ‰å‡ ç§æ–¹å¼å¯ä»¥å®ç°å­˜å‚¨åŠŸèƒ½ï¼Œåˆ†åˆ«æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿä»€ä¹ˆæ˜¯ <code>Service Worker</code>ï¼Ÿ</p></blockquote> <p><strong>cookieï¼ŒlocalStorageï¼ŒsessionStorageï¼ŒindexDB</strong></p> <table><thead><tr><th>ç‰¹æ€§</th> <th>cookie</th> <th>localStorage</th> <th>sessionStorage</th> <th>indexDB</th></tr></thead> <tbody><tr><td>æ•°æ®ç”Ÿå‘½å‘¨æœŸ</td> <td>ä¸€èˆ¬ç”±æœåŠ¡å™¨ç”Ÿæˆï¼Œå¯ä»¥è®¾ç½®è¿‡æœŸæ—¶é—´</td> <td>é™¤éè¢«æ¸…ç†ï¼Œå¦åˆ™ä¸€ç›´å­˜åœ¨</td> <td>é¡µé¢å…³é—­å°±æ¸…ç†</td> <td>é™¤éè¢«æ¸…ç†ï¼Œå¦åˆ™ä¸€ç›´å­˜åœ¨</td></tr> <tr><td>æ•°æ®å­˜å‚¨å¤§å°</td> <td><code>4K</code></td> <td><code>5M</code></td> <td><code>5M</code></td> <td>æ— é™</td></tr> <tr><td>ä¸æœåŠ¡ç«¯é€šä¿¡</td> <td>æ¯æ¬¡éƒ½ä¼šæºå¸¦åœ¨ <code>header</code> ä¸­ï¼Œå¯¹äºè¯·æ±‚æ€§èƒ½å½±å“</td> <td>ä¸å‚ä¸</td> <td>ä¸å‚ä¸</td> <td>ä¸å‚ä¸</td></tr></tbody></table> <blockquote><p>ä»ä¸Šè¡¨å¯ä»¥çœ‹åˆ°ï¼Œ<code>cookie</code> å·²ç»ä¸å»ºè®®ç”¨äºå­˜å‚¨ã€‚å¦‚æœæ²¡æœ‰å¤§é‡æ•°æ®å­˜å‚¨éœ€æ±‚çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ <code>localStorage</code> å’Œ <code>sessionStorage</code> ã€‚å¯¹äºä¸æ€ä¹ˆæ”¹å˜çš„æ•°æ®å°½é‡ä½¿ç”¨ <code>localStorage</code> å­˜å‚¨ï¼Œå¦åˆ™å¯ä»¥ç”¨ <code>sessionStorage</code>å­˜å‚¨</p></blockquote> <p><strong>å¯¹äº cookie æ¥è¯´ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ³¨æ„å®‰å…¨æ€§ã€‚</strong></p> <table><thead><tr><th>å±æ€§</th> <th>ä½œç”¨</th></tr></thead> <tbody><tr><td><code>value</code></td> <td>å¦‚æœç”¨äºä¿å­˜ç”¨æˆ·ç™»å½•æ€ï¼Œåº”è¯¥å°†è¯¥å€¼åŠ å¯†ï¼Œä¸èƒ½ä½¿ç”¨æ˜æ–‡çš„ç”¨æˆ·æ ‡è¯†</td></tr> <tr><td><code>http-only</code></td> <td>ä¸èƒ½é€šè¿‡ <code>JS</code> è®¿é—® <code>Cookie</code>ï¼Œå‡å°‘ <code>XSS</code> æ”»å‡»</td></tr> <tr><td><code>secure</code></td> <td>åªèƒ½åœ¨åè®®ä¸º <code>HTTPS</code> çš„è¯·æ±‚ä¸­æºå¸¦</td></tr> <tr><td><code>same-site</code></td> <td>è§„å®šæµè§ˆå™¨ä¸èƒ½åœ¨è·¨åŸŸè¯·æ±‚ä¸­æºå¸¦ <code>Cookie</code>ï¼Œå‡å°‘ <code>CSRF</code> æ”»å‡»</td></tr></tbody></table> <p><strong>Service Worker</strong></p> <ul><li><code>Service Worker</code> æ˜¯è¿è¡Œåœ¨æµè§ˆå™¨èƒŒåçš„ç‹¬ç«‹çº¿ç¨‹ï¼Œä¸€èˆ¬å¯ä»¥ç”¨æ¥å®ç°ç¼“å­˜åŠŸèƒ½ã€‚ä½¿ç”¨ <code>Service Worker</code>çš„è¯ï¼Œä¼ è¾“åè®®å¿…é¡»ä¸º <code>HTTPS</code>ã€‚å› ä¸º <code>Service Worker</code> ä¸­æ¶‰åŠåˆ°è¯·æ±‚æ‹¦æˆªï¼Œæ‰€ä»¥å¿…é¡»ä½¿ç”¨ <code>HTTPS</code> åè®®æ¥ä¿éšœå®‰å…¨</li> <li><code>Service Worker</code> å®ç°ç¼“å­˜åŠŸèƒ½ä¸€èˆ¬åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼šé¦–å…ˆéœ€è¦å…ˆæ³¨å†Œ <code>Service Worker</code>ï¼Œç„¶åç›‘å¬åˆ° <code>install</code> äº‹ä»¶ä»¥åå°±å¯ä»¥ç¼“å­˜éœ€è¦çš„æ–‡ä»¶ï¼Œé‚£ä¹ˆåœ¨ä¸‹æ¬¡ç”¨æˆ·è®¿é—®çš„æ—¶å€™å°±å¯ä»¥é€šè¿‡æ‹¦æˆªè¯·æ±‚çš„æ–¹å¼æŸ¥è¯¢æ˜¯å¦å­˜åœ¨ç¼“å­˜ï¼Œå­˜åœ¨ç¼“å­˜çš„è¯å°±å¯ä»¥ç›´æ¥è¯»å–ç¼“å­˜æ–‡ä»¶ï¼Œå¦åˆ™å°±å»è¯·æ±‚æ•°æ®ã€‚ä»¥ä¸‹æ˜¯è¿™ä¸ªæ­¥éª¤çš„å®ç°ï¼š</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// index.js</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  navigator<span class="token punctuation">.</span>serviceWorker
    <span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'sw.js'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">registration</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'service worker æ³¨å†ŒæˆåŠŸ'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'servcie worker æ³¨å†Œå¤±è´¥'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// sw.js</span>
<span class="token comment">// ç›‘å¬ `install` äº‹ä»¶ï¼Œå›è°ƒä¸­ç¼“å­˜æ‰€éœ€æ–‡ä»¶</span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'install'</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  e<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>
    caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'my-cache'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'./index.html'</span><span class="token punctuation">,</span> <span class="token string">'./index.js'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// æ‹¦æˆªæ‰€æœ‰è¯·æ±‚äº‹ä»¶</span>
<span class="token comment">// å¦‚æœç¼“å­˜ä¸­å·²ç»æœ‰è¯·æ±‚çš„æ•°æ®å°±ç›´æ¥ç”¨ç¼“å­˜ï¼Œå¦åˆ™å»è¯·æ±‚æ•°æ®</span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  e<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>
    caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> response
      <span class="token punctuation">}</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'fetch source'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>æ‰“å¼€é¡µé¢ï¼Œå¯ä»¥åœ¨å¼€å‘è€…å·¥å…·ä¸­çš„ <code>Application</code> çœ‹åˆ° <code>Service Worker</code> å·²ç»å¯åŠ¨äº†</p></blockquote> <blockquote><p>åœ¨ <code>Cache</code> ä¸­ä¹Ÿå¯ä»¥å‘ç°æˆ‘ä»¬æ‰€éœ€çš„æ–‡ä»¶å·²è¢«ç¼“å­˜</p></blockquote> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/6.png" alt="" class="medium-zoom-image"></p> <blockquote><p>å½“æˆ‘ä»¬é‡æ–°åˆ·æ–°é¡µé¢å¯ä»¥å‘ç°æˆ‘ä»¬ç¼“å­˜çš„æ•°æ®æ˜¯ä» <code>Service Worker</code> ä¸­è¯»å–çš„</p></blockquote> <h2 id="_20-æµè§ˆå™¨ç¼“å­˜æœºåˆ¶"><a href="http://interview.poetries.top/docs/excellent.html#_20-%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6" class="header-anchor">#</a> 20 æµè§ˆå™¨ç¼“å­˜æœºåˆ¶</h2> <blockquote><p>æ³¨æ„ï¼šè¯¥çŸ¥è¯†ç‚¹å±äºæ€§èƒ½ä¼˜åŒ–é¢†åŸŸï¼Œå¹¶ä¸”æ•´ä¸€ç« èŠ‚éƒ½æ˜¯ä¸€ä¸ªé¢è¯•é¢˜</p></blockquote> <ul><li>ç¼“å­˜å¯ä»¥è¯´æ˜¯æ€§èƒ½ä¼˜åŒ–ä¸­ç®€å•é«˜æ•ˆçš„ä¸€ç§ä¼˜åŒ–æ–¹å¼äº†ï¼Œå®ƒå¯ä»¥æ˜¾è‘—å‡å°‘ç½‘ç»œä¼ è¾“æ‰€å¸¦æ¥çš„æŸè€—ã€‚</li> <li>å¯¹äºä¸€ä¸ªæ•°æ®è¯·æ±‚æ¥è¯´ï¼Œå¯ä»¥åˆ†ä¸ºå‘èµ·ç½‘ç»œè¯·æ±‚ã€åç«¯å¤„ç†ã€æµè§ˆå™¨å“åº”ä¸‰ä¸ªæ­¥éª¤ã€‚æµè§ˆå™¨ç¼“å­˜å¯ä»¥å¸®åŠ©æˆ‘ä»¬åœ¨ç¬¬ä¸€å’Œç¬¬ä¸‰æ­¥éª¤ä¸­ä¼˜åŒ–æ€§èƒ½ã€‚æ¯”å¦‚è¯´ç›´æ¥ä½¿ç”¨ç¼“å­˜è€Œä¸å‘èµ·è¯·æ±‚ï¼Œæˆ–è€…å‘èµ·äº†è¯·æ±‚ä½†åç«¯å­˜å‚¨çš„æ•°æ®å’Œå‰ç«¯ä¸€è‡´ï¼Œé‚£ä¹ˆå°±æ²¡æœ‰å¿…è¦å†å°†æ•°æ®å›ä¼ å›æ¥ï¼Œè¿™æ ·å°±å‡å°‘äº†å“åº”æ•°æ®ã€‚</li></ul> <blockquote><p>æ¥ä¸‹æ¥çš„å†…å®¹ä¸­æˆ‘ä»¬å°†é€šè¿‡ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†æ¥æ¢è®¨æµè§ˆå™¨ç¼“å­˜æœºåˆ¶ï¼š</p></blockquote> <ul><li>ç¼“å­˜ä½ç½®</li> <li>ç¼“å­˜ç­–ç•¥</li> <li>å®é™…åœºæ™¯åº”ç”¨ç¼“å­˜ç­–ç•¥</li></ul> <h3 id="_20-1-ç¼“å­˜ä½ç½®"><a href="http://interview.poetries.top/docs/excellent.html#_20-1-%E7%BC%93%E5%AD%98%E4%BD%8D%E7%BD%AE" class="header-anchor">#</a> 20.1 ç¼“å­˜ä½ç½®</h3> <blockquote><p>ä»ç¼“å­˜ä½ç½®ä¸Šæ¥è¯´åˆ†ä¸ºå››ç§ï¼Œå¹¶ä¸”å„è‡ªæœ‰ä¼˜å…ˆçº§ï¼Œå½“ä¾æ¬¡æŸ¥æ‰¾ç¼“å­˜ä¸”éƒ½æ²¡æœ‰å‘½ä¸­çš„æ—¶å€™ï¼Œæ‰ä¼šå»è¯·æ±‚ç½‘ç»œ</p></blockquote> <ol><li><code>Service Worker</code></li> <li><code>Memory Cache</code></li> <li><code>Disk Cache</code></li> <li><code>Push Cache</code></li> <li>ç½‘ç»œè¯·æ±‚</li></ol> <p><strong>1. Service Worker</strong></p> <ul><li><code>service Worker</code> çš„ç¼“å­˜ä¸æµè§ˆå™¨å…¶ä»–å†…å»ºçš„ç¼“å­˜æœºåˆ¶ä¸åŒï¼Œå®ƒå¯ä»¥è®©æˆ‘ä»¬è‡ªç”±æ§åˆ¶ç¼“å­˜å“ªäº›æ–‡ä»¶ã€å¦‚ä½•åŒ¹é…ç¼“å­˜ã€å¦‚ä½•è¯»å–ç¼“å­˜ï¼Œå¹¶ä¸”ç¼“å­˜æ˜¯æŒç»­æ€§çš„ã€‚</li> <li>å½“ <code>Service Worker</code> æ²¡æœ‰å‘½ä¸­ç¼“å­˜çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å»è°ƒç”¨ <code>fetch</code> å‡½æ•°è·å–æ•°æ®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰åœ¨ <code>Service Worker</code> å‘½ä¸­ç¼“å­˜çš„è¯ï¼Œä¼šæ ¹æ®ç¼“å­˜æŸ¥æ‰¾ä¼˜å…ˆçº§å»æŸ¥æ‰¾æ•°æ®ã€‚ä½†æ˜¯ä¸ç®¡æˆ‘ä»¬æ˜¯ä» <code>Memory Cache</code> ä¸­è¿˜æ˜¯ä»ç½‘ç»œè¯·æ±‚ä¸­è·å–çš„æ•°æ®ï¼Œæµè§ˆå™¨éƒ½ä¼šæ˜¾ç¤ºæˆ‘ä»¬æ˜¯ä» <code>Service Worker</code> ä¸­è·å–çš„å†…å®¹ã€‚</li></ul> <p><strong>2. Memory Cache</strong></p> <ul><li><code>Memory Cache</code> ä¹Ÿå°±æ˜¯å†…å­˜ä¸­çš„ç¼“å­˜ï¼Œè¯»å–å†…å­˜ä¸­çš„æ•°æ®è‚¯å®šæ¯”ç£ç›˜å¿«ã€‚ä½†æ˜¯å†…å­˜ç¼“å­˜è™½ç„¶è¯»å–é«˜æ•ˆï¼Œå¯æ˜¯ç¼“å­˜æŒç»­æ€§å¾ˆçŸ­ï¼Œä¼šéšç€è¿›ç¨‹çš„é‡Šæ”¾è€Œé‡Šæ”¾ã€‚ ä¸€æ—¦æˆ‘ä»¬å…³é—­ <code>Tab</code> é¡µé¢ï¼Œå†…å­˜ä¸­çš„ç¼“å­˜ä¹Ÿå°±è¢«é‡Šæ”¾äº†ã€‚</li> <li>å½“æˆ‘ä»¬è®¿é—®è¿‡é¡µé¢ä»¥åï¼Œå†æ¬¡åˆ·æ–°é¡µé¢ï¼Œå¯ä»¥å‘ç°å¾ˆå¤šæ•°æ®éƒ½æ¥è‡ªäºå†…å­˜ç¼“å­˜</li></ul> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/7.png" alt="" class="medium-zoom-image"></p> <blockquote><p>é‚£ä¹ˆæ—¢ç„¶å†…å­˜ç¼“å­˜è¿™ä¹ˆé«˜æ•ˆï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯èƒ½è®©æ•°æ®éƒ½å­˜æ”¾åœ¨å†…å­˜ä¸­å‘¢ï¼Ÿ</p></blockquote> <ul><li>å…ˆè¯´ç»“è®ºï¼Œè¿™æ˜¯ä¸å¯èƒ½çš„ã€‚é¦–å…ˆè®¡ç®—æœºä¸­çš„å†…å­˜ä¸€å®šæ¯”ç¡¬ç›˜å®¹é‡å°å¾—å¤šï¼Œæ“ä½œç³»ç»Ÿéœ€è¦ç²¾æ‰“ç»†ç®—å†…å­˜çš„ä½¿ç”¨ï¼Œæ‰€ä»¥èƒ½è®©æˆ‘ä»¬ä½¿ç”¨çš„å†…å­˜å¿…ç„¶ä¸å¤šã€‚å†…å­˜ä¸­å…¶å®å¯ä»¥å­˜å‚¨å¤§éƒ¨åˆ†çš„æ–‡ä»¶ï¼Œæ¯”å¦‚è¯´ <code>JS</code>ã€<code>HTML</code>ã€<code>CSS</code>ã€å›¾ç‰‡ç­‰ç­‰</li> <li>å½“ç„¶ï¼Œæˆ‘é€šè¿‡ä¸€äº›å®è·µå’ŒçŒœæµ‹ä¹Ÿå¾—å‡ºäº†ä¸€äº›ç»“è®ºï¼š</li> <li>å¯¹äºå¤§æ–‡ä»¶æ¥è¯´ï¼Œå¤§æ¦‚ç‡æ˜¯ä¸å­˜å‚¨åœ¨å†…å­˜ä¸­çš„ï¼Œåä¹‹ä¼˜å…ˆå½“å‰ç³»ç»Ÿå†…å­˜ä½¿ç”¨ç‡é«˜çš„è¯ï¼Œæ–‡ä»¶ä¼˜å…ˆå­˜å‚¨è¿›ç¡¬ç›˜</li></ul> <p><strong>3. Disk Cache</strong></p> <ul><li><code>Disk Cache</code> ä¹Ÿå°±æ˜¯å­˜å‚¨åœ¨ç¡¬ç›˜ä¸­çš„ç¼“å­˜ï¼Œè¯»å–é€Ÿåº¦æ…¢ç‚¹ï¼Œä½†æ˜¯ä»€ä¹ˆéƒ½èƒ½å­˜å‚¨åˆ°ç£ç›˜ä¸­ï¼Œæ¯”ä¹‹ <code>Memory Cache</code> èƒœåœ¨å®¹é‡å’Œå­˜å‚¨æ—¶æ•ˆæ€§ä¸Šã€‚</li> <li>åœ¨æ‰€æœ‰æµè§ˆå™¨ç¼“å­˜ä¸­ï¼Œ<code>Disk Cache</code> è¦†ç›–é¢åŸºæœ¬æ˜¯æœ€å¤§çš„ã€‚å®ƒä¼šæ ¹æ® Â·HTTP HerderÂ· ä¸­çš„å­—æ®µåˆ¤æ–­å“ªäº›èµ„æºéœ€è¦ç¼“å­˜ï¼Œå“ªäº›èµ„æºå¯ä»¥ä¸è¯·æ±‚ç›´æ¥ä½¿ç”¨ï¼Œå“ªäº›èµ„æºå·²ç»è¿‡æœŸéœ€è¦é‡æ–°è¯·æ±‚ã€‚å¹¶ä¸”å³ä½¿åœ¨è·¨ç«™ç‚¹çš„æƒ…å†µä¸‹ï¼Œç›¸åŒåœ°å€çš„èµ„æºä¸€æ—¦è¢«ç¡¬ç›˜ç¼“å­˜ä¸‹æ¥ï¼Œå°±ä¸ä¼šå†æ¬¡å»è¯·æ±‚æ•°æ®</li></ul> <p><strong>4. Push Cache</strong></p> <ul><li><code>Push Cache</code> æ˜¯ <code>HTTP/2</code> ä¸­çš„å†…å®¹ï¼Œå½“ä»¥ä¸Šä¸‰ç§ç¼“å­˜éƒ½æ²¡æœ‰å‘½ä¸­æ—¶ï¼Œå®ƒæ‰ä¼šè¢«ä½¿ç”¨ã€‚å¹¶ä¸”ç¼“å­˜æ—¶é—´ä¹Ÿå¾ˆçŸ­æš‚ï¼Œåªåœ¨ä¼šè¯ï¼ˆ<code>Session</code>ï¼‰ä¸­å­˜åœ¨ï¼Œä¸€æ—¦ä¼šè¯ç»“æŸå°±è¢«é‡Šæ”¾ã€‚</li> <li><code>Push Cache</code> åœ¨å›½å†…èƒ½å¤ŸæŸ¥åˆ°çš„èµ„æ–™å¾ˆå°‘ï¼Œä¹Ÿæ˜¯å› ä¸º <code>HTTP/2</code> åœ¨å›½å†…ä¸å¤Ÿæ™®åŠï¼Œä½†æ˜¯ <code>HTTP/2</code> å°†ä¼šæ˜¯æ—¥åçš„ä¸€ä¸ªè¶‹åŠ¿</li></ul> <blockquote><p>ç»“è®º</p></blockquote> <ul><li>æ‰€æœ‰çš„èµ„æºéƒ½èƒ½è¢«æ¨é€ï¼Œä½†æ˜¯ <code>Edge</code> å’Œ <code>Safari</code> æµè§ˆå™¨å…¼å®¹æ€§ä¸æ€ä¹ˆå¥½</li> <li>å¯ä»¥æ¨é€ <code>no-cache</code> å’Œ <code>no-store</code> çš„èµ„æº</li> <li>ä¸€æ—¦è¿æ¥è¢«å…³é—­ï¼Œ<code>Push Cache</code> å°±è¢«é‡Šæ”¾</li> <li>å¤šä¸ªé¡µé¢å¯ä»¥ä½¿ç”¨ç›¸åŒçš„ <code>HTTP/2</code> è¿æ¥ï¼Œä¹Ÿå°±æ˜¯è¯´èƒ½ä½¿ç”¨åŒæ ·çš„ç¼“å­˜</li> <li><code>Push Cache</code> ä¸­çš„ç¼“å­˜åªèƒ½è¢«ä½¿ç”¨ä¸€æ¬¡</li> <li>æµè§ˆå™¨å¯ä»¥æ‹’ç»æ¥å—å·²ç»å­˜åœ¨çš„èµ„æºæ¨é€</li> <li>ä½ å¯ä»¥ç»™å…¶ä»–åŸŸåæ¨é€èµ„æº</li></ul> <p><strong>5. ç½‘ç»œè¯·æ±‚</strong></p> <ul><li>å¦‚æœæ‰€æœ‰ç¼“å­˜éƒ½æ²¡æœ‰å‘½ä¸­çš„è¯ï¼Œé‚£ä¹ˆåªèƒ½å‘èµ·è¯·æ±‚æ¥è·å–èµ„æºäº†ã€‚</li> <li>é‚£ä¹ˆä¸ºäº†æ€§èƒ½ä¸Šçš„è€ƒè™‘ï¼Œå¤§éƒ¨åˆ†çš„æ¥å£éƒ½åº”è¯¥é€‰æ‹©å¥½ç¼“å­˜ç­–ç•¥ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥å­¦ä¹ ç¼“å­˜ç­–ç•¥è¿™éƒ¨åˆ†çš„å†…å®¹</li></ul> <h3 id="_20-2-ç¼“å­˜ç­–ç•¥"><a href="http://interview.poetries.top/docs/excellent.html#_20-2-%E7%BC%93%E5%AD%98%E7%AD%96%E7%95%A5" class="header-anchor">#</a> 20.2 ç¼“å­˜ç­–ç•¥</h3> <blockquote><p>é€šå¸¸æµè§ˆå™¨ç¼“å­˜ç­–ç•¥åˆ†ä¸ºä¸¤ç§ï¼šå¼ºç¼“å­˜å’Œåå•†ç¼“å­˜ï¼Œå¹¶ä¸”ç¼“å­˜ç­–ç•¥éƒ½æ˜¯é€šè¿‡è®¾ç½® <code>HTTP Header</code> æ¥å®ç°çš„</p></blockquote> <h4 id="_20-2-1-å¼ºç¼“å­˜"><a href="http://interview.poetries.top/docs/excellent.html#_20-2-1-%E5%BC%BA%E7%BC%93%E5%AD%98" class="header-anchor">#</a> 20.2.1 å¼ºç¼“å­˜</h4> <blockquote><p>å¼ºç¼“å­˜å¯ä»¥é€šè¿‡è®¾ç½®ä¸¤ç§ <code>HTTP Header</code> å®ç°ï¼š<code>Expires</code> å’Œ <code>Cache-Control</code> ã€‚å¼ºç¼“å­˜è¡¨ç¤ºåœ¨ç¼“å­˜æœŸé—´ä¸éœ€è¦è¯·æ±‚ï¼Œ<code>state code</code>ä¸º <code>200</code></p></blockquote> <p><strong>Expires</strong></p> <div class="language- extra-class"><pre class="language-text"><code>Expires: Wed, 22 Oct 2018 08:41:00 GMT
</code></pre></div><blockquote><p><code>Expires</code> æ˜¯ <code>HTTP/1</code> çš„äº§ç‰©ï¼Œè¡¨ç¤ºèµ„æºä¼šåœ¨ <code>Wed, 22 Oct 2018 08:41:00 GMT</code> åè¿‡æœŸï¼Œéœ€è¦å†æ¬¡è¯·æ±‚ã€‚å¹¶ä¸” <code>Expires</code> å—é™äºæœ¬åœ°æ—¶é—´ï¼Œå¦‚æœä¿®æ”¹äº†æœ¬åœ°æ—¶é—´ï¼Œå¯èƒ½ä¼šé€ æˆç¼“å­˜å¤±æ•ˆã€‚</p></blockquote> <p><strong>Cache-control</strong></p> <div class="language- extra-class"><pre class="language-text"><code>Cache-control: max-age=30
</code></pre></div><ul><li><code>Cache-Control</code> å‡ºç°äº <code>HTTP/1.1</code>ï¼Œä¼˜å…ˆçº§é«˜äº <code>Expires</code> ã€‚è¯¥å±æ€§å€¼è¡¨ç¤ºèµ„æºä¼šåœ¨ <code>30</code> ç§’åè¿‡æœŸï¼Œéœ€è¦å†æ¬¡è¯·æ±‚ã€‚</li> <li><code>Cache-Control</code> å¯ä»¥åœ¨è¯·æ±‚å¤´æˆ–è€…å“åº”å¤´ä¸­è®¾ç½®ï¼Œå¹¶ä¸”å¯ä»¥ç»„åˆä½¿ç”¨å¤šç§æŒ‡ä»¤</li></ul> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/8.png" alt="" class="medium-zoom-image"></p> <blockquote><p>ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å¯ä»¥å°†å¤šä¸ªæŒ‡ä»¤é…åˆèµ·æ¥ä¸€èµ·ä½¿ç”¨ï¼Œè¾¾åˆ°å¤šä¸ªç›®çš„ã€‚æ¯”å¦‚è¯´æˆ‘ä»¬å¸Œæœ›èµ„æºèƒ½è¢«ç¼“å­˜ä¸‹æ¥ï¼Œå¹¶ä¸”æ˜¯å®¢æˆ·ç«¯å’Œä»£ç†æœåŠ¡å™¨éƒ½èƒ½ç¼“å­˜ï¼Œè¿˜èƒ½è®¾ç½®ç¼“å­˜å¤±æ•ˆæ—¶é—´ç­‰</p></blockquote> <p><strong>ä¸€äº›å¸¸è§æŒ‡ä»¤çš„ä½œç”¨</strong></p> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/9.png" alt="" class="medium-zoom-image"></p> <h4 id="_20-2-2-åå•†ç¼“å­˜"><a href="http://interview.poetries.top/docs/excellent.html#_20-2-2-%E5%8D%8F%E5%95%86%E7%BC%93%E5%AD%98" class="header-anchor">#</a> 20.2.2 åå•†ç¼“å­˜</h4> <ul><li>å¦‚æœç¼“å­˜è¿‡æœŸäº†ï¼Œå°±éœ€è¦å‘èµ·è¯·æ±‚éªŒè¯èµ„æºæ˜¯å¦æœ‰æ›´æ–°ã€‚åå•†ç¼“å­˜å¯ä»¥é€šè¿‡è®¾ç½®ä¸¤ç§ <code>HTTP Header</code> å®ç°ï¼š<code>Last-Modified</code> å’Œ <code>ETag</code></li> <li>å½“æµè§ˆå™¨å‘èµ·è¯·æ±‚éªŒè¯èµ„æºæ—¶ï¼Œå¦‚æœèµ„æºæ²¡æœ‰åšæ”¹å˜ï¼Œé‚£ä¹ˆæœåŠ¡ç«¯å°±ä¼šè¿”å› <code>304</code> çŠ¶æ€ç ï¼Œå¹¶ä¸”æ›´æ–°æµè§ˆå™¨ç¼“å­˜æœ‰æ•ˆæœŸã€‚</li></ul> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/10.png" alt="" class="medium-zoom-image"></p> <p><strong>Last-Modified å’Œ If-Modified-Since</strong></p> <blockquote><p><code>Last-Modified</code> è¡¨ç¤ºæœ¬åœ°æ–‡ä»¶æœ€åä¿®æ”¹æ—¥æœŸï¼Œ<code>If-Modified-Since</code> ä¼šå°† <code>Last-Modified</code> çš„å€¼å‘é€ç»™æœåŠ¡å™¨ï¼Œè¯¢é—®æœåŠ¡å™¨åœ¨è¯¥æ—¥æœŸåèµ„æºæ˜¯å¦æœ‰æ›´æ–°ï¼Œæœ‰æ›´æ–°çš„è¯å°±ä¼šå°†æ–°çš„èµ„æºå‘é€å›æ¥ï¼Œå¦åˆ™è¿”å› <code>304</code> çŠ¶æ€ç ã€‚</p></blockquote> <p>ä½†æ˜¯ <code>Last-Modified</code>å­˜åœ¨ä¸€äº›å¼Šç«¯ï¼š</p> <ul><li>å¦‚æœæœ¬åœ°æ‰“å¼€ç¼“å­˜æ–‡ä»¶ï¼Œå³ä½¿æ²¡æœ‰å¯¹æ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼Œä½†è¿˜æ˜¯ä¼šé€ æˆ <code>Last-Modified</code> è¢«ä¿®æ”¹ï¼ŒæœåŠ¡ç«¯ä¸èƒ½å‘½ä¸­ç¼“å­˜å¯¼è‡´å‘é€ç›¸åŒçš„èµ„æº</li> <li>å› ä¸º <code>Last-Modified</code> åªèƒ½ä»¥ç§’è®¡æ—¶ï¼Œå¦‚æœåœ¨ä¸å¯æ„ŸçŸ¥çš„æ—¶é—´å†…ä¿®æ”¹å®Œæˆæ–‡ä»¶ï¼Œé‚£ä¹ˆæœåŠ¡ç«¯ä¼šè®¤ä¸ºèµ„æºè¿˜æ˜¯å‘½ä¸­äº†ï¼Œä¸ä¼šè¿”å›æ­£ç¡®çš„èµ„æº
å› ä¸ºä»¥ä¸Šè¿™äº›å¼Šç«¯ï¼Œæ‰€ä»¥åœ¨ <code>HTTP / 1.1</code> å‡ºç°äº† <code>ETag</code></li></ul> <p><strong>ETag å’Œ If-None-Match</strong></p> <ul><li><code>ETag</code> ç±»ä¼¼äºæ–‡ä»¶æŒ‡çº¹ï¼Œ<code>If-None-Match</code> ä¼šå°†å½“å‰ <code>ETag</code> å‘é€ç»™æœåŠ¡å™¨ï¼Œè¯¢é—®è¯¥èµ„æº <code>ETag</code> æ˜¯å¦å˜åŠ¨ï¼Œæœ‰å˜åŠ¨çš„è¯å°±å°†æ–°çš„èµ„æºå‘é€å›æ¥ã€‚å¹¶ä¸” <code>ETag</code>ä¼˜å…ˆçº§æ¯” <code>Last-Modified</code> é«˜ã€‚</li></ul> <blockquote><p>ä»¥ä¸Šå°±æ˜¯ç¼“å­˜ç­–ç•¥çš„æ‰€æœ‰å†…å®¹äº†ï¼Œçœ‹åˆ°è¿™é‡Œï¼Œä¸çŸ¥é“ä½ æ˜¯å¦å­˜åœ¨è¿™æ ·ä¸€ä¸ªç–‘é—®ã€‚å¦‚æœä»€ä¹ˆç¼“å­˜ç­–ç•¥éƒ½æ²¡è®¾ç½®ï¼Œé‚£ä¹ˆæµè§ˆå™¨ä¼šæ€ä¹ˆå¤„ç†ï¼Ÿ</p></blockquote> <p>å¯¹äºè¿™ç§æƒ…å†µï¼Œæµè§ˆå™¨ä¼šé‡‡ç”¨ä¸€ä¸ªå¯å‘å¼çš„ç®—æ³•ï¼Œé€šå¸¸ä¼šå–å“åº”å¤´ä¸­çš„ <code>Date</code> å‡å» <code>Last-Modified</code> å€¼çš„ <code>10%</code> ä½œä¸ºç¼“å­˜æ—¶é—´ã€‚</p> <h3 id="_20-3-å®é™…åœºæ™¯åº”ç”¨ç¼“å­˜ç­–ç•¥"><a href="http://interview.poetries.top/docs/excellent.html#_20-3-%E5%AE%9E%E9%99%85%E5%9C%BA%E6%99%AF%E5%BA%94%E7%94%A8%E7%BC%93%E5%AD%98%E7%AD%96%E7%95%A5" class="header-anchor">#</a> 20.3 å®é™…åœºæ™¯åº”ç”¨ç¼“å­˜ç­–ç•¥</h3> <p><strong>é¢‘ç¹å˜åŠ¨çš„èµ„æº</strong></p> <blockquote><p>å¯¹äºé¢‘ç¹å˜åŠ¨çš„èµ„æºï¼Œé¦–å…ˆéœ€è¦ä½¿ç”¨ <code>Cache-Control: no-cache</code> ä½¿æµè§ˆå™¨æ¯æ¬¡éƒ½è¯·æ±‚æœåŠ¡å™¨ï¼Œç„¶åé…åˆ <code>ETag</code> æˆ–è€… <code>Last-Modified</code> æ¥éªŒè¯èµ„æºæ˜¯å¦æœ‰æ•ˆã€‚è¿™æ ·çš„åšæ³•è™½ç„¶ä¸èƒ½èŠ‚çœè¯·æ±‚æ•°é‡ï¼Œä½†æ˜¯èƒ½æ˜¾è‘—å‡å°‘å“åº”æ•°æ®å¤§å°ã€‚</p></blockquote> <p><strong>ä»£ç æ–‡ä»¶</strong></p> <blockquote><p>è¿™é‡Œç‰¹æŒ‡é™¤äº† <code>HTML</code> å¤–çš„ä»£ç æ–‡ä»¶ï¼Œå› ä¸º <code>HTML</code> æ–‡ä»¶ä¸€èˆ¬ä¸ç¼“å­˜æˆ–è€…ç¼“å­˜æ—¶é—´å¾ˆçŸ­ã€‚</p></blockquote> <p>ä¸€èˆ¬æ¥è¯´ï¼Œç°åœ¨éƒ½ä¼šä½¿ç”¨å·¥å…·æ¥æ‰“åŒ…ä»£ç ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å¯¹æ–‡ä»¶åè¿›è¡Œå“ˆå¸Œå¤„ç†ï¼Œåªæœ‰å½“ä»£ç ä¿®æ”¹åæ‰ä¼šç”Ÿæˆæ–°çš„æ–‡ä»¶åã€‚åŸºäºæ­¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç»™ä»£ç æ–‡ä»¶è®¾ç½®ç¼“å­˜æœ‰æ•ˆæœŸä¸€å¹´ <code>Cache-Control: max-age=31536000</code>ï¼Œè¿™æ ·åªæœ‰å½“ <code>HTML</code> æ–‡ä»¶ä¸­å¼•å…¥çš„æ–‡ä»¶åå‘ç”Ÿäº†æ”¹å˜æ‰ä¼šå»ä¸‹è½½æœ€æ–°çš„ä»£ç æ–‡ä»¶ï¼Œå¦åˆ™å°±ä¸€ç›´ä½¿ç”¨ç¼“å­˜</p> <blockquote><p>æ›´å¤šç¼“å­˜çŸ¥è¯†è¯¦è§£ http://blog.poetries.top/2019/01/02/browser-cache</p></blockquote> <h2 id="_21-æµè§ˆå™¨æ¸²æŸ“åŸç†"><a href="http://interview.poetries.top/docs/excellent.html#_21-%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E5%8E%9F%E7%90%86" class="header-anchor">#</a> 21 æµè§ˆå™¨æ¸²æŸ“åŸç†</h2> <blockquote><p>æ³¨æ„ï¼šè¯¥ç« èŠ‚éƒ½æ˜¯ä¸€ä¸ªé¢è¯•é¢˜ã€‚</p></blockquote> <h3 id="_21-1-æ¸²æŸ“è¿‡ç¨‹"><a href="http://interview.poetries.top/docs/excellent.html#_21-1-%E6%B8%B2%E6%9F%93%E8%BF%87%E7%A8%8B" class="header-anchor">#</a> 21.1 æ¸²æŸ“è¿‡ç¨‹</h3> <p><strong>1. æµè§ˆå™¨æ¥æ”¶åˆ° HTML æ–‡ä»¶å¹¶è½¬æ¢ä¸º DOM æ ‘</strong></p> <blockquote><p>å½“æˆ‘ä»¬æ‰“å¼€ä¸€ä¸ªç½‘é¡µæ—¶ï¼Œæµè§ˆå™¨éƒ½ä¼šå»è¯·æ±‚å¯¹åº”çš„ <code>HTML</code> æ–‡ä»¶ã€‚è™½ç„¶å¹³æ—¶æˆ‘ä»¬å†™ä»£ç æ—¶éƒ½ä¼šåˆ†ä¸º <code>JS</code>ã€<code>CSS</code>ã€<code>HTML</code> æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯å­—ç¬¦ä¸²ï¼Œä½†æ˜¯è®¡ç®—æœºç¡¬ä»¶æ˜¯ä¸ç†è§£è¿™äº›å­—ç¬¦ä¸²çš„ï¼Œæ‰€ä»¥åœ¨ç½‘ç»œä¸­ä¼ è¾“çš„å†…å®¹å…¶å®éƒ½æ˜¯ <code>0</code> å’Œ <code>1</code> è¿™äº›å­—èŠ‚æ•°æ®ã€‚å½“æµè§ˆå™¨æ¥æ”¶åˆ°è¿™äº›å­—èŠ‚æ•°æ®ä»¥åï¼Œå®ƒä¼šå°†è¿™äº›å­—èŠ‚æ•°æ®è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å†™çš„ä»£ç ã€‚</p></blockquote> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/11.png" alt="" class="medium-zoom-image"></p> <blockquote><p>å½“æ•°æ®è½¬æ¢ä¸ºå­—ç¬¦ä¸²ä»¥åï¼Œæµè§ˆå™¨ä¼šå…ˆå°†è¿™äº›å­—ç¬¦ä¸²é€šè¿‡è¯æ³•åˆ†æè½¬æ¢ä¸ºæ ‡è®°ï¼ˆ<code>token</code>ï¼‰ï¼Œè¿™ä¸€è¿‡ç¨‹åœ¨è¯æ³•åˆ†æä¸­å«åšæ ‡è®°åŒ–ï¼ˆ<code>tokenization</code>ï¼‰</p></blockquote> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/12.png" alt="" class="medium-zoom-image"></p> <blockquote><p>é‚£ä¹ˆä»€ä¹ˆæ˜¯æ ‡è®°å‘¢ï¼Ÿè¿™å…¶å®å±äºç¼–è¯‘åŸç†è¿™ä¸€å—çš„å†…å®¹äº†ã€‚ç®€å•æ¥è¯´ï¼Œæ ‡è®°è¿˜æ˜¯å­—ç¬¦ä¸²ï¼Œæ˜¯æ„æˆä»£ç çš„æœ€å°å•ä½ã€‚è¿™ä¸€è¿‡ç¨‹ä¼šå°†ä»£ç åˆ†æ‹†æˆä¸€å—å—ï¼Œå¹¶ç»™è¿™äº›å†…å®¹æ‰“ä¸Šæ ‡è®°ï¼Œä¾¿äºç†è§£è¿™äº›æœ€å°å•ä½çš„ä»£ç æ˜¯ä»€ä¹ˆæ„æ€</p></blockquote> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/13.png" alt="" class="medium-zoom-image"></p> <blockquote><p>å½“ç»“æŸæ ‡è®°åŒ–åï¼Œè¿™äº›æ ‡è®°ä¼šç´§æ¥ç€è½¬æ¢ä¸º <code>Node</code>ï¼Œæœ€åè¿™äº› <code>Node</code> ä¼šæ ¹æ®ä¸åŒ <code>Node</code> ä¹‹å‰çš„è”ç³»æ„å»ºä¸ºä¸€é¢— <code>DOM</code> æ ‘</p></blockquote> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/14.png" alt="" class="medium-zoom-image"></p> <blockquote><p>ä»¥ä¸Šå°±æ˜¯æµè§ˆå™¨ä»ç½‘ç»œä¸­æ¥æ”¶åˆ° <code>HTML</code> æ–‡ä»¶ç„¶åä¸€ç³»åˆ—çš„è½¬æ¢è¿‡ç¨‹</p></blockquote> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/15.png" alt="" class="medium-zoom-image"></p> <blockquote><p>å½“ç„¶ï¼Œåœ¨è§£æ <code>HTML</code> æ–‡ä»¶çš„æ—¶å€™ï¼Œæµè§ˆå™¨è¿˜ä¼šé‡åˆ° <code>CSS</code> å’Œ <code>JS</code> æ–‡ä»¶ï¼Œè¿™æ—¶å€™æµè§ˆå™¨ä¹Ÿä¼šå»ä¸‹è½½å¹¶è§£æè¿™äº›æ–‡ä»¶ï¼Œæ¥ä¸‹æ¥å°±è®©æˆ‘ä»¬å…ˆæ¥å­¦ä¹ æµè§ˆå™¨å¦‚ä½•è§£æ <code>CSS</code> æ–‡ä»¶</p></blockquote> <p><strong>2. å°† CSS æ–‡ä»¶è½¬æ¢ä¸º CSSOM æ ‘</strong></p> <blockquote><p>å…¶å®è½¬æ¢ <code>CSS</code> åˆ° <code>CSSOM</code> æ ‘çš„è¿‡ç¨‹å’Œä¸Šä¸€å°èŠ‚çš„è¿‡ç¨‹æ˜¯æå…¶ç±»ä¼¼çš„</p></blockquote> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/16.png" alt="" class="medium-zoom-image"></p> <ul><li>åœ¨è¿™ä¸€è¿‡ç¨‹ä¸­ï¼Œæµè§ˆå™¨ä¼šç¡®å®šä¸‹æ¯ä¸€ä¸ªèŠ‚ç‚¹çš„æ ·å¼åˆ°åº•æ˜¯ä»€ä¹ˆï¼Œå¹¶ä¸”è¿™ä¸€è¿‡ç¨‹å…¶å®æ˜¯å¾ˆæ¶ˆè€—èµ„æºçš„ã€‚å› ä¸ºæ ·å¼ä½ å¯ä»¥è‡ªè¡Œè®¾ç½®ç»™æŸä¸ªèŠ‚ç‚¹ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ç»§æ‰¿è·å¾—ã€‚åœ¨è¿™ä¸€è¿‡ç¨‹ä¸­ï¼Œæµè§ˆå™¨å¾—é€’å½’ <code>CSSOM</code> æ ‘ï¼Œç„¶åç¡®å®šå…·ä½“çš„å…ƒç´ åˆ°åº•æ˜¯ä»€ä¹ˆæ ·å¼ã€‚</li></ul> <p>å¦‚æœä½ æœ‰ç‚¹ä¸ç†è§£ä¸ºä»€ä¹ˆä¼šæ¶ˆè€—èµ„æºçš„è¯ï¼Œæˆ‘è¿™é‡Œä¸¾ä¸ªä¾‹å­</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
  <span class="token selector">span</span> <span class="token punctuation">{</span>
    <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector">div &gt; a &gt; span</span> <span class="token punctuation">{</span>
    <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><blockquote><p>å¯¹äºç¬¬ä¸€ç§è®¾ç½®æ ·å¼çš„æ–¹å¼æ¥è¯´ï¼Œæµè§ˆå™¨åªéœ€è¦æ‰¾åˆ°é¡µé¢ä¸­æ‰€æœ‰çš„ <code>span</code> æ ‡ç­¾ç„¶åè®¾ç½®é¢œè‰²ï¼Œä½†æ˜¯å¯¹äºç¬¬äºŒç§è®¾ç½®æ ·å¼çš„æ–¹å¼æ¥è¯´ï¼Œæµè§ˆå™¨é¦–å…ˆéœ€è¦æ‰¾åˆ°æ‰€æœ‰çš„ <code>span</code> æ ‡ç­¾ï¼Œç„¶åæ‰¾åˆ° <code>span</code> æ ‡ç­¾ä¸Šçš„ <code>a</code> æ ‡ç­¾ï¼Œæœ€åå†å»æ‰¾åˆ° <code>div</code> æ ‡ç­¾ï¼Œç„¶åç»™ç¬¦åˆè¿™ç§æ¡ä»¶çš„ <code>span</code> æ ‡ç­¾è®¾ç½®é¢œè‰²ï¼Œè¿™æ ·çš„é€’å½’è¿‡ç¨‹å°±å¾ˆå¤æ‚ã€‚æ‰€ä»¥æˆ‘ä»¬åº”è¯¥å°½å¯èƒ½çš„é¿å…å†™è¿‡äºå…·ä½“çš„ <code>CSS</code> é€‰æ‹©å™¨ï¼Œç„¶åå¯¹äº <code>HTML</code> æ¥è¯´ä¹Ÿå°½é‡å°‘çš„æ·»åŠ æ— æ„ä¹‰æ ‡ç­¾ï¼Œä¿è¯å±‚çº§æ‰å¹³</p></blockquote> <p><strong>3. ç”Ÿæˆæ¸²æŸ“æ ‘</strong></p> <blockquote><p>å½“æˆ‘ä»¬ç”Ÿæˆ <code>DOM</code> æ ‘å’Œ <code>CSSOM</code> æ ‘ä»¥åï¼Œå°±éœ€è¦å°†è¿™ä¸¤æ£µæ ‘ç»„åˆä¸ºæ¸²æŸ“æ ‘</p></blockquote> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/17.png" alt="" class="medium-zoom-image"></p> <ul><li>åœ¨è¿™ä¸€è¿‡ç¨‹ä¸­ï¼Œä¸æ˜¯ç®€å•çš„å°†ä¸¤è€…åˆå¹¶å°±è¡Œäº†ã€‚æ¸²æŸ“æ ‘åªä¼šåŒ…æ‹¬éœ€è¦æ˜¾ç¤ºçš„èŠ‚ç‚¹å’Œè¿™äº›èŠ‚ç‚¹çš„æ ·å¼ä¿¡æ¯ï¼Œå¦‚æœæŸä¸ªèŠ‚ç‚¹æ˜¯ <code>display: none</code> çš„ï¼Œé‚£ä¹ˆå°±ä¸ä¼šåœ¨æ¸²æŸ“æ ‘ä¸­æ˜¾ç¤ºã€‚</li> <li>å½“æµè§ˆå™¨ç”Ÿæˆæ¸²æŸ“æ ‘ä»¥åï¼Œå°±ä¼šæ ¹æ®æ¸²æŸ“æ ‘æ¥è¿›è¡Œå¸ƒå±€ï¼ˆä¹Ÿå¯ä»¥å«åšå›æµï¼‰ï¼Œç„¶åè°ƒç”¨ <code>GPU</code>ç»˜åˆ¶ï¼Œåˆæˆå›¾å±‚ï¼Œæ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚å¯¹äºè¿™ä¸€éƒ¨åˆ†çš„å†…å®¹å› ä¸ºè¿‡äºåº•å±‚ï¼Œè¿˜æ¶‰åŠåˆ°äº†ç¡¬ä»¶ç›¸å…³çš„çŸ¥è¯†ï¼Œè¿™é‡Œå°±ä¸å†ç»§ç»­å±•å¼€å†…å®¹äº†ã€‚</li></ul> <h3 id="_21-2-ä¸ºä»€ä¹ˆæ“ä½œ-dom-æ…¢"><a href="http://interview.poetries.top/docs/excellent.html#_21-2-%E4%B8%BA%E4%BB%80%E4%B9%88%E6%93%8D%E4%BD%9C-dom-%E6%85%A2" class="header-anchor">#</a> 21.2 ä¸ºä»€ä¹ˆæ“ä½œ DOM æ…¢</h3> <blockquote><p>æƒ³å¿…å¤§å®¶éƒ½å¬è¿‡æ“ä½œ DOM æ€§èƒ½å¾ˆå·®ï¼Œä½†æ˜¯è¿™å…¶ä¸­çš„åŸå› æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p></blockquote> <ul><li>å› ä¸º <code>DOM</code>æ˜¯å±äºæ¸²æŸ“å¼•æ“ä¸­çš„ä¸œè¥¿ï¼Œè€Œ <code>JS</code> åˆæ˜¯ <code>JS</code> å¼•æ“ä¸­çš„ä¸œè¥¿ã€‚å½“æˆ‘ä»¬é€šè¿‡ <code>JS</code> æ“ä½œ <code>DOM</code> çš„æ—¶å€™ï¼Œå…¶å®è¿™ä¸ªæ“ä½œæ¶‰åŠåˆ°äº†ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ï¼Œé‚£ä¹ˆåŠ¿å¿…ä¼šå¸¦æ¥ä¸€äº›æ€§èƒ½ä¸Šçš„æŸè€—ã€‚æ“ä½œ <code>DOM</code> æ¬¡æ•°ä¸€å¤šï¼Œä¹Ÿå°±ç­‰åŒäºä¸€ç›´åœ¨è¿›è¡Œçº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ï¼Œå¹¶ä¸”æ“ä½œ <code>DOM</code> å¯èƒ½è¿˜ä¼šå¸¦æ¥é‡ç»˜å›æµçš„æƒ…å†µï¼Œæ‰€ä»¥ä¹Ÿå°±å¯¼è‡´äº†æ€§èƒ½ä¸Šçš„é—®é¢˜ã€‚</li></ul> <blockquote><p>ç»å…¸é¢è¯•é¢˜ï¼šæ’å…¥å‡ ä¸‡ä¸ª DOMï¼Œå¦‚ä½•å®ç°é¡µé¢ä¸å¡é¡¿ï¼Ÿ</p></blockquote> <ul><li>å¯¹äºè¿™é“é¢˜ç›®æ¥è¯´ï¼Œé¦–å…ˆæˆ‘ä»¬è‚¯å®šä¸èƒ½ä¸€æ¬¡æ€§æŠŠå‡ ä¸‡ä¸ª <code>DOM</code> å…¨éƒ¨æ’å…¥ï¼Œè¿™æ ·è‚¯å®šä¼šé€ æˆå¡é¡¿ï¼Œæ‰€ä»¥è§£å†³é—®é¢˜çš„é‡ç‚¹åº”è¯¥æ˜¯å¦‚ä½•åˆ†æ‰¹æ¬¡éƒ¨åˆ†æ¸²æŸ“ <code>DOM</code>ã€‚å¤§éƒ¨åˆ†äººåº”è¯¥å¯ä»¥æƒ³åˆ°é€šè¿‡ <code>requestAnimationFrame</code> çš„æ–¹å¼å»å¾ªç¯çš„æ’å…¥ <code>DOM</code>ï¼Œå…¶å®è¿˜æœ‰ç§æ–¹å¼å»è§£å†³è¿™ä¸ªé—®é¢˜ï¼šè™šæ‹Ÿæ»šåŠ¨ï¼ˆ<code>virtualized scroller</code>ï¼‰ã€‚</li> <li>è¿™ç§æŠ€æœ¯çš„åŸç†å°±æ˜¯åªæ¸²æŸ“å¯è§†åŒºåŸŸå†…çš„å†…å®¹ï¼Œéå¯è§åŒºåŸŸçš„é‚£å°±å®Œå…¨ä¸æ¸²æŸ“äº†ï¼Œå½“ç”¨æˆ·åœ¨æ»šåŠ¨çš„æ—¶å€™å°±å®æ—¶å»æ›¿æ¢æ¸²æŸ“çš„å†…å®¹</li></ul> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/18.png" alt="" class="medium-zoom-image"></p> <blockquote><p>ä»ä¸Šå›¾ä¸­æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå³ä½¿åˆ—è¡¨å¾ˆé•¿ï¼Œä½†æ˜¯æ¸²æŸ“çš„ <code>DOM</code> å…ƒç´ æ°¸è¿œåªæœ‰é‚£ä¹ˆå‡ ä¸ªï¼Œå½“æˆ‘ä»¬æ»šåŠ¨é¡µé¢çš„æ—¶å€™å°±ä¼šå®æ—¶å»æ›´æ–° <code>DOM</code>ï¼Œè¿™ä¸ªæŠ€æœ¯å°±èƒ½é¡ºåˆ©è§£å†³è¿™é“ç»å…¸é¢è¯•é¢˜</p></blockquote> <h3 id="_21-3-ä»€ä¹ˆæƒ…å†µé˜»å¡æ¸²æŸ“"><a href="http://interview.poetries.top/docs/excellent.html#_21-3-%E4%BB%80%E4%B9%88%E6%83%85%E5%86%B5%E9%98%BB%E5%A1%9E%E6%B8%B2%E6%9F%93" class="header-anchor">#</a> 21.3 ä»€ä¹ˆæƒ…å†µé˜»å¡æ¸²æŸ“</h3> <ul><li>é¦–å…ˆæ¸²æŸ“çš„å‰ææ˜¯ç”Ÿæˆæ¸²æŸ“æ ‘ï¼Œæ‰€ä»¥ <code>HTML</code> å’Œ <code>CSS</code> è‚¯å®šä¼šé˜»å¡æ¸²æŸ“ã€‚å¦‚æœä½ æƒ³æ¸²æŸ“çš„è¶Šå¿«ï¼Œä½ è¶Šåº”è¯¥é™ä½ä¸€å¼€å§‹éœ€è¦æ¸²æŸ“çš„æ–‡ä»¶å¤§å°ï¼Œå¹¶ä¸”æ‰å¹³å±‚çº§ï¼Œä¼˜åŒ–é€‰æ‹©å™¨ã€‚</li> <li>ç„¶åå½“æµè§ˆå™¨åœ¨è§£æåˆ° <code>script</code> æ ‡ç­¾æ—¶ï¼Œä¼šæš‚åœæ„å»º <code>DOM</code>ï¼Œå®Œæˆåæ‰ä¼šä»æš‚åœçš„åœ°æ–¹é‡æ–°å¼€å§‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ æƒ³é¦–å±æ¸²æŸ“çš„è¶Šå¿«ï¼Œå°±è¶Šä¸åº”è¯¥åœ¨é¦–å±å°±åŠ è½½ <code>JS</code>æ–‡ä»¶ï¼Œè¿™ä¹Ÿæ˜¯éƒ½å»ºè®®å°† <code>script</code> æ ‡ç­¾æ”¾åœ¨ <code>body</code> æ ‡ç­¾åº•éƒ¨çš„åŸå› ã€‚</li> <li>å½“ç„¶åœ¨å½“ä¸‹ï¼Œå¹¶ä¸æ˜¯è¯´ <code>script</code> æ ‡ç­¾å¿…é¡»æ”¾åœ¨åº•éƒ¨ï¼Œå› ä¸ºä½ å¯ä»¥ç»™ <code>script</code> æ ‡ç­¾æ·»åŠ  <code>defer</code> æˆ–è€… <code>async</code> å±æ€§ã€‚</li> <li>å½“ <code>script</code> æ ‡ç­¾åŠ ä¸Š <code>defer</code> å±æ€§ä»¥åï¼Œè¡¨ç¤ºè¯¥ <code>JS</code> æ–‡ä»¶ä¼šå¹¶è¡Œä¸‹è½½ï¼Œä½†æ˜¯ä¼šæ”¾åˆ° <code>HTML</code> è§£æå®Œæˆåé¡ºåºæ‰§è¡Œï¼Œæ‰€ä»¥å¯¹äºè¿™ç§æƒ…å†µä½ å¯ä»¥æŠŠ <code>script</code>æ ‡ç­¾æ”¾åœ¨ä»»æ„ä½ç½®ã€‚</li> <li>å¯¹äºæ²¡æœ‰ä»»ä½•ä¾èµ–çš„ <code>JS</code> æ–‡ä»¶å¯ä»¥åŠ ä¸Š <code>async</code> å±æ€§ï¼Œè¡¨ç¤º <code>JS</code> æ–‡ä»¶ä¸‹è½½å’Œè§£æä¸ä¼šé˜»å¡æ¸²æŸ“ã€‚</li></ul> <h3 id="_21-4-é‡ç»˜-repaint-å’Œå›æµ-reflow"><a href="http://interview.poetries.top/docs/excellent.html#_21-4-%E9%87%8D%E7%BB%98-repaint-%E5%92%8C%E5%9B%9E%E6%B5%81-reflow" class="header-anchor">#</a> 21.4 é‡ç»˜ï¼ˆRepaintï¼‰å’Œå›æµï¼ˆReflowï¼‰</h3> <blockquote><p>é‡ç»˜å’Œå›æµä¼šåœ¨æˆ‘ä»¬è®¾ç½®èŠ‚ç‚¹æ ·å¼æ—¶é¢‘ç¹å‡ºç°ï¼ŒåŒæ—¶ä¹Ÿä¼šå¾ˆå¤§ç¨‹åº¦ä¸Šå½±å“æ€§èƒ½ã€‚</p></blockquote> <ul><li>é‡ç»˜æ˜¯å½“èŠ‚ç‚¹éœ€è¦æ›´æ”¹å¤–è§‚è€Œä¸ä¼šå½±å“å¸ƒå±€çš„ï¼Œæ¯”å¦‚æ”¹å˜ <code>color</code> å°±å«ç§°ä¸ºé‡ç»˜</li> <li>å›æµæ˜¯å¸ƒå±€æˆ–è€…å‡ ä½•å±æ€§éœ€è¦æ”¹å˜å°±ç§°ä¸ºå›æµã€‚</li> <li>å›æµå¿…å®šä¼šå‘ç”Ÿé‡ç»˜ï¼Œé‡ç»˜ä¸ä¸€å®šä¼šå¼•å‘å›æµã€‚å›æµæ‰€éœ€çš„æˆæœ¬æ¯”é‡ç»˜é«˜çš„å¤šï¼Œæ”¹å˜çˆ¶èŠ‚ç‚¹é‡Œçš„å­èŠ‚ç‚¹å¾ˆå¯èƒ½ä¼šå¯¼è‡´çˆ¶èŠ‚ç‚¹çš„ä¸€ç³»åˆ—å›æµã€‚</li></ul> <p><strong>ä»¥ä¸‹å‡ ä¸ªåŠ¨ä½œå¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜</strong>ï¼š</p> <ul><li>æ”¹å˜ <code>window</code> å¤§å°</li> <li>æ”¹å˜å­—ä½“</li> <li>æ·»åŠ æˆ–åˆ é™¤æ ·å¼</li> <li>æ–‡å­—æ”¹å˜</li> <li>å®šä½æˆ–è€…æµ®åŠ¨</li> <li>ç›’æ¨¡å‹</li></ul> <blockquote><p>å¹¶ä¸”å¾ˆå¤šäººä¸çŸ¥é“çš„æ˜¯ï¼Œé‡ç»˜å’Œå›æµå…¶å®ä¹Ÿå’Œ <code>Eventloop</code> æœ‰å…³ã€‚</p></blockquote> <ul><li>å½“ <code>Eventloop</code> æ‰§è¡Œå®Œ <code>Microtasks</code> åï¼Œä¼šåˆ¤æ–­ <code>document</code> æ˜¯å¦éœ€è¦æ›´æ–°ï¼Œå› ä¸ºæµè§ˆå™¨æ˜¯ <code>60Hz</code> çš„åˆ·æ–°ç‡ï¼Œæ¯ <code>16.6ms</code> æ‰ä¼šæ›´æ–°ä¸€æ¬¡ã€‚</li> <li>ç„¶ååˆ¤æ–­æ˜¯å¦æœ‰ <code>resize</code> æˆ–è€… <code>scroll</code> äº‹ä»¶ï¼Œæœ‰çš„è¯ä¼šå»è§¦å‘äº‹ä»¶ï¼Œæ‰€ä»¥ <code>resize</code> å’Œ <code>scroll</code> äº‹ä»¶ä¹Ÿæ˜¯è‡³å°‘ <code>16ms</code> æ‰ä¼šè§¦å‘ä¸€æ¬¡ï¼Œå¹¶ä¸”è‡ªå¸¦èŠ‚æµåŠŸèƒ½ã€‚</li> <li>åˆ¤æ–­æ˜¯å¦è§¦å‘äº† <code>media query</code></li> <li>æ›´æ–°åŠ¨ç”»å¹¶ä¸”å‘é€äº‹ä»¶</li> <li>åˆ¤æ–­æ˜¯å¦æœ‰å…¨å±æ“ä½œäº‹ä»¶</li> <li>æ‰§è¡Œ <code>requestAnimationFrame</code>å›è°ƒ</li> <li>æ‰§è¡Œ <code>IntersectionObserver</code> å›è°ƒï¼Œè¯¥æ–¹æ³•ç”¨äºåˆ¤æ–­å…ƒç´ æ˜¯å¦å¯è§ï¼Œå¯ä»¥ç”¨äºæ‡’åŠ è½½ä¸Šï¼Œä½†æ˜¯å…¼å®¹æ€§ä¸å¥½
æ›´æ–°ç•Œé¢</li> <li>ä»¥ä¸Šå°±æ˜¯ä¸€å¸§ä¸­å¯èƒ½ä¼šåšçš„äº‹æƒ…ã€‚å¦‚æœåœ¨ä¸€å¸§ä¸­æœ‰ç©ºé—²æ—¶é—´ï¼Œå°±ä¼šå»æ‰§è¡Œ <code>requestIdleCallback</code>å›è°ƒ</li></ul> <h3 id="_21-5-å‡å°‘é‡ç»˜å’Œå›æµ"><a href="http://interview.poetries.top/docs/excellent.html#_21-5-%E5%87%8F%E5%B0%91%E9%87%8D%E7%BB%98%E5%92%8C%E5%9B%9E%E6%B5%81" class="header-anchor">#</a> 21.5 å‡å°‘é‡ç»˜å’Œå›æµ</h3> <ol><li>ä½¿ç”¨ <code>transform</code> æ›¿ä»£ <code>top</code></li></ol> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>test<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
  <span class="token selector">.test</span> <span class="token punctuation">{</span>
    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
    <span class="token property">top</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
    <span class="token property">background</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¼•èµ·å›æµ</span>
    document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.test'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> <span class="token string">'100px'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><ol start="2"><li>ä½¿ç”¨ <code>visibility</code> æ›¿æ¢<code>display: none</code> ï¼Œå› ä¸ºå‰è€…åªä¼šå¼•èµ·é‡ç»˜ï¼Œåè€…ä¼šå¼•å‘å›æµï¼ˆæ”¹å˜äº†å¸ƒå±€ï¼‰</li> <li>ä¸è¦æŠŠèŠ‚ç‚¹çš„å±æ€§å€¼æ”¾åœ¨ä¸€ä¸ªå¾ªç¯é‡Œå½“æˆå¾ªç¯é‡Œçš„å˜é‡</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// è·å– offsetTop ä¼šå¯¼è‡´å›æµï¼Œå› ä¸ºéœ€è¦å»è·å–æ­£ç¡®çš„å€¼</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.test'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>offsetTop<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="4"><li>ä¸è¦ä½¿ç”¨ <code>table</code> å¸ƒå±€ï¼Œå¯èƒ½å¾ˆå°çš„ä¸€ä¸ªå°æ”¹åŠ¨ä¼šé€ æˆæ•´ä¸ª <code>table</code> çš„é‡æ–°å¸ƒå±€</li> <li>åŠ¨ç”»å®ç°çš„é€Ÿåº¦çš„é€‰æ‹©ï¼ŒåŠ¨ç”»é€Ÿåº¦è¶Šå¿«ï¼Œå›æµæ¬¡æ•°è¶Šå¤šï¼Œä¹Ÿå¯ä»¥é€‰æ‹©ä½¿ç”¨ <code>requestAnimationFrame</code></li> <li><code>CSS</code> é€‰æ‹©ç¬¦ä»å³å¾€å·¦åŒ¹é…æŸ¥æ‰¾ï¼Œé¿å…èŠ‚ç‚¹å±‚çº§è¿‡å¤š</li> <li>å°†é¢‘ç¹é‡ç»˜æˆ–è€…å›æµçš„èŠ‚ç‚¹è®¾ç½®ä¸ºå›¾å±‚ï¼Œå›¾å±‚èƒ½å¤Ÿé˜»æ­¢è¯¥èŠ‚ç‚¹çš„æ¸²æŸ“è¡Œä¸ºå½±å“åˆ«çš„èŠ‚ç‚¹ã€‚æ¯”å¦‚å¯¹äº <code>video</code> æ ‡ç­¾æ¥è¯´ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨å°†è¯¥èŠ‚ç‚¹å˜ä¸ºå›¾å±‚ã€‚</li></ol> <blockquote><p>è®¾ç½®èŠ‚ç‚¹ä¸ºå›¾å±‚çš„æ–¹å¼æœ‰å¾ˆå¤šï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ä¸ªå¸¸ç”¨å±æ€§å¯ä»¥ç”Ÿæˆæ–°å›¾å±‚</p></blockquote> <ul><li><code>will-change</code></li> <li><code>video</code>ã€<code>iframe</code> æ ‡ç­¾</li></ul> <h2 id="_22-å®‰å…¨é˜²èŒƒ"><a href="http://interview.poetries.top/docs/excellent.html#_22-%E5%AE%89%E5%85%A8%E9%98%B2%E8%8C%83" class="header-anchor">#</a> 22 å®‰å…¨é˜²èŒƒ</h2> <h3 id="_22-1-xss"><a href="http://interview.poetries.top/docs/excellent.html#_22-1-xss" class="header-anchor">#</a> 22.1 XSS</h3> <blockquote><p>æ¶‰åŠé¢è¯•é¢˜ï¼šä»€ä¹ˆæ˜¯ <code>XSS</code> æ”»å‡»ï¼Ÿå¦‚ä½•é˜²èŒƒ <code>XSS</code> æ”»å‡»ï¼Ÿä»€ä¹ˆæ˜¯ <code>CSP</code>ï¼Ÿ</p></blockquote> <ul><li><code>XSS</code> ç®€å•ç‚¹æ¥è¯´ï¼Œå°±æ˜¯æ”»å‡»è€…æƒ³å°½ä¸€åˆ‡åŠæ³•å°†å¯ä»¥æ‰§è¡Œçš„ä»£ç æ³¨å…¥åˆ°ç½‘é¡µä¸­ã€‚</li> <li><code>XSS</code> å¯ä»¥åˆ†ä¸ºå¤šç§ç±»å‹ï¼Œä½†æ˜¯æ€»ä½“ä¸Šæˆ‘è®¤ä¸ºåˆ†ä¸ºä¸¤ç±»ï¼šæŒä¹…å‹å’ŒéæŒä¹…å‹ã€‚</li> <li>æŒä¹…å‹ä¹Ÿå°±æ˜¯æ”»å‡»çš„ä»£ç è¢«æœåŠ¡ç«¯å†™å…¥è¿›æ•°æ®åº“ä¸­ï¼Œè¿™ç§æ”»å‡»å±å®³æ€§å¾ˆå¤§ï¼Œå› ä¸ºå¦‚æœç½‘ç«™è®¿é—®é‡å¾ˆå¤§çš„è¯ï¼Œå°±ä¼šå¯¼è‡´å¤§é‡æ­£å¸¸è®¿é—®é¡µé¢çš„ç”¨æˆ·éƒ½å—åˆ°æ”»å‡»ã€‚</li></ul> <blockquote><p>ä¸¾ä¸ªä¾‹å­ï¼Œå¯¹äºè¯„è®ºåŠŸèƒ½æ¥è¯´ï¼Œå°±å¾—é˜²èŒƒæŒä¹…å‹ <code>XSS</code> æ”»å‡»ï¼Œå› ä¸ºæˆ‘å¯ä»¥åœ¨è¯„è®ºä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹</p></blockquote> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/4(1).png" alt="image.png" class="medium-zoom-image"></p> <ul><li>è¿™ç§æƒ…å†µå¦‚æœå‰åç«¯æ²¡æœ‰åšå¥½é˜²å¾¡çš„è¯ï¼Œè¿™æ®µè¯„è®ºå°±ä¼šè¢«å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼Œè¿™æ ·æ¯ä¸ªæ‰“å¼€è¯¥é¡µé¢çš„ç”¨æˆ·éƒ½ä¼šè¢«æ”»å‡»åˆ°ã€‚</li> <li>éæŒä¹…å‹ç›¸æ¯”äºå‰è€…å±å®³å°±å°çš„å¤šäº†ï¼Œä¸€èˆ¬é€šè¿‡ä¿®æ”¹ <code>URL</code> å‚æ•°çš„æ–¹å¼åŠ å…¥æ”»å‡»ä»£ç ï¼Œè¯±å¯¼ç”¨æˆ·è®¿é—®é“¾æ¥ä»è€Œè¿›è¡Œæ”»å‡»ã€‚</li></ul> <blockquote><p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœé¡µé¢éœ€è¦ä» <code>URL</code> ä¸­è·å–æŸäº›å‚æ•°ä½œä¸ºå†…å®¹çš„è¯ï¼Œä¸ç»è¿‡è¿‡æ»¤å°±ä¼šå¯¼è‡´æ”»å‡»ä»£ç è¢«æ‰§è¡Œ</p></blockquote> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- http://www.domain.com?name=&lt;script&gt;alert(1)&lt;/script&gt; --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>{{name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>                                                  
</code></pre></div><blockquote><p>ä½†æ˜¯å¯¹äºè¿™ç§æ”»å‡»æ–¹å¼æ¥è¯´ï¼Œå¦‚æœç”¨æˆ·ä½¿ç”¨ <code>Chrome</code> è¿™ç±»æµè§ˆå™¨çš„è¯ï¼Œæµè§ˆå™¨å°±èƒ½è‡ªåŠ¨å¸®åŠ©ç”¨æˆ·é˜²å¾¡æ”»å‡»ã€‚ä½†æ˜¯æˆ‘ä»¬ä¸èƒ½å› æ­¤å°±ä¸é˜²å¾¡æ­¤ç±»æ”»å‡»äº†ï¼Œå› ä¸ºæˆ‘ä¸èƒ½ç¡®ä¿ç”¨æˆ·éƒ½ä½¿ç”¨äº†è¯¥ç±»æµè§ˆå™¨ã€‚</p></blockquote> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/19.png" alt="" class="medium-zoom-image"></p> <blockquote><p>å¯¹äº <code>XSS</code> æ”»å‡»æ¥è¯´ï¼Œé€šå¸¸æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥ç”¨æ¥é˜²å¾¡ã€‚</p></blockquote> <ol><li><strong>è½¬ä¹‰å­—ç¬¦</strong></li></ol> <blockquote><p>é¦–å…ˆï¼Œå¯¹äºç”¨æˆ·çš„è¾“å…¥åº”è¯¥æ˜¯æ°¸è¿œä¸ä¿¡ä»»çš„ã€‚æœ€æ™®éçš„åšæ³•å°±æ˜¯è½¬ä¹‰è¾“å…¥è¾“å‡ºçš„å†…å®¹ï¼Œå¯¹äºå¼•å·ã€å°–æ‹¬å·ã€æ–œæ è¿›è¡Œè½¬ä¹‰</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">escape</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&amp;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'&amp;amp;'</span><span class="token punctuation">)</span>
  str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&lt;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'&amp;lt;'</span><span class="token punctuation">)</span>
  str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&gt;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'&amp;gt;'</span><span class="token punctuation">)</span>
  str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">"</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'&amp;quto;'</span><span class="token punctuation">)</span>
  str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">'</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'&amp;#39;'</span><span class="token punctuation">)</span>
  str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">`</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'&amp;#96;'</span><span class="token punctuation">)</span>
  str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\/</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'&amp;#x2F;'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> str
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>é€šè¿‡è½¬ä¹‰å¯ä»¥å°†æ”»å‡»ä»£ç  <code>&lt;script&gt;alert(1)&lt;/script&gt;</code> å˜æˆ</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// -&gt; &amp;lt;script&amp;gt;alert(1)&amp;lt;&amp;#x2F;script&amp;gt;</span>
<span class="token function">escape</span><span class="token punctuation">(</span><span class="token string">'&lt;script&gt;alert(1)&lt;/script&gt;'</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>ä½†æ˜¯å¯¹äºæ˜¾ç¤ºå¯Œæ–‡æœ¬æ¥è¯´ï¼Œæ˜¾ç„¶ä¸èƒ½é€šè¿‡ä¸Šé¢çš„åŠæ³•æ¥è½¬ä¹‰æ‰€æœ‰å­—ç¬¦ï¼Œå› ä¸ºè¿™æ ·ä¼šæŠŠéœ€è¦çš„æ ¼å¼ä¹Ÿè¿‡æ»¤æ‰ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œé€šå¸¸é‡‡ç”¨ç™½åå•è¿‡æ»¤çš„åŠæ³•ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡é»‘åå•è¿‡æ»¤ï¼Œä½†æ˜¯è€ƒè™‘åˆ°éœ€è¦è¿‡æ»¤çš„æ ‡ç­¾å’Œæ ‡ç­¾å±æ€§å®åœ¨å¤ªå¤šï¼Œæ›´åŠ æ¨èä½¿ç”¨ç™½åå•çš„æ–¹å¼</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> xss <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'xss'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> html <span class="token operator">=</span> <span class="token function">xss</span><span class="token punctuation">(</span><span class="token string">'&lt;h1 id="title"&gt;XSS Demo&lt;/h1&gt;&lt;script&gt;alert("xss");&lt;/script&gt;'</span><span class="token punctuation">)</span>
<span class="token comment">// -&gt; &lt;h1&gt;XSS Demo&lt;/h1&gt;&amp;lt;script&amp;gt;alert("xss");&amp;lt;/script&amp;gt;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span>
</code></pre></div><blockquote><p>ä»¥ä¸Šç¤ºä¾‹ä½¿ç”¨äº† <code>js-xss</code> æ¥å®ç°ï¼Œå¯ä»¥çœ‹åˆ°åœ¨è¾“å‡ºä¸­ä¿ç•™äº† <code>h1</code> æ ‡ç­¾ä¸”è¿‡æ»¤äº† <code>script</code>æ ‡ç­¾</p></blockquote> <ol start="2"><li><strong>CSP</strong></li></ol> <blockquote><p><code>CSP</code> æœ¬è´¨ä¸Šå°±æ˜¯å»ºç«‹ç™½åå•ï¼Œå¼€å‘è€…æ˜ç¡®å‘Šè¯‰æµè§ˆå™¨å“ªäº›å¤–éƒ¨èµ„æºå¯ä»¥åŠ è½½å’Œæ‰§è¡Œã€‚æˆ‘ä»¬åªéœ€è¦é…ç½®è§„åˆ™ï¼Œå¦‚ä½•æ‹¦æˆªæ˜¯ç”±æµè§ˆå™¨è‡ªå·±å®ç°çš„ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æ¥å°½é‡å‡å°‘ <code>XSS</code> æ”»å‡»ã€‚</p></blockquote> <p><strong>é€šå¸¸å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼æ¥å¼€å¯ CSP</strong>ï¼š</p> <ul><li>è®¾ç½® <code>HTTP Header</code> ä¸­çš„ <code>Content-Security-Policy</code></li> <li>è®¾ç½® <code>meta</code> æ ‡ç­¾çš„æ–¹å¼ <code>&lt;meta http-equiv="Content-Security-Policy"&gt;</code></li></ul> <p>è¿™é‡Œä»¥è®¾ç½® <code>HTTP Header</code> æ¥ä¸¾ä¾‹</p> <p><strong>åªå…è®¸åŠ è½½æœ¬ç«™èµ„æº</strong></p> <div class="language- extra-class"><pre class="language-text"><code>Content-Security-Policy: default-src â€˜selfâ€™
</code></pre></div><p><strong>åªå…è®¸åŠ è½½ HTTPS åè®®å›¾ç‰‡</strong></p> <div class="language- extra-class"><pre class="language-text"><code>Content-Security-Policy: img-src https://*
</code></pre></div><p><strong>å…è®¸åŠ è½½ä»»ä½•æ¥æºæ¡†æ¶</strong></p> <div class="language- extra-class"><pre class="language-text"><code>Content-Security-Policy: child-src 'none'
</code></pre></div><blockquote><p>å½“ç„¶å¯ä»¥è®¾ç½®çš„å±æ€§è¿œä¸æ­¢è¿™äº›ï¼Œä½ å¯ä»¥é€šè¿‡æŸ¥é˜… <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy" target="_blank" rel="noopener noreferrer">æ–‡æ¡£<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> çš„æ–¹å¼æ¥å­¦ä¹ ï¼Œè¿™é‡Œå°±ä¸è¿‡å¤šèµ˜è¿°å…¶ä»–çš„å±æ€§äº†ã€‚</p></blockquote> <blockquote><p>å¯¹äºè¿™ç§æ–¹å¼æ¥è¯´ï¼Œåªè¦å¼€å‘è€…é…ç½®äº†æ­£ç¡®çš„è§„åˆ™ï¼Œé‚£ä¹ˆå³ä½¿ç½‘ç«™å­˜åœ¨æ¼æ´ï¼Œæ”»å‡»è€…ä¹Ÿä¸èƒ½æ‰§è¡Œå®ƒçš„æ”»å‡»ä»£ç ï¼Œå¹¶ä¸” <code>CSP</code> çš„å…¼å®¹æ€§ä¹Ÿä¸é”™ã€‚</p></blockquote> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/20.png" alt="" class="medium-zoom-image"></p> <h3 id="_22-2-csrf"><a href="http://interview.poetries.top/docs/excellent.html#_22-2-csrf" class="header-anchor">#</a> 22.2 CSRF</h3> <blockquote><p>æ¶‰åŠé¢è¯•é¢˜ï¼šä»€ä¹ˆæ˜¯ <code>CSRF</code> æ”»å‡»ï¼Ÿå¦‚ä½•é˜²èŒƒ <code>CSRF</code> æ”»å‡»ï¼Ÿ</p></blockquote> <blockquote><p><code>CSRF</code> ä¸­æ–‡åä¸ºè·¨ç«™è¯·æ±‚ä¼ªé€ ã€‚åŸç†å°±æ˜¯æ”»å‡»è€…æ„é€ å‡ºä¸€ä¸ªåç«¯è¯·æ±‚åœ°å€ï¼Œè¯±å¯¼ç”¨æˆ·ç‚¹å‡»æˆ–è€…é€šè¿‡æŸäº›é€”å¾„è‡ªåŠ¨å‘èµ·è¯·æ±‚ã€‚å¦‚æœç”¨æˆ·æ˜¯åœ¨ç™»å½•çŠ¶æ€ä¸‹çš„è¯ï¼Œåç«¯å°±ä»¥ä¸ºæ˜¯ç”¨æˆ·åœ¨æ“ä½œï¼Œä»è€Œè¿›è¡Œç›¸åº”çš„é€»è¾‘ã€‚</p></blockquote> <p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ç½‘ç«™ä¸­æœ‰ä¸€ä¸ªé€šè¿‡ <code>GET</code> è¯·æ±‚æäº¤ç”¨æˆ·è¯„è®ºçš„æ¥å£ï¼Œé‚£ä¹ˆæ”»å‡»è€…å°±å¯ä»¥åœ¨é’“é±¼ç½‘ç«™ä¸­åŠ å…¥ä¸€ä¸ªå›¾ç‰‡ï¼Œå›¾ç‰‡çš„åœ°å€å°±æ˜¯è¯„è®ºæ¥å£</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.domain.com/xxx?comment=<span class="token punctuation">'</span>attack<span class="token punctuation">'</span><span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre></div><blockquote><p>é‚£ä¹ˆä½ æ˜¯å¦ä¼šæƒ³åˆ°ä½¿ç”¨ <code>POST</code> æ–¹å¼æäº¤è¯·æ±‚æ˜¯ä¸æ˜¯å°±æ²¡æœ‰è¿™ä¸ªé—®é¢˜äº†å‘¢ï¼Ÿå…¶å®å¹¶ä¸æ˜¯ï¼Œä½¿ç”¨è¿™ç§æ–¹å¼ä¹Ÿä¸æ˜¯ç™¾åˆ†ç™¾å®‰å…¨çš„ï¼Œæ”»å‡»è€…åŒæ ·å¯ä»¥è¯±å¯¼ç”¨æˆ·è¿›å…¥æŸä¸ªé¡µé¢ï¼Œåœ¨é¡µé¢ä¸­é€šè¿‡è¡¨å•æäº¤ <code>POST</code> è¯·æ±‚ã€‚</p></blockquote> <p><strong>å¦‚ä½•é˜²å¾¡</strong></p> <ul><li><code>Get</code> è¯·æ±‚ä¸å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹</li> <li>ä¸è®©ç¬¬ä¸‰æ–¹ç½‘ç«™è®¿é—®åˆ°ç”¨æˆ· <code>Cookie</code></li> <li>é˜»æ­¢ç¬¬ä¸‰æ–¹ç½‘ç«™è¯·æ±‚æ¥å£</li> <li>è¯·æ±‚æ—¶é™„å¸¦éªŒè¯ä¿¡æ¯ï¼Œæ¯”å¦‚éªŒè¯ç æˆ–è€… <code>Token</code></li></ul> <p><strong>SameSite</strong></p> <blockquote><p>å¯ä»¥å¯¹ <code>Cookie</code> è®¾ç½® <code>SameSite</code> å±æ€§ã€‚è¯¥å±æ€§è¡¨ç¤º <code>Cookie</code> ä¸éšç€è·¨åŸŸè¯·æ±‚å‘é€ï¼Œå¯ä»¥å¾ˆå¤§ç¨‹åº¦å‡å°‘ <code>CSRF</code> çš„æ”»å‡»ï¼Œä½†æ˜¯è¯¥å±æ€§ç›®å‰å¹¶ä¸æ˜¯æ‰€æœ‰æµè§ˆå™¨éƒ½å…¼å®¹ã€‚</p></blockquote> <p><strong>éªŒè¯ Referer</strong></p> <blockquote><p>å¯¹äºéœ€è¦é˜²èŒƒ <code>CSRF</code> çš„è¯·æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡éªŒè¯ <code>Referer</code> æ¥åˆ¤æ–­è¯¥è¯·æ±‚æ˜¯å¦ä¸ºç¬¬ä¸‰æ–¹ç½‘ç«™å‘èµ·çš„ã€‚</p></blockquote> <p><strong>Token</strong></p> <blockquote><p>æœåŠ¡å™¨ä¸‹å‘ä¸€ä¸ªéšæœº <code>Token</code>ï¼Œæ¯æ¬¡å‘èµ·è¯·æ±‚æ—¶å°† <code>Token</code> æºå¸¦ä¸Šï¼ŒæœåŠ¡å™¨éªŒè¯ <code>Token</code> æ˜¯å¦æœ‰æ•ˆ</p></blockquote> <h3 id="_22-3-ç‚¹å‡»åŠ«æŒ"><a href="http://interview.poetries.top/docs/excellent.html#_22-3-%E7%82%B9%E5%87%BB%E5%8A%AB%E6%8C%81" class="header-anchor">#</a> 22.3 ç‚¹å‡»åŠ«æŒ</h3> <blockquote><p>æ¶‰åŠé¢è¯•é¢˜ï¼šä»€ä¹ˆæ˜¯ç‚¹å‡»åŠ«æŒï¼Ÿå¦‚ä½•é˜²èŒƒç‚¹å‡»åŠ«æŒï¼Ÿ</p></blockquote> <blockquote><p>ç‚¹å‡»åŠ«æŒæ˜¯ä¸€ç§è§†è§‰æ¬ºéª—çš„æ”»å‡»æ‰‹æ®µã€‚æ”»å‡»è€…å°†éœ€è¦æ”»å‡»çš„ç½‘ç«™é€šè¿‡ <code>iframe</code> åµŒå¥—çš„æ–¹å¼åµŒå…¥è‡ªå·±çš„ç½‘é¡µä¸­ï¼Œå¹¶å°† <code>iframe</code> è®¾ç½®ä¸ºé€æ˜ï¼Œåœ¨é¡µé¢ä¸­é€å‡ºä¸€ä¸ªæŒ‰é’®è¯±å¯¼ç”¨æˆ·ç‚¹å‡»</p></blockquote> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/5(1).png" alt="image.png" class="medium-zoom-image"></p> <blockquote><p>å¯¹äºè¿™ç§æ”»å‡»æ–¹å¼ï¼Œæ¨èé˜²å¾¡çš„æ–¹æ³•æœ‰ä¸¤ç§</p></blockquote> <p><strong>1. X-FRAME-OPTIONS</strong></p> <blockquote><p><code>X-FRAME-OPTIONS</code> æ˜¯ä¸€ä¸ª <code>HTTP</code> å“åº”å¤´ï¼Œåœ¨ç°ä»£æµè§ˆå™¨æœ‰ä¸€ä¸ªå¾ˆå¥½çš„æ”¯æŒã€‚è¿™ä¸ª HTTP å“åº”å¤´ å°±æ˜¯ä¸ºäº†é˜²å¾¡ç”¨<code>iframe</code> åµŒå¥—çš„ç‚¹å‡»åŠ«æŒæ”»å‡»ã€‚</p></blockquote> <blockquote><p>è¯¥å“åº”å¤´æœ‰ä¸‰ä¸ªå€¼å¯é€‰ï¼Œåˆ†åˆ«æ˜¯</p></blockquote> <ul><li><code>DENY</code>ï¼Œè¡¨ç¤ºé¡µé¢ä¸å…è®¸é€šè¿‡ <code>iframe</code> çš„æ–¹å¼å±•ç¤º</li> <li><code>SAMEORIGIN</code>ï¼Œè¡¨ç¤ºé¡µé¢å¯ä»¥åœ¨ç›¸åŒåŸŸåä¸‹é€šè¿‡ <code>iframe</code> çš„æ–¹å¼å±•ç¤º</li> <li><code>ALLOW-FROM</code>ï¼Œè¡¨ç¤ºé¡µé¢å¯ä»¥åœ¨æŒ‡å®šæ¥æºçš„ <code>iframe</code> ä¸­å±•ç¤º</li></ul> <p><strong>2. JS é˜²å¾¡</strong></p> <blockquote><p>å¯¹äºæŸäº›è¿œå¤æµè§ˆå™¨æ¥è¯´ï¼Œå¹¶ä¸èƒ½æ”¯æŒä¸Šé¢çš„è¿™ç§æ–¹å¼ï¼Œé‚£æˆ‘ä»¬åªæœ‰é€šè¿‡ JS çš„æ–¹å¼æ¥é˜²å¾¡ç‚¹å‡»åŠ«æŒäº†ã€‚</p></blockquote> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>click-jack<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
    <span class="token selector">html</span> <span class="token punctuation">{</span>
      <span class="token property">display</span><span class="token punctuation">:</span> none <span class="token important">!important</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">if</span> <span class="token punctuation">(</span>self <span class="token operator">==</span> top<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> style <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'click-jack'</span><span class="token punctuation">)</span>
      document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>style<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      top<span class="token punctuation">.</span>location <span class="token operator">=</span> self<span class="token punctuation">.</span>location
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><blockquote><p>ä»¥ä¸Šä»£ç çš„ä½œç”¨å°±æ˜¯å½“é€šè¿‡ <code>iframe</code> çš„æ–¹å¼åŠ è½½é¡µé¢æ—¶ï¼Œæ”»å‡»è€…çš„ç½‘é¡µç›´æ¥ä¸æ˜¾ç¤ºæ‰€æœ‰å†…å®¹äº†</p></blockquote> <h2 id="_23-ä»-v8-ä¸­çœ‹-js-æ€§èƒ½ä¼˜åŒ–"><a href="http://interview.poetries.top/docs/excellent.html#_23-%E4%BB%8E-v8-%E4%B8%AD%E7%9C%8B-js-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96" class="header-anchor">#</a> 23 ä» V8 ä¸­çœ‹ JS æ€§èƒ½ä¼˜åŒ–</h2> <blockquote><p>æ³¨æ„ï¼šè¯¥çŸ¥è¯†ç‚¹å±äºæ€§èƒ½ä¼˜åŒ–é¢†åŸŸã€‚</p></blockquote> <h3 id="_23-1-æµ‹è¯•æ€§èƒ½å·¥å…·"><a href="http://interview.poetries.top/docs/excellent.html#_23-1-%E6%B5%8B%E8%AF%95%E6%80%A7%E8%83%BD%E5%B7%A5%E5%85%B7" class="header-anchor">#</a> 23.1 æµ‹è¯•æ€§èƒ½å·¥å…·</h3> <blockquote><p><code>Chrome</code> å·²ç»æä¾›äº†ä¸€ä¸ªå¤§è€Œå…¨çš„æ€§èƒ½æµ‹è¯•å·¥å…· <code>Audits</code></p></blockquote> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/21.png" alt="" class="medium-zoom-image"></p> <blockquote><p>ç‚¹æˆ‘ä»¬ç‚¹å‡» <code>Audits</code> åï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„ç•Œé¢</p></blockquote> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/22.png" alt="" class="medium-zoom-image"></p> <blockquote><p>åœ¨è¿™ä¸ªç•Œé¢ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©æƒ³æµ‹è¯•çš„åŠŸèƒ½ç„¶åç‚¹å‡» <code>Run audits</code> ï¼Œå·¥å…·å°±ä¼šè‡ªåŠ¨è¿è¡Œå¸®åŠ©æˆ‘ä»¬æµ‹è¯•é—®é¢˜å¹¶ä¸”ç»™å‡ºä¸€ä¸ªå®Œæ•´çš„æŠ¥å‘Š</p></blockquote> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/23.png" alt="" class="medium-zoom-image"></p> <blockquote><p>ä¸Šå›¾æ˜¯ç»™æ˜é‡‘é¦–é¡µæµ‹è¯•æ€§èƒ½åç»™å‡ºçš„ä¸€ä¸ªæŠ¥å‘Šï¼Œå¯ä»¥çœ‹åˆ°æŠ¥å‘Šä¸­åˆ†åˆ«ä¸ºæ€§èƒ½ã€ä½“éªŒã€SEO éƒ½ç»™å‡ºäº†æ‰“åˆ†ï¼Œå¹¶ä¸”æ¯ä¸€ä¸ªæŒ‡æ ‡éƒ½æœ‰è¯¦ç»†çš„è¯„ä¼°</p></blockquote> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/24.png" alt="" class="medium-zoom-image"></p> <p>è¯„ä¼°ç»“æŸåï¼Œå·¥å…·è¿˜æä¾›äº†ä¸€äº›å»ºè®®ä¾¿äºæˆ‘ä»¬æé«˜è¿™ä¸ªæŒ‡æ ‡çš„åˆ†æ•°</p> <p>æˆ‘ä»¬åªéœ€è¦ä¸€æ¡æ¡æ ¹æ®å»ºè®®å»ä¼˜åŒ–æ€§èƒ½å³å¯ã€‚</p> <blockquote><p>é™¤äº† <code>Audits</code> å·¥å…·ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ª <code>Performance</code>å·¥å…·ä¹Ÿå¯ä»¥ä¾›æˆ‘ä»¬ä½¿ç”¨ã€‚</p></blockquote> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/25.png" alt="" class="medium-zoom-image"></p> <blockquote><p>åœ¨è¿™å¼ å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è¯¦ç»†çš„çœ‹åˆ°æ¯ä¸ªæ—¶é—´æ®µä¸­æµè§ˆå™¨åœ¨å¤„ç†ä»€ä¹ˆäº‹æƒ…ï¼Œå“ªä¸ªè¿‡ç¨‹æœ€æ¶ˆè€—æ—¶é—´ï¼Œä¾¿äºæˆ‘ä»¬æ›´åŠ è¯¦ç»†çš„äº†è§£æ€§èƒ½ç“¶é¢ˆ</p></blockquote> <h3 id="_23-2-js-æ€§èƒ½ä¼˜åŒ–"><a href="http://interview.poetries.top/docs/excellent.html#_23-2-js-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96" class="header-anchor">#</a> 23.2 JS æ€§èƒ½ä¼˜åŒ–</h3> <blockquote><p><code>JS</code> æ˜¯ç¼–è¯‘å‹è¿˜æ˜¯è§£é‡Šå‹è¯­è¨€å…¶å®å¹¶ä¸å›ºå®šã€‚é¦–å…ˆ <code>JS</code> éœ€è¦æœ‰å¼•æ“æ‰èƒ½è¿è¡Œèµ·æ¥ï¼Œæ— è®ºæ˜¯æµè§ˆå™¨è¿˜æ˜¯åœ¨ <code>Node</code> ä¸­ï¼Œè¿™æ˜¯è§£é‡Šå‹è¯­è¨€çš„ç‰¹æ€§ã€‚ä½†æ˜¯åœ¨ V8 å¼•æ“ä¸‹ï¼Œåˆå¼•å…¥äº† <code>TurboFan</code> ç¼–è¯‘å™¨ï¼Œä»–ä¼šåœ¨ç‰¹å®šçš„æƒ…å†µä¸‹è¿›è¡Œä¼˜åŒ–ï¼Œå°†ä»£ç ç¼–è¯‘æˆæ‰§è¡Œæ•ˆç‡æ›´é«˜çš„ <code>Machine Code</code>ï¼Œå½“ç„¶è¿™ä¸ªç¼–è¯‘å™¨å¹¶ä¸æ˜¯ <code>JS</code> å¿…é¡»éœ€è¦çš„ï¼Œåªæ˜¯ä¸ºäº†æé«˜ä»£ç æ‰§è¡Œæ€§èƒ½ï¼Œæ‰€ä»¥æ€»çš„æ¥è¯´ <code>JS</code> æ›´åå‘äºè§£é‡Šå‹è¯­è¨€ã€‚</p></blockquote> <p>é‚£ä¹ˆè¿™ä¸€å°èŠ‚çš„å†…å®¹ä¸»è¦ä¼šé’ˆå¯¹äº <code>Chrome</code> çš„ <code>V8</code> å¼•æ“æ¥è®²è§£ã€‚</p> <blockquote><p>åœ¨è¿™ä¸€è¿‡ç¨‹ä¸­ï¼Œ<code>JS</code> ä»£ç é¦–å…ˆä¼šè§£æä¸ºæŠ½è±¡è¯­æ³•æ ‘ï¼ˆ<code>AST</code>ï¼‰ï¼Œç„¶åä¼šé€šè¿‡è§£é‡Šå™¨æˆ–è€…ç¼–è¯‘å™¨è½¬åŒ–ä¸º <code>Bytecode</code> æˆ–è€…<code>Machine Code</code></p></blockquote> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/26.png" alt="" class="medium-zoom-image"></p> <blockquote><p>ä»ä¸Šå›¾ä¸­æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œ<code>JS</code> ä¼šé¦–å…ˆè¢«è§£æä¸º <code>AST</code>ï¼Œè§£æçš„è¿‡ç¨‹å…¶å®æ˜¯ç•¥æ…¢çš„ã€‚ä»£ç è¶Šå¤šï¼Œè§£æçš„è¿‡ç¨‹ä¹Ÿå°±è€—è´¹è¶Šé•¿ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬éœ€è¦å‹ç¼©ä»£ç çš„åŸå› ä¹‹ä¸€ã€‚å¦å¤–ä¸€ç§å‡å°‘è§£ææ—¶é—´çš„æ–¹å¼æ˜¯é¢„è§£æï¼Œä¼šä½œç”¨äºæœªæ‰§è¡Œçš„å‡½æ•°ï¼Œè¿™ä¸ªæˆ‘ä»¬ä¸‹é¢å†è°ˆ</p></blockquote> <p>è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œå¯¹äºå‡½æ•°æ¥è¯´ï¼Œåº”è¯¥å°½å¯èƒ½é¿å…å£°æ˜åµŒå¥—å‡½æ•°ï¼ˆç±»ä¹Ÿæ˜¯å‡½æ•°ï¼‰ï¼Œå› ä¸ºè¿™æ ·ä¼šé€ æˆå‡½æ•°çš„é‡å¤è§£æ</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ä¼šè¢«é‡å¤è§£æ</span>
  <span class="token keyword">function</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>ç„¶å <code>Ignition</code> è´Ÿè´£å°† <code>AST</code> è½¬åŒ–ä¸º <code>Bytecode</code>ï¼Œ<code>TurboFan</code> è´Ÿè´£ç¼–è¯‘å‡ºä¼˜åŒ–åçš„ <code>Machine Code</code>ï¼Œå¹¶ä¸” <code>Machine Code</code> åœ¨æ‰§è¡Œæ•ˆç‡ä¸Šä¼˜äº <code>Bytecode</code></p></blockquote> <blockquote><p>é‚£ä¹ˆæˆ‘ä»¬å°±äº§ç”Ÿäº†ä¸€ä¸ªç–‘é—®ï¼Œä»€ä¹ˆæƒ…å†µä¸‹ä»£ç ä¼šç¼–è¯‘ä¸º <code>Machine Code</code>ï¼Ÿ</p></blockquote> <blockquote><p><code>JS</code> æ˜¯ä¸€é—¨åŠ¨æ€ç±»å‹çš„è¯­è¨€ï¼Œå¹¶ä¸”è¿˜æœ‰ä¸€å¤§å †çš„è§„åˆ™ã€‚ç®€å•çš„åŠ æ³•è¿ç®—ä»£ç ï¼Œå†…éƒ¨å°±éœ€è¦è€ƒè™‘å¥½å‡ ç§è§„åˆ™ï¼Œæ¯”å¦‚æ•°å­—ç›¸åŠ ã€å­—ç¬¦ä¸²ç›¸åŠ ã€å¯¹è±¡å’Œå­—ç¬¦ä¸²ç›¸åŠ ç­‰ç­‰ã€‚è¿™æ ·çš„æƒ…å†µä¹Ÿå°±åŠ¿å¿…å¯¼è‡´äº†å†…éƒ¨è¦å¢åŠ å¾ˆå¤šåˆ¤æ–­é€»è¾‘ï¼Œé™ä½è¿è¡Œæ•ˆç‡ã€‚</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> x <span class="token operator">+</span> x
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>å¯¹äºä»¥ä¸Šä»£ç æ¥è¯´ï¼Œå¦‚æœä¸€ä¸ªå‡½æ•°è¢«å¤šæ¬¡è°ƒç”¨å¹¶ä¸”å‚æ•°ä¸€ç›´ä¼ å…¥ <code>number</code> ç±»å‹ï¼Œé‚£ä¹ˆ <code>V8</code> å°±ä¼šè®¤ä¸ºè¯¥æ®µä»£ç å¯ä»¥ç¼–è¯‘ä¸º <code>Machine Code</code>ï¼Œå› ä¸ºä½ å›ºå®šäº†ç±»å‹ï¼Œä¸éœ€è¦å†æ‰§è¡Œå¾ˆå¤šåˆ¤æ–­é€»è¾‘äº†ã€‚</li> <li>ä½†æ˜¯å¦‚æœä¸€æ—¦æˆ‘ä»¬ä¼ å…¥çš„å‚æ•°ç±»å‹æ”¹å˜ï¼Œé‚£ä¹ˆ <code>Machine Code</code> å°±ä¼šè¢« <code>DeOptimized</code>ä¸º <code>Bytecode</code>ï¼Œè¿™æ ·å°±æœ‰æ€§èƒ½ä¸Šçš„ä¸€ä¸ªæŸè€—äº†ã€‚æ‰€ä»¥å¦‚æœæˆ‘ä»¬å¸Œæœ›ä»£ç èƒ½å¤šçš„ç¼–è¯‘ä¸º <code>Machine Code</code> å¹¶ä¸” <code>DeOptimized</code>çš„æ¬¡æ•°å‡å°‘ï¼Œå°±åº”è¯¥å°½å¯èƒ½ä¿è¯ä¼ å…¥çš„ç±»å‹ä¸€è‡´ã€‚</li> <li>é‚£ä¹ˆä½ å¯èƒ½ä¼šæœ‰ä¸€ä¸ªç–‘é—®ï¼Œåˆ°åº•ä¼˜åŒ–å‰åæœ‰å¤šå°‘çš„æå‡å‘¢ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥å®è·µæµ‹è¯•ä¸€ä¸‹åˆ°åº•æœ‰å¤šå°‘çš„æå‡</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> performance<span class="token punctuation">,</span> PerformanceObserver <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'perf_hooks'</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> x <span class="token operator">+</span> x
<span class="token punctuation">}</span>
<span class="token comment">// node 10 ä¸­æ‰æœ‰ PerformanceObserver</span>
<span class="token comment">// åœ¨è¿™ä¹‹å‰çš„ node ç‰ˆæœ¬å¯ä»¥ç›´æ¥ä½¿ç”¨ performance ä¸­çš„ API</span>
<span class="token keyword">const</span> obs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PerformanceObserver</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">list<span class="token punctuation">,</span> observer</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">getEntries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  observer<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
obs<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token punctuation">{</span> entryTypes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'measure'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> buffered<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

performance<span class="token punctuation">.</span><span class="token function">mark</span><span class="token punctuation">(</span><span class="token string">'start'</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> number <span class="token operator">=</span> <span class="token number">10000000</span>
<span class="token comment">// ä¸ä¼˜åŒ–ä»£ç </span>
<span class="token operator">%</span><span class="token function">NeverOptimizeFunction</span><span class="token punctuation">(</span>test<span class="token punctuation">)</span>

<span class="token keyword">while</span> <span class="token punctuation">(</span>number<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

performance<span class="token punctuation">.</span><span class="token function">mark</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">)</span>
performance<span class="token punctuation">.</span><span class="token function">measure</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token string">'start'</span><span class="token punctuation">,</span> <span class="token string">'end'</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>ä»¥ä¸Šä»£ç ä¸­æˆ‘ä»¬ä½¿ç”¨äº† <code>performance API</code>ï¼Œè¿™ä¸ª <code>API</code> åœ¨æ€§èƒ½æµ‹è¯•ä¸Šååˆ†å¥½ç”¨ã€‚ä¸ä»…å¯ä»¥ç”¨æ¥æµ‹é‡ä»£ç çš„æ‰§è¡Œæ—¶é—´ï¼Œè¿˜èƒ½ç”¨æ¥æµ‹é‡å„ç§ç½‘ç»œè¿æ¥ä¸­çš„æ—¶é—´æ¶ˆè€—ç­‰ç­‰ï¼Œå¹¶ä¸”è¿™ä¸ª API ä¹Ÿå¯ä»¥åœ¨æµè§ˆå™¨ä¸­ä½¿</p></blockquote> <blockquote><p>ä»ä¸Šå›¾ä¸­æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œä¼˜åŒ–è¿‡çš„ä»£ç æ‰§è¡Œæ—¶é—´åªéœ€è¦ <code>9ms</code>ï¼Œä½†æ˜¯ä¸ä¼˜åŒ–è¿‡çš„ä»£ç æ‰§è¡Œæ—¶é—´å´æ˜¯å‰è€…çš„äºŒåå€ï¼Œå·²ç»æ¥è¿‘ <code>200ms</code> äº†ã€‚åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œæˆ‘ç›¸ä¿¡å¤§å®¶å·²ç»çœ‹åˆ°äº† <code>V8</code> çš„æ€§èƒ½ä¼˜åŒ–åˆ°åº•æœ‰å¤šå¼ºï¼Œåªéœ€è¦æˆ‘ä»¬ç¬¦åˆä¸€å®šçš„è§„åˆ™ä¹¦å†™ä»£ç ï¼Œå¼•æ“åº•å±‚å°±èƒ½å¸®åŠ©æˆ‘ä»¬è‡ªåŠ¨ä¼˜åŒ–ä»£ç ã€‚</p></blockquote> <blockquote><p>å¦å¤–ï¼Œç¼–è¯‘å™¨è¿˜æœ‰ä¸ªéªšæ“ä½œ <code>Lazy-Compile</code>ï¼Œå½“å‡½æ•°æ²¡æœ‰è¢«æ‰§è¡Œçš„æ—¶å€™ï¼Œä¼šå¯¹å‡½æ•°è¿›è¡Œä¸€æ¬¡é¢„è§£æï¼Œç›´åˆ°ä»£ç è¢«æ‰§è¡Œä»¥åæ‰ä¼šè¢«è§£æç¼–è¯‘ã€‚å¯¹äºä¸Šè¿°ä»£ç æ¥è¯´ï¼Œ<code>test</code> å‡½æ•°éœ€è¦è¢«é¢„è§£æä¸€æ¬¡ï¼Œç„¶ååœ¨è°ƒç”¨çš„æ—¶å€™å†è¢«è§£æç¼–è¯‘ã€‚ä½†æ˜¯å¯¹äºè¿™ç§å‡½æ•°é©¬ä¸Šå°±è¢«è°ƒç”¨çš„æƒ…å†µæ¥è¯´ï¼Œé¢„è§£æè¿™ä¸ªè¿‡ç¨‹å…¶å®æ˜¯å¤šä½™çš„ï¼Œé‚£ä¹ˆæœ‰ä»€ä¹ˆåŠæ³•èƒ½å¤Ÿè®©ä»£ç ä¸è¢«é¢„è§£æå‘¢ï¼Ÿ</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> x <span class="token operator">+</span> x
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>ä½†æ˜¯ä¸å¯èƒ½æˆ‘ä»¬ä¸ºäº†æ€§èƒ½ä¼˜åŒ–ï¼Œç»™æ‰€æœ‰çš„å‡½æ•°éƒ½å»å¥—ä¸Šæ‹¬å·ï¼Œå¹¶ä¸”ä¹Ÿä¸æ˜¯æ‰€æœ‰å‡½æ•°éƒ½éœ€è¦è¿™æ ·åšã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>optimize-js</code> å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œè¿™ä¸ªåº“ä¼šåˆ†æä¸€äº›å‡½æ•°çš„ä½¿ç”¨æƒ…å†µï¼Œç„¶åç»™éœ€è¦çš„å‡½æ•°æ·»åŠ æ‹¬å·ï¼Œå½“ç„¶è¿™ä¸ªåº“å¾ˆä¹…æ²¡äººç»´æŠ¤äº†ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨çš„è¯ï¼Œè¿˜æ˜¯éœ€è¦æµ‹è¯•è¿‡ç›¸å…³å†…å®¹çš„ã€‚</p></blockquote> <p>å…¶å®å¾ˆç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦ç»™å‡½æ•°å¥—ä¸Šæ‹¬å·å°±å¯ä»¥äº†</p> <h2 id="_24-æ€§èƒ½ä¼˜åŒ–"><a href="http://interview.poetries.top/docs/excellent.html#_24-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96" class="header-anchor">#</a> 24 æ€§èƒ½ä¼˜åŒ–</h2> <blockquote><p>æ€»çš„æ¥è¯´æ€§èƒ½ä¼˜åŒ–è¿™ä¸ªé¢†åŸŸçš„å¾ˆå¤šå†…å®¹éƒ½å¾ˆç¢ç‰‡åŒ–ï¼Œè¿™ä¸€ç« èŠ‚æˆ‘ä»¬å°†æ¥å­¦ä¹ è¿™äº›ç¢ç‰‡åŒ–çš„å†…å®¹ã€‚</p></blockquote> <h3 id="_24-1-å›¾ç‰‡ä¼˜åŒ–"><a href="http://interview.poetries.top/docs/excellent.html#_24-1-%E5%9B%BE%E7%89%87%E4%BC%98%E5%8C%96" class="header-anchor">#</a> 24.1 å›¾ç‰‡ä¼˜åŒ–</h3> <p><strong>è®¡ç®—å›¾ç‰‡å¤§å°</strong></p> <blockquote><p>å¯¹äºä¸€å¼  <code>100 * 100</code> åƒç´ çš„å›¾ç‰‡æ¥è¯´ï¼Œå›¾åƒä¸Šæœ‰ <code>10000</code> ä¸ªåƒç´ ç‚¹ï¼Œå¦‚æœæ¯ä¸ªåƒç´ çš„å€¼æ˜¯ <code>RGBA</code> å­˜å‚¨çš„è¯ï¼Œé‚£ä¹ˆä¹Ÿå°±æ˜¯è¯´æ¯ä¸ªåƒç´ æœ‰ <code>4</code> ä¸ªé€šé“ï¼Œæ¯ä¸ªé€šé“ <code>1</code> ä¸ªå­—èŠ‚ï¼ˆ<code>8</code> ä½ = <code>1</code>ä¸ªå­—èŠ‚ï¼‰ï¼Œæ‰€ä»¥è¯¥å›¾ç‰‡å¤§å°å¤§æ¦‚ä¸º <code>39KB</code>ï¼ˆ<code>10000 * 1 * 4 / 1024</code>ï¼‰ã€‚</p></blockquote> <ul><li>ä½†æ˜¯åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œä¸€å¼ å›¾ç‰‡å¯èƒ½å¹¶ä¸éœ€è¦ä½¿ç”¨é‚£ä¹ˆå¤šé¢œè‰²å»æ˜¾ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å‡å°‘æ¯ä¸ªåƒç´ çš„è°ƒè‰²æ¿æ¥ç›¸åº”ç¼©å°å›¾ç‰‡çš„å¤§å°ã€‚</li> <li>äº†è§£äº†å¦‚ä½•è®¡ç®—å›¾ç‰‡å¤§å°çš„çŸ¥è¯†ï¼Œé‚£ä¹ˆå¯¹äºå¦‚ä½•ä¼˜åŒ–å›¾ç‰‡ï¼Œæƒ³å¿…å¤§å®¶å·²ç»æœ‰ 2 ä¸ªæ€è·¯äº†ï¼š</li></ul> <ol><li>å‡å°‘åƒç´ ç‚¹</li> <li>å‡å°‘æ¯ä¸ªåƒç´ ç‚¹èƒ½å¤Ÿæ˜¾ç¤ºçš„é¢œè‰²</li></ol> <h3 id="_24-2-å›¾ç‰‡åŠ è½½ä¼˜åŒ–"><a href="http://interview.poetries.top/docs/excellent.html#_24-2-%E5%9B%BE%E7%89%87%E5%8A%A0%E8%BD%BD%E4%BC%98%E5%8C%96" class="header-anchor">#</a> 24.2 å›¾ç‰‡åŠ è½½ä¼˜åŒ–</h3> <ul><li>ä¸ç”¨å›¾ç‰‡ã€‚å¾ˆå¤šæ—¶å€™ä¼šä½¿ç”¨åˆ°å¾ˆå¤šä¿®é¥°ç±»å›¾ç‰‡ï¼Œå…¶å®è¿™ç±»ä¿®é¥°å›¾ç‰‡å®Œå…¨å¯ä»¥ç”¨ <code>CSS</code> å»ä»£æ›¿ã€‚</li> <li>å¯¹äºç§»åŠ¨ç«¯æ¥è¯´ï¼Œå±å¹•å®½åº¦å°±é‚£ä¹ˆç‚¹ï¼Œå®Œå…¨æ²¡æœ‰å¿…è¦å»åŠ è½½åŸå›¾æµªè´¹å¸¦å®½ã€‚ä¸€èˆ¬å›¾ç‰‡éƒ½ç”¨ <code>CDN</code> åŠ è½½ï¼Œå¯ä»¥è®¡ç®—å‡ºé€‚é…å±å¹•çš„å®½åº¦ï¼Œç„¶åå»è¯·æ±‚ç›¸åº”è£å‰ªå¥½çš„å›¾ç‰‡ã€‚</li> <li>å°å›¾ä½¿ç”¨ <code>base64</code> æ ¼å¼</li> <li>å°†å¤šä¸ªå›¾æ ‡æ–‡ä»¶æ•´åˆåˆ°ä¸€å¼ å›¾ç‰‡ä¸­ï¼ˆé›ªç¢§å›¾ï¼‰</li> <li>é€‰æ‹©æ­£ç¡®çš„å›¾ç‰‡æ ¼å¼ï¼š
<ul><li>å¯¹äºèƒ½å¤Ÿæ˜¾ç¤º <code>WebP</code>æ ¼å¼çš„æµè§ˆå™¨å°½é‡ä½¿ç”¨ <code>WebP</code> æ ¼å¼ã€‚å› ä¸º <code>WebP</code> æ ¼å¼å…·æœ‰æ›´å¥½çš„å›¾åƒæ•°æ®å‹ç¼©ç®—æ³•ï¼Œèƒ½å¸¦æ¥æ›´å°çš„å›¾ç‰‡ä½“ç§¯ï¼Œè€Œä¸”æ‹¥æœ‰è‚‰çœ¼è¯†åˆ«æ— å·®å¼‚çš„å›¾åƒè´¨é‡ï¼Œç¼ºç‚¹å°±æ˜¯å…¼å®¹æ€§å¹¶ä¸å¥½</li> <li>å°å›¾ä½¿ç”¨ <code>PNG</code>ï¼Œå…¶å®å¯¹äºå¤§éƒ¨åˆ†å›¾æ ‡è¿™ç±»å›¾ç‰‡ï¼Œå®Œå…¨å¯ä»¥ä½¿ç”¨ <code>SVG</code>ä»£æ›¿</li> <li>ç…§ç‰‡ä½¿ç”¨ <code>JPEG</code></li></ul></li></ul> <h3 id="_24-3-dns-é¢„è§£æ"><a href="http://interview.poetries.top/docs/excellent.html#_24-3-dns-%E9%A2%84%E8%A7%A3%E6%9E%90" class="header-anchor">#</a> 24.3 DNS é¢„è§£æ</h3> <blockquote><p><code>DNS</code> è§£æä¹Ÿæ˜¯éœ€è¦æ—¶é—´çš„ï¼Œå¯ä»¥é€šè¿‡é¢„è§£æçš„æ–¹å¼æ¥é¢„å…ˆè·å¾—åŸŸåæ‰€å¯¹åº”çš„ <code>IP</code>ã€‚</p></blockquote> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dns-prefetch<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>//blog.poetries.top<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_24-4-èŠ‚æµ"><a href="http://interview.poetries.top/docs/excellent.html#_24-4-%E8%8A%82%E6%B5%81" class="header-anchor">#</a> 24.4 èŠ‚æµ</h3> <blockquote><p>è€ƒè™‘ä¸€ä¸ªåœºæ™¯ï¼Œæ»šåŠ¨äº‹ä»¶ä¸­ä¼šå‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶ä¸å¸Œæœ›ç”¨æˆ·åœ¨æ»šåŠ¨è¿‡ç¨‹ä¸­ä¸€ç›´å‘èµ·è¯·æ±‚ï¼Œè€Œæ˜¯éš”ä¸€æ®µæ—¶é—´å‘èµ·ä¸€æ¬¡ï¼Œå¯¹äºè¿™ç§æƒ…å†µæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨èŠ‚æµã€‚</p></blockquote> <p>ç†è§£äº†èŠ‚æµçš„ç”¨é€”ï¼Œæˆ‘ä»¬å°±æ¥å®ç°ä¸‹è¿™ä¸ªå‡½æ•°</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// funcæ˜¯ç”¨æˆ·ä¼ å…¥éœ€è¦é˜²æŠ–çš„å‡½æ•°</span>
<span class="token comment">// waitæ˜¯ç­‰å¾…æ—¶é—´</span>
<span class="token keyword">const</span> <span class="token function-variable function">throttle</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">func<span class="token punctuation">,</span> wait <span class="token operator">=</span> <span class="token number">50</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ä¸Šä¸€æ¬¡æ‰§è¡Œè¯¥å‡½æ•°çš„æ—¶é—´</span>
  <span class="token keyword">let</span> lastTime <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å½“å‰æ—¶é—´</span>
    <span class="token keyword">let</span> now <span class="token operator">=</span> <span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// å°†å½“å‰æ—¶é—´å’Œä¸Šä¸€æ¬¡æ‰§è¡Œå‡½æ•°æ—¶é—´å¯¹æ¯”</span>
    <span class="token comment">// å¦‚æœå·®å€¼å¤§äºè®¾ç½®çš„ç­‰å¾…æ—¶é—´å°±æ‰§è¡Œå‡½æ•°</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>now <span class="token operator">-</span> lastTime <span class="token operator">&gt;</span> wait<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      lastTime <span class="token operator">=</span> now
      <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">setInterval</span><span class="token punctuation">(</span>
  <span class="token function">throttle</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token number">1</span>
<span class="token punctuation">)</span>

</code></pre></div><h3 id="_24-5-é˜²æŠ–"><a href="http://interview.poetries.top/docs/excellent.html#_24-5-%E9%98%B2%E6%8A%96" class="header-anchor">#</a> 24.5 é˜²æŠ–</h3> <blockquote><p>è€ƒè™‘ä¸€ä¸ªåœºæ™¯ï¼Œæœ‰ä¸€ä¸ªæŒ‰é’®ç‚¹å‡»ä¼šè§¦å‘ç½‘ç»œè¯·æ±‚ï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶ä¸å¸Œæœ›æ¯æ¬¡ç‚¹å‡»éƒ½å‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œè€Œæ˜¯å½“ç”¨æˆ·ç‚¹å‡»æŒ‰é’®ä¸€æ®µæ—¶é—´åæ²¡æœ‰å†æ¬¡ç‚¹å‡»çš„æƒ…å†µæ‰å»å‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œå¯¹äºè¿™ç§æƒ…å†µæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨é˜²æŠ–ã€‚</p></blockquote> <p>ç†è§£äº†é˜²æŠ–çš„ç”¨é€”ï¼Œæˆ‘ä»¬å°±æ¥å®ç°ä¸‹è¿™ä¸ªå‡½æ•°</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// funcæ˜¯ç”¨æˆ·ä¼ å…¥éœ€è¦é˜²æŠ–çš„å‡½æ•°</span>
<span class="token comment">// waitæ˜¯ç­‰å¾…æ—¶é—´</span>
<span class="token keyword">const</span> <span class="token function-variable function">debounce</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">func<span class="token punctuation">,</span> wait <span class="token operator">=</span> <span class="token number">50</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ç¼“å­˜ä¸€ä¸ªå®šæ—¶å™¨id</span>
  <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token comment">// è¿™é‡Œè¿”å›çš„å‡½æ•°æ˜¯æ¯æ¬¡ç”¨æˆ·å®é™…è°ƒç”¨çš„é˜²æŠ–å‡½æ•°</span>
  <span class="token comment">// å¦‚æœå·²ç»è®¾å®šè¿‡å®šæ—¶å™¨äº†å°±æ¸…ç©ºä¸Šä¸€æ¬¡çš„å®šæ—¶å™¨</span>
  <span class="token comment">// å¼€å§‹ä¸€ä¸ªæ–°çš„å®šæ—¶å™¨ï¼Œå»¶è¿Ÿæ‰§è¡Œç”¨æˆ·ä¼ å…¥çš„æ–¹æ³•</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>timer<span class="token punctuation">)</span> <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span>
    timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> wait<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_24-6-é¢„åŠ è½½"><a href="http://interview.poetries.top/docs/excellent.html#_24-6-%E9%A2%84%E5%8A%A0%E8%BD%BD" class="header-anchor">#</a> 24.6 é¢„åŠ è½½</h3> <ul><li>åœ¨å¼€å‘ä¸­ï¼Œå¯èƒ½ä¼šé‡åˆ°è¿™æ ·çš„æƒ…å†µã€‚æœ‰äº›èµ„æºä¸éœ€è¦é©¬ä¸Šç”¨åˆ°ï¼Œä½†æ˜¯å¸Œæœ›å°½æ—©è·å–ï¼Œè¿™æ—¶å€™å°±å¯ä»¥ä½¿ç”¨é¢„åŠ è½½ã€‚</li> <li>é¢„åŠ è½½å…¶å®æ˜¯å£°æ˜å¼çš„ <code>fetch</code> ï¼Œå¼ºåˆ¶æµè§ˆå™¨è¯·æ±‚èµ„æºï¼Œå¹¶ä¸”ä¸ä¼šé˜»å¡ <code>onload</code> äº‹ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç å¼€å¯é¢„åŠ è½½</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>preload<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://blog.poetries.top<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><blockquote><p>é¢„åŠ è½½å¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šé™ä½é¦–å±çš„åŠ è½½æ—¶é—´ï¼Œå› ä¸ºå¯ä»¥å°†ä¸€äº›ä¸å½±å“é¦–å±ä½†é‡è¦çš„æ–‡ä»¶å»¶ååŠ è½½ï¼Œå”¯ä¸€ç¼ºç‚¹å°±æ˜¯å…¼å®¹æ€§ä¸å¥½ã€‚</p></blockquote> <h3 id="_24-7-é¢„æ¸²æŸ“"><a href="http://interview.poetries.top/docs/excellent.html#_24-7-%E9%A2%84%E6%B8%B2%E6%9F%93" class="header-anchor">#</a> 24.7 é¢„æ¸²æŸ“</h3> <blockquote><p>å¯ä»¥é€šè¿‡é¢„æ¸²æŸ“å°†ä¸‹è½½çš„æ–‡ä»¶é¢„å…ˆåœ¨åå°æ¸²æŸ“ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç å¼€å¯é¢„æ¸²æŸ“</p></blockquote> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>prerender<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://blog.poetries.top<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><blockquote><p>é¢„æ¸²æŸ“è™½ç„¶å¯ä»¥æé«˜é¡µé¢çš„åŠ è½½é€Ÿåº¦ï¼Œä½†æ˜¯è¦ç¡®ä¿è¯¥é¡µé¢å¤§æ¦‚ç‡ä¼šè¢«ç”¨æˆ·åœ¨ä¹‹åæ‰“å¼€ï¼Œå¦åˆ™å°±æ˜¯ç™½ç™½æµªè´¹èµ„æºå»æ¸²æŸ“ã€‚</p></blockquote> <h3 id="_24-8-æ‡’æ‰§è¡Œ"><a href="http://interview.poetries.top/docs/excellent.html#_24-8-%E6%87%92%E6%89%A7%E8%A1%8C" class="header-anchor">#</a> 24.8 æ‡’æ‰§è¡Œ</h3> <blockquote><p>æ‡’æ‰§è¡Œå°±æ˜¯å°†æŸäº›é€»è¾‘å»¶è¿Ÿåˆ°ä½¿ç”¨æ—¶å†è®¡ç®—ã€‚è¯¥æŠ€æœ¯å¯ä»¥ç”¨äºé¦–å±ä¼˜åŒ–ï¼Œå¯¹äºæŸäº›è€—æ—¶é€»è¾‘å¹¶ä¸éœ€è¦åœ¨é¦–å±å°±ä½¿ç”¨çš„ï¼Œå°±å¯ä»¥ä½¿ç”¨æ‡’æ‰§è¡Œã€‚æ‡’æ‰§è¡Œéœ€è¦å”¤é†’ï¼Œä¸€èˆ¬å¯ä»¥é€šè¿‡å®šæ—¶å™¨æˆ–è€…äº‹ä»¶çš„è°ƒç”¨æ¥å”¤é†’ã€‚</p></blockquote> <h3 id="_24-9-æ‡’åŠ è½½"><a href="http://interview.poetries.top/docs/excellent.html#_24-9-%E6%87%92%E5%8A%A0%E8%BD%BD" class="header-anchor">#</a> 24.9 æ‡’åŠ è½½</h3> <ul><li>æ‡’åŠ è½½å°±æ˜¯å°†ä¸å…³é”®çš„èµ„æºå»¶ååŠ è½½ã€‚</li> <li>æ‡’åŠ è½½çš„åŸç†å°±æ˜¯åªåŠ è½½è‡ªå®šä¹‰åŒºåŸŸï¼ˆé€šå¸¸æ˜¯å¯è§†åŒºåŸŸï¼Œä½†ä¹Ÿå¯ä»¥æ˜¯å³å°†è¿›å…¥å¯è§†åŒºåŸŸï¼‰å†…éœ€è¦åŠ è½½çš„ä¸œè¥¿ã€‚å¯¹äºå›¾ç‰‡æ¥è¯´ï¼Œå…ˆè®¾ç½®å›¾ç‰‡æ ‡ç­¾çš„ <code>src</code> å±æ€§ä¸ºä¸€å¼ å ä½å›¾ï¼Œå°†çœŸå®çš„å›¾ç‰‡èµ„æºæ”¾å…¥ä¸€ä¸ªè‡ªå®šä¹‰å±æ€§ä¸­ï¼Œå½“è¿›å…¥è‡ªå®šä¹‰åŒºåŸŸæ—¶ï¼Œå°±å°†è‡ªå®šä¹‰å±æ€§æ›¿æ¢ä¸º <code>src</code> å±æ€§ï¼Œè¿™æ ·å›¾ç‰‡å°±ä¼šå»ä¸‹è½½èµ„æºï¼Œå®ç°äº†å›¾ç‰‡æ‡’åŠ è½½ã€‚</li> <li>æ‡’åŠ è½½ä¸ä»…å¯ä»¥ç”¨äºå›¾ç‰‡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åœ¨åˆ«çš„èµ„æºä¸Šã€‚æ¯”å¦‚è¿›å…¥å¯è§†åŒºåŸŸæ‰å¼€å§‹æ’­æ”¾è§†é¢‘ç­‰ç­‰ã€‚</li></ul> <h3 id="_24-10-cdn"><a href="http://interview.poetries.top/docs/excellent.html#_24-10-cdn" class="header-anchor">#</a> 24.10 CDN</h3> <blockquote><p><code>CDN</code>çš„åŸç†æ˜¯å°½å¯èƒ½çš„åœ¨å„ä¸ªåœ°æ–¹åˆ†å¸ƒæœºæˆ¿ç¼“å­˜æ•°æ®ï¼Œè¿™æ ·å³ä½¿æˆ‘ä»¬çš„æ ¹æœåŠ¡å™¨è¿œåœ¨å›½å¤–ï¼Œåœ¨å›½å†…çš„ç”¨æˆ·ä¹Ÿå¯ä»¥é€šè¿‡å›½å†…çš„æœºæˆ¿è¿…é€ŸåŠ è½½èµ„æºã€‚</p></blockquote> <blockquote><p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å°†é™æ€èµ„æºå°½é‡ä½¿ç”¨ <code>CDN</code> åŠ è½½ï¼Œç”±äºæµè§ˆå™¨å¯¹äºå•ä¸ªåŸŸåæœ‰å¹¶å‘è¯·æ±‚ä¸Šé™ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å¤šä¸ª <code>CDN</code> åŸŸåã€‚å¹¶ä¸”å¯¹äº <code>CDN</code> åŠ è½½é™æ€èµ„æºéœ€è¦æ³¨æ„ <code>CDN</code>  åŸŸåè¦ä¸ä¸»ç«™ä¸åŒï¼Œå¦åˆ™æ¯æ¬¡è¯·æ±‚éƒ½ä¼šå¸¦ä¸Šä¸»ç«™çš„ <code>Cookie</code>ï¼Œå¹³ç™½æ¶ˆè€—æµé‡</p></blockquote> <h2 id="_25-webpack-æ€§èƒ½ä¼˜åŒ–"><a href="http://interview.poetries.top/docs/excellent.html#_25-webpack-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96" class="header-anchor">#</a> 25 Webpack æ€§èƒ½ä¼˜åŒ–</h2> <blockquote><p>åœ¨è¿™éƒ¨åˆ†çš„å†…å®¹ä¸­ï¼Œæˆ‘ä»¬ä¼šèšç„¦äºä»¥ä¸‹ä¸¤ä¸ªçŸ¥è¯†ç‚¹ï¼Œå¹¶ä¸”æ¯ä¸€ä¸ªçŸ¥è¯†ç‚¹éƒ½å±äºé«˜é¢‘è€ƒç‚¹ï¼š</p></blockquote> <ul><li>æœ‰å“ªäº›æ–¹å¼å¯ä»¥å‡å°‘ <code>Webpack</code> çš„æ‰“åŒ…æ—¶é—´</li> <li>æœ‰å“ªäº›æ–¹å¼å¯ä»¥è®© <code>Webpack</code> æ‰“å‡ºæ¥çš„åŒ…æ›´å°</li></ul> <h3 id="_25-1-å‡å°‘-webpack-æ‰“åŒ…æ—¶é—´"><a href="http://interview.poetries.top/docs/excellent.html#_25-1-%E5%87%8F%E5%B0%91-webpack-%E6%89%93%E5%8C%85%E6%97%B6%E9%97%B4" class="header-anchor">#</a> 25.1 å‡å°‘ Webpack æ‰“åŒ…æ—¶é—´</h3> <p><strong>1. ä¼˜åŒ– Loader</strong></p> <blockquote><p>å¯¹äº <code>Loader</code> æ¥è¯´ï¼Œå½±å“æ‰“åŒ…æ•ˆç‡é¦–å½“å…¶å†²å¿…å± <code>Babel</code> äº†ã€‚å› ä¸º <code>Babel</code> ä¼šå°†ä»£ç è½¬ä¸ºå­—ç¬¦ä¸²ç”Ÿæˆ <code>AST</code>ï¼Œç„¶åå¯¹ <code>AST</code> ç»§ç»­è¿›è¡Œè½¬å˜æœ€åå†ç”Ÿæˆæ–°çš„ä»£ç ï¼Œé¡¹ç›®è¶Šå¤§ï¼Œè½¬æ¢ä»£ç è¶Šå¤šï¼Œæ•ˆç‡å°±è¶Šä½ã€‚å½“ç„¶äº†ï¼Œæˆ‘ä»¬æ˜¯æœ‰åŠæ³•ä¼˜åŒ–çš„</p></blockquote> <blockquote><p>é¦–å…ˆæˆ‘ä»¬å¯ä»¥ä¼˜åŒ– <code>Loader</code> çš„æ–‡ä»¶æœç´¢èŒƒå›´</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token comment">// js æ–‡ä»¶æ‰ä½¿ç”¨ babel</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        loader<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
        <span class="token comment">// åªåœ¨ src æ–‡ä»¶å¤¹ä¸‹æŸ¥æ‰¾</span>
        include<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token comment">// ä¸ä¼šå»æŸ¥æ‰¾çš„è·¯å¾„</span>
        exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>å¯¹äº <code>Babel</code> æ¥è¯´ï¼Œæˆ‘ä»¬è‚¯å®šæ˜¯å¸Œæœ›åªä½œç”¨åœ¨ <code>JS</code>ä»£ç ä¸Šçš„ï¼Œç„¶å <code>node_modules</code> ä¸­ä½¿ç”¨çš„ä»£ç éƒ½æ˜¯ç¼–è¯‘è¿‡çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå®Œå…¨æ²¡æœ‰å¿…è¦å†å»å¤„ç†ä¸€é</p></blockquote> <ul><li>å½“ç„¶è¿™æ ·åšè¿˜ä¸å¤Ÿï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å°† <code>Babel</code> ç¼–è¯‘è¿‡çš„æ–‡ä»¶ç¼“å­˜èµ·æ¥ï¼Œä¸‹æ¬¡åªéœ€è¦ç¼–è¯‘æ›´æ”¹è¿‡çš„ä»£ç æ–‡ä»¶å³å¯ï¼Œè¿™æ ·å¯ä»¥å¤§å¹…åº¦åŠ å¿«æ‰“åŒ…æ—¶é—´</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>loader<span class="token operator">:</span> <span class="token string">'babel-loader?cacheDirectory=true'</span>
</code></pre></div><p><strong>2. HappyPack</strong></p> <blockquote><p>å—é™äº <code>Node</code> æ˜¯å•çº¿ç¨‹è¿è¡Œçš„ï¼Œæ‰€ä»¥ <code>Webpack</code> åœ¨æ‰“åŒ…çš„è¿‡ç¨‹ä¸­ä¹Ÿæ˜¯å•çº¿ç¨‹çš„ï¼Œç‰¹åˆ«æ˜¯åœ¨æ‰§è¡Œ<code>Loader</code> çš„æ—¶å€™ï¼Œé•¿æ—¶é—´ç¼–è¯‘çš„ä»»åŠ¡å¾ˆå¤šï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´ç­‰å¾…çš„æƒ…å†µã€‚</p></blockquote> <blockquote><p><code>HappyPack</code> å¯ä»¥å°† <code>Loader</code> çš„åŒæ­¥æ‰§è¡Œè½¬æ¢ä¸ºå¹¶è¡Œçš„ï¼Œè¿™æ ·å°±èƒ½å……åˆ†åˆ©ç”¨ç³»ç»Ÿèµ„æºæ¥åŠ å¿«æ‰“åŒ…æ•ˆç‡äº†</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token operator">:</span> <span class="token punctuation">{</span>
  loaders<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      include<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      <span class="token comment">// id åé¢çš„å†…å®¹å¯¹åº”ä¸‹é¢</span>
      loader<span class="token operator">:</span> <span class="token string">'happypack/loader?id=happybabel'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">HappyPack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">'happybabel'</span><span class="token punctuation">,</span>
    loaders<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'babel-loader?cacheDirectory'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// å¼€å¯ 4 ä¸ªçº¿ç¨‹</span>
    threads<span class="token operator">:</span> <span class="token number">4</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div><p><strong>3. DllPlugin</strong></p> <blockquote><p><code>DllPlugin</code> å¯ä»¥å°†ç‰¹å®šçš„ç±»åº“æå‰æ‰“åŒ…ç„¶åå¼•å…¥ã€‚è¿™ç§æ–¹å¼å¯ä»¥æå¤§çš„å‡å°‘æ‰“åŒ…ç±»åº“çš„æ¬¡æ•°ï¼Œåªæœ‰å½“ç±»åº“æ›´æ–°ç‰ˆæœ¬æ‰æœ‰éœ€è¦é‡æ–°æ‰“åŒ…ï¼Œå¹¶ä¸”ä¹Ÿå®ç°äº†å°†å…¬å…±ä»£ç æŠ½ç¦»æˆå•ç‹¬æ–‡ä»¶çš„ä¼˜åŒ–æ–¹æ¡ˆã€‚</p></blockquote> <p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥å­¦ä¹ å¦‚ä½•ä½¿ç”¨ <code>DllPlugin</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// å•ç‹¬é…ç½®åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­</span>
<span class="token comment">// webpack.dll.conf.js</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// æƒ³ç»Ÿä¸€æ‰“åŒ…çš„ç±»åº“</span>
    vendor<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'react'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">'[name].dll.js'</span><span class="token punctuation">,</span>
    library<span class="token operator">:</span> <span class="token string">'[name]-[hash]'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token comment">// name å¿…é¡»å’Œ output.library ä¸€è‡´</span>
      name<span class="token operator">:</span> <span class="token string">'[name]-[hash]'</span><span class="token punctuation">,</span>
      <span class="token comment">// è¯¥å±æ€§éœ€è¦ä¸ DllReferencePlugin ä¸­ä¸€è‡´</span>
      context<span class="token operator">:</span> __dirname<span class="token punctuation">,</span>
      path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">,</span> <span class="token string">'[name]-manifest.json'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>ç„¶åæˆ‘ä»¬éœ€è¦æ‰§è¡Œè¿™ä¸ªé…ç½®æ–‡ä»¶ç”Ÿæˆä¾èµ–æ–‡ä»¶ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨ <code>DllReferencePlugin</code> å°†ä¾èµ–æ–‡ä»¶å¼•å…¥é¡¹ç›®ä¸­</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack.conf.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...çœç•¥å…¶ä»–é…ç½®</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      context<span class="token operator">:</span> __dirname<span class="token punctuation">,</span>
      <span class="token comment">// manifest å°±æ˜¯ä¹‹å‰æ‰“åŒ…å‡ºæ¥çš„ json æ–‡ä»¶</span>
      manifest<span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./dist/vendor-manifest.json'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>4. ä»£ç å‹ç¼©</strong></p> <blockquote><p>åœ¨ <code>Webpack3</code> ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ <code>UglifyJS</code> æ¥å‹ç¼©ä»£ç ï¼Œä½†æ˜¯è¿™ä¸ªæ˜¯å•çº¿ç¨‹è¿è¡Œçš„ï¼Œä¸ºäº†åŠ å¿«æ•ˆç‡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>webpack-parallel-uglify-plugin</code> æ¥å¹¶è¡Œè¿è¡Œ <code>UglifyJS</code>ï¼Œä»è€Œæé«˜æ•ˆç‡ã€‚</p></blockquote> <blockquote><p>åœ¨ <code>Webpack4</code> ä¸­ï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦ä»¥ä¸Šè¿™äº›æ“ä½œäº†ï¼Œåªéœ€è¦å°† <code>mode</code> è®¾ç½®ä¸º <code>production</code> å°±å¯ä»¥é»˜è®¤å¼€å¯ä»¥ä¸ŠåŠŸèƒ½ã€‚ä»£ç å‹ç¼©ä¹Ÿæ˜¯æˆ‘ä»¬å¿…åšçš„æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆï¼Œå½“ç„¶æˆ‘ä»¬ä¸æ­¢å¯ä»¥å‹ç¼© <code>JS</code> ä»£ç ï¼Œè¿˜å¯ä»¥å‹ç¼© <code>HTML</code>ã€<code>CSS</code> ä»£ç ï¼Œå¹¶ä¸”åœ¨å‹ç¼© <code>JS</code> ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡é…ç½®å®ç°æ¯”å¦‚åˆ é™¤ <code>console.log</code> è¿™ç±»ä»£ç çš„åŠŸèƒ½ã€‚</p></blockquote> <p><strong>5. ä¸€äº›å°çš„ä¼˜åŒ–ç‚¹</strong></p> <blockquote><p>æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ä¸€äº›å°çš„ä¼˜åŒ–ç‚¹æ¥åŠ å¿«æ‰“åŒ…é€Ÿåº¦</p></blockquote> <ul><li><code>resolve.extensions</code>ï¼šç”¨æ¥è¡¨æ˜æ–‡ä»¶åç¼€åˆ—è¡¨ï¼Œé»˜è®¤æŸ¥æ‰¾é¡ºåºæ˜¯ <code>['.js', '.json']</code>ï¼Œå¦‚æœä½ çš„å¯¼å…¥æ–‡ä»¶æ²¡æœ‰æ·»åŠ åç¼€å°±ä¼šæŒ‰ç…§è¿™ä¸ªé¡ºåºæŸ¥æ‰¾æ–‡ä»¶ã€‚æˆ‘ä»¬åº”è¯¥å°½å¯èƒ½å‡å°‘åç¼€åˆ—è¡¨é•¿åº¦ï¼Œç„¶åå°†å‡ºç°é¢‘ç‡é«˜çš„åç¼€æ’åœ¨å‰é¢</li> <li><code>resolve.alias</code>ï¼šå¯ä»¥é€šè¿‡åˆ«åçš„æ–¹å¼æ¥æ˜ å°„ä¸€ä¸ªè·¯å¾„ï¼Œèƒ½è®© <code>Webpack</code> æ›´å¿«æ‰¾åˆ°è·¯å¾„</li> <li><code>module.noParse</code>ï¼šå¦‚æœä½ ç¡®å®šä¸€ä¸ªæ–‡ä»¶ä¸‹æ²¡æœ‰å…¶ä»–ä¾èµ–ï¼Œå°±å¯ä»¥ä½¿ç”¨è¯¥å±æ€§è®© Webpack ä¸æ‰«æè¯¥æ–‡ä»¶ï¼Œè¿™ç§æ–¹å¼å¯¹äºå¤§å‹çš„ç±»åº“å¾ˆæœ‰å¸®åŠ©</li></ul> <h3 id="_25-2-å‡å°‘-webpack-æ‰“åŒ…åçš„æ–‡ä»¶ä½“ç§¯"><a href="http://interview.poetries.top/docs/excellent.html#_25-2-%E5%87%8F%E5%B0%91-webpack-%E6%89%93%E5%8C%85%E5%90%8E%E7%9A%84%E6%96%87%E4%BB%B6%E4%BD%93%E7%A7%AF" class="header-anchor">#</a> 25.2 å‡å°‘ Webpack æ‰“åŒ…åçš„æ–‡ä»¶ä½“ç§¯</h3> <p><strong>1. æŒ‰éœ€åŠ è½½</strong></p> <blockquote><p>æƒ³å¿…å¤§å®¶åœ¨å¼€å‘ <code>SPA</code> é¡¹ç›®çš„æ—¶å€™ï¼Œé¡¹ç›®ä¸­éƒ½ä¼šå­˜åœ¨åå‡ ç”šè‡³æ›´å¤šçš„è·¯ç”±é¡µé¢ã€‚å¦‚æœæˆ‘ä»¬å°†è¿™äº›é¡µé¢å…¨éƒ¨æ‰“åŒ…è¿›ä¸€ä¸ª <code>JS</code>æ–‡ä»¶çš„è¯ï¼Œè™½ç„¶å°†å¤šä¸ªè¯·æ±‚åˆå¹¶äº†ï¼Œä½†æ˜¯åŒæ ·ä¹ŸåŠ è½½äº†å¾ˆå¤šå¹¶ä¸éœ€è¦çš„ä»£ç ï¼Œè€—è´¹äº†æ›´é•¿çš„æ—¶é—´ã€‚é‚£ä¹ˆä¸ºäº†é¦–é¡µèƒ½æ›´å¿«åœ°å‘ˆç°ç»™ç”¨æˆ·ï¼Œæˆ‘ä»¬è‚¯å®šæ˜¯å¸Œæœ›é¦–é¡µèƒ½åŠ è½½çš„æ–‡ä»¶ä½“ç§¯è¶Šå°è¶Šå¥½ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨æŒ‰éœ€åŠ è½½ï¼Œå°†æ¯ä¸ªè·¯ç”±é¡µé¢å•ç‹¬æ‰“åŒ…ä¸ºä¸€ä¸ªæ–‡ä»¶ã€‚å½“ç„¶ä¸ä»…ä»…è·¯ç”±å¯ä»¥æŒ‰éœ€åŠ è½½ï¼Œå¯¹äº <code>loadash</code> è¿™ç§å¤§å‹ç±»åº“åŒæ ·å¯ä»¥ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½ã€‚</p></blockquote> <blockquote><p>æŒ‰éœ€åŠ è½½çš„ä»£ç å®ç°è¿™é‡Œå°±ä¸è¯¦ç»†å±•å¼€äº†ï¼Œå› ä¸ºé‰´äºç”¨çš„æ¡†æ¶ä¸åŒï¼Œå®ç°èµ·æ¥éƒ½æ˜¯ä¸ä¸€æ ·çš„ã€‚å½“ç„¶äº†ï¼Œè™½ç„¶ä»–ä»¬çš„ç”¨æ³•å¯èƒ½ä¸åŒï¼Œä½†æ˜¯åº•å±‚çš„æœºåˆ¶éƒ½æ˜¯ä¸€æ ·çš„ã€‚éƒ½æ˜¯å½“ä½¿ç”¨çš„æ—¶å€™å†å»ä¸‹è½½å¯¹åº”æ–‡ä»¶ï¼Œè¿”å›ä¸€ä¸ª <code>Promise</code>ï¼Œå½“ <code>Promise</code>æˆåŠŸä»¥åå»æ‰§è¡Œå›è°ƒã€‚</p></blockquote> <p><strong>2. Scope Hoisting</strong></p> <blockquote><p><code>Scope Hoisting</code> ä¼šåˆ†æå‡ºæ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œå°½å¯èƒ½çš„æŠŠæ‰“åŒ…å‡ºæ¥çš„æ¨¡å—åˆå¹¶åˆ°ä¸€ä¸ªå‡½æ•°ä¸­å»ã€‚</p></blockquote> <p>æ¯”å¦‚æˆ‘ä»¬å¸Œæœ›æ‰“åŒ…ä¸¤ä¸ªæ–‡ä»¶</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// test.js</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">1</span>

<span class="token comment">// index.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> a <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./test.js'</span>
</code></pre></div><blockquote><p>å¯¹äºè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬æ‰“åŒ…å‡ºæ¥çš„ä»£ç ä¼šç±»ä¼¼è¿™æ ·</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">[</span>
  <span class="token comment">/* 0 */</span>
  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">/* 1 */</span>
  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><blockquote><p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬ä½¿ç”¨ <code>Scope Hoisting</code> çš„è¯ï¼Œä»£ç å°±ä¼šå°½å¯èƒ½çš„åˆå¹¶åˆ°ä¸€ä¸ªå‡½æ•°ä¸­å»ï¼Œä¹Ÿå°±å˜æˆäº†è¿™æ ·çš„ç±»ä¼¼ä»£ç </p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">[</span>
  <span class="token comment">/* 0 */</span>
  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

</code></pre></div><blockquote><p>è¿™æ ·çš„æ‰“åŒ…æ–¹å¼ç”Ÿæˆçš„ä»£ç æ˜æ˜¾æ¯”ä¹‹å‰çš„å°‘å¤šäº†ã€‚å¦‚æœåœ¨ <code>Webpack4</code> ä¸­ä½ å¸Œæœ›å¼€å¯è¿™ä¸ªåŠŸèƒ½ï¼Œåªéœ€è¦å¯ç”¨ <code>optimization.concatenateModules</code>å°±å¯ä»¥äº†ã€‚</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    concatenateModules<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>3. Tree Shaking</strong></p> <blockquote><p><code>Tree Shaking</code> å¯ä»¥å®ç°åˆ é™¤é¡¹ç›®ä¸­æœªè¢«å¼•ç”¨çš„ä»£ç ï¼Œæ¯”å¦‚</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// test.js</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token number">2</span>
<span class="token comment">// index.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> a <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./test.js'</span>
</code></pre></div><ul><li>å¯¹äºä»¥ä¸Šæƒ…å†µï¼Œ<code>test</code> æ–‡ä»¶ä¸­çš„å˜é‡ <code>b</code> å¦‚æœæ²¡æœ‰åœ¨é¡¹ç›®ä¸­ä½¿ç”¨åˆ°çš„è¯ï¼Œå°±ä¸ä¼šè¢«æ‰“åŒ…åˆ°æ–‡ä»¶ä¸­ã€‚</li> <li>å¦‚æœä½ ä½¿ç”¨ <code>Webpack 4</code> çš„è¯ï¼Œå¼€å¯ç”Ÿäº§ç¯å¢ƒå°±ä¼šè‡ªåŠ¨å¯åŠ¨è¿™ä¸ªä¼˜åŒ–åŠŸèƒ½ã€‚</li></ul> <h2 id="_26-å®ç°å°å‹æ‰“åŒ…å·¥å…·"><a href="http://interview.poetries.top/docs/excellent.html#_26-%E5%AE%9E%E7%8E%B0%E5%B0%8F%E5%9E%8B%E6%89%93%E5%8C%85%E5%B7%A5%E5%85%B7" class="header-anchor">#</a> 26 å®ç°å°å‹æ‰“åŒ…å·¥å…·</h2> <blockquote><p>è¯¥å·¥å…·å¯ä»¥å®ç°ä»¥ä¸‹ä¸¤ä¸ªåŠŸèƒ½</p></blockquote> <ul><li>å°† <code>ES6</code> è½¬æ¢ä¸º <code>ES5</code></li> <li>æ”¯æŒåœ¨ <code>JS</code> æ–‡ä»¶ä¸­ <code>import CSS</code> æ–‡ä»¶</li></ul> <blockquote><p>é€šè¿‡è¿™ä¸ªå·¥å…·çš„å®ç°ï¼Œå¤§å®¶å¯ä»¥ç†è§£åˆ°æ‰“åŒ…å·¥å…·çš„åŸç†åˆ°åº•æ˜¯ä»€ä¹ˆ</p></blockquote> <p><strong>å®ç°</strong></p> <blockquote><p>å› ä¸ºæ¶‰åŠåˆ° <code>ES6</code> è½¬ <code>ES5</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬é¦–å…ˆéœ€è¦å®‰è£…ä¸€äº› <code>Babel</code> ç›¸å…³çš„å·¥å…·</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>yarn add babylon babel-traverse babel-core babel-preset-env  
</code></pre></div><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°†è¿™äº›å·¥å…·å¼•å…¥æ–‡ä»¶ä¸­</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> babylon <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'babylon'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> traverse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'babel-traverse'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default
<span class="token keyword">const</span> <span class="token punctuation">{</span> transformFromAst <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'babel-core'</span><span class="token punctuation">)</span>
</code></pre></div><p>é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆæ¥å®ç°å¦‚ä½•ä½¿ç”¨ <code>Babel</code> è½¬æ¢ä»£ç </p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">readCode</span><span class="token punctuation">(</span><span class="token parameter">filePath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// è¯»å–æ–‡ä»¶å†…å®¹</span>
  <span class="token keyword">const</span> content <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>
  <span class="token comment">// ç”Ÿæˆ AST</span>
  <span class="token keyword">const</span> ast <span class="token operator">=</span> babylon<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    sourceType<span class="token operator">:</span> <span class="token string">'module'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// å¯»æ‰¾å½“å‰æ–‡ä»¶çš„ä¾èµ–å…³ç³»</span>
  <span class="token keyword">const</span> dependencies <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token function">traverse</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">ImportDeclaration</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> node <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      dependencies<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>source<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// é€šè¿‡ AST å°†ä»£ç è½¬ä¸º ES5</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> code <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">transformFromAst</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    presets<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'env'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    filePath<span class="token punctuation">,</span>
    dependencies<span class="token punctuation">,</span>
    code
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>é¦–å…ˆæˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªæ–‡ä»¶è·¯å¾„å‚æ•°ï¼Œç„¶åé€šè¿‡ <code>fs</code> å°†æ–‡ä»¶ä¸­çš„å†…å®¹è¯»å–å‡ºæ¥</li> <li>æ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡ <code>babylon</code> è§£æä»£ç è·å– <code>AST</code>ï¼Œç›®çš„æ˜¯ä¸ºäº†åˆ†æä»£ç ä¸­æ˜¯å¦è¿˜å¼•å…¥äº†åˆ«çš„æ–‡ä»¶</li> <li>é€šè¿‡ <code>dependencies</code> æ¥å­˜å‚¨æ–‡ä»¶ä¸­çš„ä¾èµ–ï¼Œç„¶åå†å°† <code>AST</code> è½¬æ¢ä¸º <code>ES5</code> ä»£ç </li> <li>æœ€åå‡½æ•°è¿”å›äº†ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡ä¸­åŒ…å«äº†å½“å‰æ–‡ä»¶è·¯å¾„ã€å½“å‰æ–‡ä»¶ä¾èµ–å’Œå½“å‰æ–‡ä»¶è½¬æ¢åçš„ä»£ç </li></ul> <blockquote><p>æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„åŠŸèƒ½æœ‰ä»¥ä¸‹å‡ ç‚¹</p></blockquote> <ul><li>è°ƒç”¨ <code>readCode</code> å‡½æ•°ï¼Œä¼ å…¥å…¥å£æ–‡ä»¶</li> <li>åˆ†æå…¥å£æ–‡ä»¶çš„ä¾èµ–</li> <li>è¯†åˆ« <code>JS</code> å’Œ <code>CSS</code> æ–‡ä»¶</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getDependencies</span><span class="token punctuation">(</span><span class="token parameter">entry</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// è¯»å–å…¥å£æ–‡ä»¶</span>
  <span class="token keyword">const</span> entryObject <span class="token operator">=</span> <span class="token function">readCode</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span>
  <span class="token keyword">const</span> dependencies <span class="token operator">=</span> <span class="token punctuation">[</span>entryObject<span class="token punctuation">]</span>
  <span class="token comment">// éå†æ‰€æœ‰æ–‡ä»¶ä¾èµ–å…³ç³»</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> asset <span class="token keyword">of</span> dependencies<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// è·å¾—æ–‡ä»¶ç›®å½•</span>
    <span class="token keyword">const</span> dirname <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>asset<span class="token punctuation">.</span>filePath<span class="token punctuation">)</span>
    <span class="token comment">// éå†å½“å‰æ–‡ä»¶ä¾èµ–å…³ç³»</span>
    asset<span class="token punctuation">.</span>dependencies<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">relativePath</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// è·å¾—ç»å¯¹è·¯å¾„</span>
      <span class="token keyword">const</span> absolutePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>dirname<span class="token punctuation">,</span> relativePath<span class="token punctuation">)</span>
      <span class="token comment">// CSS æ–‡ä»¶é€»è¾‘å°±æ˜¯å°†ä»£ç æ’å…¥åˆ° `style` æ ‡ç­¾ä¸­</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>absolutePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> content <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>absolutePath<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> code <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
          const style = document.createElement('style')
          style.innerText = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\r\\n</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
          document.head.appendChild(style)
        </span><span class="token template-punctuation string">`</span></span>
        dependencies<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          filePath<span class="token operator">:</span> absolutePath<span class="token punctuation">,</span>
          relativePath<span class="token punctuation">,</span>
          dependencies<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          code
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// JS ä»£ç éœ€è¦ç»§ç»­æŸ¥æ‰¾æ˜¯å¦æœ‰ä¾èµ–å…³ç³»</span>
        <span class="token keyword">const</span> child <span class="token operator">=</span> <span class="token function">readCode</span><span class="token punctuation">(</span>absolutePath<span class="token punctuation">)</span>
        child<span class="token punctuation">.</span>relativePath <span class="token operator">=</span> relativePath
        dependencies<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> dependencies
<span class="token punctuation">}</span>
</code></pre></div><ul><li>é¦–å…ˆæˆ‘ä»¬è¯»å–å…¥å£æ–‡ä»¶ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªæ•°ç»„ï¼Œè¯¥æ•°ç»„çš„ç›®çš„æ˜¯å­˜å‚¨ä»£ç ä¸­æ¶‰åŠåˆ°çš„æ‰€æœ‰æ–‡ä»¶</li> <li>æ¥ä¸‹æ¥æˆ‘ä»¬éå†è¿™ä¸ªæ•°ç»„ï¼Œä¸€å¼€å§‹è¿™ä¸ªæ•°ç»„ä¸­åªæœ‰å…¥å£æ–‡ä»¶ï¼Œåœ¨éå†çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå…¥å£æ–‡ä»¶æœ‰ä¾èµ–å…¶ä»–çš„æ–‡ä»¶ï¼Œé‚£ä¹ˆå°±ä¼šè¢« <code>push</code> åˆ°è¿™ä¸ªæ•°ç»„ä¸­</li> <li>åœ¨éå†çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å…ˆè·å¾—è¯¥æ–‡ä»¶å¯¹åº”çš„ç›®å½•ï¼Œç„¶åéå†å½“å‰æ–‡ä»¶çš„ä¾èµ–å…³ç³»</li> <li>åœ¨éå†å½“å‰æ–‡ä»¶ä¾èµ–å…³ç³»çš„è¿‡ç¨‹ä¸­ï¼Œé¦–å…ˆç”Ÿæˆä¾èµ–æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼Œç„¶ååˆ¤æ–­å½“å‰æ–‡ä»¶æ˜¯ <code>CSS</code> æ–‡ä»¶è¿˜æ˜¯ <code>JS</code> æ–‡ä»¶</li> <li>å¦‚æœæ˜¯ <code>CSS</code> æ–‡ä»¶çš„è¯ï¼Œæˆ‘ä»¬å°±ä¸èƒ½ç”¨ <code>Babel</code> å»ç¼–è¯‘äº†ï¼Œåªéœ€è¦è¯»å– <code>CSS</code> æ–‡ä»¶ä¸­çš„ä»£ç ï¼Œç„¶ååˆ›å»ºä¸€ä¸ª <code>style</code> æ ‡ç­¾ï¼Œå°†ä»£ç æ’å…¥è¿›æ ‡ç­¾å¹¶ä¸”æ”¾å…¥ <code>head</code> ä¸­å³å¯</li> <li>å¦‚æœæ˜¯ <code>JS</code> æ–‡ä»¶çš„è¯ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åˆ†æ <code>JS</code> æ–‡ä»¶æ˜¯å¦è¿˜æœ‰åˆ«çš„ä¾èµ–å…³ç³»</li> <li>æœ€åå°†è¯»å–æ–‡ä»¶åçš„å¯¹è±¡ <code>push</code> è¿›æ•°ç»„ä¸­</li> <li>ç°åœ¨æˆ‘ä»¬å·²ç»è·å–åˆ°äº†æ‰€æœ‰çš„ä¾èµ–æ–‡ä»¶ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å®ç°æ‰“åŒ…çš„åŠŸèƒ½äº†</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">bundle</span><span class="token punctuation">(</span><span class="token parameter">dependencies<span class="token punctuation">,</span> entry</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> modules <span class="token operator">=</span> <span class="token string">''</span>
  <span class="token comment">// æ„å»ºå‡½æ•°å‚æ•°ï¼Œç”Ÿæˆçš„ç»“æ„ä¸º</span>
  <span class="token comment">// { './entry.js': function(module, exports, require) { ä»£ç  } }</span>
  dependencies<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">dep</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> filePath <span class="token operator">=</span> dep<span class="token punctuation">.</span>relativePath <span class="token operator">||</span> entry
    modules <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">'</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>filePath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">': (
      function (module, exports, require) { </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dep<span class="token punctuation">.</span>code<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> }
    ),</span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// æ„å»º require å‡½æ•°ï¼Œç›®çš„æ˜¯ä¸ºäº†è·å–æ¨¡å—æš´éœ²å‡ºæ¥çš„å†…å®¹</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    (function(modules) {
      function require(id) {
        const module = { exports : {} }
        modules[id](module, module.exports, require)
        return module.exports
      }
      require('</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>entry<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">')
    })({</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>modules<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">})
  </span><span class="token template-punctuation string">`</span></span>
  <span class="token comment">// å½“ç”Ÿæˆçš„å†…å®¹å†™å…¥åˆ°æ–‡ä»¶ä¸­</span>
  fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span><span class="token string">'./bundle.js'</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>è¿™æ®µä»£ç éœ€è¦ç»“åˆç€ <code>Babel</code> è½¬æ¢åçš„ä»£ç æ¥çœ‹ï¼Œè¿™æ ·å¤§å®¶å°±èƒ½ç†è§£ä¸ºä»€ä¹ˆéœ€è¦è¿™æ ·å†™äº†</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// entry.js</span>
<span class="token keyword">var</span> _a <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./a.js'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> _a2 <span class="token operator">=</span> <span class="token function">_interopRequireDefault</span><span class="token punctuation">(</span>_a<span class="token punctuation">)</span>
<span class="token keyword">function</span> <span class="token function">_interopRequireDefault</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> obj <span class="token operator">&amp;&amp;</span> obj<span class="token punctuation">.</span>__esModule <span class="token operator">?</span> obj <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token keyword">default</span><span class="token operator">:</span> obj <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_a2<span class="token punctuation">.</span>default<span class="token punctuation">)</span>
<span class="token comment">// a.js</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">'__esModule'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    value<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span>
exports<span class="token punctuation">.</span>default <span class="token operator">=</span> a
</code></pre></div><blockquote><p><code>Babel</code> å°†æˆ‘ä»¬ <code>ES6</code>çš„æ¨¡å—åŒ–ä»£ç è½¬æ¢ä¸ºäº† <code>CommonJS</code>çš„ä»£ç ï¼Œä½†æ˜¯æµè§ˆå™¨æ˜¯ä¸æ”¯æŒ <code>CommonJS</code> çš„ï¼Œæ‰€ä»¥å¦‚æœè¿™æ®µä»£ç éœ€è¦åœ¨æµè§ˆå™¨ç¯å¢ƒä¸‹è¿è¡Œçš„è¯ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±å®ç° <code>CommonJS</code> ç›¸å…³çš„ä»£ç ï¼Œè¿™å°±æ˜¯ <code>bundle</code> å‡½æ•°åšçš„å¤§éƒ¨åˆ†äº‹æƒ…ã€‚</p></blockquote> <p><strong>æ¥ä¸‹æ¥æˆ‘ä»¬å†æ¥é€è¡Œè§£æ bundle å‡½æ•°</strong></p> <ul><li>é¦–å…ˆéå†æ‰€æœ‰ä¾èµ–æ–‡ä»¶ï¼Œæ„å»ºå‡ºä¸€ä¸ªå‡½æ•°å‚æ•°å¯¹è±¡</li> <li>å¯¹è±¡çš„å±æ€§å°±æ˜¯å½“å‰æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„ï¼Œå±æ€§å€¼æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°ä½“æ˜¯å½“å‰æ–‡ä»¶ä¸‹çš„ä»£ç ï¼Œå‡½æ•°æ¥å—ä¸‰ä¸ªå‚æ•° <code>module</code>ã€<code>exports</code>ã€ <code>require</code> <ul><li><code>module</code> å‚æ•°å¯¹åº” <code>CommonJS</code> ä¸­çš„ <code>module</code></li> <li><code>exports</code> å‚æ•°å¯¹åº” <code>CommonJS</code> ä¸­çš„ <code>module.export</code></li> <li><code>require</code> å‚æ•°å¯¹åº”æˆ‘ä»¬è‡ªå·±åˆ›å»ºçš„ <code>require</code> å‡½æ•°</li></ul></li> <li>æ¥ä¸‹æ¥å°±æ˜¯æ„é€ ä¸€ä¸ªä½¿ç”¨å‚æ•°çš„å‡½æ•°äº†ï¼Œå‡½æ•°åšçš„äº‹æƒ…å¾ˆç®€å•ï¼Œå°±æ˜¯å†…éƒ¨åˆ›å»ºä¸€ä¸ª <code>require</code>å‡½æ•°ï¼Œç„¶åè°ƒç”¨ <code>require(entry)</code>ï¼Œä¹Ÿå°±æ˜¯ <code>require('./entry.js')</code>ï¼Œè¿™æ ·å°±ä¼šä»å‡½æ•°å‚æ•°ä¸­æ‰¾åˆ° <code>./entry.js</code> å¯¹åº”çš„å‡½æ•°å¹¶æ‰§è¡Œï¼Œæœ€åå°†å¯¼å‡ºçš„å†…å®¹é€šè¿‡ <code>module.export</code> çš„æ–¹å¼è®©å¤–éƒ¨è·å–åˆ°</li> <li>æœ€åå†å°†æ‰“åŒ…å‡ºæ¥çš„å†…å®¹å†™å…¥åˆ°å•ç‹¬çš„æ–‡ä»¶ä¸­</li></ul> <blockquote><p>å¦‚æœä½ å¯¹äºä¸Šé¢çš„å®ç°è¿˜æœ‰ç–‘æƒ‘çš„è¯ï¼Œå¯ä»¥é˜…è¯»ä¸‹æ‰“åŒ…åçš„éƒ¨åˆ†ç®€åŒ–ä»£ç </p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">modules</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ„é€ ä¸€ä¸ª CommonJS å¯¼å‡ºä»£ç </span>
    <span class="token keyword">const</span> module <span class="token operator">=</span> <span class="token punctuation">{</span> exports<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span>
    <span class="token comment">// å»å‚æ•°ä¸­è·å–æ–‡ä»¶å¯¹åº”çš„å‡½æ•°å¹¶æ‰§è¡Œ</span>
    modules<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">(</span>module<span class="token punctuation">,</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> require<span class="token punctuation">)</span>
    <span class="token keyword">return</span> module<span class="token punctuation">.</span>exports
  <span class="token punctuation">}</span>
  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./entry.js'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'./entry.js'</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// è¿™é‡Œç»§ç»­é€šè¿‡æ„é€ çš„ require å»æ‰¾åˆ° a.js æ–‡ä»¶å¯¹åº”çš„å‡½æ•°</span>
    <span class="token keyword">var</span> _a <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./a.js'</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_a2<span class="token punctuation">.</span>default<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">'./a.js'</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token comment">// å°† require å‡½æ•°ä¸­çš„å˜é‡ module å˜æˆäº†è¿™æ ·çš„ç»“æ„</span>
    <span class="token comment">// module.exports = 1</span>
    <span class="token comment">// è¿™æ ·å°±èƒ½åœ¨å¤–éƒ¨å–åˆ°å¯¼å‡ºçš„å†…å®¹äº†</span>
    exports<span class="token punctuation">.</span>default <span class="token operator">=</span> a
  <span class="token punctuation">}</span>
  <span class="token comment">// çœç•¥</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>è™½ç„¶å®ç°è¿™ä¸ªå·¥å…·åªå†™äº†ä¸åˆ° <code>100</code> è¡Œçš„ä»£ç ï¼Œä½†æ˜¯æ‰“åŒ…å·¥å…·çš„æ ¸å¿ƒåŸç†å°±æ˜¯è¿™äº›äº†</p></blockquote> <ul><li>æ‰¾å‡ºå…¥å£æ–‡ä»¶æ‰€æœ‰çš„ä¾èµ–å…³ç³»</li> <li>ç„¶åé€šè¿‡æ„å»º <code>CommonJS</code> ä»£ç æ¥è·å– <code>exports</code> å¯¼å‡ºçš„å†…å®¹</li></ul> <h2 id="_27-mvvm-è™šæ‹Ÿdom-å‰ç«¯è·¯ç”±"><a href="http://interview.poetries.top/docs/excellent.html#_27-mvvm-%E8%99%9A%E6%8B%9Fdom-%E5%89%8D%E7%AB%AF%E8%B7%AF%E7%94%B1" class="header-anchor">#</a> 27 MVVM/è™šæ‹ŸDOM/å‰ç«¯è·¯ç”±</h2> <h3 id="_27-1-mvvm"><a href="http://interview.poetries.top/docs/excellent.html#_27-1-mvvm" class="header-anchor">#</a> 27.1 MVVM</h3> <blockquote><p>æ¶‰åŠé¢è¯•é¢˜ï¼šä»€ä¹ˆæ˜¯ <code>MVVM</code>ï¼Ÿæ¯”ä¹‹ <code>MVC</code> æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p></blockquote> <p><strong>é¦–å…ˆå…ˆæ¥è¯´ä¸‹ View å’Œ Model</strong></p> <ul><li><code>View</code> å¾ˆç®€å•ï¼Œå°±æ˜¯ç”¨æˆ·çœ‹åˆ°çš„è§†å›¾</li> <li><code>Model</code> åŒæ ·å¾ˆç®€å•ï¼Œä¸€èˆ¬å°±æ˜¯æœ¬åœ°æ•°æ®å’Œæ•°æ®åº“ä¸­çš„æ•°æ®</li></ul> <blockquote><p>åŸºæœ¬ä¸Šï¼Œæˆ‘ä»¬å†™çš„äº§å“å°±æ˜¯é€šè¿‡æ¥å£ä»æ•°æ®åº“ä¸­è¯»å–æ•°æ®ï¼Œç„¶åå°†æ•°æ®ç»è¿‡å¤„ç†å±•ç°åˆ°ç”¨æˆ·çœ‹åˆ°çš„è§†å›¾ä¸Šã€‚å½“ç„¶æˆ‘ä»¬è¿˜å¯ä»¥ä»è§†å›¾ä¸Šè¯»å–ç”¨æˆ·çš„è¾“å…¥ï¼Œç„¶ååˆå°†ç”¨æˆ·çš„è¾“å…¥é€šè¿‡æ¥å£å†™å…¥åˆ°æ•°æ®åº“ä¸­ã€‚ä½†æ˜¯ï¼Œå¦‚ä½•å°†æ•°æ®å±•ç¤ºåˆ°è§†å›¾ä¸Šï¼Œç„¶ååˆå¦‚ä½•å°†ç”¨æˆ·çš„è¾“å…¥å†™å…¥åˆ°æ•°æ®ä¸­ï¼Œä¸åŒçš„äººå°±äº§ç”Ÿäº†ä¸åŒçš„çœ‹æ³•ï¼Œä»æ­¤å‡ºç°äº†å¾ˆå¤šç§æ¶æ„è®¾è®¡ã€‚</p></blockquote> <blockquote><p>ä¼ ç»Ÿçš„ <code>MVC</code> æ¶æ„é€šå¸¸æ˜¯ä½¿ç”¨æ§åˆ¶å™¨æ›´æ–°æ¨¡å‹ï¼Œè§†å›¾ä»æ¨¡å‹ä¸­è·å–æ•°æ®å»æ¸²æŸ“ã€‚å½“ç”¨æˆ·æœ‰è¾“å…¥æ—¶ï¼Œä¼šé€šè¿‡æ§åˆ¶å™¨å»æ›´æ–°æ¨¡å‹ï¼Œå¹¶ä¸”é€šçŸ¥è§†å›¾è¿›è¡Œæ›´æ–°</p></blockquote> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/27.png" alt="" class="medium-zoom-image"></p> <ul><li>ä½†æ˜¯ <code>MVC</code> æœ‰ä¸€ä¸ªå·¨å¤§çš„ç¼ºé™·å°±æ˜¯æ§åˆ¶å™¨æ‰¿æ‹…çš„è´£ä»»å¤ªå¤§äº†ï¼Œéšç€é¡¹ç›®æ„ˆåŠ å¤æ‚ï¼Œæ§åˆ¶å™¨ä¸­çš„ä»£ç ä¼šè¶Šæ¥è¶Šè‡ƒè‚¿ï¼Œå¯¼è‡´å‡ºç°ä¸åˆ©äºç»´æŠ¤çš„æƒ…å†µã€‚</li> <li>åœ¨ <code>MVVM</code> æ¶æ„ä¸­ï¼Œå¼•å…¥äº† <code>ViewModel</code> çš„æ¦‚å¿µã€‚<code>ViewModel</code> åªå…³å¿ƒæ•°æ®å’Œä¸šåŠ¡çš„å¤„ç†ï¼Œä¸å…³å¿ƒ <code>View</code> å¦‚ä½•å¤„ç†æ•°æ®ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>View</code>å’Œ <code>Model</code> éƒ½å¯ä»¥ç‹¬ç«‹å‡ºæ¥ï¼Œä»»ä½•ä¸€æ–¹æ”¹å˜äº†ä¹Ÿä¸ä¸€å®šéœ€è¦æ”¹å˜å¦ä¸€æ–¹ï¼Œå¹¶ä¸”å¯ä»¥å°†ä¸€äº›å¯å¤ç”¨çš„é€»è¾‘æ”¾åœ¨ä¸€ä¸ª <code>ViewModel</code> ä¸­ï¼Œè®©å¤šä¸ª <code>View</code> å¤ç”¨è¿™ä¸ª <code>ViewModel</code>ã€‚</li></ul> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/28.png" alt="" class="medium-zoom-image"></p> <ul><li>ä»¥ <code>Vue</code> æ¡†æ¶æ¥ä¸¾ä¾‹ï¼Œ<code>ViewModel</code> å°±æ˜¯ç»„ä»¶çš„å®ä¾‹ã€‚<code>View</code> å°±æ˜¯æ¨¡æ¿ï¼Œ<code>Model</code> çš„è¯åœ¨å¼•å…¥ <code>Vuex</code> çš„æƒ…å†µä¸‹æ˜¯å®Œå…¨å¯ä»¥å’Œç»„ä»¶åˆ†ç¦»çš„ã€‚</li> <li>é™¤äº†ä»¥ä¸Šä¸‰ä¸ªéƒ¨åˆ†ï¼Œå…¶å®åœ¨ <code>MVVM</code> ä¸­è¿˜å¼•å…¥äº†ä¸€ä¸ªéšå¼çš„ <code>Binder</code> å±‚ï¼Œå®ç°äº† <code>View</code> å’Œ <code>ViewModel</code> çš„ç»‘å®š</li></ul> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/29.png" alt="" class="medium-zoom-image"></p> <ul><li>åŒæ ·ä»¥ <code>Vue</code> æ¡†æ¶æ¥ä¸¾ä¾‹ï¼Œè¿™ä¸ªéšå¼çš„ <code>Binder</code> å±‚å°±æ˜¯ <code>Vue</code> é€šè¿‡è§£ææ¨¡æ¿ä¸­çš„æ’å€¼å’ŒæŒ‡ä»¤ä»è€Œå®ç° <code>View</code> ä¸ <code>ViewModel</code> çš„ç»‘å®šã€‚</li> <li>å¯¹äº <code>MVVM</code>æ¥è¯´ï¼Œå…¶å®æœ€é‡è¦çš„å¹¶ä¸æ˜¯é€šè¿‡åŒå‘ç»‘å®šæˆ–è€…å…¶ä»–çš„æ–¹å¼å°† <code>View</code> ä¸ <code>ViewModel</code> ç»‘å®šèµ·æ¥ï¼Œè€Œæ˜¯é€šè¿‡ <code>ViewModel</code> å°†è§†å›¾ä¸­çš„çŠ¶æ€å’Œç”¨æˆ·çš„è¡Œä¸ºåˆ†ç¦»å‡ºä¸€ä¸ªæŠ½è±¡ï¼Œè¿™æ‰æ˜¯ <code>MVVM</code> çš„ç²¾é«“</li></ul> <h3 id="_27-2-virtual-dom"><a href="http://interview.poetries.top/docs/excellent.html#_27-2-virtual-dom" class="header-anchor">#</a> 27.2 Virtual DOM</h3> <blockquote><p>æ¶‰åŠé¢è¯•é¢˜ï¼šä»€ä¹ˆæ˜¯ <code>Virtual DOM</code>ï¼Ÿä¸ºä»€ä¹ˆ <code>Virtual DOM</code>æ¯”åŸç”Ÿ <code>DOM</code> å¿«ï¼Ÿ</p></blockquote> <ul><li>å¤§å®¶éƒ½çŸ¥é“æ“ä½œ <code>DOM</code> æ˜¯å¾ˆæ…¢çš„ï¼Œä¸ºä»€ä¹ˆæ…¢çš„åŸå› ä»¥åŠåœ¨ã€Œæµè§ˆå™¨æ¸²æŸ“åŸç†ã€ç« èŠ‚ä¸­è¯´è¿‡ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†- é‚£ä¹ˆç›¸è¾ƒäº <code>DOM</code>æ¥è¯´ï¼Œæ“ä½œ <code>JS</code> å¯¹è±¡ä¼šå¿«å¾ˆå¤šï¼Œå¹¶ä¸”æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ <code>JS</code>æ¥æ¨¡æ‹Ÿ <code>DOM</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> ul <span class="token operator">=</span> <span class="token punctuation">{</span>
  tag<span class="token operator">:</span> <span class="token string">'ul'</span><span class="token punctuation">,</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">'list'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  children<span class="token operator">:</span> <span class="token punctuation">{</span>
    tag<span class="token operator">:</span> <span class="token string">'li'</span><span class="token punctuation">,</span>
    children<span class="token operator">:</span> <span class="token string">'1'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ä¸Šè¿°ä»£ç å¯¹åº”çš„ <code>DOM</code> å°±æ˜¯</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>list<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>é‚£ä¹ˆæ—¢ç„¶ <code>DOM</code> å¯ä»¥é€šè¿‡ <code>JS</code> å¯¹è±¡æ¥æ¨¡æ‹Ÿï¼Œåä¹‹ä¹Ÿå¯ä»¥é€šè¿‡ <code>JS</code> å¯¹è±¡æ¥æ¸²æŸ“å‡ºå¯¹åº”çš„ <code>DOM</code>ã€‚å½“ç„¶äº†ï¼Œé€šè¿‡ <code>JS</code> æ¥æ¨¡æ‹Ÿ <code>DOM</code> å¹¶ä¸”æ¸²æŸ“å¯¹åº”çš„ <code>DOM</code> åªæ˜¯ç¬¬ä¸€æ­¥ï¼Œéš¾ç‚¹åœ¨äºå¦‚ä½•åˆ¤æ–­æ–°æ—§ä¸¤ä¸ª <code>JS</code> å¯¹è±¡çš„æœ€å°å·®å¼‚å¹¶ä¸”å®ç°å±€éƒ¨æ›´æ–° <code>DOM</code></li></ul> <blockquote><p>é¦–å…ˆ <code>DOM</code> æ˜¯ä¸€ä¸ªå¤šå‰æ ‘çš„ç»“æ„ï¼Œå¦‚æœéœ€è¦å®Œæ•´çš„å¯¹æ¯”ä¸¤é¢—æ ‘çš„å·®å¼‚ï¼Œé‚£ä¹ˆéœ€è¦çš„æ—¶é—´å¤æ‚åº¦ä¼šæ˜¯ <code>O(n ^ 3)</code>ï¼Œè¿™ä¸ªå¤æ‚åº¦è‚¯å®šæ˜¯ä¸èƒ½æ¥å—çš„ã€‚äºæ˜¯ <code>React</code> å›¢é˜Ÿä¼˜åŒ–äº†ç®—æ³•ï¼Œå®ç°äº† <code>O(n)</code> çš„å¤æ‚åº¦æ¥å¯¹æ¯”å·®å¼‚ã€‚ å®ç° <code>O(n)</code> å¤æ‚åº¦çš„å…³é”®å°±æ˜¯åªå¯¹æ¯”åŒå±‚çš„èŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯è·¨å±‚å¯¹æ¯”ï¼Œè¿™ä¹Ÿæ˜¯è€ƒè™‘åˆ°åœ¨å®é™…ä¸šåŠ¡ä¸­å¾ˆå°‘ä¼šå»è·¨å±‚çš„ç§»åŠ¨ <code>DOM</code> å…ƒç´ ã€‚ æ‰€ä»¥åˆ¤æ–­å·®å¼‚çš„ç®—æ³•å°±åˆ†ä¸ºäº†ä¸¤æ­¥</p></blockquote> <ul><li>é¦–å…ˆä»ä¸Šè‡³ä¸‹ï¼Œä»å·¦å¾€å³éå†å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯æ ‘çš„æ·±åº¦éå†ï¼Œè¿™ä¸€æ­¥ä¸­ä¼šç»™æ¯ä¸ªèŠ‚ç‚¹æ·»åŠ ç´¢å¼•ï¼Œä¾¿äºæœ€åæ¸²æŸ“å·®å¼‚</li> <li>ä¸€æ—¦èŠ‚ç‚¹æœ‰å­å…ƒç´ ï¼Œå°±å»åˆ¤æ–­å­å…ƒç´ æ˜¯å¦æœ‰ä¸åŒ</li></ul> <blockquote><p>åœ¨ç¬¬ä¸€æ­¥ç®—æ³•ä¸­æˆ‘ä»¬éœ€è¦åˆ¤æ–­æ–°æ—§èŠ‚ç‚¹çš„ <code>tagName</code> æ˜¯å¦ç›¸åŒï¼Œå¦‚æœä¸ç›¸åŒçš„è¯å°±ä»£è¡¨èŠ‚ç‚¹è¢«æ›¿æ¢äº†ã€‚å¦‚æœæ²¡æœ‰æ›´æ”¹ <code>tagName</code> çš„è¯ï¼Œå°±éœ€è¦åˆ¤æ–­æ˜¯å¦æœ‰å­å…ƒç´ ï¼Œæœ‰çš„è¯å°±è¿›è¡Œç¬¬äºŒæ­¥ç®—æ³•ã€‚</p></blockquote> <blockquote><p>åœ¨ç¬¬äºŒæ­¥ç®—æ³•ä¸­ï¼Œæˆ‘ä»¬éœ€è¦åˆ¤æ–­åŸæœ¬çš„åˆ—è¡¨ä¸­æ˜¯å¦æœ‰èŠ‚ç‚¹è¢«ç§»é™¤ï¼Œåœ¨æ–°çš„åˆ—è¡¨ä¸­éœ€è¦åˆ¤æ–­æ˜¯å¦æœ‰æ–°çš„èŠ‚ç‚¹åŠ å…¥ï¼Œè¿˜éœ€è¦åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦æœ‰ç§»åŠ¨ã€‚</p></blockquote> <p>ä¸¾ä¸ªä¾‹å­æ¥è¯´ï¼Œå‡è®¾é¡µé¢ä¸­åªæœ‰ä¸€ä¸ªåˆ—è¡¨ï¼Œæˆ‘ä»¬å¯¹åˆ—è¡¨ä¸­çš„å…ƒç´ è¿›è¡Œäº†å˜æ›´</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// å‡è®¾è¿™é‡Œæ¨¡æ‹Ÿä¸€ä¸ª ulï¼Œå…¶ä¸­åŒ…å«äº† 5 ä¸ª li</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>
<span class="token comment">// è¿™é‡Œæ›¿æ¢ä¸Šé¢çš„ li</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>
</code></pre></div><blockquote><p>ä»ä¸Šè¿°ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä¸€çœ¼å°±å¯ä»¥çœ‹å‡ºå…ˆå‰çš„ <code>ul</code> ä¸­çš„ç¬¬ä¸‰ä¸ª<code>li</code>è¢«ç§»é™¤äº†ï¼Œå››äº”æ›¿æ¢äº†ä½ç½®ã€‚</p></blockquote> <blockquote><p>é‚£ä¹ˆåœ¨å®é™…çš„ç®—æ³•ä¸­ï¼Œæˆ‘ä»¬å¦‚ä½•å»è¯†åˆ«æ”¹åŠ¨çš„æ˜¯å“ªä¸ªèŠ‚ç‚¹å‘¢ï¼Ÿè¿™å°±å¼•å…¥äº† <code>key</code> è¿™ä¸ªå±æ€§ï¼Œæƒ³å¿…å¤§å®¶åœ¨ <code>Vue</code> æˆ–è€… <code>React</code> çš„åˆ—è¡¨ä¸­éƒ½ç”¨è¿‡è¿™ä¸ªå±æ€§ã€‚è¿™ä¸ªå±æ€§æ˜¯ç”¨æ¥ç»™æ¯ä¸€ä¸ªèŠ‚ç‚¹æ‰“æ ‡å¿—çš„ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦æ˜¯åŒä¸€ä¸ªèŠ‚ç‚¹ã€‚</p></blockquote> <ul><li>å½“ç„¶åœ¨åˆ¤æ–­ä»¥ä¸Šå·®å¼‚çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åˆ¤æ–­èŠ‚ç‚¹çš„å±æ€§æ˜¯å¦æœ‰å˜åŒ–ç­‰ç­‰ã€‚</li> <li>å½“æˆ‘ä»¬åˆ¤æ–­å‡ºä»¥ä¸Šçš„å·®å¼‚åï¼Œå°±å¯ä»¥æŠŠè¿™äº›å·®å¼‚è®°å½•ä¸‹æ¥ã€‚å½“å¯¹æ¯”å®Œä¸¤æ£µæ ‘ä»¥åï¼Œå°±å¯ä»¥é€šè¿‡å·®å¼‚å»å±€éƒ¨æ›´æ–° <code>DOM</code>ï¼Œå®ç°æ€§èƒ½çš„æœ€ä¼˜åŒ–ã€‚</li></ul> <blockquote><p>å½“ç„¶äº† <code>Virtual DOM</code> æé«˜æ€§èƒ½æ˜¯å…¶ä¸­ä¸€ä¸ªä¼˜åŠ¿ï¼Œå…¶å®æœ€å¤§çš„ä¼˜åŠ¿è¿˜æ˜¯åœ¨äºï¼š</p></blockquote> <ul><li>å°† <code>Virtual DOM</code>ä½œä¸ºä¸€ä¸ªå…¼å®¹å±‚ï¼Œè®©æˆ‘ä»¬è¿˜èƒ½å¯¹æ¥é <code>Web</code> ç«¯çš„ç³»ç»Ÿï¼Œå®ç°è·¨ç«¯å¼€å‘ã€‚</li> <li>åŒæ ·çš„ï¼Œé€šè¿‡ <code>Virtual DOM</code>æˆ‘ä»¬å¯ä»¥æ¸²æŸ“åˆ°å…¶ä»–çš„å¹³å°ï¼Œæ¯”å¦‚å®ç° <code>SSR</code>ã€åŒæ„æ¸²æŸ“ç­‰ç­‰ã€‚</li> <li>å®ç°ç»„ä»¶çš„é«˜åº¦æŠ½è±¡åŒ–</li></ul> <h3 id="_27-3-è·¯ç”±åŸç†"><a href="http://interview.poetries.top/docs/excellent.html#_27-3-%E8%B7%AF%E7%94%B1%E5%8E%9F%E7%90%86" class="header-anchor">#</a> 27.3 è·¯ç”±åŸç†</h3> <blockquote><p>æ¶‰åŠé¢è¯•é¢˜ï¼šå‰ç«¯è·¯ç”±åŸç†ï¼Ÿä¸¤ç§å®ç°æ–¹å¼æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p></blockquote> <blockquote><p>å‰ç«¯è·¯ç”±å®ç°èµ·æ¥å…¶å®å¾ˆç®€å•ï¼Œæœ¬è´¨å°±æ˜¯ç›‘å¬ <code>URL</code> çš„å˜åŒ–ï¼Œç„¶ååŒ¹é…è·¯ç”±è§„åˆ™ï¼Œæ˜¾ç¤ºç›¸åº”çš„é¡µé¢ï¼Œå¹¶ä¸”æ— é¡»åˆ·æ–°é¡µé¢ã€‚ç›®å‰å‰ç«¯ä½¿ç”¨çš„è·¯ç”±å°±åªæœ‰ä¸¤ç§å®ç°æ–¹å¼</p></blockquote> <ul><li><code>Hash</code> æ¨¡å¼</li> <li><code>History</code> æ¨¡å¼</li></ul> <p><strong>1. Hash æ¨¡å¼</strong></p> <blockquote><p><code>www.test.com/#/</code> å°±æ˜¯ <code>Hash URL</code>ï¼Œå½“ <code>#</code> åé¢çš„å“ˆå¸Œå€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå¯ä»¥é€šè¿‡ <code>hashchange</code> äº‹ä»¶æ¥ç›‘å¬åˆ° <code>URL</code> çš„å˜åŒ–ï¼Œä»è€Œè¿›è¡Œè·³è½¬é¡µé¢ï¼Œå¹¶ä¸”æ— è®ºå“ˆå¸Œå€¼å¦‚ä½•å˜åŒ–ï¼ŒæœåŠ¡ç«¯æ¥æ”¶åˆ°çš„ <code>URL</code> è¯·æ±‚æ°¸è¿œæ˜¯ <code>www.test.com</code></p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'hashchange'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ... å…·ä½“é€»è¾‘</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p><code>Hash</code> æ¨¡å¼ç›¸å¯¹æ¥è¯´æ›´ç®€å•ï¼Œå¹¶ä¸”å…¼å®¹æ€§ä¹Ÿæ›´å¥½</p></blockquote> <p><strong>2. History æ¨¡å¼</strong></p> <blockquote><p><code>History</code> æ¨¡å¼æ˜¯ <code>HTML5</code> æ–°æ¨å‡ºçš„åŠŸèƒ½ï¼Œä¸»è¦ä½¿ç”¨ <code>history.pushState</code> å’Œ <code>history.replaceState</code> æ”¹å˜ <code>URL</code></p></blockquote> <ul><li>é€šè¿‡ <code>History</code> æ¨¡å¼æ”¹å˜ <code>URL</code> åŒæ ·ä¸ä¼šå¼•èµ·é¡µé¢çš„åˆ·æ–°ï¼Œåªä¼šæ›´æ–°æµè§ˆå™¨çš„å†å²è®°å½•ã€‚</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// æ–°å¢å†å²è®°å½•</span>
history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span>stateObject<span class="token punctuation">,</span> title<span class="token punctuation">,</span> <span class="token constant">URL</span><span class="token punctuation">)</span>
<span class="token comment">// æ›¿æ¢å½“å‰å†å²è®°å½•</span>
history<span class="token punctuation">.</span><span class="token function">replaceState</span><span class="token punctuation">(</span>stateObject<span class="token punctuation">,</span> title<span class="token punctuation">,</span> <span class="token constant">URL</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>å½“ç”¨æˆ·åšå‡ºæµè§ˆå™¨åŠ¨ä½œæ—¶ï¼Œæ¯”å¦‚ç‚¹å‡»åé€€æŒ‰é’®æ—¶ä¼šè§¦å‘ <code>popState</code> äº‹ä»¶</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'popstate'</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// e.state å°±æ˜¯ pushState(stateObject) ä¸­çš„ stateObject</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>state<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>ä¸¤ç§æ¨¡å¼å¯¹æ¯”</strong></p> <ul><li><code>Hash</code>æ¨¡å¼åªå¯ä»¥æ›´æ”¹ <code>#</code> åé¢çš„å†…å®¹ï¼Œ<code>History</code> æ¨¡å¼å¯ä»¥é€šè¿‡ <code>API</code> è®¾ç½®ä»»æ„çš„åŒæº <code>URL</code></li> <li><code>History</code> æ¨¡å¼å¯ä»¥é€šè¿‡ <code>API</code> æ·»åŠ ä»»æ„ç±»å‹çš„æ•°æ®åˆ°å†å²è®°å½•ä¸­ï¼Œ<code>Hash</code> æ¨¡å¼åªèƒ½æ›´æ”¹å“ˆå¸Œå€¼ï¼Œä¹Ÿå°±æ˜¯å­—ç¬¦ä¸²</li> <li><code>Hash</code> æ¨¡å¼æ— éœ€åç«¯é…ç½®ï¼Œå¹¶ä¸”å…¼å®¹æ€§å¥½ã€‚<code>History</code> æ¨¡å¼åœ¨ç”¨æˆ·æ‰‹åŠ¨è¾“å…¥åœ°å€æˆ–è€…åˆ·æ–°é¡µé¢çš„æ—¶å€™ä¼šå‘èµ· <code>URL</code> è¯·æ±‚ï¼Œåç«¯éœ€è¦é…ç½® <code>index.html</code> é¡µé¢ç”¨äºåŒ¹é…ä¸åˆ°é™æ€èµ„æºçš„æ—¶å€™</li></ul> <h3 id="_27-4-vue-å’Œ-react-ä¹‹é—´çš„åŒºåˆ«"><a href="http://interview.poetries.top/docs/excellent.html#_27-4-vue-%E5%92%8C-react-%E4%B9%8B%E9%97%B4%E7%9A%84%E5%8C%BA%E5%88%AB" class="header-anchor">#</a> 27.4 Vue å’Œ React ä¹‹é—´çš„åŒºåˆ«</h3> <ul><li><code>Vue</code> çš„è¡¨å•å¯ä»¥ä½¿ç”¨ <code>v-model</code> æ”¯æŒåŒå‘ç»‘å®šï¼Œç›¸æ¯”äº <code>React</code> æ¥è¯´å¼€å‘ä¸Šæ›´åŠ æ–¹ä¾¿ï¼Œå½“ç„¶äº† <code>v-model</code> å…¶å®å°±æ˜¯ä¸ªè¯­æ³•ç³–ï¼Œæœ¬è´¨ä¸Šå’Œ <code>React</code> å†™è¡¨å•çš„æ–¹å¼æ²¡ä»€ä¹ˆåŒºåˆ«</li> <li>æ”¹å˜æ•°æ®æ–¹å¼ä¸åŒï¼Œ<code>Vue</code> ä¿®æ”¹çŠ¶æ€ç›¸æ¯”æ¥è¯´è¦ç®€å•è®¸å¤šï¼Œ<code>React</code> éœ€è¦ä½¿ç”¨ <code>setState</code> æ¥æ”¹å˜çŠ¶æ€ï¼Œå¹¶ä¸”ä½¿ç”¨è¿™ä¸ª <code>API</code> ä¹Ÿæœ‰ä¸€äº›å‘ç‚¹ã€‚å¹¶ä¸” <code>Vue</code> çš„åº•å±‚ä½¿ç”¨äº†ä¾èµ–è¿½è¸ªï¼Œé¡µé¢æ›´æ–°æ¸²æŸ“å·²ç»æ˜¯æœ€ä¼˜çš„äº†ï¼Œä½†æ˜¯ <code>React</code> è¿˜æ˜¯éœ€è¦ç”¨æˆ·æ‰‹åŠ¨å»ä¼˜åŒ–è¿™æ–¹é¢çš„é—®é¢˜ã€‚</li> <li><code>React 16</code>ä»¥åï¼Œæœ‰äº›é’©å­å‡½æ•°ä¼šæ‰§è¡Œå¤šæ¬¡ï¼Œè¿™æ˜¯å› ä¸ºå¼•å…¥ <code>Fiber</code> çš„åŸå› </li> <li><code>React</code> éœ€è¦ä½¿ç”¨ <code>JSX</code>ï¼Œæœ‰ä¸€å®šçš„ä¸Šæ‰‹æˆæœ¬ï¼Œå¹¶ä¸”éœ€è¦ä¸€æ•´å¥—çš„å·¥å…·é“¾æ”¯æŒï¼Œä½†æ˜¯å®Œå…¨å¯ä»¥é€šè¿‡ <code>JS</code> æ¥æ§åˆ¶é¡µé¢ï¼Œæ›´åŠ çš„çµæ´»ã€‚<code>Vue</code> ä½¿ç”¨äº†æ¨¡æ¿è¯­æ³•ï¼Œç›¸æ¯”äº <code>JSX</code> æ¥è¯´æ²¡æœ‰é‚£ä¹ˆçµæ´»ï¼Œä½†æ˜¯å®Œå…¨å¯ä»¥è„±ç¦»å·¥å…·é“¾ï¼Œé€šè¿‡ç›´æ¥ç¼–å†™ <code>render</code> å‡½æ•°å°±èƒ½åœ¨æµè§ˆå™¨ä¸­è¿è¡Œã€‚</li> <li>åœ¨ç”Ÿæ€ä¸Šæ¥è¯´ï¼Œä¸¤è€…å…¶å®æ²¡å¤šå¤§çš„å·®è·ï¼Œå½“ç„¶ <code>React</code>çš„ç”¨æˆ·æ˜¯è¿œè¿œé«˜äº<code>Vue</code> çš„</li></ul> <h2 id="_28-vueå¸¸è€ƒçŸ¥è¯†ç‚¹"><a href="http://interview.poetries.top/docs/excellent.html#_28-vue%E5%B8%B8%E8%80%83%E7%9F%A5%E8%AF%86%E7%82%B9" class="header-anchor">#</a> 28 Vueå¸¸è€ƒçŸ¥è¯†ç‚¹</h2> <h3 id="_28-1-ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°"><a href="http://interview.poetries.top/docs/excellent.html#_28-1-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E9%92%A9%E5%AD%90%E5%87%BD%E6%95%B0" class="header-anchor">#</a> 28.1 ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°</h3> <ul><li>åœ¨ <code>beforeCreate</code> é’©å­å‡½æ•°è°ƒç”¨çš„æ—¶å€™ï¼Œæ˜¯è·å–ä¸åˆ° <code>props</code> æˆ–è€… <code>data</code> ä¸­çš„æ•°æ®çš„ï¼Œå› ä¸ºè¿™äº›æ•°æ®çš„åˆå§‹åŒ–éƒ½åœ¨ <code>initState</code> ä¸­ã€‚</li> <li>ç„¶åä¼šæ‰§è¡Œ <code>created</code> é’©å­å‡½æ•°ï¼Œåœ¨è¿™ä¸€æ­¥çš„æ—¶å€™å·²ç»å¯ä»¥è®¿é—®åˆ°ä¹‹å‰ä¸èƒ½è®¿é—®åˆ°çš„æ•°æ®ï¼Œä½†æ˜¯è¿™æ—¶å€™ç»„ä»¶è¿˜æ²¡è¢«æŒ‚è½½ï¼Œæ‰€ä»¥æ˜¯çœ‹ä¸åˆ°çš„ã€‚</li> <li>æ¥ä¸‹æ¥ä¼šå…ˆæ‰§è¡Œ <code>beforeMount</code> é’©å­å‡½æ•°ï¼Œå¼€å§‹åˆ›å»º <code>VDOM</code>ï¼Œæœ€åæ‰§è¡Œ <code>mounted</code> é’©å­ï¼Œå¹¶å°† <code>VDOM</code>æ¸²æŸ“ä¸ºçœŸå® <code>DOM</code> å¹¶ä¸”æ¸²æŸ“æ•°æ®ã€‚ç»„ä»¶ä¸­å¦‚æœæœ‰å­ç»„ä»¶çš„è¯ï¼Œä¼šé€’å½’æŒ‚è½½å­ç»„ä»¶ï¼Œåªæœ‰å½“æ‰€æœ‰å­ç»„ä»¶å…¨éƒ¨æŒ‚è½½å®Œæ¯•ï¼Œæ‰ä¼šæ‰§è¡Œæ ¹ç»„ä»¶çš„æŒ‚è½½é’©å­ã€‚</li> <li>æ¥ä¸‹æ¥æ˜¯æ•°æ®æ›´æ–°æ—¶ä¼šè°ƒç”¨çš„é’©å­å‡½æ•° <code>beforeUpdate</code> å’Œ <code>updated</code>ï¼Œè¿™ä¸¤ä¸ªé’©å­å‡½æ•°æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œå°±æ˜¯åˆ†åˆ«åœ¨æ•°æ®æ›´æ–°å‰å’Œæ›´æ–°åä¼šè°ƒç”¨ã€‚</li> <li>å¦å¤–è¿˜æœ‰ <code>keep-alive</code> ç‹¬æœ‰çš„ç”Ÿå‘½å‘¨æœŸï¼Œåˆ†åˆ«ä¸º <code>activated</code> å’Œ <code>deactivated</code>ã€‚ç”¨ <code>keep-alive</code> åŒ…è£¹çš„ç»„ä»¶åœ¨åˆ‡æ¢æ—¶ä¸ä¼šè¿›è¡Œé”€æ¯ï¼Œè€Œæ˜¯ç¼“å­˜åˆ°å†…å­˜ä¸­å¹¶æ‰§è¡Œ <code>deactivated</code> é’©å­å‡½æ•°ï¼Œå‘½ä¸­ç¼“å­˜æ¸²æŸ“åä¼šæ‰§è¡Œ <code>actived</code> é’©å­å‡½æ•°ã€‚</li> <li>æœ€åå°±æ˜¯é”€æ¯ç»„ä»¶çš„é’©å­å‡½æ•° <code>beforeDestroy</code> å’Œ <code>destroyed</code>ã€‚å‰è€…é€‚åˆç§»é™¤äº‹ä»¶ã€å®šæ—¶å™¨ç­‰ç­‰ï¼Œå¦åˆ™å¯èƒ½ä¼šå¼•èµ·å†…å­˜æ³„éœ²çš„é—®é¢˜ã€‚ç„¶åè¿›è¡Œä¸€ç³»åˆ—çš„é”€æ¯æ“ä½œï¼Œå¦‚æœæœ‰å­ç»„ä»¶çš„è¯ï¼Œä¹Ÿä¼šé€’å½’é”€æ¯å­ç»„ä»¶ï¼Œæ‰€æœ‰å­ç»„ä»¶éƒ½é”€æ¯å®Œæ¯•åæ‰ä¼šæ‰§è¡Œæ ¹ç»„ä»¶çš„ <code>destroyed</code> é’©å­å‡½æ•°</li></ul> <h3 id="_28-2-ç»„ä»¶é€šä¿¡"><a href="http://interview.poetries.top/docs/excellent.html#_28-2-%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1" class="header-anchor">#</a> 28.2 ç»„ä»¶é€šä¿¡</h3> <blockquote><p>ç»„ä»¶é€šä¿¡ä¸€èˆ¬åˆ†ä¸ºä»¥ä¸‹å‡ ç§æƒ…å†µï¼š</p></blockquote> <ul><li>çˆ¶å­ç»„ä»¶é€šä¿¡</li> <li>å…„å¼Ÿç»„ä»¶é€šä¿¡</li> <li>è·¨å¤šå±‚çº§ç»„ä»¶é€šä¿¡</li></ul> <blockquote><p>å¯¹äºä»¥ä¸Šæ¯ç§æƒ…å†µéƒ½æœ‰å¤šç§æ–¹å¼å»å®ç°ï¼Œæ¥ä¸‹æ¥å°±æ¥å­¦ä¹ ä¸‹å¦‚ä½•å®ç°ã€‚</p></blockquote> <p><strong>1. çˆ¶å­é€šä¿¡</strong></p> <ul><li>çˆ¶ç»„ä»¶é€šè¿‡ <code>props</code> ä¼ é€’æ•°æ®ç»™å­ç»„ä»¶ï¼Œå­ç»„ä»¶é€šè¿‡ <code>emit</code> å‘é€äº‹ä»¶ä¼ é€’æ•°æ®ç»™çˆ¶ç»„ä»¶ï¼Œè¿™ä¸¤ç§æ–¹å¼æ˜¯æœ€å¸¸ç”¨çš„çˆ¶å­é€šä¿¡å®ç°åŠæ³•ã€‚</li> <li>è¿™ç§çˆ¶å­é€šä¿¡æ–¹å¼ä¹Ÿå°±æ˜¯å…¸å‹çš„å•å‘æ•°æ®æµï¼Œçˆ¶ç»„ä»¶é€šè¿‡ <code>props</code> ä¼ é€’æ•°æ®ï¼Œå­ç»„ä»¶ä¸èƒ½ç›´æ¥ä¿®æ”¹ <code>props</code>ï¼Œè€Œæ˜¯å¿…é¡»é€šè¿‡å‘é€äº‹ä»¶çš„æ–¹å¼å‘ŠçŸ¥çˆ¶ç»„ä»¶ä¿®æ”¹æ•°æ®ã€‚</li> <li>å¦å¤–è¿™ä¸¤ç§æ–¹å¼è¿˜å¯ä»¥ä½¿ç”¨è¯­æ³•ç³– <code>v-model</code> æ¥ç›´æ¥å®ç°ï¼Œå› ä¸º <code>v-model</code> é»˜è®¤ä¼šè§£ææˆåä¸º <code>value</code> çš„ <code>prop</code> å’Œåä¸º <code>input</code> çš„äº‹ä»¶ã€‚è¿™ç§è¯­æ³•ç³–çš„æ–¹å¼æ˜¯å…¸å‹çš„åŒå‘ç»‘å®šï¼Œå¸¸ç”¨äº <code>UI</code> æ§ä»¶ä¸Šï¼Œä½†æ˜¯ç©¶å…¶æ ¹æœ¬ï¼Œè¿˜æ˜¯é€šè¿‡äº‹ä»¶çš„æ–¹æ³•è®©çˆ¶ç»„ä»¶ä¿®æ”¹æ•°æ®ã€‚</li> <li>å½“ç„¶æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡è®¿é—® <code>$parent</code> æˆ–è€… <code>$children</code> å¯¹è±¡æ¥è®¿é—®ç»„ä»¶å®ä¾‹ä¸­çš„æ–¹æ³•å’Œæ•°æ®ã€‚</li> <li>å¦å¤–å¦‚æœä½ ä½¿ç”¨ Vue 2.3 åŠä»¥ä¸Šç‰ˆæœ¬çš„è¯è¿˜å¯ä»¥ä½¿ç”¨ <code>$listeners</code> å’Œ <code>.sync</code> è¿™ä¸¤ä¸ªå±æ€§ã€‚</li> <li><code>$listeners</code> å±æ€§ä¼šå°†çˆ¶ç»„ä»¶ä¸­çš„ (ä¸å« <code>.native</code> ä¿®é¥°å™¨çš„) <code>v-on</code> äº‹ä»¶ç›‘å¬å™¨ä¼ é€’ç»™å­ç»„ä»¶ï¼Œå­ç»„ä»¶å¯ä»¥é€šè¿‡è®¿é—® <code>$listeners</code> æ¥è‡ªå®šä¹‰ç›‘å¬å™¨ã€‚</li> <li><code>.sync</code> å±æ€§æ˜¯ä¸ªè¯­æ³•ç³–ï¼Œå¯ä»¥å¾ˆç®€å•çš„å®ç°å­ç»„ä»¶ä¸çˆ¶ç»„ä»¶é€šä¿¡</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!--çˆ¶ç»„ä»¶ä¸­--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">:value.sync</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>value<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token comment">&lt;!--ä»¥ä¸Šå†™æ³•ç­‰åŒäº--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">:value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>value<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">@update:</span>value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>v =&gt; value = v<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>comp</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--å­ç»„ä»¶ä¸­--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'update:value'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>2. å…„å¼Ÿç»„ä»¶é€šä¿¡</strong></p> <blockquote><p>å¯¹äºè¿™ç§æƒ…å†µå¯ä»¥é€šè¿‡æŸ¥æ‰¾çˆ¶ç»„ä»¶ä¸­çš„å­ç»„ä»¶å®ç°ï¼Œä¹Ÿå°±æ˜¯ <code>this.$parent.$children</code>ï¼Œåœ¨ <code>$children</code> ä¸­å¯ä»¥é€šè¿‡ç»„ä»¶ <code>name</code> æŸ¥è¯¢åˆ°éœ€è¦çš„ç»„ä»¶å®ä¾‹ï¼Œç„¶åè¿›è¡Œé€šä¿¡ã€‚</p></blockquote> <p><strong>3. è·¨å¤šå±‚æ¬¡ç»„ä»¶é€šä¿¡</strong></p> <blockquote><p>å¯¹äºè¿™ç§æƒ…å†µå¯ä»¥ä½¿ç”¨ <code>Vue 2.2</code> æ–°å¢çš„ <code>API provide / inject</code>ï¼Œè™½ç„¶æ–‡æ¡£ä¸­ä¸æ¨èç›´æ¥ä½¿ç”¨åœ¨ä¸šåŠ¡ä¸­ï¼Œä½†æ˜¯å¦‚æœç”¨å¾—å¥½çš„è¯è¿˜æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚</p></blockquote> <p>å‡è®¾æœ‰çˆ¶ç»„ä»¶ <code>A</code>ï¼Œç„¶åæœ‰ä¸€ä¸ªè·¨å¤šå±‚çº§çš„å­ç»„ä»¶ <code>B</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// çˆ¶ç»„ä»¶ A</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  provide<span class="token operator">:</span> <span class="token punctuation">{</span>
    data<span class="token operator">:</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// å­ç»„ä»¶ B</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  inject<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ— è®ºè·¨å‡ å±‚éƒ½èƒ½è·å¾—çˆ¶ç»„ä»¶çš„ data å±æ€§</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token comment">// =&gt; 1</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>ç»ˆæåŠæ³•è§£å†³ä¸€åˆ‡é€šä¿¡é—®é¢˜</strong></p> <blockquote><p>åªè¦ä½ ä¸æ€•éº»çƒ¦ï¼Œå¯ä»¥ä½¿ç”¨ <code>Vuex</code> æˆ–è€… <code>Event Bus</code> è§£å†³ä¸Šè¿°æ‰€æœ‰çš„é€šä¿¡æƒ…å†µã€‚</p></blockquote> <h3 id="_28-3-extend-èƒ½åšä»€ä¹ˆ"><a href="http://interview.poetries.top/docs/excellent.html#_28-3-extend-%E8%83%BD%E5%81%9A%E4%BB%80%E4%B9%88" class="header-anchor">#</a> 28.3 extend èƒ½åšä»€ä¹ˆ</h3> <blockquote><p>è¿™ä¸ª <code>API</code> å¾ˆå°‘ç”¨åˆ°ï¼Œä½œç”¨æ˜¯æ‰©å±•ç»„ä»¶ç”Ÿæˆä¸€ä¸ªæ„é€ å™¨ï¼Œé€šå¸¸ä¼šä¸ <code>$mount</code> ä¸€èµ·ä½¿ç”¨ã€‚</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// åˆ›å»ºç»„ä»¶æ„é€ å™¨</span>
<span class="token keyword">let</span> Component <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  template<span class="token operator">:</span> <span class="token string">'&lt;div&gt;test&lt;/div&gt;'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// æŒ‚è½½åˆ° #app ä¸Š</span>
<span class="token keyword">new</span> <span class="token class-name">Component</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
<span class="token comment">// é™¤äº†ä¸Šé¢çš„æ–¹å¼ï¼Œè¿˜å¯ä»¥ç”¨æ¥æ‰©å±•å·²æœ‰çš„ç»„ä»¶</span>
<span class="token keyword">let</span> SuperComponent <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span>Component<span class="token punctuation">)</span>
<span class="token keyword">new</span> <span class="token class-name">SuperComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">new</span> <span class="token class-name">SuperComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_28-4-mixin-å’Œ-mixins-åŒºåˆ«"><a href="http://interview.poetries.top/docs/excellent.html#_28-4-mixin-%E5%92%8C-mixins-%E5%8C%BA%E5%88%AB" class="header-anchor">#</a> 28.4 mixin å’Œ mixins åŒºåˆ«</h3> <blockquote><p><code>mixin</code> ç”¨äºå…¨å±€æ··å…¥ï¼Œä¼šå½±å“åˆ°æ¯ä¸ªç»„ä»¶å®ä¾‹ï¼Œé€šå¸¸æ’ä»¶éƒ½æ˜¯è¿™æ ·åšåˆå§‹åŒ–çš„</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>Vue<span class="token punctuation">.</span><span class="token function">mixin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function">beforeCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...é€»è¾‘</span>
        <span class="token comment">// è¿™ç§æ–¹å¼ä¼šå½±å“åˆ°æ¯ä¸ªç»„ä»¶çš„ beforeCreate é’©å­å‡½æ•°</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>è™½ç„¶æ–‡æ¡£ä¸å»ºè®®æˆ‘ä»¬åœ¨åº”ç”¨ä¸­ç›´æ¥ä½¿ç”¨ <code>mixin</code>ï¼Œä½†æ˜¯å¦‚æœä¸æ»¥ç”¨çš„è¯ä¹Ÿæ˜¯å¾ˆæœ‰å¸®åŠ©çš„ï¼Œæ¯”å¦‚å¯ä»¥å…¨å±€æ··å…¥å°è£…å¥½çš„ <code>ajax</code> æˆ–è€…ä¸€äº›å·¥å…·å‡½æ•°ç­‰ç­‰ã€‚</li> <li><code>mixins</code> åº”è¯¥æ˜¯æˆ‘ä»¬æœ€å¸¸ä½¿ç”¨çš„æ‰©å±•ç»„ä»¶çš„æ–¹å¼äº†ã€‚å¦‚æœå¤šä¸ªç»„ä»¶ä¸­æœ‰ç›¸åŒçš„ä¸šåŠ¡é€»è¾‘ï¼Œå°±å¯ä»¥å°†è¿™äº›é€»è¾‘å‰¥ç¦»å‡ºæ¥ï¼Œé€šè¿‡ <code>mixins</code> æ··å…¥ä»£ç ï¼Œæ¯”å¦‚ä¸Šæ‹‰ä¸‹æ‹‰åŠ è½½æ•°æ®è¿™ç§é€»è¾‘ç­‰ç­‰ã€‚</li> <li>å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ <code>mixins</code> æ··å…¥çš„é’©å­å‡½æ•°ä¼šå…ˆäºç»„ä»¶å†…çš„é’©å­å‡½æ•°æ‰§è¡Œï¼Œå¹¶ä¸”åœ¨é‡åˆ°åŒåé€‰é¡¹çš„æ—¶å€™ä¹Ÿä¼šæœ‰é€‰æ‹©æ€§çš„è¿›è¡Œåˆå¹¶ï¼Œå…·ä½“å¯ä»¥é˜…è¯» æ–‡æ¡£ã€‚</li></ul> <h3 id="_28-5-computed-å’Œ-watch-åŒºåˆ«"><a href="http://interview.poetries.top/docs/excellent.html#_28-5-computed-%E5%92%8C-watch-%E5%8C%BA%E5%88%AB" class="header-anchor">#</a> 28.5 computed å’Œ watch åŒºåˆ«</h3> <ul><li><code>computed</code> æ˜¯è®¡ç®—å±æ€§ï¼Œä¾èµ–å…¶ä»–å±æ€§è®¡ç®—å€¼ï¼Œå¹¶ä¸” <code>computed</code> çš„å€¼æœ‰ç¼“å­˜ï¼Œåªæœ‰å½“è®¡ç®—å€¼å˜åŒ–æ‰ä¼šè¿”å›å†…å®¹ã€‚</li> <li><code>watch</code> ç›‘å¬åˆ°å€¼çš„å˜åŒ–å°±ä¼šæ‰§è¡Œå›è°ƒï¼Œåœ¨å›è°ƒä¸­å¯ä»¥è¿›è¡Œä¸€äº›é€»è¾‘æ“ä½œã€‚</li> <li>æ‰€ä»¥ä¸€èˆ¬æ¥è¯´éœ€è¦ä¾èµ–åˆ«çš„å±æ€§æ¥åŠ¨æ€è·å¾—å€¼çš„æ—¶å€™å¯ä»¥ä½¿ç”¨ <code>computed</code>ï¼Œå¯¹äºç›‘å¬åˆ°å€¼çš„å˜åŒ–éœ€è¦åšä¸€äº›å¤æ‚ä¸šåŠ¡é€»è¾‘çš„æƒ…å†µå¯ä»¥ä½¿ç”¨ <code>watch</code>ã€‚</li> <li>å¦å¤– <code>computer</code> å’Œ <code>watch</code> è¿˜éƒ½æ”¯æŒå¯¹è±¡çš„å†™æ³•ï¼Œè¿™ç§æ–¹å¼çŸ¥é“çš„äººå¹¶ä¸å¤šã€‚</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>vm<span class="token punctuation">.</span><span class="token function">$watch</span><span class="token punctuation">(</span><span class="token string">'obj'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ·±åº¦éå†</span>
    deep<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token comment">// ç«‹å³è§¦å‘</span>
    immediate<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token comment">// æ‰§è¡Œçš„å‡½æ•°</span>
    <span class="token function-variable function">handler</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">val<span class="token punctuation">,</span> oldVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  data<span class="token operator">:</span> <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  computed<span class="token operator">:</span> <span class="token punctuation">{</span>
    aPlus<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// this.aPlus æ—¶è§¦å‘</span>
      <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">+</span> <span class="token number">1</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// this.aPlus = 1 æ—¶è§¦å‘</span>
      <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">=</span> v <span class="token operator">-</span> <span class="token number">1</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_28-6-keep-alive-ç»„ä»¶æœ‰ä»€ä¹ˆä½œç”¨"><a href="http://interview.poetries.top/docs/excellent.html#_28-6-keep-alive-%E7%BB%84%E4%BB%B6%E6%9C%89%E4%BB%80%E4%B9%88%E4%BD%9C%E7%94%A8" class="header-anchor">#</a> 28.6 keep-alive ç»„ä»¶æœ‰ä»€ä¹ˆä½œç”¨</h3> <ul><li>å¦‚æœä½ éœ€è¦åœ¨ç»„ä»¶åˆ‡æ¢çš„æ—¶å€™ï¼Œä¿å­˜ä¸€äº›ç»„ä»¶çš„çŠ¶æ€é˜²æ­¢å¤šæ¬¡æ¸²æŸ“ï¼Œå°±å¯ä»¥ä½¿ç”¨ <code>keep-alive</code> ç»„ä»¶åŒ…è£¹éœ€è¦ä¿å­˜çš„ç»„ä»¶ã€‚</li> <li>å¯¹äº <code>keep-alive</code> ç»„ä»¶æ¥è¯´ï¼Œå®ƒæ‹¥æœ‰ä¸¤ä¸ªç‹¬æœ‰çš„ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ï¼Œåˆ†åˆ«ä¸º <code>activated</code> å’Œ <code>deactivated</code> ã€‚ç”¨ <code>keep-alive</code> åŒ…è£¹çš„ç»„ä»¶åœ¨åˆ‡æ¢æ—¶ä¸ä¼šè¿›è¡Œé”€æ¯ï¼Œè€Œæ˜¯ç¼“å­˜åˆ°å†…å­˜ä¸­å¹¶æ‰§è¡Œ <code>deactivated</code> é’©å­å‡½æ•°ï¼Œå‘½ä¸­ç¼“å­˜æ¸²æŸ“åä¼šæ‰§è¡Œ <code>actived</code> é’©å­å‡½æ•°ã€‚</li></ul> <h3 id="_28-7-v-show-ä¸-v-if-åŒºåˆ«"><a href="http://interview.poetries.top/docs/excellent.html#_28-7-v-show-%E4%B8%8E-v-if-%E5%8C%BA%E5%88%AB" class="header-anchor">#</a> 28.7 v-show ä¸ v-if åŒºåˆ«</h3> <ul><li><code>v-show</code> åªæ˜¯åœ¨ <code>display: none</code> å’Œ <code>display: block</code> ä¹‹é—´åˆ‡æ¢ã€‚æ— è®ºåˆå§‹æ¡ä»¶æ˜¯ä»€ä¹ˆéƒ½ä¼šè¢«æ¸²æŸ“å‡ºæ¥ï¼Œåé¢åªéœ€è¦åˆ‡æ¢ <code>CSS</code>ï¼Œ<code>DOM</code> è¿˜æ˜¯ä¸€ç›´ä¿ç•™ç€çš„ã€‚æ‰€ä»¥æ€»çš„æ¥è¯´ <code>v-show</code> åœ¨åˆå§‹æ¸²æŸ“æ—¶æœ‰æ›´é«˜çš„å¼€é”€ï¼Œä½†æ˜¯åˆ‡æ¢å¼€é”€å¾ˆå°ï¼Œæ›´é€‚åˆäºé¢‘ç¹åˆ‡æ¢çš„åœºæ™¯ã€‚</li> <li><code>v-if</code> çš„è¯å°±å¾—è¯´åˆ° <code>Vue</code> åº•å±‚çš„ç¼–è¯‘äº†ã€‚å½“å±æ€§åˆå§‹ä¸º <code>false</code> æ—¶ï¼Œç»„ä»¶å°±ä¸ä¼šè¢«æ¸²æŸ“ï¼Œç›´åˆ°æ¡ä»¶ä¸º <code>true</code>ï¼Œå¹¶ä¸”åˆ‡æ¢æ¡ä»¶æ—¶ä¼šè§¦å‘é”€æ¯/æŒ‚è½½ç»„ä»¶ï¼Œæ‰€ä»¥æ€»çš„æ¥è¯´åœ¨åˆ‡æ¢æ—¶å¼€é”€æ›´é«˜ï¼Œæ›´é€‚åˆä¸ç»å¸¸åˆ‡æ¢çš„åœºæ™¯ã€‚</li> <li>å¹¶ä¸”åŸºäº <code>v-if</code> çš„è¿™ç§æƒ°æ€§æ¸²æŸ“æœºåˆ¶ï¼Œå¯ä»¥åœ¨å¿…è¦çš„æ—¶å€™æ‰å»æ¸²æŸ“ç»„ä»¶ï¼Œå‡å°‘æ•´ä¸ªé¡µé¢çš„åˆå§‹æ¸²æŸ“å¼€é”€ã€‚</li></ul> <h3 id="_28-8-ç»„ä»¶ä¸­-data-ä»€ä¹ˆæ—¶å€™å¯ä»¥ä½¿ç”¨å¯¹è±¡"><a href="http://interview.poetries.top/docs/excellent.html#_28-8-%E7%BB%84%E4%BB%B6%E4%B8%AD-data-%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E5%AF%B9%E8%B1%A1" class="header-anchor">#</a> 28.8 ç»„ä»¶ä¸­ data ä»€ä¹ˆæ—¶å€™å¯ä»¥ä½¿ç”¨å¯¹è±¡</h3> <blockquote><p>è¿™é“é¢˜ç›®å…¶å®æ›´å¤šè€ƒçš„æ˜¯ JS åŠŸåº•ã€‚</p></blockquote> <ul><li>ç»„ä»¶å¤ç”¨æ—¶æ‰€æœ‰ç»„ä»¶å®ä¾‹éƒ½ä¼šå…±äº« <code>data</code>ï¼Œå¦‚æœ <code>data</code> æ˜¯å¯¹è±¡çš„è¯ï¼Œå°±ä¼šé€ æˆä¸€ä¸ªç»„ä»¶ä¿®æ”¹ <code>data</code> ä»¥åä¼šå½±å“åˆ°å…¶ä»–æ‰€æœ‰ç»„ä»¶ï¼Œæ‰€ä»¥éœ€è¦å°† <code>data</code> å†™æˆå‡½æ•°ï¼Œæ¯æ¬¡ç”¨åˆ°å°±è°ƒç”¨ä¸€æ¬¡å‡½æ•°è·å¾—æ–°çš„æ•°æ®ã€‚</li> <li>å½“æˆ‘ä»¬ä½¿ç”¨ <code>new Vue()</code> çš„æ–¹å¼çš„æ—¶å€™ï¼Œæ— è®ºæˆ‘ä»¬å°† <code>data</code> è®¾ç½®ä¸ºå¯¹è±¡è¿˜æ˜¯å‡½æ•°éƒ½æ˜¯å¯ä»¥çš„ï¼Œå› ä¸º <code>new Vue()</code> çš„æ–¹å¼æ˜¯ç”Ÿæˆä¸€ä¸ªæ ¹ç»„ä»¶ï¼Œè¯¥ç»„ä»¶ä¸ä¼šå¤ç”¨ï¼Œä¹Ÿå°±ä¸å­˜åœ¨å…±äº« <code>data</code> çš„æƒ…å†µäº†</li></ul> <blockquote><p>ä»¥ä¸‹æ˜¯è¿›é˜¶éƒ¨åˆ†</p></blockquote> <h3 id="_28-9-å“åº”å¼åŸç†"><a href="http://interview.poetries.top/docs/excellent.html#_28-9-%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86" class="header-anchor">#</a> 28.9 å“åº”å¼åŸç†</h3> <blockquote><p><code>Vue</code> å†…éƒ¨ä½¿ç”¨äº† <code>Object.defineProperty()</code> æ¥å®ç°æ•°æ®å“åº”å¼ï¼Œé€šè¿‡è¿™ä¸ªå‡½æ•°å¯ä»¥ç›‘å¬åˆ° <code>set</code> å’Œ <code>get</code> çš„äº‹ä»¶</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'poetries'</span> <span class="token punctuation">}</span>
<span class="token function">observe</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token keyword">let</span> name <span class="token operator">=</span> data<span class="token punctuation">.</span>name <span class="token comment">// -&gt; get value</span>
data<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'yyy'</span> <span class="token comment">// -&gt; change value</span>

<span class="token keyword">function</span> <span class="token function">observe</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// åˆ¤æ–­ç±»å‹</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>obj <span class="token operator">||</span> <span class="token keyword">typeof</span> obj <span class="token operator">!==</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">defineReactive</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">defineReactive</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// é€’å½’å­å±æ€§</span>
  <span class="token function">observe</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¯æšä¸¾</span>
    enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token comment">// å¯é…ç½®</span>
    configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token comment">// è‡ªå®šä¹‰å‡½æ•°</span>
    <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">reactiveGetter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'get value'</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> val
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">reactiveSetter</span><span class="token punctuation">(</span><span class="token parameter">newVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'change value'</span><span class="token punctuation">)</span>
      val <span class="token operator">=</span> newVal
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>ä»¥ä¸Šä»£ç ç®€å•çš„å®ç°äº†å¦‚ä½•ç›‘å¬æ•°æ®çš„ <code>set</code> å’Œ <code>get</code> çš„äº‹ä»¶ï¼Œä½†æ˜¯ä»…ä»…å¦‚æ­¤æ˜¯ä¸å¤Ÿçš„ï¼Œå› ä¸ºè‡ªå®šä¹‰çš„å‡½æ•°ä¸€å¼€å§‹æ˜¯ä¸ä¼šæ‰§è¡Œçš„ã€‚åªæœ‰å…ˆæ‰§è¡Œäº†ä¾èµ–æ”¶é›†ï¼Œä»èƒ½åœ¨å±æ€§æ›´æ–°çš„æ—¶å€™æ´¾å‘æ›´æ–°ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å…ˆè§¦å‘ä¾èµ–æ”¶é›†</p></blockquote> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    {{name}}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>åœ¨è§£æå¦‚ä¸Šæ¨¡æ¿ä»£ç æ—¶ï¼Œé‡åˆ° <code>{name}</code> å°±ä¼šè¿›è¡Œä¾èµ–æ”¶é›†ã€‚</li> <li>æ¥ä¸‹æ¥æˆ‘ä»¬å…ˆæ¥å®ç°ä¸€ä¸ª <code>Dep</code> ç±»ï¼Œç”¨äºè§£è€¦å±æ€§çš„ä¾èµ–æ”¶é›†å’Œæ´¾å‘æ›´æ–°æ“ä½œ</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// é€šè¿‡ Dep è§£è€¦å±æ€§çš„ä¾èµ–å’Œæ›´æ–°æ“ä½œ</span>
<span class="token keyword">class</span> <span class="token class-name">Dep</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// æ·»åŠ ä¾èµ–</span>
  <span class="token function">addSub</span><span class="token punctuation">(</span><span class="token parameter">sub</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>sub<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// æ›´æ–°</span>
  <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">sub</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      sub<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// å…¨å±€å±æ€§ï¼Œé€šè¿‡è¯¥å±æ€§é…ç½® Watcher</span>
Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> <span class="token keyword">null</span>
</code></pre></div><blockquote><p>ä»¥ä¸Šçš„ä»£ç å®ç°å¾ˆç®€å•ï¼Œå½“éœ€è¦ä¾èµ–æ”¶é›†çš„æ—¶å€™è°ƒç”¨ <code>addSub</code>ï¼Œå½“éœ€è¦æ´¾å‘æ›´æ–°çš„æ—¶å€™è°ƒç”¨ <code>notify</code>ã€‚</p></blockquote> <blockquote><p>æ¥ä¸‹æ¥æˆ‘ä»¬å…ˆæ¥ç®€å•çš„äº†è§£ä¸‹ <code>Vue</code>ç»„ä»¶æŒ‚è½½æ—¶æ·»åŠ å“åº”å¼çš„è¿‡ç¨‹ã€‚åœ¨ç»„ä»¶æŒ‚è½½æ—¶ï¼Œä¼šå…ˆå¯¹æ‰€æœ‰éœ€è¦çš„å±æ€§è°ƒç”¨ <code>Object.defineProperty()</code>ï¼Œç„¶åå®ä¾‹åŒ– <code>Watcher</code>ï¼Œä¼ å…¥ç»„ä»¶æ›´æ–°çš„å›è°ƒã€‚åœ¨å®ä¾‹åŒ–è¿‡ç¨‹ä¸­ï¼Œä¼šå¯¹æ¨¡æ¿ä¸­çš„å±æ€§è¿›è¡Œæ±‚å€¼ï¼Œè§¦å‘ä¾èµ–æ”¶é›†ã€‚</p></blockquote> <p>å› ä¸ºè¿™ä¸€å°èŠ‚ä¸»è¦ç›®çš„æ˜¯å­¦ä¹ å“åº”å¼åŸç†çš„ç»†èŠ‚ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥çš„ä»£ç ä¼šç®€ç•¥çš„è¡¨è¾¾è§¦å‘ä¾èµ–æ”¶é›†æ—¶çš„æ“ä½œã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Watcher</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å°† Dep.target æŒ‡å‘è‡ªå·±</span>
    <span class="token comment">// ç„¶åè§¦å‘å±æ€§çš„ getter æ·»åŠ ç›‘å¬</span>
    <span class="token comment">// æœ€åå°† Dep.target ç½®ç©º</span>
    Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>cb <span class="token operator">=</span> cb
    <span class="token keyword">this</span><span class="token punctuation">.</span>obj <span class="token operator">=</span> obj
    <span class="token keyword">this</span><span class="token punctuation">.</span>key <span class="token operator">=</span> key
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
    Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span>
  <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// è·å¾—æ–°å€¼</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>obj<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>key<span class="token punctuation">]</span>
    <span class="token comment">// è°ƒç”¨ update æ–¹æ³•æ›´æ–° Dom</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>ä»¥ä¸Šå°±æ˜¯ <code>Watcher</code>çš„ç®€å•å®ç°ï¼Œåœ¨æ‰§è¡Œæ„é€ å‡½æ•°çš„æ—¶å€™å°† <code>Dep.target</code>æŒ‡å‘è‡ªèº«ï¼Œä»è€Œä½¿å¾—æ”¶é›†åˆ°äº†å¯¹åº”çš„ <code>Watcher</code>ï¼Œåœ¨æ´¾å‘æ›´æ–°çš„æ—¶å€™å–å‡ºå¯¹åº”çš„ <code>Watcher</code> ç„¶åæ‰§è¡Œ <code>update</code> å‡½æ•°ã€‚</p></blockquote> <p>æ¥ä¸‹æ¥ï¼Œéœ€è¦å¯¹<code>defineReactive</code> å‡½æ•°è¿›è¡Œæ”¹é€ ï¼Œåœ¨è‡ªå®šä¹‰å‡½æ•°ä¸­æ·»åŠ ä¾èµ–æ”¶é›†å’Œæ´¾å‘æ›´æ–°ç›¸å…³çš„ä»£ç </p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">defineReactive</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// é€’å½’å­å±æ€§</span>
  <span class="token function">observe</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
  <span class="token keyword">let</span> dp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">reactiveGetter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'get value'</span><span class="token punctuation">)</span>
      <span class="token comment">// å°† Watcher æ·»åŠ åˆ°è®¢é˜…</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        dp<span class="token punctuation">.</span><span class="token function">addSub</span><span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> val
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">reactiveSetter</span><span class="token punctuation">(</span><span class="token parameter">newVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'change value'</span><span class="token punctuation">)</span>
      val <span class="token operator">=</span> newVal
      <span class="token comment">// æ‰§è¡Œ watcher çš„ update æ–¹æ³•</span>
      dp<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>ä»¥ä¸Šæ‰€æœ‰ä»£ç å®ç°äº†ä¸€ä¸ªç®€æ˜“çš„æ•°æ®å“åº”å¼ï¼Œæ ¸å¿ƒæ€è·¯å°±æ˜¯æ‰‹åŠ¨è§¦å‘ä¸€æ¬¡å±æ€§çš„ <code>getter</code> æ¥å®ç°ä¾èµ–æ”¶é›†ã€‚</p></blockquote> <p>ç°åœ¨æˆ‘ä»¬å°±æ¥æµ‹è¯•ä¸‹ä»£ç çš„æ•ˆæœï¼Œåªéœ€è¦æŠŠæ‰€æœ‰çš„ä»£ç å¤åˆ¶åˆ°æµè§ˆå™¨ä¸­æ‰§è¡Œï¼Œå°±ä¼šå‘ç°é¡µé¢çš„å†…å®¹å…¨éƒ¨è¢«æ›¿æ¢äº†</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'poetries'</span> <span class="token punctuation">}</span>
<span class="token function">observe</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText <span class="token operator">=</span> value
<span class="token punctuation">}</span>
<span class="token comment">// æ¨¡æ‹Ÿè§£æåˆ° `{{name}}` è§¦å‘çš„æ“ä½œ</span>
<span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">,</span> update<span class="token punctuation">)</span>
<span class="token comment">// update Dom innerText</span>
data<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'yyy'</span>
</code></pre></div><h4 id="_28-9-1-object-defineproperty-çš„ç¼ºé™·"><a href="http://interview.poetries.top/docs/excellent.html#_28-9-1-object-defineproperty-%E7%9A%84%E7%BC%BA%E9%99%B7" class="header-anchor">#</a> 28.9.1 Object.defineProperty çš„ç¼ºé™·</h4> <ul><li>ä»¥ä¸Šå·²ç»åˆ†æå®Œäº† <code>Vue</code> çš„å“åº”å¼åŸç†ï¼Œæ¥ä¸‹æ¥è¯´ä¸€ç‚¹ <code>Object.defineProperty</code> ä¸­çš„ç¼ºé™·ã€‚</li> <li>å¦‚æœé€šè¿‡ä¸‹æ ‡æ–¹å¼ä¿®æ”¹æ•°ç»„æ•°æ®æˆ–è€…ç»™å¯¹è±¡æ–°å¢å±æ€§å¹¶ä¸ä¼šè§¦å‘ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ï¼Œå› ä¸º<code>Object.defineProperty</code> ä¸èƒ½æ‹¦æˆªåˆ°è¿™äº›æ“ä½œï¼Œæ›´ç²¾ç¡®çš„æ¥è¯´ï¼Œå¯¹äºæ•°ç»„è€Œè¨€ï¼Œå¤§éƒ¨åˆ†æ“ä½œéƒ½æ˜¯æ‹¦æˆªä¸åˆ°çš„ï¼Œåªæ˜¯ <code>Vue</code> å†…éƒ¨é€šè¿‡é‡å†™å‡½æ•°çš„æ–¹å¼è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚</li> <li>å¯¹äºç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œ<code>Vue</code> æä¾›äº†ä¸€ä¸ª <code>API</code> è§£å†³</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">set</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token operator">:</span> Array<span class="token operator">&lt;</span>any<span class="token operator">&gt;</span> <span class="token operator">|</span> Object<span class="token punctuation">,</span> key<span class="token operator">:</span> any<span class="token punctuation">,</span> val<span class="token operator">:</span> any</span><span class="token punctuation">)</span><span class="token operator">:</span> any <span class="token punctuation">{</span>
  <span class="token comment">// åˆ¤æ–­æ˜¯å¦ä¸ºæ•°ç»„ä¸”ä¸‹æ ‡æ˜¯å¦æœ‰æ•ˆ</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isValidArrayIndex</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// è°ƒç”¨ splice å‡½æ•°è§¦å‘æ´¾å‘æ›´æ–°</span>
    <span class="token comment">// è¯¥å‡½æ•°å·²è¢«é‡å†™</span>
    target<span class="token punctuation">.</span>length <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>length<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
    target<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span>
    <span class="token keyword">return</span> val
  <span class="token punctuation">}</span>
  <span class="token comment">// åˆ¤æ–­ key æ˜¯å¦å·²ç»å­˜åœ¨</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token keyword">in</span> target <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token punctuation">(</span>key <span class="token keyword">in</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> val
    <span class="token keyword">return</span> val
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> ob <span class="token operator">=</span> <span class="token punctuation">(</span>target<span class="token operator">:</span> any<span class="token punctuation">)</span><span class="token punctuation">.</span>__ob__
  <span class="token comment">// å¦‚æœå¯¹è±¡ä¸æ˜¯å“åº”å¼å¯¹è±¡ï¼Œå°±èµ‹å€¼è¿”å›</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ob<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> val
    <span class="token keyword">return</span> val
  <span class="token punctuation">}</span>
  <span class="token comment">// è¿›è¡ŒåŒå‘ç»‘å®š</span>
  <span class="token function">defineReactive</span><span class="token punctuation">(</span>ob<span class="token punctuation">.</span>value<span class="token punctuation">,</span> key<span class="token punctuation">,</span> val<span class="token punctuation">)</span>
  <span class="token comment">// æ‰‹åŠ¨æ´¾å‘æ›´æ–°</span>
  ob<span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> val
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>å¯¹äºæ•°ç»„è€Œè¨€ï¼Œ<code>Vue</code>å†…éƒ¨é‡å†™äº†ä»¥ä¸‹å‡½æ•°å®ç°æ´¾å‘æ›´æ–°</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// è·å¾—æ•°ç»„åŸå‹</span>
<span class="token keyword">const</span> arrayProto <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype
<span class="token keyword">export</span> <span class="token keyword">const</span> arrayMethods <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>arrayProto<span class="token punctuation">)</span>
<span class="token comment">// é‡å†™ä»¥ä¸‹å‡½æ•°</span>
<span class="token keyword">const</span> methodsToPatch <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">'push'</span><span class="token punctuation">,</span>
  <span class="token string">'pop'</span><span class="token punctuation">,</span>
  <span class="token string">'shift'</span><span class="token punctuation">,</span>
  <span class="token string">'unshift'</span><span class="token punctuation">,</span>
  <span class="token string">'splice'</span><span class="token punctuation">,</span>
  <span class="token string">'sort'</span><span class="token punctuation">,</span>
  <span class="token string">'reverse'</span>
<span class="token punctuation">]</span>
methodsToPatch<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">method</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ç¼“å­˜åŸç”Ÿå‡½æ•°</span>
  <span class="token keyword">const</span> original <span class="token operator">=</span> arrayProto<span class="token punctuation">[</span>method<span class="token punctuation">]</span>
  <span class="token comment">// é‡å†™å‡½æ•°</span>
  <span class="token function">def</span><span class="token punctuation">(</span>arrayMethods<span class="token punctuation">,</span> method<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">mutator</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// å…ˆè°ƒç”¨åŸç”Ÿå‡½æ•°è·å¾—ç»“æœ</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">original</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span>
    <span class="token keyword">const</span> ob <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__ob__
    <span class="token keyword">let</span> inserted
    <span class="token comment">// è°ƒç”¨ä»¥ä¸‹å‡ ä¸ªå‡½æ•°æ—¶ï¼Œç›‘å¬æ–°æ•°æ®</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>method<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">'push'</span><span class="token operator">:</span>
      <span class="token keyword">case</span> <span class="token string">'unshift'</span><span class="token operator">:</span>
        inserted <span class="token operator">=</span> args
        <span class="token keyword">break</span>
      <span class="token keyword">case</span> <span class="token string">'splice'</span><span class="token operator">:</span>
        inserted <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>inserted<span class="token punctuation">)</span> ob<span class="token punctuation">.</span><span class="token function">observeArray</span><span class="token punctuation">(</span>inserted<span class="token punctuation">)</span>
    <span class="token comment">// æ‰‹åŠ¨æ´¾å‘æ›´æ–°</span>
    ob<span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> result
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_28-9-2-ç¼–è¯‘è¿‡ç¨‹"><a href="http://interview.poetries.top/docs/excellent.html#_28-9-2-%E7%BC%96%E8%AF%91%E8%BF%87%E7%A8%8B" class="header-anchor">#</a> 28.9.2 ç¼–è¯‘è¿‡ç¨‹</h4> <blockquote><p>æƒ³å¿…å¤§å®¶åœ¨ä½¿ç”¨ Vue å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼ŒåŸºæœ¬éƒ½æ˜¯ä½¿ç”¨æ¨¡æ¿çš„æ–¹å¼ã€‚é‚£ä¹ˆä½ æœ‰è¿‡ã€Œæ¨¡æ¿æ˜¯æ€ä¹ˆåœ¨æµè§ˆå™¨ä¸­è¿è¡Œçš„ã€è¿™ç§ç–‘è™‘å˜›ï¼Ÿ</p></blockquote> <ul><li>é¦–å…ˆç›´æ¥æŠŠæ¨¡æ¿ä¸¢åˆ°æµè§ˆå™¨ä¸­è‚¯å®šæ˜¯ä¸èƒ½è¿è¡Œçš„ï¼Œæ¨¡æ¿åªæ˜¯ä¸ºäº†æ–¹ä¾¿å¼€å‘è€…è¿›è¡Œå¼€å‘ã€‚<code>Vue</code> ä¼šé€šè¿‡ç¼–è¯‘å™¨å°†æ¨¡æ¿é€šè¿‡å‡ ä¸ªé˜¶æ®µæœ€ç»ˆç¼–è¯‘ä¸º <code>render</code> å‡½æ•°ï¼Œç„¶åé€šè¿‡æ‰§è¡Œ <code>render</code> å‡½æ•°ç”Ÿæˆ <code>Virtual DOM</code> æœ€ç»ˆæ˜ å°„ä¸ºçœŸå® <code>DOM</code>ã€‚</li> <li>æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥å­¦ä¹ è¿™ä¸ªç¼–è¯‘çš„è¿‡ç¨‹ï¼Œäº†è§£è¿™ä¸ªè¿‡ç¨‹ä¸­å¤§æ¦‚å‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ…ã€‚<strong>è¿™ä¸ªè¿‡ç¨‹å…¶ä¸­åˆåˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µ</strong>ï¼Œåˆ†åˆ«ä¸ºï¼š</li></ul> <blockquote><ul><li>å°†æ¨¡æ¿è§£æä¸º <code>AST</code></li> <li>ä¼˜åŒ– <code>AST</code></li> <li>å°† <code>AST</code>è½¬æ¢ä¸º <code>render</code>å‡½æ•°</li></ul></blockquote> <p>åœ¨ç¬¬ä¸€ä¸ªé˜¶æ®µä¸­ï¼Œæœ€ä¸»è¦çš„äº‹æƒ…è¿˜æ˜¯é€šè¿‡å„ç§å„æ ·çš„æ­£åˆ™è¡¨è¾¾å¼å»åŒ¹é…æ¨¡æ¿ä¸­çš„å†…å®¹ï¼Œç„¶åå°†å†…å®¹æå–å‡ºæ¥åšå„ç§é€»è¾‘æ“ä½œï¼Œæ¥ä¸‹æ¥ä¼šç”Ÿæˆä¸€ä¸ªæœ€åŸºæœ¬çš„ <code>AST</code>å¯¹è±¡</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token comment">// ç±»å‹</span>
    type<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token comment">// æ ‡ç­¾</span>
    tag<span class="token punctuation">,</span>
    <span class="token comment">// å±æ€§åˆ—è¡¨</span>
    attrsList<span class="token operator">:</span> attrs<span class="token punctuation">,</span>
    <span class="token comment">// å±æ€§æ˜ å°„</span>
    attrsMap<span class="token operator">:</span> <span class="token function">makeAttrsMap</span><span class="token punctuation">(</span>attrs<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// çˆ¶èŠ‚ç‚¹</span>
    parent<span class="token punctuation">,</span>
    <span class="token comment">// å­èŠ‚ç‚¹</span>
    children<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>ç„¶åä¼šæ ¹æ®è¿™ä¸ªæœ€åŸºæœ¬çš„ AST å¯¹è±¡ä¸­çš„å±æ€§ï¼Œè¿›ä¸€æ­¥æ‰©å±• <code>AST</code>ã€‚</li> <li>å½“ç„¶åœ¨è¿™ä¸€é˜¶æ®µä¸­ï¼Œè¿˜ä¼šè¿›è¡Œå…¶ä»–çš„ä¸€äº›åˆ¤æ–­é€»è¾‘ã€‚æ¯”å¦‚è¯´å¯¹æ¯”å‰åå¼€é—­æ ‡ç­¾æ˜¯å¦ä¸€è‡´ï¼Œåˆ¤æ–­æ ¹ç»„ä»¶æ˜¯å¦åªå­˜åœ¨ä¸€ä¸ªï¼Œåˆ¤æ–­æ˜¯å¦ç¬¦åˆ <code>HTML5 Content Model</code>è§„èŒƒç­‰ç­‰é—®é¢˜ã€‚</li> <li>æ¥ä¸‹æ¥å°±æ˜¯ä¼˜åŒ– AST çš„é˜¶æ®µã€‚åœ¨å½“å‰ç‰ˆæœ¬ä¸‹ï¼Œ<code>Vue</code> è¿›è¡Œçš„ä¼˜åŒ–å†…å®¹å…¶å®è¿˜æ˜¯ä¸å¤šçš„ã€‚åªæ˜¯å¯¹èŠ‚ç‚¹è¿›è¡Œäº†é™æ€å†…å®¹æå–ï¼Œä¹Ÿå°±æ˜¯å°†æ°¸è¿œä¸ä¼šå˜åŠ¨çš„èŠ‚ç‚¹æå–äº†å‡ºæ¥ï¼Œå®ç°å¤ç”¨ <code>Virtual DOM</code>ï¼Œè·³è¿‡å¯¹æ¯”ç®—æ³•çš„åŠŸèƒ½ã€‚åœ¨ä¸‹ä¸€ä¸ªå¤§ç‰ˆæœ¬ä¸­ï¼Œ<code>Vue</code> ä¼šåœ¨ä¼˜åŒ– <code>AST</code> çš„é˜¶æ®µç»§ç»­å‘åŠ›ï¼Œå®ç°æ›´å¤šçš„ä¼˜åŒ–åŠŸèƒ½ï¼Œå°½å¯èƒ½çš„åœ¨ç¼–è¯‘é˜¶æ®µå‹æ¦¨æ›´å¤šçš„æ€§èƒ½ï¼Œæ¯”å¦‚è¯´æå–é™æ€çš„å±æ€§ç­‰ç­‰ä¼˜åŒ–è¡Œä¸ºã€‚</li> <li>æœ€åä¸€ä¸ªé˜¶æ®µå°±æ˜¯é€šè¿‡ <code>AST</code> ç”Ÿæˆ <code>render</code> å‡½æ•°äº†ã€‚å…¶å®è¿™ä¸€é˜¶æ®µè™½ç„¶åˆ†æ”¯æœ‰å¾ˆå¤šï¼Œä½†æ˜¯æœ€ä¸»è¦çš„ç›®çš„å°±æ˜¯éå†æ•´ä¸ª <code>AST</code>ï¼Œæ ¹æ®ä¸åŒçš„æ¡ä»¶ç”Ÿæˆä¸åŒçš„ä»£ç ç½¢äº†ã€‚</li></ul> <h4 id="_28-9-3-nexttick-åŸç†åˆ†æ"><a href="http://interview.poetries.top/docs/excellent.html#_28-9-3-nexttick-%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90" class="header-anchor">#</a> 28.9.3 NextTick åŸç†åˆ†æ</h4> <blockquote><p><code>nextTick</code> å¯ä»¥è®©æˆ‘ä»¬åœ¨ä¸‹æ¬¡ <code>DOM</code> æ›´æ–°å¾ªç¯ç»“æŸä¹‹åæ‰§è¡Œå»¶è¿Ÿå›è°ƒï¼Œç”¨äºè·å¾—æ›´æ–°åçš„ <code>DOM</code>ã€‚</p></blockquote> <ul><li>åœ¨ <code>Vue 2.4</code> ä¹‹å‰éƒ½æ˜¯ä½¿ç”¨çš„ <code>microtasks</code>ï¼Œä½†æ˜¯<code>microtasks</code> çš„ä¼˜å…ˆçº§è¿‡é«˜ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½ä¼šå‡ºç°æ¯”äº‹ä»¶å†’æ³¡æ›´å¿«çš„æƒ…å†µï¼Œä½†å¦‚æœéƒ½ä½¿ç”¨ <code>macrotasks</code> åˆå¯èƒ½ä¼šå‡ºç°æ¸²æŸ“çš„æ€§èƒ½é—®é¢˜ã€‚æ‰€ä»¥åœ¨æ–°ç‰ˆæœ¬ä¸­ï¼Œä¼šé»˜è®¤ä½¿ç”¨ <code>microtasks</code>ï¼Œä½†åœ¨ç‰¹æ®Šæƒ…å†µä¸‹ä¼šä½¿ç”¨ <code>macrotasks</code>ï¼Œæ¯”å¦‚ <code>v-on</code>ã€‚</li> <li>å¯¹äºå®ç° <code>macrotasks</code> ï¼Œä¼šå…ˆåˆ¤æ–­æ˜¯å¦èƒ½ä½¿ç”¨ <code>setImmediate</code> ï¼Œä¸èƒ½çš„è¯é™çº§ä¸º <code>MessageChannel</code> ï¼Œä»¥ä¸Šéƒ½ä¸è¡Œçš„è¯å°±ä½¿ç”¨ <code>setTimeout</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> setImmediate <span class="token operator">!==</span> <span class="token string">'undefined'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isNative</span><span class="token punctuation">(</span>setImmediate<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">macroTimerFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setImmediate</span><span class="token punctuation">(</span>flushCallbacks<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>
  <span class="token keyword">typeof</span> MessageChannel <span class="token operator">!==</span> <span class="token string">'undefined'</span> <span class="token operator">&amp;&amp;</span>
  <span class="token punctuation">(</span><span class="token function">isNative</span><span class="token punctuation">(</span>MessageChannel<span class="token punctuation">)</span> <span class="token operator">||</span>
    <span class="token comment">// PhantomJS</span>
    MessageChannel<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'[object MessageChannelConstructor]'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> channel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MessageChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> port <span class="token operator">=</span> channel<span class="token punctuation">.</span>port2
  channel<span class="token punctuation">.</span>port1<span class="token punctuation">.</span>onmessage <span class="token operator">=</span> flushCallbacks
  <span class="token function-variable function">macroTimerFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    port<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">macroTimerFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span>flushCallbacks<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>ä»¥ä¸Šä»£ç å¾ˆç®€å•ï¼Œå°±æ˜¯åˆ¤æ–­èƒ½ä¸èƒ½ä½¿ç”¨ç›¸åº”çš„<code>API</code></p></blockquote> <h2 id="_29-reactå¸¸è€ƒçŸ¥è¯†ç‚¹"><a href="http://interview.poetries.top/docs/excellent.html#_29-react%E5%B8%B8%E8%80%83%E7%9F%A5%E8%AF%86%E7%82%B9" class="header-anchor">#</a> 29 Reactå¸¸è€ƒçŸ¥è¯†ç‚¹</h2> <h3 id="_29-1-ç”Ÿå‘½å‘¨æœŸ"><a href="http://interview.poetries.top/docs/excellent.html#_29-1-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F" class="header-anchor">#</a> 29.1 ç”Ÿå‘½å‘¨æœŸ</h3> <blockquote><p>åœ¨ <code>V16</code> ç‰ˆæœ¬ä¸­å¼•å…¥äº† <code>Fiber</code> æœºåˆ¶ã€‚è¿™ä¸ªæœºåˆ¶ä¸€å®šç¨‹åº¦ä¸Šçš„å½±å“äº†éƒ¨åˆ†ç”Ÿå‘½å‘¨æœŸçš„è°ƒç”¨ï¼Œå¹¶ä¸”ä¹Ÿå¼•å…¥äº†æ–°çš„ <code>2</code> ä¸ª <code>API</code> æ¥è§£å†³é—®é¢˜</p></blockquote> <blockquote><p>åœ¨ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœä½ æ‹¥æœ‰ä¸€ä¸ªå¾ˆå¤æ‚çš„å¤åˆç»„ä»¶ï¼Œç„¶åæ”¹åŠ¨äº†æœ€ä¸Šå±‚ç»„ä»¶çš„ <code>state</code>ï¼Œé‚£ä¹ˆè°ƒç”¨æ ˆå¯èƒ½ä¼šå¾ˆé•¿</p></blockquote> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/30.png" alt="" class="medium-zoom-image"></p> <ul><li>è°ƒç”¨æ ˆè¿‡é•¿ï¼Œå†åŠ ä¸Šä¸­é—´è¿›è¡Œäº†å¤æ‚çš„æ“ä½œï¼Œå°±å¯èƒ½å¯¼è‡´é•¿æ—¶é—´é˜»å¡ä¸»çº¿ç¨‹ï¼Œå¸¦æ¥ä¸å¥½çš„ç”¨æˆ·ä½“éªŒã€‚<code>Fiber</code> å°±æ˜¯ä¸ºäº†è§£å†³è¯¥é—®é¢˜è€Œç”Ÿ</li> <li><code>Fiber</code> æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„å †æ ˆå¸§ï¼Œæ–°çš„è°ƒåº¦å™¨ä¼šæŒ‰ç…§ä¼˜å…ˆçº§è‡ªç”±è°ƒåº¦è¿™äº›å¸§ï¼Œä»è€Œå°†ä¹‹å‰çš„åŒæ­¥æ¸²æŸ“æ”¹æˆäº†å¼‚æ­¥æ¸²æŸ“ï¼Œåœ¨ä¸å½±å“ä½“éªŒçš„æƒ…å†µä¸‹å»åˆ†æ®µè®¡ç®—æ›´æ–°</li></ul> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/31.png" alt="" class="medium-zoom-image"></p> <ul><li>å¯¹äºå¦‚ä½•åŒºåˆ«ä¼˜å…ˆçº§ï¼Œ<code>React</code> æœ‰è‡ªå·±çš„ä¸€å¥—é€»è¾‘ã€‚å¯¹äºåŠ¨ç”»è¿™ç§å®æ—¶æ€§å¾ˆé«˜çš„ä¸œè¥¿ï¼Œä¹Ÿå°±æ˜¯ <code>16 ms</code> å¿…é¡»æ¸²æŸ“ä¸€æ¬¡ä¿è¯ä¸å¡é¡¿çš„æƒ…å†µä¸‹ï¼Œ<code>React</code> ä¼šæ¯ <code>16 ms</code>ï¼ˆä»¥å†…ï¼‰ æš‚åœä¸€ä¸‹æ›´æ–°ï¼Œè¿”å›æ¥ç»§ç»­æ¸²æŸ“åŠ¨ç”»</li> <li>å¯¹äºå¼‚æ­¥æ¸²æŸ“ï¼Œç°åœ¨æ¸²æŸ“æœ‰ä¸¤ä¸ªé˜¶æ®µï¼š<code>reconciliation</code> å’Œ <code>commit</code> ã€‚å‰è€…è¿‡ç¨‹æ˜¯å¯ä»¥æ‰“æ–­çš„ï¼Œåè€…ä¸èƒ½æš‚åœï¼Œä¼šä¸€ç›´æ›´æ–°ç•Œé¢ç›´åˆ°å®Œæˆã€‚</li></ul> <p><strong>1. Reconciliation é˜¶æ®µ</strong></p> <ul><li><code>componentWillMount</code></li> <li><code>componentWillReceiveProps</code></li> <li><code>shouldComponentUpdate</code></li> <li><code>componentWillUpdate</code></li></ul> <p><strong>2. Commit é˜¶æ®µ</strong></p> <ul><li><code>componentDidMount</code></li> <li><code>componentDidUpdate</code></li> <li><code>componentWillUnmount</code></li></ul> <blockquote><p>å› ä¸º <code>Reconciliation</code> é˜¶æ®µæ˜¯å¯ä»¥è¢«æ‰“æ–­çš„ï¼Œæ‰€ä»¥ <code>Reconciliation</code> é˜¶æ®µä¼šæ‰§è¡Œçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°å°±å¯èƒ½ä¼šå‡ºç°è°ƒç”¨å¤šæ¬¡çš„æƒ…å†µï¼Œä»è€Œå¼•èµ· <code>Bug</code>ã€‚ç”±æ­¤å¯¹äº <code>Reconciliation</code> é˜¶æ®µè°ƒç”¨çš„å‡ ä¸ªå‡½æ•°ï¼Œé™¤äº† <code>shouldComponentUpdate</code> ä»¥å¤–ï¼Œå…¶ä»–éƒ½åº”è¯¥é¿å…å»ä½¿ç”¨ï¼Œå¹¶ä¸” <code>V16</code> ä¸­ä¹Ÿå¼•å…¥äº†æ–°çš„ <code>API</code> æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p></blockquote> <blockquote><p><code>getDerivedStateFromProps</code> ç”¨äºæ›¿æ¢ <code>componentWillReceiveProps</code> ï¼Œè¯¥å‡½æ•°ä¼šåœ¨åˆå§‹åŒ–å’Œ <code>update</code> æ—¶è¢«è°ƒç”¨</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">ExampleComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token comment">// Initialize state in constructor,</span>
  <span class="token comment">// Or with a property initializer.</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">static</span> <span class="token function">getDerivedStateFromProps</span><span class="token punctuation">(</span><span class="token parameter">nextProps<span class="token punctuation">,</span> prevState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>prevState<span class="token punctuation">.</span>someMirroredValue <span class="token operator">!==</span> nextProps<span class="token punctuation">.</span>someValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        derivedData<span class="token operator">:</span> <span class="token function">computeDerivedState</span><span class="token punctuation">(</span>nextProps<span class="token punctuation">)</span><span class="token punctuation">,</span>
        someMirroredValue<span class="token operator">:</span> nextProps<span class="token punctuation">.</span>someValue
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Return null to indicate no change to state.</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><code>getSnapshotBeforeUpdate</code> ç”¨äºæ›¿æ¢ <code>componentWillUpdate</code> ï¼Œè¯¥å‡½æ•°ä¼šåœ¨ <code>update</code> å <code>DOM</code> æ›´æ–°å‰è¢«è°ƒç”¨ï¼Œç”¨äºè¯»å–æœ€æ–°çš„ <code>DOM</code> æ•°æ®</p></blockquote> <blockquote><p>æ›´å¤šè¯¦æƒ… http://blog.poetries.top/2018/11/18/react-lifecircle</p></blockquote> <h3 id="_29-2-setstate"><a href="http://interview.poetries.top/docs/excellent.html#_29-2-setstate" class="header-anchor">#</a> 29.2 setState</h3> <ul><li><code>setState</code> åœ¨ <code>React</code> ä¸­æ˜¯ç»å¸¸ä½¿ç”¨çš„ä¸€ä¸ª <code>API</code>ï¼Œä½†æ˜¯å®ƒå­˜åœ¨ä¸€äº›çš„é—®é¢˜ç»å¸¸ä¼šå¯¼è‡´åˆå­¦è€…å‡ºé”™ï¼Œæ ¸å¿ƒåŸå› å°±æ˜¯å› ä¸ºè¿™ä¸ª <code>API</code> æ˜¯å¼‚æ­¥çš„ã€‚</li> <li>é¦–å…ˆ  <code>setState</code>   çš„è°ƒç”¨å¹¶ä¸ä¼šé©¬ä¸Šå¼•èµ·   <code>state</code>  çš„æ”¹å˜ï¼Œå¹¶ä¸”å¦‚æœä½ ä¸€æ¬¡è°ƒç”¨äº†å¤šä¸ª   <code>setState</code>   ï¼Œé‚£ä¹ˆç»“æœå¯èƒ½å¹¶ä¸å¦‚ä½ æœŸå¾…çš„ä¸€æ ·ã€‚</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// åˆå§‹åŒ– `count` ä¸º 0</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span> <span class="token comment">// -&gt; 0</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> count<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> count<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> count<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span> <span class="token comment">// -&gt; 0</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>ç¬¬ä¸€ï¼Œä¸¤æ¬¡çš„æ‰“å°éƒ½ä¸º <code>0</code>ï¼Œå› ä¸º <code>setState</code> æ˜¯ä¸ªå¼‚æ­¥ <code>API</code>ï¼Œåªæœ‰åŒæ­¥ä»£ç è¿è¡Œå®Œæ¯•æ‰ä¼šæ‰§è¡Œã€‚<code>setState</code> å¼‚æ­¥çš„åŸå› æˆ‘è®¤ä¸ºåœ¨äºï¼Œ<code>setState</code> å¯èƒ½ä¼šå¯¼è‡´ <code>DOM</code> çš„é‡ç»˜ï¼Œå¦‚æœè°ƒç”¨ä¸€æ¬¡å°±é©¬ä¸Šå»è¿›è¡Œé‡ç»˜ï¼Œé‚£ä¹ˆè°ƒç”¨å¤šæ¬¡å°±ä¼šé€ æˆä¸å¿…è¦çš„æ€§èƒ½æŸå¤±ã€‚è®¾è®¡æˆå¼‚æ­¥çš„è¯ï¼Œå°±å¯ä»¥å°†å¤šæ¬¡è°ƒç”¨æ”¾å…¥ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œåœ¨æ°å½“çš„æ—¶å€™ç»Ÿä¸€è¿›è¡Œæ›´æ–°è¿‡ç¨‹ã€‚</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>  
  <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> count<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> count<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> count<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
</code></pre></div><blockquote><p>å½“ç„¶ä½ ä¹Ÿå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¥å®ç°è°ƒç”¨ä¸‰æ¬¡ <code>setState</code>ä½¿å¾— <code>count</code> ä¸º <code>3</code></p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">prevState</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> count<span class="token operator">:</span> prevState<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">prevState</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> count<span class="token operator">:</span> prevState<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">prevState</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> count<span class="token operator">:</span> prevState<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>å¦‚æœä½ æƒ³åœ¨æ¯æ¬¡è°ƒç”¨ <code>setState</code> åè·å¾—æ­£ç¡®çš„ <code>state</code>ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹ä»£ç å®ç°</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">prevState</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> count<span class="token operator">:</span> prevState<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>æ›´å¤šè¯¦æƒ… http://blog.poetries.top/2018/12/20/react-setState</p></blockquote> <h3 id="_29-3-æ€§èƒ½ä¼˜åŒ–"><a href="http://interview.poetries.top/docs/excellent.html#_29-3-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96" class="header-anchor">#</a> 29.3 æ€§èƒ½ä¼˜åŒ–</h3> <ul><li>åœ¨ <code>shouldComponentUpdate</code> å‡½æ•°ä¸­æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿”å›å¸ƒå°”å€¼æ¥å†³å®šå½“å‰ç»„ä»¶æ˜¯å¦éœ€è¦æ›´æ–°ã€‚è¿™å±‚ä»£ç é€»è¾‘å¯ä»¥æ˜¯ç®€å•åœ°æµ…æ¯”è¾ƒä¸€ä¸‹å½“å‰ <code>state</code> å’Œä¹‹å‰çš„ <code>state</code> æ˜¯å¦ç›¸åŒï¼Œä¹Ÿå¯ä»¥æ˜¯åˆ¤æ–­æŸä¸ªå€¼æ›´æ–°äº†æ‰è§¦å‘ç»„ä»¶æ›´æ–°ã€‚ä¸€èˆ¬æ¥è¯´ä¸æ¨èå®Œæ•´åœ°å¯¹æ¯”å½“å‰ <code>state</code> å’Œä¹‹å‰çš„ <code>state</code> æ˜¯å¦ç›¸åŒï¼Œå› ä¸ºç»„ä»¶æ›´æ–°è§¦å‘å¯èƒ½ä¼šå¾ˆé¢‘ç¹ï¼Œè¿™æ ·çš„å®Œæ•´å¯¹æ¯”æ€§èƒ½å¼€é”€ä¼šæœ‰ç‚¹å¤§ï¼Œå¯èƒ½ä¼šé€ æˆå¾—ä¸å¿å¤±çš„æƒ…å†µã€‚</li> <li>å½“ç„¶å¦‚æœçœŸçš„æƒ³å®Œæ•´å¯¹æ¯”å½“å‰ <code>state</code> å’Œä¹‹å‰çš„ <code>state</code> æ˜¯å¦ç›¸åŒï¼Œå¹¶ä¸”ä¸å½±å“æ€§èƒ½ä¹Ÿæ˜¯è¡Œå¾—é€šçš„ï¼Œå¯ä»¥é€šè¿‡ <code>immutable</code> æˆ–è€… <code>immer</code> è¿™äº›åº“æ¥ç”Ÿæˆä¸å¯å˜å¯¹è±¡ã€‚è¿™ç±»åº“å¯¹äºæ“ä½œå¤§è§„æ¨¡çš„æ•°æ®æ¥è¯´ä¼šæå‡ä¸é”™çš„æ€§èƒ½ï¼Œå¹¶ä¸”ä¸€æ—¦æ”¹å˜æ•°æ®å°±ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå¯¹æ¯”å‰å <code>state</code> æ˜¯å¦ä¸€è‡´ä¹Ÿå°±æ–¹ä¾¿å¤šäº†ï¼ŒåŒæ—¶ä¹Ÿå¾ˆæ¨èé˜…è¯»ä¸‹ <code>immer</code> çš„æºç å®ç°</li> <li>å¦å¤–å¦‚æœåªæ˜¯å•çº¯çš„æµ…æ¯”è¾ƒä¸€ä¸‹ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ <code>PureComponent</code>ï¼Œåº•å±‚å°±æ˜¯å®ç°äº†æµ…æ¯”è¾ƒ <code>state</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>PureComponent</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        PureComponent
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>è¿™æ—¶å€™ä½ å¯èƒ½ä¼šè€ƒè™‘åˆ°å‡½æ•°ç»„ä»¶å°±ä¸èƒ½ä½¿ç”¨è¿™ç§æ–¹å¼äº†ï¼Œå¦‚æœä½ ä½¿ç”¨ <code>16.6.0</code> ä¹‹åçš„ç‰ˆæœ¬çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ <code>React.memo</code> æ¥å®ç°ç›¸åŒçš„åŠŸèƒ½</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Test <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">memo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        PureComponent
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>é€šè¿‡è¿™ç§æ–¹å¼æˆ‘ä»¬å°±å¯ä»¥æ—¢å®ç°äº† <code>shouldComponentUpdate</code> çš„æµ…æ¯”è¾ƒï¼Œåˆèƒ½å¤Ÿä½¿ç”¨å‡½æ•°ç»„ä»¶</p></blockquote> <h3 id="_29-4-é€šä¿¡"><a href="http://interview.poetries.top/docs/excellent.html#_29-4-%E9%80%9A%E4%BF%A1" class="header-anchor">#</a> 29.4 é€šä¿¡</h3> <p><strong>1. çˆ¶å­é€šä¿¡</strong></p> <ul><li>çˆ¶ç»„ä»¶é€šè¿‡ <code>props</code> ä¼ é€’æ•°æ®ç»™å­ç»„ä»¶ï¼Œå­ç»„ä»¶é€šè¿‡è°ƒç”¨çˆ¶ç»„ä»¶ä¼ æ¥çš„å‡½æ•°ä¼ é€’æ•°æ®ç»™çˆ¶ç»„ä»¶ï¼Œè¿™ä¸¤ç§æ–¹å¼æ˜¯æœ€å¸¸ç”¨çš„çˆ¶å­é€šä¿¡å®ç°åŠæ³•ã€‚</li> <li>è¿™ç§çˆ¶å­é€šä¿¡æ–¹å¼ä¹Ÿå°±æ˜¯å…¸å‹çš„å•å‘æ•°æ®æµï¼Œçˆ¶ç»„ä»¶é€šè¿‡ <code>props</code> ä¼ é€’æ•°æ®ï¼Œå­ç»„ä»¶ä¸èƒ½ç›´æ¥ä¿®æ”¹ <code>props</code>ï¼Œ è€Œæ˜¯å¿…é¡»é€šè¿‡è°ƒç”¨çˆ¶ç»„ä»¶å‡½æ•°çš„æ–¹å¼å‘ŠçŸ¥çˆ¶ç»„ä»¶ä¿®æ”¹æ•°æ®ã€‚</li></ul> <p><strong>2. å…„å¼Ÿç»„ä»¶é€šä¿¡</strong></p> <blockquote><p>å¯¹äºè¿™ç§æƒ…å†µå¯ä»¥é€šè¿‡å…±åŒçš„çˆ¶ç»„ä»¶æ¥ç®¡ç†çŠ¶æ€å’Œäº‹ä»¶å‡½æ•°ã€‚æ¯”å¦‚è¯´å…¶ä¸­ä¸€ä¸ªå…„å¼Ÿç»„ä»¶è°ƒç”¨çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„äº‹ä»¶å‡½æ•°ä¿®æ”¹çˆ¶ç»„ä»¶ä¸­çš„çŠ¶æ€ï¼Œç„¶åçˆ¶ç»„ä»¶å°†çŠ¶æ€ä¼ é€’ç»™å¦ä¸€ä¸ªå…„å¼Ÿç»„ä»¶</p></blockquote> <p><strong>3. è·¨å¤šå±‚æ¬¡ç»„ä»¶é€šä¿¡</strong></p> <blockquote><p>å¦‚æœä½ ä½¿ç”¨ <code>16.3</code> ä»¥ä¸Šç‰ˆæœ¬çš„è¯ï¼Œå¯¹äºè¿™ç§æƒ…å†µå¯ä»¥ä½¿ç”¨ <code>Context API</code></p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// åˆ›å»º Contextï¼Œå¯ä»¥åœ¨å¼€å§‹å°±ä¼ å…¥å€¼</span>
<span class="token keyword">const</span> StateContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token comment">// value å°±æ˜¯ä¼ å…¥ Context ä¸­çš„å€¼</span>
      <span class="token operator">&lt;</span>StateContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token string">'yck'</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Child <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>StateContext<span class="token punctuation">.</span>Provider<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>ThemeContext<span class="token punctuation">.</span>Consumer<span class="token operator">&gt;</span>
        <span class="token comment">// å–å‡ºå€¼</span>
        <span class="token punctuation">{</span><span class="token parameter">context</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
          name is <span class="token punctuation">{</span> context <span class="token punctuation">}</span>
        <span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>ThemeContext<span class="token punctuation">.</span>Consumer<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>4. ä»»æ„ç»„ä»¶</strong></p> <blockquote><p>è¿™ç§æ–¹å¼å¯ä»¥é€šè¿‡ <code>Redux</code> æˆ–è€… <code>Event Bus</code> è§£å†³ï¼Œå¦å¤–å¦‚æœä½ ä¸æ€•éº»çƒ¦çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨è¿™ç§æ–¹å¼è§£å†³ä¸Šè¿°æ‰€æœ‰çš„é€šä¿¡æƒ…å†µ</p></blockquote> <h3 id="_29-5-hoc-æ˜¯ä»€ä¹ˆ-ç›¸æ¯”-mixins-æœ‰ä»€ä¹ˆä¼˜ç‚¹"><a href="http://interview.poetries.top/docs/excellent.html#_29-5-hoc-%E6%98%AF%E4%BB%80%E4%B9%88-%E7%9B%B8%E6%AF%94-mixins-%E6%9C%89%E4%BB%80%E4%B9%88%E4%BC%98%E7%82%B9" class="header-anchor">#</a> 29.5 HOC æ˜¯ä»€ä¹ˆï¼Ÿç›¸æ¯” mixins æœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿ</h3> <blockquote><p>å¾ˆå¤šäººçœ‹åˆ°é«˜é˜¶ç»„ä»¶ï¼ˆ<code>HOC</code>ï¼‰è¿™ä¸ªæ¦‚å¿µå°±è¢«å“åˆ°äº†ï¼Œè®¤ä¸ºè¿™ä¸œè¥¿å¾ˆéš¾ï¼Œå…¶å®è¿™ä¸œè¥¿æ¦‚å¿µçœŸçš„å¾ˆç®€å•ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªä¾‹å­ã€‚</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> a <span class="token operator">+</span> b
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>ç°åœ¨å¦‚æœæˆ‘æƒ³ç»™è¿™ä¸ª <code>add</code> å‡½æ•°æ·»åŠ ä¸€ä¸ªè¾“å‡ºç»“æœçš„åŠŸèƒ½ï¼Œé‚£ä¹ˆä½ å¯èƒ½ä¼šè€ƒè™‘æˆ‘ç›´æ¥ä½¿ç”¨ <code>console.log</code> ä¸å°±å®ç°äº†ä¹ˆã€‚è¯´çš„æ²¡é”™ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬æƒ³åšçš„æ›´åŠ ä¼˜é›…å¹¶ä¸”å®¹æ˜“å¤ç”¨å’Œæ‰©å±•ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å»åš</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">withLog</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
        <span class="token keyword">return</span> result
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> wrapper
<span class="token punctuation">}</span>
<span class="token keyword">const</span> withLogAdd <span class="token operator">=</span> <span class="token function">withLog</span><span class="token punctuation">(</span>add<span class="token punctuation">)</span>
<span class="token function">withLogAdd</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>å…¶å®è¿™ä¸ªåšæ³•åœ¨å‡½æ•°å¼ç¼–ç¨‹é‡Œç§°ä¹‹ä¸ºé«˜é˜¶å‡½æ•°ï¼Œå¤§å®¶éƒ½çŸ¥é“ <code>React</code> çš„æ€æƒ³ä¸­æ˜¯å­˜åœ¨å‡½æ•°å¼ç¼–ç¨‹çš„ï¼Œé«˜é˜¶ç»„ä»¶å’Œé«˜é˜¶å‡½æ•°å°±æ˜¯åŒä¸€ä¸ªä¸œè¥¿ã€‚æˆ‘ä»¬å®ç°ä¸€ä¸ªå‡½æ•°ï¼Œä¼ å…¥ä¸€ä¸ªç»„ä»¶ï¼Œç„¶ååœ¨å‡½æ•°å†…éƒ¨å†å®ç°ä¸€ä¸ªå‡½æ•°å»æ‰©å±•ä¼ å…¥çš„ç»„ä»¶ï¼Œæœ€åè¿”å›ä¸€ä¸ªæ–°çš„ç»„ä»¶ï¼Œè¿™å°±æ˜¯é«˜é˜¶ç»„ä»¶çš„æ¦‚å¿µï¼Œä½œç”¨å°±æ˜¯ä¸ºäº†æ›´å¥½çš„å¤ç”¨ä»£ç ã€‚</li> <li>å…¶å® <code>HOC</code> å’Œ <code>Vue</code> ä¸­çš„ <code>mixins</code> ä½œç”¨æ˜¯ä¸€è‡´çš„ï¼Œå¹¶ä¸”åœ¨æ—©æœŸ <code>React</code> ä¹Ÿæ˜¯ä½¿ç”¨ <code>mixins</code> çš„æ–¹å¼ã€‚ä½†æ˜¯åœ¨ä½¿ç”¨ <code>class</code> çš„æ–¹å¼åˆ›å»ºç»„ä»¶ä»¥åï¼Œ<code>mixins</code> çš„æ–¹å¼å°±ä¸èƒ½ä½¿ç”¨äº†ï¼Œå¹¶ä¸”å…¶å® <code>mixins</code> ä¹Ÿæ˜¯å­˜åœ¨ä¸€äº›é—®é¢˜çš„ï¼Œæ¯”å¦‚</li></ul> <ol><li>éšå«äº†ä¸€äº›ä¾èµ–ï¼Œæ¯”å¦‚æˆ‘åœ¨ç»„ä»¶ä¸­å†™äº†æŸä¸ª <code>state</code> å¹¶ä¸”åœ¨ <code>mixin</code> ä¸­ä½¿ç”¨äº†ï¼Œå°±è¿™å­˜åœ¨äº†ä¸€ä¸ªä¾èµ–å…³ç³»ã€‚ä¸‡ä¸€ä¸‹æ¬¡åˆ«äººè¦ç§»é™¤å®ƒï¼Œå°±å¾—å» <code>mixin</code> ä¸­æŸ¥æ‰¾ä¾èµ–</li> <li>å¤šä¸ª <code>mixin</code> ä¸­å¯èƒ½å­˜åœ¨ç›¸åŒå‘½åçš„å‡½æ•°ï¼ŒåŒæ—¶ä»£ç ç»„ä»¶ä¸­ä¹Ÿä¸èƒ½å‡ºç°ç›¸åŒå‘½åçš„å‡½æ•°ï¼Œå¦åˆ™å°±æ˜¯é‡å†™äº†ï¼Œå…¶å®æˆ‘ä¸€ç›´è§‰å¾—å‘½åçœŸçš„æ˜¯ä¸€ä»¶éº»çƒ¦äº‹ã€‚ã€‚</li> <li>é›ªçƒæ•ˆåº”ï¼Œè™½ç„¶æˆ‘ä¸€ä¸ªç»„ä»¶è¿˜æ˜¯ä½¿ç”¨ç€åŒä¸€ä¸ª <code>mixin</code>ï¼Œä½†æ˜¯ä¸€ä¸ª <code>mixin</code> ä¼šè¢«å¤šä¸ªç»„ä»¶ä½¿ç”¨ï¼Œå¯èƒ½ä¼šå­˜åœ¨éœ€æ±‚ä½¿å¾— <code>mixin</code> ä¿®æ”¹åŸæœ¬çš„å‡½æ•°æˆ–è€…æ–°å¢æ›´å¤šçš„å‡½æ•°ï¼Œè¿™æ ·å¯èƒ½å°±ä¼šäº§ç”Ÿä¸€ä¸ªç»´æŠ¤æˆæœ¬</li></ol> <blockquote><p><code>HOC</code> è§£å†³äº†è¿™äº›é—®é¢˜ï¼Œå¹¶ä¸”å®ƒä»¬è¾¾æˆçš„æ•ˆæœä¹Ÿæ˜¯ä¸€è‡´çš„ï¼ŒåŒæ—¶ä¹Ÿæ›´åŠ çš„æ”¿æ²»æ­£ç¡®ï¼ˆæ¯•ç«Ÿæ›´åŠ å‡½æ•°å¼äº†ï¼‰</p></blockquote> <h3 id="_29-6-äº‹ä»¶æœºåˆ¶"><a href="http://interview.poetries.top/docs/excellent.html#_29-6-%E4%BA%8B%E4%BB%B6%E6%9C%BA%E5%88%B6" class="header-anchor">#</a> 29.6 äº‹ä»¶æœºåˆ¶</h3> <blockquote><p><code>React</code> å…¶å®è‡ªå·±å®ç°äº†ä¸€å¥—äº‹ä»¶æœºåˆ¶ï¼Œé¦–å…ˆæˆ‘ä»¬è€ƒè™‘ä¸€ä¸‹ä»¥ä¸‹ä»£ç ï¼š</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">Test</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> list<span class="token punctuation">,</span> handleClick <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    list<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>span onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleClick<span class="token punctuation">}</span> key<span class="token operator">=</span><span class="token punctuation">{</span>index<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>index<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>ä»¥ä¸Šç±»ä¼¼ä»£ç æƒ³å¿…å¤§å®¶ç»å¸¸ä¼šå†™åˆ°ï¼Œä½†æ˜¯ä½ æ˜¯å¦è€ƒè™‘è¿‡ç‚¹å‡»äº‹ä»¶æ˜¯å¦ç»‘å®šåœ¨äº†æ¯ä¸€ä¸ªæ ‡ç­¾ä¸Šï¼Ÿäº‹å®å½“ç„¶ä¸æ˜¯ï¼Œ<code>JSX</code> ä¸Šå†™çš„äº‹ä»¶å¹¶æ²¡æœ‰ç»‘å®šåœ¨å¯¹åº”çš„çœŸå® <code>DOM</code> ä¸Šï¼Œè€Œæ˜¯é€šè¿‡äº‹ä»¶ä»£ç†çš„æ–¹å¼ï¼Œå°†æ‰€æœ‰çš„äº‹ä»¶éƒ½ç»Ÿä¸€ç»‘å®šåœ¨äº† <code>document</code> ä¸Šã€‚è¿™æ ·çš„æ–¹å¼ä¸ä»…å‡å°‘äº†å†…å­˜æ¶ˆè€—ï¼Œè¿˜èƒ½åœ¨ç»„ä»¶æŒ‚è½½é”€æ¯æ—¶ç»Ÿä¸€è®¢é˜…å’Œç§»é™¤äº‹ä»¶ã€‚</li> <li>å¦å¤–å†’æ³¡åˆ° <code>document</code> ä¸Šçš„äº‹ä»¶ä¹Ÿä¸æ˜¯åŸç”Ÿæµè§ˆå™¨äº‹ä»¶ï¼Œè€Œæ˜¯ <code>React</code> è‡ªå·±å®ç°çš„åˆæˆäº‹ä»¶ï¼ˆ<code>SyntheticEvent</code>ï¼‰ã€‚å› æ­¤æˆ‘ä»¬å¦‚æœä¸æƒ³è¦äº‹ä»¶å†’æ³¡çš„è¯ï¼Œè°ƒç”¨ <code>event.stopPropagation</code> æ˜¯æ— æ•ˆçš„ï¼Œè€Œåº”è¯¥è°ƒç”¨ <code>event.preventDefault</code></li></ul> <blockquote><p>é‚£ä¹ˆå®ç°åˆæˆäº‹ä»¶çš„ç›®çš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ€»çš„æ¥è¯´åœ¨æˆ‘çœ‹æ¥å¥½å¤„æœ‰ä¸¤ç‚¹ï¼Œåˆ†åˆ«æ˜¯ï¼š</p></blockquote> <ol><li>åˆæˆäº‹ä»¶é¦–å…ˆæŠ¹å¹³äº†æµè§ˆå™¨ä¹‹é—´çš„å…¼å®¹é—®é¢˜ï¼Œå¦å¤–è¿™æ˜¯ä¸€ä¸ªè·¨æµè§ˆå™¨åŸç”Ÿäº‹ä»¶åŒ…è£…å™¨ï¼Œèµ‹äºˆäº†è·¨æµè§ˆå™¨å¼€å‘çš„èƒ½åŠ›</li> <li>å¯¹äºåŸç”Ÿæµè§ˆå™¨äº‹ä»¶æ¥è¯´ï¼Œæµè§ˆå™¨ä¼šç»™ç›‘å¬å™¨åˆ›å»ºä¸€ä¸ªäº‹ä»¶å¯¹è±¡ã€‚å¦‚æœä½ æœ‰å¾ˆå¤šçš„äº‹ä»¶ç›‘å¬ï¼Œé‚£ä¹ˆå°±éœ€è¦åˆ†é…å¾ˆå¤šçš„äº‹ä»¶å¯¹è±¡ï¼Œé€ æˆé«˜é¢çš„å†…å­˜åˆ†é…é—®é¢˜ã€‚ä½†æ˜¯å¯¹äºåˆæˆäº‹ä»¶æ¥è¯´ï¼Œæœ‰ä¸€ä¸ªäº‹ä»¶æ± ä¸“é—¨æ¥ç®¡ç†å®ƒä»¬çš„åˆ›å»ºå’Œé”€æ¯ï¼Œå½“äº‹ä»¶éœ€è¦è¢«ä½¿ç”¨æ—¶ï¼Œå°±ä¼šä»æ± å­ä¸­å¤ç”¨å¯¹è±¡ï¼Œäº‹ä»¶å›è°ƒç»“æŸåï¼Œå°±ä¼šé”€æ¯äº‹ä»¶å¯¹è±¡ä¸Šçš„å±æ€§ï¼Œä»è€Œä¾¿äºä¸‹æ¬¡å¤ç”¨äº‹ä»¶å¯¹è±¡ã€‚</li></ol> <h2 id="_30-ç›‘æ§"><a href="http://interview.poetries.top/docs/excellent.html#_30-%E7%9B%91%E6%8E%A7" class="header-anchor">#</a> 30 ç›‘æ§</h2> <blockquote><p>å‰ç«¯ç›‘æ§ä¸€èˆ¬åˆ†ä¸ºä¸‰ç§ï¼Œåˆ†åˆ«ä¸ºé¡µé¢åŸ‹ç‚¹ã€æ€§èƒ½ç›‘æ§ä»¥åŠå¼‚å¸¸ç›‘æ§ã€‚</p></blockquote> <p>è¿™ä¸€ç« èŠ‚æˆ‘ä»¬å°†æ¥å­¦ä¹ è¿™äº›ç›‘æ§ç›¸å…³çš„å†…å®¹ï¼Œä½†æ˜¯åŸºæœ¬ä¸ä¼šæ¶‰åŠåˆ°ä»£ç ï¼Œåªæ˜¯è®©å¤§å®¶äº†è§£ä¸‹å‰ç«¯ç›‘æ§è¯¥ç”¨ä»€ä¹ˆæ–¹å¼å®ç°ã€‚æ¯•ç«Ÿå¤§éƒ¨åˆ†å…¬å¸éƒ½åªæ˜¯ä½¿ç”¨åˆ°äº†ç¬¬ä¸‰æ–¹çš„ç›‘æ§å·¥å…·ï¼Œè€Œä¸æ˜¯é€‰æ‹©è‡ªå·±é€ è½®å­</p> <h3 id="_30-1-é¡µé¢åŸ‹ç‚¹"><a href="http://interview.poetries.top/docs/excellent.html#_30-1-%E9%A1%B5%E9%9D%A2%E5%9F%8B%E7%82%B9" class="header-anchor">#</a> 30.1 é¡µé¢åŸ‹ç‚¹</h3> <blockquote><p>é¡µé¢åŸ‹ç‚¹åº”è¯¥æ˜¯å¤§å®¶æœ€å¸¸å†™çš„ç›‘æ§äº†ï¼Œä¸€èˆ¬èµ·ç ä¼šç›‘æ§ä»¥ä¸‹å‡ ä¸ªæ•°æ®ï¼š</p></blockquote> <ul><li><code>PV</code> / <code>UV</code></li> <li>åœç•™æ—¶é•¿</li> <li>æµé‡æ¥æº</li> <li>ç”¨æˆ·äº¤äº’</li></ul> <blockquote><p>å¯¹äºè¿™å‡ ç±»ç»Ÿè®¡ï¼Œä¸€èˆ¬çš„å®ç°æ€è·¯å¤§è‡´å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼Œåˆ†åˆ«ä¸ºæ‰‹å†™åŸ‹ç‚¹å’Œæ— åŸ‹ç‚¹çš„æ–¹å¼ã€‚</p></blockquote> <p>ç›¸ä¿¡ç¬¬ä¸€ç§æ–¹å¼ä¹Ÿæ˜¯å¤§å®¶æœ€å¸¸ç”¨çš„æ–¹å¼ï¼Œå¯ä»¥è‡ªä¸»é€‰æ‹©éœ€è¦ç›‘æ§çš„æ•°æ®ç„¶ååœ¨ç›¸åº”çš„åœ°æ–¹å†™å…¥ä»£ç ã€‚è¿™ç§æ–¹å¼çš„çµæ´»æ€§å¾ˆå¤§ï¼Œä½†æ˜¯å”¯ä¸€çš„ç¼ºç‚¹å°±æ˜¯å·¥ä½œé‡è¾ƒå¤§ï¼Œæ¯ä¸ªéœ€è¦ç›‘æ§çš„åœ°æ–¹éƒ½å¾—æ’å…¥ä»£ç ã€‚</p> <p>å¦ä¸€ç§æ— åŸ‹ç‚¹çš„æ–¹å¼åŸºæœ¬ä¸éœ€è¦å¼€å‘è€…æ‰‹å†™åŸ‹ç‚¹äº†ï¼Œè€Œæ˜¯ç»Ÿè®¡æ‰€æœ‰çš„äº‹ä»¶å¹¶ä¸”å®šæ—¶ä¸ŠæŠ¥ã€‚è¿™ç§æ–¹å¼è™½ç„¶æ²¡æœ‰å‰ä¸€ç§æ–¹å¼ç¹çäº†ï¼Œä½†æ˜¯å› ä¸ºç»Ÿè®¡çš„æ˜¯æ‰€æœ‰äº‹ä»¶ï¼Œæ‰€ä»¥è¿˜éœ€è¦åæœŸè¿‡æ»¤å‡ºéœ€è¦çš„æ•°æ®ã€‚</p> <h3 id="_30-2-æ€§èƒ½ç›‘æ§"><a href="http://interview.poetries.top/docs/excellent.html#_30-2-%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7" class="header-anchor">#</a> 30.2 æ€§èƒ½ç›‘æ§</h3> <ul><li>æ€§èƒ½ç›‘æ§å¯ä»¥å¾ˆå¥½çš„å¸®åŠ©å¼€å‘è€…äº†è§£åœ¨å„ç§çœŸå®ç¯å¢ƒä¸‹ï¼Œé¡µé¢çš„æ€§èƒ½æƒ…å†µæ˜¯å¦‚ä½•çš„ã€‚</li> <li>å¯¹äºæ€§èƒ½ç›‘æ§æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨æµè§ˆå™¨è‡ªå¸¦çš„ <code>Performance API</code> æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚</li> <li>å¯¹äºæ€§èƒ½ç›‘æ§æ¥è¯´ï¼Œå…¶å®æˆ‘ä»¬åªéœ€è¦è°ƒç”¨ <code>performance.getEntriesByType('navigation')</code> è¿™è¡Œä»£ç å°±è¡Œäº†ã€‚å¯¹ï¼Œä½ æ²¡çœ‹é”™ï¼Œä¸€è¡Œä»£ç æˆ‘ä»¬å°±å¯ä»¥è·å¾—é¡µé¢ä¸­å„ç§è¯¦ç»†çš„æ€§èƒ½ç›¸å…³ä¿¡æ¯</li></ul> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/32.png" alt="" class="medium-zoom-image"></p> <blockquote><p>æˆ‘ä»¬å¯ä»¥å‘ç°è¿™è¡Œä»£ç è¿”å›äº†ä¸€ä¸ªæ•°ç»„ï¼Œå†…éƒ¨åŒ…å«äº†ç›¸å½“å¤šçš„ä¿¡æ¯ï¼Œä»æ•°æ®å¼€å§‹åœ¨ç½‘ç»œä¸­ä¼ è¾“åˆ°é¡µé¢åŠ è½½å®Œæˆéƒ½æä¾›äº†ç›¸åº”çš„æ•°æ®</p></blockquote> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/33.png" alt="" class="medium-zoom-image"></p> <h3 id="_30-3-å¼‚å¸¸ç›‘æ§"><a href="http://interview.poetries.top/docs/excellent.html#_30-3-%E5%BC%82%E5%B8%B8%E7%9B%91%E6%8E%A7" class="header-anchor">#</a> 30.3 å¼‚å¸¸ç›‘æ§</h3> <ul><li>å¯¹äºå¼‚å¸¸ç›‘æ§æ¥è¯´ï¼Œä»¥ä¸‹ä¸¤ç§ç›‘æ§æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œåˆ†åˆ«æ˜¯ä»£ç æŠ¥é”™ä»¥åŠæ¥å£å¼‚å¸¸ä¸ŠæŠ¥ã€‚</li> <li>å¯¹äºä»£ç è¿è¡Œé”™è¯¯ï¼Œé€šå¸¸çš„åŠæ³•æ˜¯ä½¿ç”¨ <code>window.onerror</code> æ‹¦æˆªæŠ¥é”™ã€‚è¯¥æ–¹æ³•èƒ½æ‹¦æˆªåˆ°å¤§éƒ¨åˆ†çš„è¯¦ç»†æŠ¥é”™ä¿¡æ¯ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¾‹å¤–</li></ul> <ol><li>å¯¹äºè·¨åŸŸçš„ä»£ç è¿è¡Œé”™è¯¯ä¼šæ˜¾ç¤º <code>Script error</code>. å¯¹äºè¿™ç§æƒ…å†µæˆ‘ä»¬éœ€è¦ç»™ <code>script</code>æ ‡ç­¾æ·»åŠ  <code>crossorigin</code> å±æ€§</li> <li>å¯¹äºæŸäº›æµè§ˆå™¨å¯èƒ½ä¸ä¼šæ˜¾ç¤ºè°ƒç”¨æ ˆä¿¡æ¯ï¼Œè¿™ç§æƒ…å†µå¯ä»¥é€šè¿‡ <code>arguments.callee.caller</code> æ¥åšæ ˆé€’å½’</li></ol> <ul><li>å¯¹äºå¼‚æ­¥ä»£ç æ¥è¯´ï¼Œå¯ä»¥ä½¿ç”¨ <code>catch</code> çš„æ–¹å¼æ•è·é”™è¯¯ã€‚æ¯”å¦‚ <code>Promise</code> å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>catch</code> å‡½æ•°ï¼Œ<code>async await</code> å¯ä»¥ä½¿ç”¨ <code>try catch</code></li> <li>ä½†æ˜¯è¦æ³¨æ„çº¿ä¸Šè¿è¡Œçš„ä»£ç éƒ½æ˜¯å‹ç¼©è¿‡çš„ï¼Œéœ€è¦åœ¨æ‰“åŒ…æ—¶ç”Ÿæˆ <code>sourceMap</code> æ–‡ä»¶ä¾¿äº <code>debug</code></li> <li>å¯¹äºæ•è·çš„é”™è¯¯éœ€è¦ä¸Šä¼ ç»™æœåŠ¡å™¨ï¼Œé€šå¸¸å¯ä»¥é€šè¿‡ <code>img</code> æ ‡ç­¾çš„ <code>src</code> å‘èµ·ä¸€ä¸ªè¯·æ±‚ã€‚</li> <li>å¦å¤–æ¥å£å¼‚å¸¸å°±ç›¸å¯¹æ¥è¯´ç®€å•äº†ï¼Œå¯ä»¥åˆ—ä¸¾å‡ºå‡ºé”™çš„çŠ¶æ€ç ã€‚ä¸€æ—¦å‡ºç°æ­¤ç±»çš„çŠ¶æ€ç å°±å¯ä»¥ç«‹å³ä¸ŠæŠ¥å‡ºé”™ã€‚æ¥å£å¼‚å¸¸ä¸ŠæŠ¥å¯ä»¥è®©å¼€å‘äººå‘˜è¿…é€ŸçŸ¥é“æœ‰å“ªäº›æ¥å£å‡ºç°äº†å¤§é¢ç§¯çš„æŠ¥é”™ï¼Œä»¥ä¾¿è¿…é€Ÿä¿®å¤é—®é¢˜ã€‚</li></ul> <h2 id="_31-tcp-udp"><a href="http://interview.poetries.top/docs/excellent.html#_31-tcp-udp" class="header-anchor">#</a> 31 TCP/UDP</h2> <h3 id="_31-1-udp"><a href="http://interview.poetries.top/docs/excellent.html#_31-1-udp" class="header-anchor">#</a> 31.1 UDP</h3> <blockquote><p>ç½‘ç»œåè®®æ˜¯æ¯ä¸ªå‰ç«¯å·¥ç¨‹å¸ˆéƒ½å¿…é¡»è¦æŒæ¡çš„çŸ¥è¯†ï¼Œæˆ‘ä»¬å°†å…ˆæ¥å­¦ä¹ ä¼ è¾“å±‚ä¸­çš„ä¸¤ä¸ªåè®®ï¼š<code>UDP</code> ä»¥åŠ<code>TCP</code>ã€‚å¯¹äºå¤§éƒ¨åˆ†å·¥ç¨‹å¸ˆæ¥è¯´æœ€å¸¸ç”¨çš„åè®®ä¹Ÿå°±æ˜¯è¿™ä¸¤ä¸ªäº†ï¼Œå¹¶ä¸”é¢è¯•ä¸­ç»å¸¸ä¼šæé—®çš„ä¹Ÿæ˜¯å…³äºè¿™ä¸¤ä¸ªåè®®çš„åŒºåˆ«</p></blockquote> <blockquote><p>å¸¸è€ƒé¢è¯•é¢˜ï¼š<code>UDP</code> ä¸ <code>TCP</code> çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</p></blockquote> <p>é¦–å…ˆ <code>UDP</code> åè®®æ˜¯é¢å‘æ— è¿æ¥çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸éœ€è¦åœ¨æ­£å¼ä¼ é€’æ•°æ®ä¹‹å‰å…ˆè¿æ¥èµ·åŒæ–¹ã€‚ç„¶å <code>UDP</code>åè®®åªæ˜¯æ•°æ®æŠ¥æ–‡çš„æ¬è¿å·¥ï¼Œä¸ä¿è¯æœ‰åºä¸”ä¸ä¸¢å¤±çš„ä¼ é€’åˆ°å¯¹ç«¯ï¼Œå¹¶ä¸”<code>UDP</code> åè®®ä¹Ÿæ²¡æœ‰ä»»ä½•æ§åˆ¶æµé‡çš„ç®—æ³•ï¼Œæ€»çš„æ¥è¯´ <code>UDP</code> ç›¸è¾ƒäº <code>TCP</code> æ›´åŠ çš„è½»ä¾¿</p> <p><strong>1. é¢å‘æ— è¿æ¥</strong></p> <ul><li>é¦–å…ˆ<code>UDP</code> æ˜¯ä¸éœ€è¦å’Œ <code>TCP</code> ä¸€æ ·åœ¨å‘é€æ•°æ®å‰è¿›è¡Œä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥çš„ï¼Œæƒ³å‘æ•°æ®å°±å¯ä»¥å¼€å§‹å‘é€äº†ã€‚</li> <li>å¹¶ä¸”ä¹Ÿåªæ˜¯æ•°æ®æŠ¥æ–‡çš„æ¬è¿å·¥ï¼Œä¸ä¼šå¯¹æ•°æ®æŠ¥æ–‡è¿›è¡Œä»»ä½•æ‹†åˆ†å’Œæ‹¼æ¥æ“ä½œã€‚</li></ul> <blockquote><p>å…·ä½“æ¥è¯´å°±æ˜¯ï¼š</p></blockquote> <ul><li>åœ¨å‘é€ç«¯ï¼Œåº”ç”¨å±‚å°†æ•°æ®ä¼ é€’ç»™ä¼ è¾“å±‚çš„ <code>UDP</code> åè®®ï¼Œ<code>UDP</code> åªä¼šç»™æ•°æ®å¢åŠ ä¸€ä¸ª <code>UDP</code> å¤´æ ‡è¯†ä¸‹æ˜¯ <code>UDP</code> åè®®ï¼Œç„¶åå°±ä¼ é€’ç»™ç½‘ç»œå±‚äº†
åœ¨æ¥æ”¶ç«¯ï¼Œç½‘ç»œå±‚å°†æ•°æ®ä¼ é€’ç»™ä¼ è¾“å±‚ï¼Œ<code>UDP</code> åªå»é™¤ <code>IP</code> æŠ¥æ–‡å¤´å°±ä¼ é€’ç»™åº”ç”¨å±‚ï¼Œä¸ä¼šä»»ä½•æ‹¼æ¥æ“ä½œ</li></ul> <p><strong>2. ä¸å¯é æ€§</strong></p> <ul><li>é¦–å…ˆä¸å¯é æ€§ä½“ç°åœ¨æ— è¿æ¥ä¸Šï¼Œé€šä¿¡éƒ½ä¸éœ€è¦å»ºç«‹è¿æ¥ï¼Œæƒ³å‘å°±å‘ï¼Œè¿™æ ·çš„æƒ…å†µè‚¯å®šä¸å¯é ã€‚</li> <li>å¹¶ä¸”æ”¶åˆ°ä»€ä¹ˆæ•°æ®å°±ä¼ é€’ä»€ä¹ˆæ•°æ®ï¼Œå¹¶ä¸”ä¹Ÿä¸ä¼šå¤‡ä»½æ•°æ®ï¼Œå‘é€æ•°æ®ä¹Ÿä¸ä¼šå…³å¿ƒå¯¹æ–¹æ˜¯å¦å·²ç»æ­£ç¡®æ¥æ”¶åˆ°æ•°æ®äº†ã€‚</li> <li>å†è€…ç½‘ç»œç¯å¢ƒæ—¶å¥½æ—¶åï¼Œä½†æ˜¯ <code>UDP</code> å› ä¸ºæ²¡æœ‰æ‹¥å¡æ§åˆ¶ï¼Œä¸€ç›´ä¼šä»¥æ’å®šçš„é€Ÿåº¦å‘é€æ•°æ®ã€‚å³ä½¿ç½‘ç»œæ¡ä»¶ä¸å¥½ï¼Œä¹Ÿä¸ä¼šå¯¹å‘é€é€Ÿç‡è¿›è¡Œè°ƒæ•´ã€‚è¿™æ ·å®ç°çš„å¼Šç«¯å°±æ˜¯åœ¨ç½‘ç»œæ¡ä»¶ä¸å¥½çš„æƒ…å†µä¸‹å¯èƒ½ä¼šå¯¼è‡´ä¸¢åŒ…ï¼Œä½†æ˜¯ä¼˜ç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œåœ¨æŸäº›å®æ—¶æ€§è¦æ±‚é«˜çš„åœºæ™¯ï¼ˆæ¯”å¦‚ç”µè¯ä¼šè®®ï¼‰å°±éœ€è¦ä½¿ç”¨ <code>UDP</code> è€Œä¸æ˜¯ <code>TCP</code></li></ul> <p><strong>3. é«˜æ•ˆ</strong></p> <ul><li>è™½ç„¶ <code>UDP</code> åè®®ä¸æ˜¯é‚£ä¹ˆçš„å¯é ï¼Œä½†æ˜¯æ­£æ˜¯å› ä¸ºå®ƒä¸æ˜¯é‚£ä¹ˆçš„å¯é ï¼Œæ‰€ä»¥ä¹Ÿå°±æ²¡æœ‰ <code>TCP</code> é‚£ä¹ˆå¤æ‚äº†ï¼Œéœ€è¦ä¿è¯æ•°æ®ä¸ä¸¢å¤±ä¸”æœ‰åºåˆ°è¾¾ã€‚</li> <li>å› æ­¤ <code>UDP</code> çš„å¤´éƒ¨å¼€é”€å°ï¼Œåªæœ‰å…«å­—èŠ‚ï¼Œç›¸æ¯” <code>TCP</code> çš„è‡³å°‘äºŒåå­—èŠ‚è¦å°‘å¾—å¤šï¼Œåœ¨ä¼ è¾“æ•°æ®æŠ¥æ–‡æ—¶æ˜¯å¾ˆé«˜æ•ˆçš„ã€‚</li></ul> <blockquote><p><code>UDP</code> å¤´éƒ¨åŒ…å«äº†ä»¥ä¸‹å‡ ä¸ªæ•°æ®</p></blockquote> <ul><li>ä¸¤ä¸ªåå…­ä½çš„ç«¯å£å·ï¼Œåˆ†åˆ«ä¸ºæºç«¯å£ï¼ˆå¯é€‰å­—æ®µï¼‰å’Œç›®æ ‡ç«¯å£
æ•´ä¸ªæ•°æ®æŠ¥æ–‡çš„é•¿åº¦</li> <li>æ•´ä¸ªæ•°æ®æŠ¥æ–‡çš„æ£€éªŒå’Œï¼ˆ<code>IPv4</code> å¯é€‰ å­—æ®µï¼‰ï¼Œè¯¥å­—æ®µç”¨äºå‘ç°å¤´éƒ¨ä¿¡æ¯å’Œæ•°æ®ä¸­çš„é”™è¯¯</li></ul> <p><strong>4. ä¼ è¾“æ–¹å¼</strong></p> <blockquote><p><code>UDP</code> ä¸æ­¢æ”¯æŒä¸€å¯¹ä¸€çš„ä¼ è¾“æ–¹å¼ï¼ŒåŒæ ·æ”¯æŒä¸€å¯¹å¤šï¼Œå¤šå¯¹å¤šï¼Œå¤šå¯¹ä¸€çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯è¯´ <code>UDP</code> æä¾›äº†å•æ’­ï¼Œå¤šæ’­ï¼Œå¹¿æ’­çš„åŠŸèƒ½ã€‚</p></blockquote> <p><strong>5. é€‚åˆä½¿ç”¨çš„åœºæ™¯</strong></p> <blockquote><p><code>UDP</code>è™½ç„¶å¯¹æ¯” <code>TCP</code> æœ‰å¾ˆå¤šç¼ºç‚¹ï¼Œä½†æ˜¯æ­£æ˜¯å› ä¸ºè¿™äº›ç¼ºç‚¹é€ å°±äº†å®ƒé«˜æ•ˆçš„ç‰¹æ€§ï¼Œåœ¨å¾ˆå¤šå®æ—¶æ€§è¦æ±‚é«˜çš„åœ°æ–¹éƒ½å¯ä»¥çœ‹åˆ° <code>UDP</code> çš„èº«å½±ã€‚</p></blockquote> <p><strong>5.1 ç›´æ’­</strong></p> <ul><li>æƒ³å¿…å¤§å®¶éƒ½çœ‹è¿‡ç›´æ’­å§ï¼Œå¤§å®¶å¯ä»¥è€ƒè™‘ä¸‹å¦‚æœç›´æ’­ä½¿ç”¨äº†åŸºäº TCP çš„åè®®ä¼šå‘ç”Ÿä»€ä¹ˆäº‹æƒ…ï¼Ÿ</li></ul> <blockquote><ul><li><code>TCP</code> ä¼šä¸¥æ ¼æ§åˆ¶ä¼ è¾“çš„æ­£ç¡®æ€§ï¼Œä¸€æ—¦æœ‰æŸä¸€ä¸ªæ•°æ®å¯¹ç«¯æ²¡æœ‰æ”¶åˆ°ï¼Œå°±ä¼šåœæ­¢ä¸‹æ¥ç›´åˆ°å¯¹ç«¯æ”¶åˆ°è¿™ä¸ªæ•°æ®ã€‚è¿™ç§é—®é¢˜åœ¨ç½‘ç»œæ¡ä»¶ä¸é”™çš„æƒ…å†µä¸‹å¯èƒ½å¹¶ä¸ä¼šå‘ç”Ÿä»€ä¹ˆäº‹æƒ…ï¼Œä½†æ˜¯åœ¨ç½‘ç»œæƒ…å†µå·®çš„æ—¶å€™å°±ä¼šå˜æˆç”»é¢å¡ä½ï¼Œç„¶åå†ç»§ç»­æ’­æ”¾ä¸‹ä¸€å¸§çš„æƒ…å†µã€‚</li> <li>ä½†æ˜¯å¯¹äºç›´æ’­æ¥è¯´ï¼Œç”¨æˆ·è‚¯å®šå…³æ³¨çš„æ˜¯æœ€æ–°çš„ç”»é¢ï¼Œè€Œä¸æ˜¯å› ä¸ºç½‘ç»œæ¡ä»¶å·®è€Œä¸¢å¤±çš„è€æ—§ç”»é¢ï¼Œæ‰€ä»¥ <code>TCP</code> åœ¨è¿™ç§æƒ…å†µä¸‹æ— ç”¨æ­¦ä¹‹åœ°ï¼Œåªä¼šé™ä½ç”¨æˆ·ä½“éªŒã€‚</li></ul></blockquote> <p><strong>5.2 ç‹è€…è£è€€</strong></p> <ul><li>é¦–å…ˆå¯¹äºç‹è€…è£è€€æ¥è¯´ï¼Œç”¨æˆ·ä½“é‡æ˜¯ç›¸å½“å¤§çš„ï¼Œå¦‚æœä½¿ç”¨ <code>TCP</code> è¿æ¥çš„è¯ï¼Œå°±å¯èƒ½ä¼šå‡ºç°æœåŠ¡å™¨ä¸å¤Ÿç”¨çš„æƒ…å†µï¼Œå› ä¸ºæ¯å°æœåŠ¡å™¨å¯ä¾›æ”¯æ’‘çš„ <code>TCP</code> è¿æ¥æ•°é‡æ˜¯æœ‰é™åˆ¶çš„ã€‚</li> <li>å†è€…ï¼Œå› ä¸º <code>TCP</code> ä¼šä¸¥æ ¼æ§åˆ¶ä¼ è¾“çš„æ­£ç¡®æ€§ï¼Œå¦‚æœå› ä¸ºç”¨æˆ·ç½‘ç»œæ¡ä»¶ä¸å¥½å°±é€ æˆé¡µé¢å¡é¡¿ç„¶åå†ä¼ è¾“æ—§çš„æ¸¸æˆç”»é¢æ˜¯è‚¯å®šä¸èƒ½æ¥å—çš„ï¼Œæ¯•ç«Ÿå¯¹äºè¿™ç±»å®æ—¶æ€§è¦æ±‚å¾ˆé«˜çš„æ¸¸æˆæ¥è¯´ï¼Œæœ€æ–°çš„æ¸¸æˆç”»é¢æ‰æ˜¯æœ€éœ€è¦çš„ï¼Œè€Œä¸æ˜¯è€æ—§çš„ç”»é¢ï¼Œå¦åˆ™è§’è‰²éƒ½ä¸çŸ¥é“æ­»å¤šå°‘æ¬¡äº†ã€‚</li></ul> <h3 id="_31-2-tcp"><a href="http://interview.poetries.top/docs/excellent.html#_31-2-tcp" class="header-anchor">#</a> 31.2 TCP</h3> <blockquote><p>å¸¸è€ƒé¢è¯•é¢˜ï¼š<code>UDP</code> ä¸ <code>TCP</code> çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</p></blockquote> <blockquote><p><code>TCP</code> åŸºæœ¬æ˜¯å’Œ <code>UDP</code> åç€æ¥ï¼Œå»ºç«‹è¿æ¥æ–­å¼€è¿æ¥éƒ½éœ€è¦å…ˆéœ€è¦è¿›è¡Œæ¡æ‰‹ã€‚åœ¨ä¼ è¾“æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡å„ç§ç®—æ³•ä¿è¯æ•°æ®çš„å¯é æ€§ï¼Œå½“ç„¶å¸¦æ¥çš„é—®é¢˜å°±æ˜¯ç›¸æ¯” <code>UDP</code> æ¥è¯´ä¸é‚£ä¹ˆçš„é«˜æ•ˆ</p></blockquote> <p><strong>1. å¤´éƒ¨</strong></p> <blockquote><p><code>TCP</code> å¤´éƒ¨æ¯” <code>UDP</code> å¤´éƒ¨å¤æ‚çš„å¤š</p></blockquote> <blockquote><p>å¯¹äº <code>TCP</code> å¤´éƒ¨æ¥è¯´ï¼Œä»¥ä¸‹å‡ ä¸ªå­—æ®µæ˜¯å¾ˆé‡è¦çš„</p></blockquote> <ul><li><code>Sequence number</code>ï¼Œè¿™ä¸ªåºå·ä¿è¯äº† TCP ä¼ è¾“çš„æŠ¥æ–‡éƒ½æ˜¯æœ‰åºçš„ï¼Œå¯¹ç«¯å¯ä»¥é€šè¿‡åºå·é¡ºåºçš„æ‹¼æ¥æŠ¥æ–‡</li> <li><code>Acknowledgement Number</code>ï¼Œè¿™ä¸ªåºå·è¡¨ç¤ºæ•°æ®æ¥æ”¶ç«¯æœŸæœ›æ¥æ”¶çš„ä¸‹ä¸€ä¸ªå­—èŠ‚çš„ç¼–å·æ˜¯å¤šå°‘ï¼ŒåŒæ—¶ä¹Ÿè¡¨ç¤ºä¸Šä¸€ä¸ªåºå·çš„æ•°æ®å·²ç»æ”¶åˆ°</li> <li><code>Window Size</code>ï¼Œçª—å£å¤§å°ï¼Œè¡¨ç¤ºè¿˜èƒ½æ¥æ”¶å¤šå°‘å­—èŠ‚çš„æ•°æ®ï¼Œç”¨äºæµé‡æ§åˆ¶</li> <li><strong>æ ‡è¯†ç¬¦</strong> <ul><li><code>URG=1</code>ï¼šè¯¥å­—æ®µä¸ºä¸€è¡¨ç¤ºæœ¬æ•°æ®æŠ¥çš„æ•°æ®éƒ¨åˆ†åŒ…å«ç´§æ€¥ä¿¡æ¯ï¼Œæ˜¯ä¸€ä¸ªé«˜ä¼˜å…ˆçº§æ•°æ®æŠ¥æ–‡ï¼Œæ­¤æ—¶ç´§æ€¥æŒ‡é’ˆæœ‰æ•ˆã€‚ç´§æ€¥æ•°æ®ä¸€å®šä½äºå½“å‰æ•°æ®åŒ…æ•°æ®éƒ¨åˆ†çš„æœ€å‰é¢ï¼Œç´§æ€¥æŒ‡é’ˆæ ‡æ˜äº†ç´§æ€¥æ•°æ®çš„å°¾éƒ¨ã€‚</li> <li><code>ACK=1</code>ï¼šè¯¥å­—æ®µä¸ºä¸€è¡¨ç¤ºç¡®è®¤å·å­—æ®µæœ‰æ•ˆã€‚æ­¤å¤–ï¼Œ<code>TCP</code> è¿˜è§„å®šåœ¨è¿æ¥å»ºç«‹åä¼ é€çš„æ‰€æœ‰æŠ¥æ–‡æ®µéƒ½å¿…é¡»æŠŠ <code>ACK</code> ç½®ä¸ºä¸€ã€‚</li> <li><code>PSH=1</code>ï¼šè¯¥å­—æ®µä¸ºä¸€è¡¨ç¤ºæ¥æ”¶ç«¯åº”è¯¥ç«‹å³å°†æ•°æ® <code>push</code> ç»™åº”ç”¨å±‚ï¼Œè€Œä¸æ˜¯ç­‰åˆ°ç¼“å†²åŒºæ»¡åå†æäº¤ã€‚</li> <li><code>RST=1</code>ï¼šè¯¥å­—æ®µä¸ºä¸€è¡¨ç¤ºå½“å‰ <code>TCP</code> è¿æ¥å‡ºç°ä¸¥é‡é—®é¢˜ï¼Œå¯èƒ½éœ€è¦é‡æ–°å»ºç«‹ TCP è¿æ¥ï¼Œä¹Ÿå¯ä»¥ç”¨äºæ‹’ç»éæ³•çš„æŠ¥æ–‡æ®µå’Œæ‹’ç»è¿æ¥è¯·æ±‚ã€‚</li> <li><code>SYN=1</code>ï¼šå½“<code>SYN=1</code>ï¼Œ<code>ACK=0</code>æ—¶ï¼Œè¡¨ç¤ºå½“å‰æŠ¥æ–‡æ®µæ˜¯ä¸€ä¸ªè¿æ¥è¯·æ±‚æŠ¥æ–‡ã€‚å½“  <code>SYN=1</code>ï¼Œ<code>ACK=1</code>æ—¶ï¼Œè¡¨ç¤ºå½“å‰æŠ¥æ–‡æ®µæ˜¯ä¸€ä¸ªåŒæ„å»ºç«‹è¿æ¥çš„åº”ç­”æŠ¥æ–‡ã€‚</li> <li><code>FIN=1</code>ï¼šè¯¥å­—æ®µä¸ºä¸€è¡¨ç¤ºæ­¤æŠ¥æ–‡æ®µæ˜¯ä¸€ä¸ªé‡Šæ”¾è¿æ¥çš„è¯·æ±‚æŠ¥æ–‡ã€‚</li></ul></li></ul> <p><strong>2. çŠ¶æ€æœº</strong></p> <blockquote><p><code>TCP</code> çš„çŠ¶æ€æœºæ˜¯å¾ˆå¤æ‚çš„ï¼Œå¹¶ä¸”ä¸å»ºç«‹æ–­å¼€è¿æ¥æ—¶çš„æ¡æ‰‹æ¯æ¯ç›¸å…³ï¼Œæ¥ä¸‹æ¥å°±æ¥è¯¦ç»†æè¿°ä¸‹ä¸¤ç§æ¡æ‰‹</p></blockquote> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/34.png" alt="" class="medium-zoom-image"></p> <blockquote><p>åœ¨è¿™ä¹‹å‰éœ€è¦äº†è§£ä¸€ä¸ªé‡è¦çš„æ€§èƒ½æŒ‡æ ‡ <code>RTT</code>ã€‚è¯¥æŒ‡æ ‡è¡¨ç¤ºå‘é€ç«¯å‘é€æ•°æ®åˆ°æ¥æ”¶åˆ°å¯¹ç«¯æ•°æ®æ‰€éœ€çš„å¾€è¿”æ—¶é—´</p></blockquote> <p><strong>2.1. å»ºç«‹è¿æ¥ä¸‰æ¬¡æ¡æ‰‹</strong></p> <ul><li>é¦–å…ˆå‡è®¾ä¸»åŠ¨å‘èµ·è¯·æ±‚çš„ä¸€ç«¯ç§°ä¸ºå®¢æˆ·ç«¯ï¼Œè¢«åŠ¨è¿æ¥çš„ä¸€ç«¯ç§°ä¸ºæœåŠ¡ç«¯ã€‚ä¸ç®¡æ˜¯å®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡ç«¯ï¼Œ<code>TCP</code> è¿æ¥å»ºç«‹å®Œåéƒ½èƒ½å‘é€å’Œæ¥æ”¶æ•°æ®ï¼Œæ‰€ä»¥ <code>TCP</code> æ˜¯ä¸€ä¸ªå…¨åŒå·¥çš„åè®®ã€‚</li> <li>èµ·åˆï¼Œä¸¤ç«¯éƒ½ä¸º <code>CLOSED</code> çŠ¶æ€ã€‚åœ¨é€šä¿¡å¼€å§‹å‰ï¼ŒåŒæ–¹éƒ½ä¼šåˆ›å»º <code>TCB</code>ã€‚ æœåŠ¡å™¨åˆ›å»ºå®Œ <code>TCB</code> åä¾¿è¿›å…¥ <code>LISTEN</code> çŠ¶æ€ï¼Œæ­¤æ—¶å¼€å§‹ç­‰å¾…å®¢æˆ·ç«¯å‘é€æ•°æ®</li></ul> <p><strong>ç¬¬ä¸€æ¬¡æ¡æ‰‹</strong></p> <blockquote><p>å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µã€‚è¯¥æŠ¥æ–‡æ®µä¸­åŒ…å«è‡ªèº«çš„æ•°æ®é€šè®¯åˆå§‹åºå·ã€‚è¯·æ±‚å‘é€åï¼Œå®¢æˆ·ç«¯ä¾¿è¿›å…¥ <code>SYN-SENT</code> çŠ¶æ€</p></blockquote> <p><strong>ç¬¬äºŒæ¬¡æ¡æ‰‹</strong></p> <blockquote><p>æœåŠ¡ç«¯æ”¶åˆ°è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µåï¼Œå¦‚æœåŒæ„è¿æ¥ï¼Œåˆ™ä¼šå‘é€ä¸€ä¸ªåº”ç­”ï¼Œè¯¥åº”ç­”ä¸­ä¹Ÿä¼šåŒ…å«è‡ªèº«çš„æ•°æ®é€šè®¯åˆå§‹åºå·ï¼Œå‘é€å®Œæˆåä¾¿è¿›å…¥ <code>SYN-RECEIVED</code> çŠ¶æ€</p></blockquote> <p><strong>ç¬¬ä¸‰æ¬¡æ¡æ‰‹</strong></p> <ul><li>å½“å®¢æˆ·ç«¯æ”¶åˆ°è¿æ¥åŒæ„çš„åº”ç­”åï¼Œè¿˜è¦å‘æœåŠ¡ç«¯å‘é€ä¸€ä¸ªç¡®è®¤æŠ¥æ–‡ã€‚å®¢æˆ·ç«¯å‘å®Œè¿™ä¸ªæŠ¥æ–‡æ®µåä¾¿è¿›å…¥ <code>ESTABLISHED</code> çŠ¶æ€ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°è¿™ä¸ªåº”ç­”åä¹Ÿè¿›å…¥ <code>ESTABLISHED</code> çŠ¶æ€ï¼Œæ­¤æ—¶è¿æ¥å»ºç«‹æˆåŠŸã€‚</li> <li>PSï¼šç¬¬ä¸‰æ¬¡æ¡æ‰‹ä¸­å¯ä»¥åŒ…å«æ•°æ®ï¼Œé€šè¿‡å¿«é€Ÿæ‰“å¼€ï¼ˆ<code>TFO</code>ï¼‰æŠ€æœ¯å°±å¯ä»¥å®ç°è¿™ä¸€åŠŸèƒ½ã€‚å…¶å®åªè¦æ¶‰åŠåˆ°æ¡æ‰‹çš„åè®®ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ç±»ä¼¼ <code>TFO</code> çš„æ–¹å¼ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å­˜å‚¨ç›¸åŒçš„ <code>cookie</code>ï¼Œä¸‹æ¬¡æ¡æ‰‹æ—¶å‘å‡º <code>cookie</code> è¾¾åˆ°å‡å°‘ <code>RTT</code> çš„ç›®çš„ã€‚</li></ul> <blockquote><p>å¸¸è€ƒé¢è¯•é¢˜ï¼šä¸ºä»€ä¹ˆ <code>TCP</code> å»ºç«‹è¿æ¥éœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Œæ˜æ˜ä¸¤æ¬¡å°±å¯ä»¥å»ºç«‹èµ·è¿æ¥</p></blockquote> <ul><li>å› ä¸ºè¿™æ˜¯ä¸ºäº†é˜²æ­¢å‡ºç°å¤±æ•ˆçš„è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µè¢«æœåŠ¡ç«¯æ¥æ”¶çš„æƒ…å†µï¼Œä»è€Œäº§ç”Ÿé”™è¯¯ã€‚</li> <li>å¯ä»¥æƒ³è±¡å¦‚ä¸‹åœºæ™¯ã€‚å®¢æˆ·ç«¯å‘é€äº†ä¸€ä¸ªè¿æ¥è¯·æ±‚ <code>A</code>ï¼Œä½†æ˜¯å› ä¸ºç½‘ç»œåŸå› é€ æˆäº†è¶…æ—¶ï¼Œè¿™æ—¶ <code>TCP</code> ä¼šå¯åŠ¨è¶…æ—¶é‡ä¼ çš„æœºåˆ¶å†æ¬¡å‘é€ä¸€ä¸ªè¿æ¥è¯·æ±‚ <code>B</code>ã€‚æ­¤æ—¶è¯·æ±‚é¡ºåˆ©åˆ°è¾¾æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯åº”ç­”å®Œå°±å»ºç«‹äº†è¯·æ±‚ï¼Œç„¶åæ¥æ”¶æ•°æ®åé‡Šæ”¾äº†è¿æ¥ã€‚</li></ul> <blockquote><p>å‡è®¾è¿™æ—¶å€™è¿æ¥è¯·æ±‚ <code>A</code> åœ¨ä¸¤ç«¯å…³é—­åç»ˆäºæŠµè¾¾äº†æœåŠ¡ç«¯ï¼Œé‚£ä¹ˆæ­¤æ—¶æœåŠ¡ç«¯ä¼šè®¤ä¸ºå®¢æˆ·ç«¯åˆéœ€è¦å»ºç«‹ <code>TCP</code> è¿æ¥ï¼Œä»è€Œåº”ç­”äº†è¯¥è¯·æ±‚å¹¶è¿›å…¥ <code>ESTABLISHED</code> çŠ¶æ€ã€‚ä½†æ˜¯å®¢æˆ·ç«¯å…¶å®æ˜¯ <code>CLOSED</code> çš„çŠ¶æ€ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´æœåŠ¡ç«¯ä¸€ç›´ç­‰å¾…ï¼Œé€ æˆèµ„æºçš„æµªè´¹ã€‚</p></blockquote> <blockquote><p>PSï¼šåœ¨å»ºç«‹è¿æ¥ä¸­ï¼Œä»»æ„ä¸€ç«¯æ‰çº¿ï¼Œ<code>TCP</code> éƒ½ä¼šé‡å‘ <code>SYN</code> åŒ…ï¼Œä¸€èˆ¬ä¼šé‡è¯•äº”æ¬¡ï¼Œåœ¨å»ºç«‹è¿æ¥ä¸­å¯èƒ½ä¼šé‡åˆ° <code>SYN Flood</code> æ”»å‡»ã€‚é‡åˆ°è¿™ç§æƒ…å†µä½ å¯ä»¥é€‰æ‹©è°ƒä½é‡è¯•æ¬¡æ•°æˆ–è€…å¹²è„†åœ¨ä¸èƒ½å¤„ç†çš„æƒ…å†µä¸‹æ‹’ç»è¯·æ±‚</p></blockquote> <p><strong>2.2. æ–­å¼€é“¾æ¥å››æ¬¡æ¡æ‰‹</strong></p> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/35.png" alt="" class="medium-zoom-image"></p> <blockquote><p><code>TCP</code> æ˜¯å…¨åŒå·¥çš„ï¼Œåœ¨æ–­å¼€è¿æ¥æ—¶ä¸¤ç«¯éƒ½éœ€è¦å‘é€ <code>FIN</code> å’Œ <code>ACK</code></p></blockquote> <p><strong>ç¬¬ä¸€æ¬¡æ¡æ‰‹</strong></p> <blockquote><p>è‹¥å®¢æˆ·ç«¯ <code>A</code> è®¤ä¸ºæ•°æ®å‘é€å®Œæˆï¼Œåˆ™å®ƒéœ€è¦å‘æœåŠ¡ç«¯ <code>B</code> å‘é€è¿æ¥é‡Šæ”¾è¯·æ±‚ã€‚</p></blockquote> <p><strong>ç¬¬äºŒæ¬¡æ¡æ‰‹</strong></p> <blockquote><p><code>B</code> æ”¶åˆ°è¿æ¥é‡Šæ”¾è¯·æ±‚åï¼Œä¼šå‘Šè¯‰åº”ç”¨å±‚è¦é‡Šæ”¾ <code>TCP</code> é“¾æ¥ã€‚ç„¶åä¼šå‘é€ <code>ACK</code> åŒ…ï¼Œå¹¶è¿›å…¥ <code>CLOSE_WAIT</code>çŠ¶æ€ï¼Œæ­¤æ—¶è¡¨æ˜ <code>A</code> åˆ° <code>B</code> çš„è¿æ¥å·²ç»é‡Šæ”¾ï¼Œä¸å†æ¥æ”¶ <code>A</code> å‘çš„æ•°æ®äº†ã€‚ä½†æ˜¯å› ä¸º <code>TCP</code> è¿æ¥æ˜¯åŒå‘çš„ï¼Œæ‰€ä»¥ <code>B</code> ä»æ—§å¯ä»¥å‘é€æ•°æ®ç»™ <code>A</code></p></blockquote> <p><strong>3. ARQ åè®®</strong></p> <blockquote><p><code>ARQ</code> åè®®ä¹Ÿå°±æ˜¯è¶…æ—¶é‡ä¼ æœºåˆ¶ã€‚é€šè¿‡ç¡®è®¤å’Œè¶…æ—¶æœºåˆ¶ä¿è¯äº†æ•°æ®çš„æ­£ç¡®é€è¾¾ï¼Œ<code>ARQ</code> åè®®åŒ…å«åœæ­¢ç­‰å¾… <code>ARQ</code> å’Œè¿ç»­ <code>ARQ</code> ä¸¤ç§åè®®ã€‚</p></blockquote> <p><strong>åœæ­¢ç­‰å¾… ARQ</strong></p> <p><strong>æ­£å¸¸ä¼ è¾“è¿‡ç¨‹</strong></p> <blockquote><p>åªè¦ A å‘ B å‘é€ä¸€æ®µæŠ¥æ–‡ï¼Œéƒ½è¦åœæ­¢å‘é€å¹¶å¯åŠ¨ä¸€ä¸ªå®šæ—¶å™¨ï¼Œç­‰å¾…å¯¹ç«¯å›åº”ï¼Œåœ¨å®šæ—¶å™¨æ—¶é—´å†…æ¥æ”¶åˆ°å¯¹ç«¯åº”ç­”å°±å–æ¶ˆå®šæ—¶å™¨å¹¶å‘é€ä¸‹ä¸€æ®µæŠ¥æ–‡ã€‚</p></blockquote> <p><strong>æŠ¥æ–‡ä¸¢å¤±æˆ–å‡ºé”™</strong></p> <ul><li>åœ¨æŠ¥æ–‡ä¼ è¾“çš„è¿‡ç¨‹ä¸­å¯èƒ½ä¼šå‡ºç°ä¸¢åŒ…ã€‚è¿™æ—¶å€™è¶…è¿‡å®šæ—¶å™¨è®¾å®šçš„æ—¶é—´å°±ä¼šå†æ¬¡å‘é€ä¸¢å¤±çš„æ•°æ®ç›´åˆ°å¯¹ç«¯å“åº”ï¼Œæ‰€ä»¥éœ€è¦æ¯æ¬¡éƒ½å¤‡ä»½å‘é€çš„æ•°æ®ã€‚</li> <li>å³ä½¿æŠ¥æ–‡æ­£å¸¸çš„ä¼ è¾“åˆ°å¯¹ç«¯ï¼Œä¹Ÿå¯èƒ½å‡ºç°åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æŠ¥æ–‡å‡ºé”™çš„é—®é¢˜ã€‚è¿™æ—¶å€™å¯¹ç«¯ä¼šæŠ›å¼ƒè¯¥æŠ¥æ–‡å¹¶ç­‰å¾… <code>A</code> ç«¯é‡ä¼ ã€‚</li> <li>PSï¼šä¸€èˆ¬å®šæ—¶å™¨è®¾å®šçš„æ—¶é—´éƒ½ä¼šå¤§äºä¸€ä¸ª <code>RTT</code> çš„å¹³å‡æ—¶é—´ã€‚</li></ul> <p><strong>ç¬¬ä¸‰æ¬¡æ¡æ‰‹</strong></p> <ul><li><code>B</code> å¦‚æœæ­¤æ—¶è¿˜æœ‰æ²¡å‘å®Œçš„æ•°æ®ä¼šç»§ç»­å‘é€ï¼Œå®Œæ¯•åä¼šå‘ <code>A</code> å‘é€è¿æ¥é‡Šæ”¾è¯·æ±‚ï¼Œç„¶å <code>B</code> ä¾¿è¿›å…¥ <code>LAST-ACK</code> çŠ¶æ€ã€‚</li> <li>PSï¼šé€šè¿‡å»¶è¿Ÿç¡®è®¤çš„æŠ€æœ¯ï¼ˆé€šå¸¸æœ‰æ—¶é—´é™åˆ¶ï¼Œå¦åˆ™å¯¹æ–¹ä¼šè¯¯è®¤ä¸ºéœ€è¦é‡ä¼ ï¼‰ï¼Œå¯ä»¥å°†ç¬¬äºŒæ¬¡å’Œç¬¬ä¸‰æ¬¡æ¡æ‰‹åˆå¹¶ï¼Œå»¶è¿Ÿ <code>ACK</code> åŒ…çš„å‘é€ã€‚</li></ul> <p><strong>ç¬¬å››æ¬¡æ¡æ‰‹</strong></p> <blockquote><p>A æ”¶åˆ°é‡Šæ”¾è¯·æ±‚åï¼Œå‘ B å‘é€ç¡®è®¤åº”ç­”ï¼Œæ­¤æ—¶ A è¿›å…¥ TIME-WAIT çŠ¶æ€ã€‚è¯¥çŠ¶æ€ä¼šæŒç»­ 2MSLï¼ˆæœ€å¤§æ®µç”Ÿå­˜æœŸï¼ŒæŒ‡æŠ¥æ–‡æ®µåœ¨ç½‘ç»œä¸­ç”Ÿå­˜çš„æ—¶é—´ï¼Œè¶…æ—¶ä¼šè¢«æŠ›å¼ƒï¼‰ æ—¶é—´ï¼Œè‹¥è¯¥æ—¶é—´æ®µå†…æ²¡æœ‰ B çš„é‡å‘è¯·æ±‚çš„è¯ï¼Œå°±è¿›å…¥ CLOSED çŠ¶æ€ã€‚å½“ B æ”¶åˆ°ç¡®è®¤åº”ç­”åï¼Œä¹Ÿä¾¿è¿›å…¥ CLOSED çŠ¶æ€ã€‚</p></blockquote> <ul><li>ä¸ºä»€ä¹ˆ A è¦è¿›å…¥ TIME-WAIT çŠ¶æ€ï¼Œç­‰å¾… 2MSL æ—¶é—´åæ‰è¿›å…¥ CLOSED çŠ¶æ€ï¼Ÿ</li> <li>ä¸ºäº†ä¿è¯ B èƒ½æ”¶åˆ° A çš„ç¡®è®¤åº”ç­”ã€‚è‹¥ A å‘å®Œç¡®è®¤åº”ç­”åç›´æ¥è¿›å…¥ CLOSED çŠ¶æ€ï¼Œå¦‚æœç¡®è®¤åº”ç­”å› ä¸ºç½‘ç»œé—®é¢˜ä¸€ç›´æ²¡æœ‰åˆ°è¾¾ï¼Œé‚£ä¹ˆä¼šé€ æˆ B ä¸èƒ½æ­£å¸¸å…³é—­ã€‚</li></ul> <p><strong>ACK è¶…æ—¶æˆ–ä¸¢å¤±</strong></p> <ul><li>å¯¹ç«¯ä¼ è¾“çš„åº”ç­”ä¹Ÿå¯èƒ½å‡ºç°ä¸¢å¤±æˆ–è¶…æ—¶çš„æƒ…å†µã€‚é‚£ä¹ˆè¶…è¿‡å®šæ—¶å™¨æ—¶é—´ A ç«¯ç…§æ ·ä¼šé‡ä¼ æŠ¥æ–‡ã€‚è¿™æ—¶å€™ B ç«¯æ”¶åˆ°ç›¸åŒåºå·çš„æŠ¥æ–‡ä¼šä¸¢å¼ƒè¯¥æŠ¥æ–‡å¹¶é‡ä¼ åº”ç­”ï¼Œç›´åˆ° A ç«¯å‘é€ä¸‹ä¸€ä¸ªåºå·çš„æŠ¥æ–‡ã€‚</li> <li>åœ¨è¶…æ—¶çš„æƒ…å†µä¸‹ä¹Ÿå¯èƒ½å‡ºç°åº”ç­”å¾ˆè¿Ÿåˆ°è¾¾ï¼Œè¿™æ—¶ A ç«¯ä¼šåˆ¤æ–­è¯¥åºå·æ˜¯å¦å·²ç»æ¥æ”¶è¿‡ï¼Œå¦‚æœæ¥æ”¶è¿‡åªéœ€è¦ä¸¢å¼ƒåº”ç­”å³å¯ã€‚</li> <li>ä»ä¸Šé¢çš„æè¿°ä¸­å¤§å®¶è‚¯å®šå¯ä»¥å‘ç°è¿™è‚¯å®šä¸æ˜¯ä¸€ä¸ªé«˜æ•ˆçš„æ–¹å¼ã€‚å‡è®¾åœ¨è‰¯å¥½çš„ç½‘ç»œç¯å¢ƒä¸­ï¼Œæ¯æ¬¡å‘é€æ•°æ®éƒ½éœ€è¦ç­‰å¾…ç‰‡åˆ»è‚¯å®šæ˜¯ä¸èƒ½æ¥å—çš„ã€‚é‚£ä¹ˆæ—¢ç„¶æˆ‘ä»¬ä¸èƒ½æ¥å—è¿™ä¸ªä¸é‚£ä¹ˆé«˜æ•ˆçš„åè®®ï¼Œå°±æ¥ç»§ç»­å­¦ä¹ ç›¸å¯¹é«˜æ•ˆçš„åè®®å§ã€‚</li></ul> <p><strong>è¿ç»­ ARQ</strong></p> <blockquote><p>åœ¨è¿ç»­ ARQ ä¸­ï¼Œå‘é€ç«¯æ‹¥æœ‰ä¸€ä¸ªå‘é€çª—å£ï¼Œå¯ä»¥åœ¨æ²¡æœ‰æ”¶åˆ°åº”ç­”çš„æƒ…å†µä¸‹æŒç»­å‘é€çª—å£å†…çš„æ•°æ®ï¼Œè¿™æ ·ç›¸æ¯”åœæ­¢ç­‰å¾… ARQ åè®®æ¥è¯´å‡å°‘äº†ç­‰å¾…æ—¶é—´ï¼Œæé«˜äº†æ•ˆç‡ã€‚</p></blockquote> <p><strong>ç´¯è®¡ç¡®è®¤</strong></p> <blockquote><p>è¿ç»­ ARQ ä¸­ï¼Œæ¥æ”¶ç«¯ä¼šæŒç»­ä¸æ–­æ”¶åˆ°æŠ¥æ–‡ã€‚å¦‚æœå’Œåœæ­¢ç­‰å¾… ARQ ä¸­æ¥æ”¶ä¸€ä¸ªæŠ¥æ–‡å°±å‘é€ä¸€ä¸ªåº”ç­”ä¸€æ ·ï¼Œå°±å¤ªæµªè´¹èµ„æºäº†ã€‚é€šè¿‡ç´¯è®¡ç¡®è®¤ï¼Œå¯ä»¥åœ¨æ”¶åˆ°å¤šä¸ªæŠ¥æ–‡ä»¥åç»Ÿä¸€å›å¤ä¸€ä¸ªåº”ç­”æŠ¥æ–‡ã€‚æŠ¥æ–‡ä¸­çš„ ACK æ ‡å¿—ä½å¯ä»¥ç”¨æ¥å‘Šè¯‰å‘é€ç«¯è¿™ä¸ªåºå·ä¹‹å‰çš„æ•°æ®å·²ç»å…¨éƒ¨æ¥æ”¶åˆ°äº†ï¼Œä¸‹æ¬¡è¯·å‘é€è¿™ä¸ªåºå·åçš„æ•°æ®ã€‚</p></blockquote> <blockquote><p>ä½†æ˜¯ç´¯è®¡ç¡®è®¤ä¹Ÿæœ‰ä¸€ä¸ªå¼Šç«¯ã€‚åœ¨è¿ç»­æ¥æ”¶æŠ¥æ–‡æ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ°æ¥æ”¶åˆ°åºå· 5 çš„æŠ¥æ–‡åï¼Œå¹¶æœªæ¥æ”¶åˆ°åºå· 6 çš„æŠ¥æ–‡ï¼Œç„¶è€Œåºå· 7 ä»¥åçš„æŠ¥æ–‡å·²ç»æ¥æ”¶ã€‚é‡åˆ°è¿™ç§æƒ…å†µæ—¶ï¼ŒACK åªèƒ½å›å¤ 6ï¼Œè¿™æ ·å°±ä¼šé€ æˆå‘é€ç«¯é‡å¤å‘é€æ•°æ®çš„æƒ…å†µ</p></blockquote> <p><strong>4. æ»‘åŠ¨çª—å£</strong></p> <ul><li>ä¸Šé¢å°èŠ‚ä¸­è®²åˆ°äº†å‘é€çª—å£ã€‚åœ¨ <code>TCP</code> ä¸­ï¼Œä¸¤ç«¯å…¶å®éƒ½ç»´æŠ¤ç€çª—å£ï¼šåˆ†åˆ«ä¸ºå‘é€ç«¯çª—å£å’Œæ¥æ”¶ç«¯çª—å£ã€‚</li> <li>å‘é€ç«¯çª—å£åŒ…å«å·²å‘é€ä½†æœªæ”¶åˆ°åº”ç­”çš„æ•°æ®å’Œå¯ä»¥å‘é€ä½†æ˜¯æœªå‘é€çš„æ•°æ®ã€‚</li></ul> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/36.png" alt="" class="medium-zoom-image"></p> <ul><li>å‘é€ç«¯çª—å£æ˜¯ç”±æ¥æ”¶çª—å£å‰©ä½™å¤§å°å†³å®šçš„ã€‚æ¥æ”¶æ–¹ä¼šæŠŠå½“å‰æ¥æ”¶çª—å£çš„å‰©ä½™å¤§å°å†™å…¥åº”ç­”æŠ¥æ–‡ï¼Œå‘é€ç«¯æ”¶åˆ°åº”ç­”åæ ¹æ®è¯¥å€¼å’Œå½“å‰ç½‘ç»œæ‹¥å¡æƒ…å†µè®¾ç½®å‘é€çª—å£çš„å¤§å°ï¼Œæ‰€ä»¥å‘é€çª—å£çš„å¤§å°æ˜¯ä¸æ–­å˜åŒ–çš„ã€‚</li> <li>å½“å‘é€ç«¯æ¥æ”¶åˆ°åº”ç­”æŠ¥æ–‡åï¼Œä¼šéšä¹‹å°†çª—å£è¿›è¡Œæ»‘åŠ¨</li></ul> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/37.png" alt="" class="medium-zoom-image"></p> <blockquote><p>æ»‘åŠ¨çª—å£æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„æ¦‚å¿µï¼Œå®ƒå¸®åŠ© TCP å®ç°äº†æµé‡æ§åˆ¶çš„åŠŸèƒ½ã€‚æ¥æ”¶æ–¹é€šè¿‡æŠ¥æ–‡å‘ŠçŸ¥å‘é€æ–¹è¿˜å¯ä»¥å‘é€å¤šå°‘æ•°æ®ï¼Œä»è€Œä¿è¯æ¥æ”¶æ–¹èƒ½å¤Ÿæ¥å¾—åŠæ¥æ”¶æ•°æ®ï¼Œé˜²æ­¢å‡ºç°æ¥æ”¶æ–¹å¸¦å®½å·²æ»¡ï¼Œä½†æ˜¯å‘é€æ–¹è¿˜ä¸€ç›´å‘é€æ•°æ®çš„æƒ…å†µ</p></blockquote> <p><strong>Zero çª—å£</strong></p> <blockquote><p>åœ¨å‘é€æŠ¥æ–‡çš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šé‡åˆ°å¯¹ç«¯å‡ºç°é›¶çª—å£çš„æƒ…å†µã€‚åœ¨è¯¥æƒ…å†µä¸‹ï¼Œå‘é€ç«¯ä¼šåœæ­¢å‘é€æ•°æ®ï¼Œå¹¶å¯åŠ¨ <code>persistent timer</code> ã€‚è¯¥å®šæ—¶å™¨ä¼šå®šæ—¶å‘é€è¯·æ±‚ç»™å¯¹ç«¯ï¼Œè®©å¯¹ç«¯å‘ŠçŸ¥çª—å£å¤§å°ã€‚åœ¨é‡è¯•æ¬¡æ•°è¶…è¿‡ä¸€å®šæ¬¡æ•°åï¼Œå¯èƒ½ä¼šä¸­æ–­ <code>TCP</code> é“¾æ¥</p></blockquote> <p><strong>5. æ‹¥å¡å¤„ç†</strong></p> <ul><li>æ‹¥å¡å¤„ç†å’Œæµé‡æ§åˆ¶ä¸åŒï¼Œåè€…æ˜¯ä½œç”¨äºæ¥æ”¶æ–¹ï¼Œä¿è¯æ¥æ”¶æ–¹æ¥å¾—åŠæ¥å—æ•°æ®ã€‚è€Œå‰è€…æ˜¯ä½œç”¨äºç½‘ç»œï¼Œé˜²æ­¢è¿‡å¤šçš„æ•°æ®æ‹¥å¡ç½‘ç»œï¼Œé¿å…å‡ºç°ç½‘ç»œè´Ÿè½½è¿‡å¤§çš„æƒ…å†µã€‚</li> <li>æ‹¥å¡å¤„ç†åŒ…æ‹¬äº†å››ä¸ªç®—æ³•ï¼Œåˆ†åˆ«ä¸ºï¼šæ…¢å¼€å§‹ï¼Œæ‹¥å¡é¿å…ï¼Œå¿«é€Ÿé‡ä¼ ï¼Œå¿«é€Ÿæ¢å¤</li></ul> <p><strong>æ…¢å¼€å§‹ç®—æ³•</strong></p> <blockquote><p>æ…¢å¼€å§‹ç®—æ³•ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯åœ¨ä¼ è¾“å¼€å§‹æ—¶å°†å‘é€çª—å£æ…¢æ…¢æŒ‡æ•°çº§æ‰©å¤§ï¼Œä»è€Œé¿å…ä¸€å¼€å§‹å°±ä¼ è¾“å¤§é‡æ•°æ®å¯¼è‡´ç½‘ç»œæ‹¥å¡ã€‚æƒ³å¿…å¤§å®¶éƒ½ä¸‹è½½è¿‡èµ„æºï¼Œæ¯å½“æˆ‘ä»¬å¼€å§‹ä¸‹è½½çš„æ—¶å€™éƒ½ä¼šå‘ç°ä¸‹è½½é€Ÿåº¦æ˜¯æ…¢æ…¢æå‡çš„ï¼Œè€Œä¸æ˜¯ä¸€è¹´è€Œå°±ç›´æ¥æ‹‰æ»¡å¸¦å®½</p></blockquote> <p><strong>æ…¢å¼€å§‹ç®—æ³•æ­¥éª¤å…·ä½“å¦‚ä¸‹</strong></p> <ul><li>è¿æ¥åˆå§‹è®¾ç½®æ‹¥å¡çª—å£ï¼ˆCongestion Windowï¼‰ ä¸º <code>1 MSS</code>ï¼ˆä¸€ä¸ªåˆ†æ®µçš„æœ€å¤§æ•°æ®é‡ï¼‰</li> <li>æ¯è¿‡ä¸€ä¸ª <code>RTT</code> å°±å°†çª—å£å¤§å°ä¹˜äºŒ</li> <li>æŒ‡æ•°çº§å¢é•¿è‚¯å®šä¸èƒ½æ²¡æœ‰é™åˆ¶çš„ï¼Œæ‰€ä»¥æœ‰ä¸€ä¸ªé˜ˆå€¼é™åˆ¶ï¼Œå½“çª—å£å¤§å°å¤§äºé˜ˆå€¼æ—¶å°±ä¼šå¯åŠ¨æ‹¥å¡é¿å…ç®—æ³•ã€‚</li></ul> <p><strong>æ‹¥å¡é¿å…ç®—æ³•</strong></p> <ul><li>æ‹¥å¡é¿å…ç®—æ³•ç›¸æ¯”ç®€å•ç‚¹ï¼Œæ¯è¿‡ä¸€ä¸ª <code>RTT</code> çª—å£å¤§å°åªåŠ ä¸€ï¼Œè¿™æ ·èƒ½å¤Ÿé¿å…æŒ‡æ•°çº§å¢é•¿å¯¼è‡´ç½‘ç»œæ‹¥å¡ï¼Œæ…¢æ…¢å°†å¤§å°è°ƒæ•´åˆ°æœ€ä½³å€¼ã€‚</li> <li>åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­å¯èƒ½å®šæ—¶å™¨è¶…æ—¶çš„æƒ…å†µï¼Œè¿™æ—¶å€™ <code>TCP</code> ä¼šè®¤ä¸ºç½‘ç»œæ‹¥å¡äº†ï¼Œä¼šé©¬ä¸Šè¿›è¡Œä»¥ä¸‹æ­¥éª¤ï¼š</li></ul> <ol><li>å°†é˜ˆå€¼è®¾ä¸ºå½“å‰æ‹¥å¡çª—å£çš„ä¸€åŠ</li> <li>å°†æ‹¥å¡çª—å£è®¾ä¸º <code>1 MSS</code></li> <li>å¯åŠ¨æ‹¥å¡é¿å…ç®—æ³•</li></ol> <p><strong>å¿«é€Ÿé‡ä¼ </strong></p> <blockquote><p>å¿«é€Ÿé‡ä¼ ä¸€èˆ¬å’Œå¿«æ¢å¤ä¸€èµ·å‡ºç°ã€‚ä¸€æ—¦æ¥æ”¶ç«¯æ”¶åˆ°çš„æŠ¥æ–‡å‡ºç°å¤±åºçš„æƒ…å†µï¼Œæ¥æ”¶ç«¯åªä¼šå›å¤æœ€åä¸€ä¸ªé¡ºåºæ­£ç¡®çš„æŠ¥æ–‡åºå·ã€‚å¦‚æœå‘é€ç«¯æ”¶åˆ°ä¸‰ä¸ªé‡å¤çš„ <code>ACK</code>ï¼Œæ— éœ€ç­‰å¾…å®šæ—¶å™¨è¶…æ—¶è€Œæ˜¯ç›´æ¥å¯åŠ¨å¿«é€Ÿé‡ä¼ ç®—æ³•ã€‚å…·ä½“ç®—æ³•åˆ†ä¸ºä¸¤ç§ï¼š</p></blockquote> <p><strong>TCP Taho å®ç°å¦‚ä¸‹</strong></p> <ul><li>å°†é˜ˆå€¼è®¾ä¸ºå½“å‰æ‹¥å¡çª—å£çš„ä¸€åŠ</li> <li>å°†æ‹¥å¡çª—å£è®¾ä¸º 1 MSS</li> <li>é‡æ–°å¼€å§‹æ…¢å¼€å§‹ç®—æ³•</li> <li><code>TCP Reno</code> å®ç°å¦‚ä¸‹</li></ul> <p><strong>æ‹¥å¡çª—å£å‡åŠ</strong></p> <ul><li>å°†é˜ˆå€¼è®¾ä¸ºå½“å‰æ‹¥å¡çª—å£</li> <li>è¿›å…¥å¿«æ¢å¤é˜¶æ®µï¼ˆé‡å‘å¯¹ç«¯éœ€è¦çš„åŒ…ï¼Œä¸€æ—¦æ”¶åˆ°ä¸€ä¸ªæ–°çš„ ACK ç­”å¤å°±é€€å‡ºè¯¥é˜¶æ®µï¼‰ï¼Œè¿™ç§æ–¹å¼åœ¨ä¸¢å¤±å¤šä¸ªåŒ…çš„æƒ…å†µä¸‹å°±ä¸é‚£ä¹ˆå¥½äº†</li> <li>ä½¿ç”¨æ‹¥å¡é¿å…ç®—æ³•</li></ul> <p><strong>TCP New Ren æ”¹è¿›åçš„å¿«æ¢å¤</strong></p> <ul><li>TCP New Reno ç®—æ³•æ”¹è¿›äº†ä¹‹å‰ TCP Reno ç®—æ³•çš„ç¼ºé™·ã€‚åœ¨ä¹‹å‰ï¼Œå¿«æ¢å¤ä¸­åªè¦æ”¶åˆ°ä¸€ä¸ªæ–°çš„ ACK åŒ…ï¼Œå°±ä¼šé€€å‡ºå¿«æ¢å¤ã€‚</li> <li>åœ¨ TCP New Reno ä¸­ï¼ŒTCP å‘é€æ–¹å…ˆè®°ä¸‹ä¸‰ä¸ªé‡å¤ ACK çš„åˆ†æ®µçš„æœ€å¤§åºå·ã€‚</li></ul> <blockquote><p>å‡å¦‚æˆ‘æœ‰ä¸€ä¸ªåˆ†æ®µæ•°æ®æ˜¯ <code>1 ~ 10</code> è¿™åä¸ªåºå·çš„æŠ¥æ–‡ï¼Œå…¶ä¸­ä¸¢å¤±äº†åºå·ä¸º 3 å’Œ 7 çš„æŠ¥æ–‡ï¼Œé‚£ä¹ˆè¯¥åˆ†æ®µçš„æœ€å¤§åºå·å°±æ˜¯ 10ã€‚å‘é€ç«¯åªä¼šæ”¶åˆ° ACK åºå·ä¸º 3 çš„åº”ç­”ã€‚è¿™æ—¶å€™é‡å‘åºå·ä¸º 3 çš„æŠ¥æ–‡ï¼Œæ¥æ”¶æ–¹é¡ºåˆ©æ¥æ”¶çš„è¯å°±ä¼šå‘é€ ACK åºå·ä¸º 7 çš„åº”ç­”ã€‚è¿™æ—¶å€™ TCP çŸ¥é“å¯¹ç«¯æ˜¯æœ‰å¤šä¸ªåŒ…æœªæ”¶åˆ°ï¼Œä¼šç»§ç»­å‘é€åºå·ä¸º 7 çš„æŠ¥æ–‡ï¼Œæ¥æ”¶æ–¹é¡ºåˆ©æ¥æ”¶å¹¶ä¼šå‘é€ ACK åºå·ä¸º 11 çš„åº”ç­”ï¼Œè¿™æ—¶å‘é€ç«¯è®¤ä¸ºè¿™ä¸ªåˆ†æ®µæ¥æ”¶ç«¯å·²ç»é¡ºåˆ©æ¥æ”¶ï¼Œæ¥ä¸‹æ¥ä¼šé€€å‡ºå¿«æ¢å¤é˜¶æ®µã€‚</p></blockquote> <h2 id="_32-http-tls"><a href="http://interview.poetries.top/docs/excellent.html#_32-http-tls" class="header-anchor">#</a> 32 HTTP/TLS</h2> <h3 id="_32-1-http-è¯·æ±‚ä¸­çš„å†…å®¹"><a href="http://interview.poetries.top/docs/excellent.html#_32-1-http-%E8%AF%B7%E6%B1%82%E4%B8%AD%E7%9A%84%E5%86%85%E5%AE%B9" class="header-anchor">#</a> 32.1 HTTP è¯·æ±‚ä¸­çš„å†…å®¹</h3> <blockquote><p><code>HTTP</code> è¯·æ±‚ç”±ä¸‰éƒ¨åˆ†æ„æˆï¼Œåˆ†åˆ«ä¸ºï¼š</p></blockquote> <ul><li>è¯·æ±‚è¡Œ</li> <li>é¦–éƒ¨</li> <li>å®ä½“</li></ul> <blockquote><ul><li>è¯·æ±‚è¡Œå¤§æ¦‚é•¿è¿™æ · <code>GET /images/logo.gif HTTP/1.1</code>ï¼ŒåŸºæœ¬ç”±è¯·æ±‚æ–¹æ³•ã€<code>URL</code>ã€åè®®ç‰ˆæœ¬ç»„æˆï¼Œè¿™å…¶ä¸­å€¼å¾—ä¸€è¯´çš„å°±æ˜¯è¯·æ±‚æ–¹æ³•äº†ã€‚</li> <li>è¯·æ±‚æ–¹æ³•åˆ†ä¸ºå¾ˆå¤šç§ï¼Œæœ€å¸¸ç”¨çš„ä¹Ÿå°±æ˜¯ <code>Get</code> å’Œ <code>Post</code> äº†ã€‚è™½ç„¶è¯·æ±‚æ–¹æ³•æœ‰å¾ˆå¤šï¼Œä½†æ˜¯æ›´å¤šçš„æ˜¯ä¼ è¾¾ä¸€ä¸ªè¯­ä¹‰ï¼Œè€Œä¸æ˜¯è¯´ <code>Post</code> èƒ½åšçš„äº‹æƒ… <code>Get</code> å°±ä¸èƒ½åšäº†ã€‚å¦‚æœä½ æ„¿æ„ï¼Œéƒ½ä½¿ç”¨ <code>Get</code> è¯·æ±‚æˆ–è€… <code>Post</code> è¯·æ±‚éƒ½æ˜¯å¯ä»¥çš„</li></ul></blockquote> <blockquote><p>å¸¸è€ƒé¢è¯•é¢˜ï¼šPost å’Œ Get çš„åŒºåˆ«ï¼Ÿ</p></blockquote> <ul><li>é¦–å…ˆå…ˆå¼•å…¥å‰¯ä½œç”¨å’Œå¹‚ç­‰çš„æ¦‚å¿µã€‚</li> <li>å‰¯ä½œç”¨æŒ‡å¯¹æœåŠ¡å™¨ä¸Šçš„èµ„æºåšæ”¹å˜ï¼Œæœç´¢æ˜¯æ— å‰¯ä½œç”¨çš„ï¼Œæ³¨å†Œæ˜¯å‰¯ä½œç”¨çš„ã€‚</li> <li>å¹‚ç­‰æŒ‡å‘é€ M å’Œ N æ¬¡è¯·æ±‚ï¼ˆä¸¤è€…ä¸ç›¸åŒä¸”éƒ½å¤§äº 1ï¼‰ï¼ŒæœåŠ¡å™¨ä¸Šèµ„æºçš„çŠ¶æ€ä¸€è‡´ï¼Œæ¯”å¦‚æ³¨å†Œ 10 ä¸ªå’Œ 11 ä¸ªå¸å·æ˜¯ä¸å¹‚ç­‰çš„ï¼Œå¯¹æ–‡ç« è¿›è¡Œæ›´æ”¹ 10 æ¬¡å’Œ 11 æ¬¡æ˜¯å¹‚ç­‰çš„ã€‚å› ä¸ºå‰è€…æ˜¯å¤šäº†ä¸€ä¸ªè´¦å·ï¼ˆèµ„æºï¼‰ï¼Œåè€…åªæ˜¯æ›´æ–°åŒä¸€ä¸ªèµ„æºã€‚</li> <li>åœ¨è§„èŒƒçš„åº”ç”¨åœºæ™¯ä¸Šè¯´ï¼ŒGet å¤šç”¨äºæ— å‰¯ä½œç”¨ï¼Œå¹‚ç­‰çš„åœºæ™¯ï¼Œä¾‹å¦‚æœç´¢å…³é”®å­—ã€‚Post å¤šç”¨äºå‰¯ä½œç”¨ï¼Œä¸å¹‚ç­‰çš„åœºæ™¯ï¼Œä¾‹å¦‚æ³¨å†Œã€‚</li></ul> <blockquote><ul><li><code>Get</code> è¯·æ±‚èƒ½ç¼“å­˜ï¼Œ<code>Post</code> ä¸èƒ½</li> <li><code>Post</code> ç›¸å¯¹ <code>Get</code> å®‰å…¨ä¸€ç‚¹ç‚¹ï¼Œå› ä¸º<code>Get</code> è¯·æ±‚éƒ½åŒ…å«åœ¨ <code>URL</code> é‡Œï¼ˆå½“ç„¶ä½ æƒ³å†™åˆ° <code>body</code> é‡Œä¹Ÿæ˜¯å¯ä»¥çš„ï¼‰ï¼Œä¸”ä¼šè¢«æµè§ˆå™¨ä¿å­˜å†å²çºªå½•ã€‚<code>Post</code> ä¸ä¼šï¼Œä½†æ˜¯åœ¨æŠ“åŒ…çš„æƒ…å†µä¸‹éƒ½æ˜¯ä¸€æ ·çš„ã€‚</li> <li><code>URL</code>æœ‰é•¿åº¦é™åˆ¶ï¼Œä¼šå½±å“ <code>Get</code> è¯·æ±‚ï¼Œä½†æ˜¯è¿™ä¸ªé•¿åº¦é™åˆ¶æ˜¯æµè§ˆå™¨è§„å®šçš„ï¼Œä¸æ˜¯ <code>RFC</code> è§„å®šçš„</li> <li><code>Post</code> æ”¯æŒæ›´å¤šçš„ç¼–ç ç±»å‹ä¸”ä¸å¯¹æ•°æ®ç±»å‹é™åˆ¶</li></ul></blockquote> <p><strong>1. é¦–éƒ¨</strong></p> <blockquote><p>é¦–éƒ¨åˆ†ä¸ºè¯·æ±‚é¦–éƒ¨å’Œå“åº”é¦–éƒ¨ï¼Œå¹¶ä¸”éƒ¨åˆ†é¦–éƒ¨ä¸¤ç§é€šç”¨ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥å­¦ä¹ ä¸€éƒ¨åˆ†çš„å¸¸ç”¨é¦–éƒ¨ã€‚</p></blockquote> <p><strong>1.1 é€šç”¨é¦–éƒ¨</strong></p> <table><thead><tr><th>é€šç”¨å­—æ®µ</th> <th>ä½œç”¨</th></tr></thead> <tbody><tr><td><code>Cache-Control</code></td> <td>æ§åˆ¶ç¼“å­˜çš„è¡Œä¸º</td></tr> <tr><td><code>Connection</code></td> <td>æµè§ˆå™¨æƒ³è¦ä¼˜å…ˆä½¿ç”¨çš„è¿æ¥ç±»å‹ï¼Œæ¯”å¦‚ <code>keep-alive</code></td></tr> <tr><td><code>Date</code></td> <td>åˆ›å»ºæŠ¥æ–‡æ—¶é—´</td></tr> <tr><td><code>Pragma</code></td> <td>æŠ¥æ–‡æŒ‡ä»¤</td></tr> <tr><td><code>Via</code></td> <td>ä»£ç†æœåŠ¡å™¨ç›¸å…³ä¿¡æ¯</td></tr> <tr><td><code>Transfer-Encoding</code></td> <td>ä¼ è¾“ç¼–ç æ–¹å¼</td></tr> <tr><td><code>Upgrade</code></td> <td>è¦æ±‚å®¢æˆ·ç«¯å‡çº§åè®®</td></tr> <tr><td><code>Warning</code></td> <td>åœ¨å†…å®¹ä¸­å¯èƒ½å­˜åœ¨é”™è¯¯</td></tr></tbody></table> <p><strong>1.2 è¯·æ±‚é¦–éƒ¨</strong></p> <table><thead><tr><th>è¯·æ±‚é¦–éƒ¨</th> <th>ä½œç”¨</th></tr></thead> <tbody><tr><td><code>Accept</code></td> <td>èƒ½æ­£ç¡®æ¥æ”¶çš„åª’ä½“ç±»å‹</td></tr> <tr><td><code>Accept-Charset</code></td> <td>èƒ½æ­£ç¡®æ¥æ”¶çš„å­—ç¬¦é›†</td></tr> <tr><td><code>Accept-Encoding</code></td> <td>èƒ½æ­£ç¡®æ¥æ”¶çš„ç¼–ç æ ¼å¼åˆ—è¡¨</td></tr> <tr><td><code>Accept-Language</code></td> <td>èƒ½æ­£ç¡®æ¥æ”¶çš„è¯­è¨€åˆ—è¡¨</td></tr> <tr><td><code>Expect</code></td> <td>æœŸå¾…æœåŠ¡ç«¯çš„æŒ‡å®šè¡Œä¸º</td></tr> <tr><td><code>From</code></td> <td>è¯·æ±‚æ–¹é‚®ç®±åœ°å€</td></tr> <tr><td><code>Host</code></td> <td>æœåŠ¡å™¨çš„åŸŸå</td></tr> <tr><td><code>If-Match</code></td> <td>ä¸¤ç«¯èµ„æºæ ‡è®°æ¯”è¾ƒ</td></tr> <tr><td><code>If-Modified-Since</code></td> <td>æœ¬åœ°èµ„æºæœªä¿®æ”¹è¿”å› <code>304</code>ï¼ˆæ¯”è¾ƒæ—¶é—´ï¼‰</td></tr> <tr><td><code>If-None-Match</code></td> <td>æœ¬åœ°èµ„æºæœªä¿®æ”¹è¿”å› <code>304</code>ï¼ˆæ¯”è¾ƒæ ‡è®°ï¼‰</td></tr> <tr><td><code>User-Agent</code></td> <td>å®¢æˆ·ç«¯ä¿¡æ¯</td></tr> <tr><td><code>Max-Forwards</code></td> <td>é™åˆ¶å¯è¢«ä»£ç†åŠç½‘å…³è½¬å‘çš„æ¬¡æ•°</td></tr> <tr><td><code>Proxy-Authorization</code></td> <td>å‘ä»£ç†æœåŠ¡å™¨å‘é€éªŒè¯ä¿¡æ¯</td></tr> <tr><td><code>Range</code></td> <td>è¯·æ±‚æŸä¸ªå†…å®¹çš„ä¸€éƒ¨åˆ†</td></tr> <tr><td><code>Referer</code></td> <td>è¡¨ç¤ºæµè§ˆå™¨æ‰€è®¿é—®çš„å‰ä¸€ä¸ªé¡µé¢</td></tr> <tr><td><code>TE</code></td> <td>ä¼ è¾“ç¼–ç æ–¹å¼</td></tr></tbody></table> <p><strong>1.3 å“åº”é¦–éƒ¨</strong></p> <table><thead><tr><th>å“åº”é¦–éƒ¨</th> <th>ä½œç”¨</th></tr></thead> <tbody><tr><td><code>Accept-Ranges</code></td> <td>æ˜¯å¦æ”¯æŒæŸäº›ç§ç±»çš„èŒƒå›´</td></tr> <tr><td><code>Age</code></td> <td>èµ„æºåœ¨ä»£ç†ç¼“å­˜ä¸­å­˜åœ¨çš„æ—¶é—´</td></tr> <tr><td><code>ETag</code></td> <td>èµ„æºæ ‡è¯†</td></tr> <tr><td><code>Location</code></td> <td>å®¢æˆ·ç«¯é‡å®šå‘åˆ°æŸä¸ª <code>URL</code></td></tr> <tr><td><code>Proxy-Authenticate</code></td> <td>å‘ä»£ç†æœåŠ¡å™¨å‘é€éªŒè¯ä¿¡æ¯</td></tr> <tr><td><code>Server</code></td> <td>æœåŠ¡å™¨åå­—</td></tr> <tr><td><code>WWW-Authenticate</code></td> <td>è·å–èµ„æºéœ€è¦çš„éªŒè¯ä¿¡æ¯</td></tr></tbody></table> <p><strong>1.4 å®ä½“é¦–éƒ¨</strong></p> <table><thead><tr><th>å®ä½“é¦–éƒ¨</th> <th>ä½œç”¨</th></tr></thead> <tbody><tr><td><code>Allow</code></td> <td>èµ„æºçš„æ­£ç¡®è¯·æ±‚æ–¹å¼</td></tr> <tr><td><code>Content-Encoding</code></td> <td>å†…å®¹çš„ç¼–ç æ ¼å¼</td></tr> <tr><td><code>Content-Language</code></td> <td>å†…å®¹ä½¿ç”¨çš„è¯­è¨€</td></tr> <tr><td><code>Content-Length</code></td> <td><code>request body</code> é•¿åº¦</td></tr> <tr><td><code>Content-Location</code></td> <td>è¿”å›æ•°æ®çš„å¤‡ç”¨åœ°å€</td></tr> <tr><td><code>Content-MD5</code></td> <td><code>Base64</code>åŠ å¯†æ ¼å¼çš„å†…å®¹ <code>MD5</code>æ£€éªŒå€¼</td></tr> <tr><td><code>Content-Range</code></td> <td>å†…å®¹çš„ä½ç½®èŒƒå›´</td></tr> <tr><td><code>Content-Type</code></td> <td>å†…å®¹çš„åª’ä½“ç±»å‹</td></tr> <tr><td><code>Expires</code></td> <td>å†…å®¹çš„è¿‡æœŸæ—¶é—´</td></tr> <tr><td><code>Last_modified</code></td> <td>å†…å®¹çš„æœ€åä¿®æ”¹æ—¶é—´</td></tr></tbody></table> <p><strong>2. å¸¸è§çŠ¶æ€ç </strong></p> <blockquote><p>çŠ¶æ€ç è¡¨ç¤ºäº†å“åº”çš„ä¸€ä¸ªçŠ¶æ€ï¼Œå¯ä»¥è®©æˆ‘ä»¬æ¸…æ™°çš„äº†è§£åˆ°è¿™ä¸€æ¬¡è¯·æ±‚æ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œå¦‚æœå¤±è´¥çš„è¯ï¼Œæ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´çš„ï¼Œå½“ç„¶çŠ¶æ€ç ä¹Ÿæ˜¯ç”¨äºä¼ è¾¾è¯­ä¹‰çš„ã€‚å¦‚æœèƒ¡ä¹±ä½¿ç”¨çŠ¶æ€ç ï¼Œé‚£ä¹ˆå®ƒå­˜åœ¨çš„æ„ä¹‰å°±æ²¡æœ‰äº†</p></blockquote> <p><strong>2XX æˆåŠŸ</strong></p> <ul><li><code>200 OK</code>ï¼Œè¡¨ç¤ºä»å®¢æˆ·ç«¯å‘æ¥çš„è¯·æ±‚åœ¨æœåŠ¡å™¨ç«¯è¢«æ­£ç¡®å¤„ç†</li> <li><code>204 No content</code>ï¼Œè¡¨ç¤ºè¯·æ±‚æˆåŠŸï¼Œä½†å“åº”æŠ¥æ–‡ä¸å«å®ä½“çš„ä¸»ä½“éƒ¨åˆ†</li> <li><code>205 Reset Content</code>ï¼Œè¡¨ç¤ºè¯·æ±‚æˆåŠŸï¼Œä½†å“åº”æŠ¥æ–‡ä¸å«å®ä½“çš„ä¸»ä½“éƒ¨åˆ†ï¼Œä½†æ˜¯ä¸ <code>204</code> å“åº”ä¸åŒåœ¨äºè¦æ±‚è¯·æ±‚æ–¹é‡ç½®å†…å®¹</li> <li><code>206 Partial Content</code>ï¼Œè¿›è¡ŒèŒƒå›´è¯·æ±‚</li></ul> <p><strong>3XX é‡å®šå‘</strong></p> <ul><li><code>301 moved permanently</code>ï¼Œæ°¸ä¹…æ€§é‡å®šå‘ï¼Œè¡¨ç¤ºèµ„æºå·²è¢«åˆ†é…äº†æ–°çš„ URL</li> <li><code>302 found</code>ï¼Œä¸´æ—¶æ€§é‡å®šå‘ï¼Œè¡¨ç¤ºèµ„æºä¸´æ—¶è¢«åˆ†é…äº†æ–°çš„ <code>URL</code></li> <li><code>303 see other</code>ï¼Œè¡¨ç¤ºèµ„æºå­˜åœ¨ç€å¦ä¸€ä¸ª <code>URL</code>ï¼Œåº”ä½¿ç”¨ <code>GET</code> æ–¹æ³•è·å–èµ„æº</li> <li><code>304 not modified</code>ï¼Œè¡¨ç¤ºæœåŠ¡å™¨å…è®¸è®¿é—®èµ„æºï¼Œä½†å› å‘ç”Ÿè¯·æ±‚æœªæ»¡è¶³æ¡ä»¶çš„æƒ…å†µ</li> <li><code>307 temporary redirect</code>ï¼Œä¸´æ—¶é‡å®šå‘ï¼Œå’Œ<code>302</code>å«ä¹‰ç±»ä¼¼ï¼Œä½†æ˜¯æœŸæœ›å®¢æˆ·ç«¯ä¿æŒè¯·æ±‚æ–¹æ³•ä¸å˜å‘æ–°çš„åœ°å€å‘å‡ºè¯·æ±‚</li></ul> <p><strong>4XX å®¢æˆ·ç«¯é”™è¯¯</strong></p> <ul><li><code>400 bad request</code>ï¼Œè¯·æ±‚æŠ¥æ–‡å­˜åœ¨è¯­æ³•é”™è¯¯</li> <li><code>401 unauthorized</code>ï¼Œè¡¨ç¤ºå‘é€çš„è¯·æ±‚éœ€è¦æœ‰é€šè¿‡ HTTP è®¤è¯çš„è®¤è¯ä¿¡æ¯</li> <li><code>403 forbidden</code>ï¼Œè¡¨ç¤ºå¯¹è¯·æ±‚èµ„æºçš„è®¿é—®è¢«æœåŠ¡å™¨æ‹’ç»</li> <li><code>404 not found</code>ï¼Œè¡¨ç¤ºåœ¨æœåŠ¡å™¨ä¸Šæ²¡æœ‰æ‰¾åˆ°è¯·æ±‚çš„èµ„æº</li></ul> <p><strong>5XX æœåŠ¡å™¨é”™è¯¯</strong></p> <ul><li><code>500 internal sever error</code>ï¼Œè¡¨ç¤ºæœåŠ¡å™¨ç«¯åœ¨æ‰§è¡Œè¯·æ±‚æ—¶å‘ç”Ÿäº†é”™è¯¯</li> <li><code>501 Not Implemented</code>ï¼Œè¡¨ç¤ºæœåŠ¡å™¨ä¸æ”¯æŒå½“å‰è¯·æ±‚æ‰€éœ€è¦çš„æŸä¸ªåŠŸèƒ½</li> <li><code>503 service unavailable</code>ï¼Œè¡¨æ˜æœåŠ¡å™¨æš‚æ—¶å¤„äºè¶…è´Ÿè½½æˆ–æ­£åœ¨åœæœºç»´æŠ¤ï¼Œæ— æ³•å¤„ç†è¯·æ±‚</li></ul> <h3 id="_32-2-tls"><a href="http://interview.poetries.top/docs/excellent.html#_32-2-tls" class="header-anchor">#</a> 32.2 TLS</h3> <ul><li><code>HTTPS</code> è¿˜æ˜¯é€šè¿‡äº† <code>HTTP</code> æ¥ä¼ è¾“ä¿¡æ¯ï¼Œä½†æ˜¯ä¿¡æ¯é€šè¿‡ <code>TLS</code> åè®®è¿›è¡Œäº†åŠ å¯†ã€‚</li> <li><code>TLS</code> åè®®ä½äºä¼ è¾“å±‚ä¹‹ä¸Šï¼Œåº”ç”¨å±‚ä¹‹ä¸‹ã€‚é¦–æ¬¡è¿›è¡Œ <code>TLS</code> åè®®ä¼ è¾“éœ€è¦ä¸¤ä¸ª <code>RTT</code> ï¼Œæ¥ä¸‹æ¥å¯ä»¥é€šè¿‡ <code>Session Resumption</code> å‡å°‘åˆ°ä¸€ä¸ª <code>RTT</code>ã€‚</li> <li>åœ¨ <code>TLS</code> ä¸­ä½¿ç”¨äº†ä¸¤ç§åŠ å¯†æŠ€æœ¯ï¼Œåˆ†åˆ«ä¸ºï¼šå¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†ã€‚</li></ul> <p><strong>å¯¹ç§°åŠ å¯†</strong></p> <ul><li>å¯¹ç§°åŠ å¯†å°±æ˜¯ä¸¤è¾¹æ‹¥æœ‰ç›¸åŒçš„ç§˜é’¥ï¼Œä¸¤è¾¹éƒ½çŸ¥é“å¦‚ä½•å°†å¯†æ–‡åŠ å¯†è§£å¯†ã€‚</li> <li>è¿™ç§åŠ å¯†æ–¹å¼å›ºç„¶å¾ˆå¥½ï¼Œä½†æ˜¯é—®é¢˜å°±åœ¨äºå¦‚ä½•è®©åŒæ–¹çŸ¥é“ç§˜é’¥ã€‚å› ä¸ºä¼ è¾“æ•°æ®éƒ½æ˜¯èµ°çš„ç½‘ç»œï¼Œå¦‚æœå°†ç§˜é’¥é€šè¿‡ç½‘ç»œçš„æ–¹å¼ä¼ é€’çš„è¯ï¼Œä¸€æ—¦ç§˜é’¥è¢«æˆªè·å°±æ²¡æœ‰åŠ å¯†çš„æ„ä¹‰çš„ã€‚</li></ul> <p><strong>éå¯¹ç§°åŠ å¯†</strong></p> <ul><li>æœ‰å…¬é’¥ç§é’¥ä¹‹åˆ†ï¼Œå…¬é’¥æ‰€æœ‰äººéƒ½å¯ä»¥çŸ¥é“ï¼Œå¯ä»¥å°†æ•°æ®ç”¨å…¬é’¥åŠ å¯†ï¼Œä½†æ˜¯å°†æ•°æ®è§£å¯†å¿…é¡»ä½¿ç”¨ç§é’¥è§£å¯†ï¼Œç§é’¥åªæœ‰åˆ†å‘å…¬é’¥çš„ä¸€æ–¹æ‰çŸ¥é“ã€‚</li> <li>è¿™ç§åŠ å¯†æ–¹å¼å°±å¯ä»¥å®Œç¾è§£å†³å¯¹ç§°åŠ å¯†å­˜åœ¨çš„é—®é¢˜ã€‚å‡è®¾ç°åœ¨ä¸¤ç«¯éœ€è¦ä½¿ç”¨å¯¹ç§°åŠ å¯†ï¼Œé‚£ä¹ˆåœ¨è¿™ä¹‹å‰ï¼Œå¯ä»¥å…ˆä½¿ç”¨éå¯¹ç§°åŠ å¯†äº¤æ¢ç§˜é’¥ã€‚</li></ul> <blockquote><p>ç®€å•æµç¨‹å¦‚ä¸‹ï¼šé¦–å…ˆæœåŠ¡ç«¯å°†å…¬é’¥å…¬å¸ƒå‡ºå»ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯ä¹Ÿå°±çŸ¥é“å…¬é’¥äº†ã€‚æ¥ä¸‹æ¥å®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ªç§˜é’¥ï¼Œç„¶åé€šè¿‡å…¬é’¥åŠ å¯†å¹¶å‘é€ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯æ¥æ”¶åˆ°å¯†æ–‡ä»¥åé€šè¿‡ç§é’¥è§£å¯†å‡ºæ­£ç¡®çš„ç§˜é’¥ï¼Œè¿™æ—¶å€™ä¸¤ç«¯å°±éƒ½çŸ¥é“ç§˜é’¥æ˜¯ä»€ä¹ˆäº†ã€‚</p></blockquote> <p>TLS æ¡æ‰‹è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š</p> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/38.png" alt="" class="medium-zoom-image"></p> <ul><li>å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªéšæœºå€¼ä»¥åŠéœ€è¦çš„åè®®å’ŒåŠ å¯†æ–¹å¼ã€‚</li> <li>æœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯çš„éšæœºå€¼ï¼Œè‡ªå·±ä¹Ÿäº§ç”Ÿä¸€ä¸ªéšæœºå€¼ï¼Œå¹¶æ ¹æ®å®¢æˆ·ç«¯éœ€æ±‚çš„åè®®å’ŒåŠ å¯†æ–¹å¼æ¥ä½¿ç”¨å¯¹åº”çš„æ–¹å¼ï¼Œå¹¶ä¸”å‘é€è‡ªå·±çš„è¯ä¹¦ï¼ˆå¦‚æœéœ€è¦éªŒè¯å®¢æˆ·ç«¯è¯ä¹¦éœ€è¦è¯´æ˜ï¼‰</li> <li>å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯çš„è¯ä¹¦å¹¶éªŒè¯æ˜¯å¦æœ‰æ•ˆï¼ŒéªŒè¯é€šè¿‡ä¼šå†ç”Ÿæˆä¸€ä¸ªéšæœºå€¼ï¼Œé€šè¿‡æœåŠ¡ç«¯è¯ä¹¦çš„å…¬é’¥å»åŠ å¯†è¿™ä¸ªéšæœºå€¼å¹¶å‘é€ç»™æœåŠ¡ç«¯ï¼Œå¦‚æœæœåŠ¡ç«¯éœ€è¦éªŒè¯å®¢æˆ·ç«¯è¯ä¹¦çš„è¯ä¼šé™„å¸¦è¯ä¹¦</li> <li>æœåŠ¡ç«¯æ”¶åˆ°åŠ å¯†è¿‡çš„éšæœºå€¼å¹¶ä½¿ç”¨ç§é’¥è§£å¯†è·å¾—ç¬¬ä¸‰ä¸ªéšæœºå€¼ï¼Œè¿™æ—¶å€™ä¸¤ç«¯éƒ½æ‹¥æœ‰äº†ä¸‰ä¸ªéšæœºå€¼ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸‰ä¸ªéšæœºå€¼æŒ‰ç…§ä¹‹å‰çº¦å®šçš„åŠ å¯†æ–¹å¼ç”Ÿæˆå¯†é’¥ï¼Œæ¥ä¸‹æ¥çš„é€šä¿¡å°±å¯ä»¥é€šè¿‡è¯¥å¯†é’¥æ¥åŠ å¯†è§£å¯†</li> <li>é€šè¿‡ä»¥ä¸Šæ­¥éª¤å¯çŸ¥ï¼Œåœ¨ TLS æ¡æ‰‹é˜¶æ®µï¼Œä¸¤ç«¯ä½¿ç”¨éå¯¹ç§°åŠ å¯†çš„æ–¹å¼æ¥é€šä¿¡ï¼Œä½†æ˜¯å› ä¸ºéå¯¹ç§°åŠ å¯†æŸè€—çš„æ€§èƒ½æ¯”å¯¹ç§°åŠ å¯†å¤§ï¼Œæ‰€ä»¥åœ¨æ­£å¼ä¼ è¾“æ•°æ®æ—¶ï¼Œä¸¤ç«¯ä½¿ç”¨å¯¹ç§°åŠ å¯†çš„æ–¹å¼é€šä¿¡ã€‚</li></ul> <blockquote><p>PSï¼šä»¥ä¸Šè¯´æ˜çš„éƒ½æ˜¯ <code>TLS 1.2</code> åè®®çš„æ¡æ‰‹æƒ…å†µï¼Œåœ¨ 1.3 åè®®ä¸­ï¼Œé¦–æ¬¡å»ºç«‹è¿æ¥åªéœ€è¦ä¸€ä¸ª RTTï¼Œåé¢æ¢å¤è¿æ¥ä¸éœ€è¦ RTT äº†</p></blockquote> <h2 id="_33-http2-0"><a href="http://interview.poetries.top/docs/excellent.html#_33-http2-0" class="header-anchor">#</a> 33 HTTP2.0</h2> <blockquote><ul><li><code>HTTP/2</code> å¾ˆå¥½çš„è§£å†³äº†å½“ä¸‹æœ€å¸¸ç”¨çš„ <code>HTTP/1</code> æ‰€å­˜åœ¨çš„ä¸€äº›æ€§èƒ½é—®é¢˜ï¼Œåªéœ€è¦å‡çº§åˆ°è¯¥åè®®å°±å¯ä»¥å‡å°‘å¾ˆå¤šä¹‹å‰éœ€è¦åšçš„æ€§èƒ½ä¼˜åŒ–å·¥ä½œï¼Œå½“ç„¶å…¼å®¹é—®é¢˜ä»¥åŠå¦‚ä½•ä¼˜é›…é™çº§åº”è¯¥æ˜¯å›½å†…è¿˜ä¸æ™®éä½¿ç”¨çš„åŸå› ä¹‹ä¸€ã€‚</li> <li>è™½ç„¶ <code>HTTP/2</code> å·²ç»è§£å†³äº†å¾ˆå¤šé—®é¢˜ï¼Œä½†æ˜¯å¹¶ä¸ä»£è¡¨å®ƒå·²ç»æ˜¯å®Œç¾çš„äº†ï¼Œ<code>HTTP/3</code> å°±æ˜¯ä¸ºäº†è§£å†³ <code>HTTP/2</code> æ‰€å­˜åœ¨çš„ä¸€äº›é—®é¢˜è€Œè¢«æ¨å‡ºæ¥çš„ã€‚</li></ul></blockquote> <h3 id="_33-1-http-2"><a href="http://interview.poetries.top/docs/excellent.html#_33-1-http-2" class="header-anchor">#</a> 33.1 HTTP/2</h3> <ul><li><code>HTTP/2</code> ç›¸æ¯”äº <code>HTTP/1</code>ï¼Œå¯ä»¥è¯´æ˜¯å¤§å¹…åº¦æé«˜äº†ç½‘é¡µçš„æ€§èƒ½ã€‚</li> <li>åœ¨ <code>HTTP/1</code> ä¸­ï¼Œä¸ºäº†æ€§èƒ½è€ƒè™‘ï¼Œæˆ‘ä»¬ä¼šå¼•å…¥é›ªç¢§å›¾ã€å°†å°å›¾å†…è”ã€ä½¿ç”¨å¤šä¸ªåŸŸåç­‰ç­‰çš„æ–¹å¼ã€‚è¿™ä¸€åˆ‡éƒ½æ˜¯å› ä¸ºæµè§ˆå™¨é™åˆ¶äº†åŒä¸€ä¸ªåŸŸåä¸‹çš„è¯·æ±‚æ•°é‡ï¼ˆChrome ä¸‹ä¸€èˆ¬æ˜¯é™åˆ¶å…­ä¸ªè¿æ¥ï¼‰ï¼Œå½“é¡µé¢ä¸­éœ€è¦è¯·æ±‚å¾ˆå¤šèµ„æºçš„æ—¶å€™ï¼Œé˜Ÿå¤´é˜»å¡ï¼ˆHead of line blockingï¼‰ä¼šå¯¼è‡´åœ¨è¾¾åˆ°æœ€å¤§è¯·æ±‚æ•°é‡æ—¶ï¼Œå‰©ä½™çš„èµ„æºéœ€è¦ç­‰å¾…å…¶ä»–èµ„æºè¯·æ±‚å®Œæˆåæ‰èƒ½å‘èµ·è¯·æ±‚ã€‚</li> <li>åœ¨ <code>HTTP/2</code> ä¸­å¼•å…¥äº†å¤šè·¯å¤ç”¨çš„æŠ€æœ¯ï¼Œè¿™ä¸ªæŠ€æœ¯å¯ä»¥åªé€šè¿‡ä¸€ä¸ª <code>TCP</code> è¿æ¥å°±å¯ä»¥ä¼ è¾“æ‰€æœ‰çš„è¯·æ±‚æ•°æ®ã€‚å¤šè·¯å¤ç”¨å¾ˆå¥½çš„è§£å†³äº†æµè§ˆå™¨é™åˆ¶åŒä¸€ä¸ªåŸŸåä¸‹çš„è¯·æ±‚æ•°é‡çš„é—®é¢˜ï¼ŒåŒæ—¶ä¹Ÿæ¥æ›´å®¹æ˜“å®ç°å…¨é€Ÿä¼ è¾“ï¼Œæ¯•ç«Ÿæ–°å¼€ä¸€ä¸ª <code>TCP</code> è¿æ¥éƒ½éœ€è¦æ…¢æ…¢æå‡ä¼ è¾“é€Ÿåº¦ã€‚</li></ul> <blockquote><p>å¤§å®¶å¯ä»¥é€šè¿‡ <a href="https://http2.akamai.com/demo" target="_blank" rel="noopener noreferrer">è¯¥é“¾æ¥<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> æ„Ÿå—ä¸‹ HTTP/2 æ¯” HTTP/1 åˆ°åº•å¿«äº†å¤šå°‘</p></blockquote> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/103.png" alt="" class="medium-zoom-image"></p> <blockquote><p>åœ¨ <code>HTTP/1</code> ä¸­ï¼Œå› ä¸ºé˜Ÿå¤´é˜»å¡çš„åŸå› ï¼Œä½ ä¼šå‘ç°å‘é€è¯·æ±‚æ˜¯é•¿è¿™æ ·çš„</p></blockquote> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/39.png" alt="" class="medium-zoom-image"></p> <blockquote><p>åœ¨ <code>HTTP/2</code> ä¸­ï¼Œå› ä¸ºå¯ä»¥å¤ç”¨åŒä¸€ä¸ª <code>TCP</code> è¿æ¥ï¼Œä½ ä¼šå‘ç°å‘é€è¯·æ±‚æ˜¯é•¿è¿™æ ·çš„</p></blockquote> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/40.png" alt="" class="medium-zoom-image"></p> <h3 id="_33-2-äºŒè¿›åˆ¶ä¼ è¾“"><a href="http://interview.poetries.top/docs/excellent.html#_33-2-%E4%BA%8C%E8%BF%9B%E5%88%B6%E4%BC%A0%E8%BE%93" class="header-anchor">#</a> 33.2 äºŒè¿›åˆ¶ä¼ è¾“</h3> <blockquote><p><code>HTTP/2</code> ä¸­æ‰€æœ‰åŠ å¼ºæ€§èƒ½çš„æ ¸å¿ƒç‚¹åœ¨äºæ­¤ã€‚åœ¨ä¹‹å‰çš„ <code>HTTP</code> ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬æ˜¯é€šè¿‡æ–‡æœ¬çš„æ–¹å¼ä¼ è¾“æ•°æ®ã€‚åœ¨ <code>HTTP/2</code> ä¸­å¼•å…¥äº†æ–°çš„ç¼–ç æœºåˆ¶ï¼Œæ‰€æœ‰ä¼ è¾“çš„æ•°æ®éƒ½ä¼šè¢«åˆ†å‰²ï¼Œå¹¶é‡‡ç”¨äºŒè¿›åˆ¶æ ¼å¼ç¼–ç ã€‚</p></blockquote> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/41.png" alt="" class="medium-zoom-image"></p> <h3 id="_33-3-å¤šè·¯å¤ç”¨"><a href="http://interview.poetries.top/docs/excellent.html#_33-3-%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8" class="header-anchor">#</a> 33.3 å¤šè·¯å¤ç”¨</h3> <ul><li>åœ¨ <code>HTTP/2</code> ä¸­ï¼Œæœ‰ä¸¤ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µï¼Œåˆ†åˆ«æ˜¯å¸§ï¼ˆframeï¼‰å’Œæµï¼ˆstreamï¼‰ã€‚</li> <li>å¸§ä»£è¡¨ç€æœ€å°çš„æ•°æ®å•ä½ï¼Œæ¯ä¸ªå¸§ä¼šæ ‡è¯†å‡ºè¯¥å¸§å±äºå“ªä¸ªæµï¼Œæµä¹Ÿå°±æ˜¯å¤šä¸ªå¸§ç»„æˆçš„æ•°æ®æµã€‚</li> <li>å¤šè·¯å¤ç”¨ï¼Œå°±æ˜¯åœ¨ä¸€ä¸ª <code>TCP</code> è¿æ¥ä¸­å¯ä»¥å­˜åœ¨å¤šæ¡æµã€‚æ¢å¥è¯è¯´ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥å‘é€å¤šä¸ªè¯·æ±‚ï¼Œå¯¹ç«¯å¯ä»¥é€šè¿‡å¸§ä¸­çš„æ ‡è¯†çŸ¥é“å±äºå“ªä¸ªè¯·æ±‚ã€‚é€šè¿‡è¿™ä¸ªæŠ€æœ¯ï¼Œå¯ä»¥é¿å… <code>HTTP</code> æ—§ç‰ˆæœ¬ä¸­çš„é˜Ÿå¤´é˜»å¡é—®é¢˜ï¼Œæå¤§çš„æé«˜ä¼ è¾“æ€§èƒ½ã€‚</li></ul> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/42.png" alt="" class="medium-zoom-image"></p> <h3 id="_33-4-header-å‹ç¼©"><a href="http://interview.poetries.top/docs/excellent.html#_33-4-header-%E5%8E%8B%E7%BC%A9" class="header-anchor">#</a> 33.4 Header å‹ç¼©</h3> <ul><li>åœ¨ <code>HTTP/1</code> ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ–‡æœ¬çš„å½¢å¼ä¼ è¾“ <code>header</code>ï¼Œåœ¨ <code>header</code> æºå¸¦ cookie çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½æ¯æ¬¡éƒ½éœ€è¦é‡å¤ä¼ è¾“å‡ ç™¾åˆ°å‡ åƒçš„å­—èŠ‚ã€‚</li> <li>åœ¨ <code>HTTP / 2</code>ä¸­ï¼Œä½¿ç”¨äº† <code>HPACK</code> å‹ç¼©æ ¼å¼å¯¹ä¼ è¾“çš„ <code>header</code> è¿›è¡Œç¼–ç ï¼Œå‡å°‘äº† <code>header</code> çš„å¤§å°ã€‚å¹¶åœ¨ä¸¤ç«¯ç»´æŠ¤äº†ç´¢å¼•è¡¨ï¼Œç”¨äºè®°å½•å‡ºç°è¿‡çš„ <code>header</code> ï¼Œåé¢åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­å°±å¯ä»¥ä¼ è¾“å·²ç»è®°å½•è¿‡çš„ <code>header</code> çš„é”®åï¼Œå¯¹ç«¯æ”¶åˆ°æ•°æ®åå°±å¯ä»¥é€šè¿‡é”®åæ‰¾åˆ°å¯¹åº”çš„å€¼ã€‚</li></ul> <h3 id="_33-5-æœåŠ¡ç«¯-push"><a href="http://interview.poetries.top/docs/excellent.html#_33-5-%E6%9C%8D%E5%8A%A1%E7%AB%AF-push" class="header-anchor">#</a> 33.5 æœåŠ¡ç«¯ Push</h3> <ul><li>åœ¨ <code>HTTP/2</code> ä¸­ï¼ŒæœåŠ¡ç«¯å¯ä»¥åœ¨å®¢æˆ·ç«¯æŸä¸ªè¯·æ±‚åï¼Œä¸»åŠ¨æ¨é€å…¶ä»–èµ„æºã€‚</li> <li>å¯ä»¥æƒ³è±¡ä»¥ä¸‹æƒ…å†µï¼ŒæŸäº›èµ„æºå®¢æˆ·ç«¯æ˜¯ä¸€å®šä¼šè¯·æ±‚çš„ï¼Œè¿™æ—¶å°±å¯ä»¥é‡‡å–æœåŠ¡ç«¯ <code>push</code> çš„æŠ€æœ¯ï¼Œæå‰ç»™å®¢æˆ·ç«¯æ¨é€å¿…è¦çš„èµ„æºï¼Œè¿™æ ·å°±å¯ä»¥ç›¸å¯¹å‡å°‘ä¸€ç‚¹å»¶è¿Ÿæ—¶é—´ã€‚å½“ç„¶åœ¨æµè§ˆå™¨å…¼å®¹çš„æƒ…å†µä¸‹ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>prefetch</code></li></ul> <h3 id="_33-6-http-3"><a href="http://interview.poetries.top/docs/excellent.html#_33-6-http-3" class="header-anchor">#</a> 33.6  HTTP/3</h3> <ul><li>è™½ç„¶ <code>HTTP/2</code> è§£å†³äº†å¾ˆå¤šä¹‹å‰æ—§ç‰ˆæœ¬çš„é—®é¢˜ï¼Œä½†æ˜¯å®ƒè¿˜æ˜¯å­˜åœ¨ä¸€ä¸ªå·¨å¤§çš„é—®é¢˜ï¼Œè™½ç„¶è¿™ä¸ªé—®é¢˜å¹¶ä¸æ˜¯å®ƒæœ¬èº«é€ æˆçš„ï¼Œè€Œæ˜¯åº•å±‚æ”¯æ’‘çš„ <code>TCP</code> åè®®çš„é—®é¢˜ã€‚</li> <li>å› ä¸º <code>HTTP/2</code> ä½¿ç”¨äº†å¤šè·¯å¤ç”¨ï¼Œä¸€èˆ¬æ¥è¯´åŒä¸€åŸŸåä¸‹åªéœ€è¦ä½¿ç”¨ä¸€ä¸ª <code>TCP</code> è¿æ¥ã€‚å½“è¿™ä¸ªè¿æ¥ä¸­å‡ºç°äº†ä¸¢åŒ…çš„æƒ…å†µï¼Œé‚£å°±ä¼šå¯¼è‡´ <code>HTTP/2</code> çš„è¡¨ç°æƒ…å†µåå€’ä¸å¦‚ <code>HTTP/1</code> äº†ã€‚</li> <li>å› ä¸ºåœ¨å‡ºç°ä¸¢åŒ…çš„æƒ…å†µä¸‹ï¼Œæ•´ä¸ª <code>TCP</code> éƒ½è¦å¼€å§‹ç­‰å¾…é‡ä¼ ï¼Œä¹Ÿå°±å¯¼è‡´äº†åé¢çš„æ‰€æœ‰æ•°æ®éƒ½è¢«é˜»å¡äº†ã€‚ä½†æ˜¯å¯¹äº <code>HTTP/1</code> æ¥è¯´ï¼Œå¯ä»¥å¼€å¯å¤šä¸ª <code>TCP</code> è¿æ¥ï¼Œå‡ºç°è¿™ç§æƒ…å†µååˆ°åªä¼šå½±å“å…¶ä¸­ä¸€ä¸ªè¿æ¥ï¼Œå‰©ä½™çš„ <code>TCP</code> è¿æ¥è¿˜å¯ä»¥æ­£å¸¸ä¼ è¾“æ•°æ®ã€‚</li> <li>é‚£ä¹ˆå¯èƒ½å°±ä¼šæœ‰äººè€ƒè™‘åˆ°å»ä¿®æ”¹ TCP åè®®ï¼Œå…¶å®è¿™å·²ç»æ˜¯ä¸€ä»¶ä¸å¯èƒ½å®Œæˆçš„ä»»åŠ¡äº†ã€‚å› ä¸º TCP å­˜åœ¨çš„æ—¶é—´å®åœ¨å¤ªé•¿ï¼Œå·²ç»å……æ–¥åœ¨å„ç§è®¾å¤‡ä¸­ï¼Œå¹¶ä¸”è¿™ä¸ªåè®®æ˜¯ç”±æ“ä½œç³»ç»Ÿå®ç°çš„ï¼Œæ›´æ–°èµ·æ¥ä¸å¤§ç°å®ã€‚</li> <li>åŸºäºè¿™ä¸ªåŸå› ï¼ŒGoogle å°±æ›´èµ·ç‚‰ç¶æäº†ä¸€ä¸ªåŸºäº <code>UDP</code> åè®®çš„ <code>QUIC</code> åè®®ï¼Œå¹¶ä¸”ä½¿ç”¨åœ¨äº† <code>HTTP/3</code> ä¸Šï¼Œå½“ç„¶ <code>HTTP/3</code> ä¹‹å‰åä¸º <code>HTTP-over-QUIC</code>ï¼Œä»è¿™ä¸ªåå­—ä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥å‘ç°ï¼ŒHTTP/3 æœ€å¤§çš„æ”¹é€ å°±æ˜¯ä½¿ç”¨äº† <code>QUIC</code>ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥å­¦ä¹ å…³äºè¿™ä¸ªåè®®çš„å†…å®¹ã€‚</li></ul> <p><strong>QUIC</strong></p> <blockquote><p>ä¹‹å‰æˆ‘ä»¬å­¦ä¹ è¿‡ UDP åè®®çš„å†…å®¹ï¼ŒçŸ¥é“è¿™ä¸ªåè®®è™½ç„¶æ•ˆç‡å¾ˆé«˜ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯é‚£ä¹ˆçš„å¯é ã€‚QUIC è™½ç„¶åŸºäº UDPï¼Œä½†æ˜¯åœ¨åŸæœ¬çš„åŸºç¡€ä¸Šæ–°å¢äº†å¾ˆå¤šåŠŸèƒ½ï¼Œæ¯”å¦‚å¤šè·¯å¤ç”¨ã€0-RTTã€ä½¿ç”¨ TLS1.3 åŠ å¯†ã€æµé‡æ§åˆ¶ã€æœ‰åºäº¤ä»˜ã€é‡ä¼ ç­‰ç­‰åŠŸèƒ½ã€‚è¿™é‡Œæˆ‘ä»¬å°±æŒ‘é€‰å‡ ä¸ªé‡è¦çš„åŠŸèƒ½å­¦ä¹ ä¸‹è¿™ä¸ªåè®®çš„å†…å®¹ã€‚</p></blockquote> <p><strong>å¤šè·¯å¤ç”¨</strong></p> <blockquote><p>è™½ç„¶ HTTP/2 æ”¯æŒäº†å¤šè·¯å¤ç”¨ï¼Œä½†æ˜¯ TCP åè®®ç»ˆç©¶æ˜¯æ²¡æœ‰è¿™ä¸ªåŠŸèƒ½çš„ã€‚QUIC åŸç”Ÿå°±å®ç°äº†è¿™ä¸ªåŠŸèƒ½ï¼Œå¹¶ä¸”ä¼ è¾“çš„å•ä¸ªæ•°æ®æµå¯ä»¥ä¿è¯æœ‰åºäº¤ä»˜ä¸”ä¸ä¼šå½±å“å…¶ä»–çš„æ•°æ®æµï¼Œè¿™æ ·çš„æŠ€æœ¯å°±è§£å†³äº†ä¹‹å‰ TCP å­˜åœ¨çš„é—®é¢˜ã€‚</p></blockquote> <ul><li>å¹¶ä¸” <code>QUIC</code> åœ¨ç§»åŠ¨ç«¯çš„è¡¨ç°ä¹Ÿä¼šæ¯” <code>TCP</code> å¥½ã€‚å› ä¸º <code>TCP</code> æ˜¯åŸºäº <code>IP</code> å’Œç«¯å£å»è¯†åˆ«è¿æ¥çš„ï¼Œè¿™ç§æ–¹å¼åœ¨å¤šå˜çš„ç§»åŠ¨ç«¯ç½‘ç»œç¯å¢ƒä¸‹æ˜¯å¾ˆè„†å¼±çš„ã€‚ä½†æ˜¯ <code>QUIC</code> æ˜¯é€šè¿‡ <code>ID</code>** çš„æ–¹å¼å»è¯†åˆ«ä¸€ä¸ªè¿æ¥ï¼Œä¸ç®¡ä½ ç½‘ç»œç¯å¢ƒå¦‚ä½•å˜åŒ–ï¼Œåªè¦ <code>ID</code> ä¸å˜ï¼Œå°±èƒ½è¿…é€Ÿé‡è¿ä¸Šã€‚</li></ul> <p><strong>0-RTT</strong></p> <blockquote><p>é€šè¿‡ä½¿ç”¨ç±»ä¼¼ TCP å¿«é€Ÿæ‰“å¼€çš„æŠ€æœ¯ï¼Œç¼“å­˜å½“å‰ä¼šè¯çš„ä¸Šä¸‹æ–‡ï¼Œåœ¨ä¸‹æ¬¡æ¢å¤ä¼šè¯çš„æ—¶å€™ï¼Œåªéœ€è¦å°†ä¹‹å‰çš„ç¼“å­˜ä¼ é€’ç»™æœåŠ¡ç«¯éªŒè¯é€šè¿‡å°±å¯ä»¥è¿›è¡Œä¼ è¾“äº†ã€‚</p></blockquote> <p><strong>çº é”™æœºåˆ¶</strong></p> <ul><li>å‡å¦‚è¯´è¿™æ¬¡æˆ‘è¦å‘é€ä¸‰ä¸ªåŒ…ï¼Œé‚£ä¹ˆåè®®ä¼šç®—å‡ºè¿™ä¸‰ä¸ªåŒ…çš„å¼‚æˆ–å€¼å¹¶å•ç‹¬å‘å‡ºä¸€ä¸ªæ ¡éªŒåŒ…ï¼Œä¹Ÿå°±æ˜¯æ€»å…±å‘å‡ºäº†å››ä¸ªåŒ…ã€‚</li> <li>å½“å‡ºç°å…¶ä¸­çš„éæ ¡éªŒåŒ…ä¸¢åŒ…çš„æƒ…å†µæ—¶ï¼Œå¯ä»¥é€šè¿‡å¦å¤–ä¸‰ä¸ªåŒ…è®¡ç®—å‡ºä¸¢å¤±çš„æ•°æ®åŒ…çš„å†…å®¹ã€‚</li> <li>å½“ç„¶è¿™ç§æŠ€æœ¯åªèƒ½ä½¿ç”¨åœ¨ä¸¢å¤±ä¸€ä¸ªåŒ…çš„æƒ…å†µä¸‹ï¼Œå¦‚æœå‡ºç°ä¸¢å¤±å¤šä¸ªåŒ…å°±ä¸èƒ½ä½¿ç”¨çº é”™æœºåˆ¶äº†ï¼Œåªèƒ½ä½¿ç”¨é‡ä¼ çš„æ–¹å¼äº†</li></ul> <h2 id="_34-è®¾è®¡æ¨¡å¼"><a href="http://interview.poetries.top/docs/excellent.html#_34-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F" class="header-anchor">#</a> 34 è®¾è®¡æ¨¡å¼</h2> <blockquote><p>è®¾è®¡æ¨¡å¼æ€»çš„æ¥è¯´æ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ¦‚å¿µï¼Œå‰äººé€šè¿‡æ— æ•°æ¬¡çš„å®è·µæ€»ç»“å‡ºçš„ä¸€å¥—å†™ä»£ç çš„æ–¹å¼ï¼Œé€šè¿‡è¿™ç§æ–¹å¼å†™çš„ä»£ç å¯ä»¥è®©åˆ«äººæ›´åŠ å®¹æ˜“é˜…è¯»ã€ç»´æŠ¤ä»¥åŠå¤ç”¨ã€‚</p></blockquote> <h3 id="_34-1-å·¥å‚æ¨¡å¼"><a href="http://interview.poetries.top/docs/excellent.html#_34-1-%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F" class="header-anchor">#</a> 34.1 å·¥å‚æ¨¡å¼</h3> <blockquote><p>å·¥å‚æ¨¡å¼åˆ†ä¸ºå¥½å‡ ç§ï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€è®²è§£äº†ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•å·¥å‚æ¨¡å¼çš„ä¾‹å­</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Man</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
  <span class="token punctuation">}</span>
  <span class="token function">alertName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Factory</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Man</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

Factory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">'yck'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">alertName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>å½“ç„¶å·¥å‚æ¨¡å¼å¹¶ä¸ä»…ä»…æ˜¯ç”¨æ¥ <code>new</code> å‡ºå®ä¾‹ã€‚</li> <li>å¯ä»¥æƒ³è±¡ä¸€ä¸ªåœºæ™¯ã€‚å‡è®¾æœ‰ä¸€ä»½å¾ˆå¤æ‚çš„ä»£ç éœ€è¦ç”¨æˆ·å»è°ƒç”¨ï¼Œä½†æ˜¯ç”¨æˆ·å¹¶ä¸å…³å¿ƒè¿™äº›å¤æ‚çš„ä»£ç ï¼Œåªéœ€è¦ä½ æä¾›ç»™æˆ‘ä¸€ä¸ªæ¥å£å»è°ƒç”¨ï¼Œç”¨æˆ·åªè´Ÿè´£ä¼ é€’éœ€è¦çš„å‚æ•°ï¼Œè‡³äºè¿™äº›å‚æ•°æ€ä¹ˆä½¿ç”¨ï¼Œå†…éƒ¨æœ‰ä»€ä¹ˆé€»è¾‘æ˜¯ä¸å…³å¿ƒçš„ï¼Œåªéœ€è¦ä½ æœ€åè¿”å›æˆ‘ä¸€ä¸ªå®ä¾‹ã€‚è¿™ä¸ªæ„é€ è¿‡ç¨‹å°±æ˜¯å·¥å‚ã€‚</li> <li>å·¥å‚èµ·åˆ°çš„ä½œç”¨å°±æ˜¯éšè—äº†åˆ›å»ºå®ä¾‹çš„å¤æ‚åº¦ï¼Œåªéœ€è¦æä¾›ä¸€ä¸ªæ¥å£ï¼Œç®€å•æ¸…æ™°ã€‚</li> <li>åœ¨ <code>Vue</code> æºç ä¸­ï¼Œä½ ä¹Ÿå¯ä»¥çœ‹åˆ°å·¥å‚æ¨¡å¼çš„ä½¿ç”¨ï¼Œæ¯”å¦‚åˆ›å»ºå¼‚æ­¥ç»„ä»¶</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createComponent</span> <span class="token punctuation">(</span>
  <span class="token parameter">Ctor<span class="token operator">:</span> Class<span class="token operator">&lt;</span>Component<span class="token operator">&gt;</span> <span class="token operator">|</span> Function <span class="token operator">|</span> Object <span class="token operator">|</span> <span class="token keyword">void</span><span class="token punctuation">,</span>
  data<span class="token operator">:</span> <span class="token operator">?</span>VNodeData<span class="token punctuation">,</span>
  context<span class="token operator">:</span> Component<span class="token punctuation">,</span>
  children<span class="token operator">:</span> <span class="token operator">?</span>Array<span class="token operator">&lt;</span>VNode<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  tag<span class="token operator">?</span><span class="token operator">:</span> string</span>
<span class="token punctuation">)</span><span class="token operator">:</span> VNode <span class="token operator">|</span> Array<span class="token operator">&lt;</span>VNode<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    
    <span class="token comment">// é€»è¾‘å¤„ç†...</span>
  
  <span class="token keyword">const</span> vnode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VNode</span><span class="token punctuation">(</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">vue-component-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>Ctor<span class="token punctuation">.</span>cid<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">''</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    data<span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> context<span class="token punctuation">,</span>
    <span class="token punctuation">{</span> Ctor<span class="token punctuation">,</span> propsData<span class="token punctuation">,</span> listeners<span class="token punctuation">,</span> tag<span class="token punctuation">,</span> children <span class="token punctuation">}</span><span class="token punctuation">,</span>
    asyncFactory
  <span class="token punctuation">)</span>

  <span class="token keyword">return</span> vnode
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åªéœ€è¦è°ƒç”¨ <code>createComponent</code> ä¼ å…¥å‚æ•°å°±èƒ½åˆ›å»ºä¸€ä¸ªç»„ä»¶å®ä¾‹ï¼Œä½†æ˜¯åˆ›å»ºè¿™ä¸ªå®ä¾‹æ˜¯å¾ˆå¤æ‚çš„ä¸€ä¸ªè¿‡ç¨‹ï¼Œå·¥å‚å¸®åŠ©æˆ‘ä»¬éšè—äº†è¿™ä¸ªå¤æ‚çš„è¿‡ç¨‹ï¼Œåªéœ€è¦ä¸€å¥ä»£ç è°ƒç”¨å°±èƒ½å®ç°åŠŸèƒ½</p></blockquote> <h3 id="_34-2-å•ä¾‹æ¨¡å¼"><a href="http://interview.poetries.top/docs/excellent.html#_34-2-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F" class="header-anchor">#</a> 34.2 å•ä¾‹æ¨¡å¼</h3> <ul><li>å•ä¾‹æ¨¡å¼å¾ˆå¸¸ç”¨ï¼Œæ¯”å¦‚å…¨å±€ç¼“å­˜ã€å…¨å±€çŠ¶æ€ç®¡ç†ç­‰ç­‰è¿™äº›åªéœ€è¦ä¸€ä¸ªå¯¹è±¡ï¼Œå°±å¯ä»¥ä½¿ç”¨å•ä¾‹æ¨¡å¼ã€‚</li> <li>å•ä¾‹æ¨¡å¼çš„æ ¸å¿ƒå°±æ˜¯ä¿è¯å…¨å±€åªæœ‰ä¸€ä¸ªå¯¹è±¡å¯ä»¥è®¿é—®ã€‚å› ä¸º <code>JS</code> æ˜¯é—¨æ— ç±»çš„è¯­è¨€ï¼Œæ‰€ä»¥åˆ«çš„è¯­è¨€å®ç°å•ä¾‹çš„æ–¹å¼å¹¶ä¸èƒ½å¥—å…¥ <code>JS</code> ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦ç”¨ä¸€ä¸ªå˜é‡ç¡®ä¿å®ä¾‹åªåˆ›å»ºä¸€æ¬¡å°±è¡Œï¼Œä»¥ä¸‹æ˜¯å¦‚ä½•å®ç°å•ä¾‹æ¨¡å¼çš„ä¾‹å­</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

Singleton<span class="token punctuation">.</span>getInstance <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> instance
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>instance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> instance
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> s1 <span class="token operator">=</span> Singleton<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> s2 <span class="token operator">=</span> Singleton<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s1 <span class="token operator">===</span> s2<span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre></div><blockquote><p>åœ¨ <code>Vuex</code> æºç ä¸­ï¼Œä½ ä¹Ÿå¯ä»¥çœ‹åˆ°å•ä¾‹æ¨¡å¼çš„ä½¿ç”¨ï¼Œè™½ç„¶å®ƒçš„å®ç°æ–¹å¼ä¸å¤§ä¸€æ ·ï¼Œé€šè¿‡ä¸€ä¸ªå¤–éƒ¨å˜é‡æ¥æ§åˆ¶åªå®‰è£…ä¸€æ¬¡ <code>Vuex</code></p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> Vue <span class="token comment">// bind on install</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">install</span> <span class="token punctuation">(</span><span class="token parameter">_Vue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Vue <span class="token operator">&amp;&amp;</span> _Vue <span class="token operator">===</span> Vue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¦‚æœå‘ç° Vue æœ‰å€¼ï¼Œå°±ä¸é‡æ–°åˆ›å»ºå®ä¾‹äº†</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  Vue <span class="token operator">=</span> _Vue
  <span class="token function">applyMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_34-3-é€‚é…å™¨æ¨¡å¼"><a href="http://interview.poetries.top/docs/excellent.html#_34-3-%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F" class="header-anchor">#</a> 34.3 é€‚é…å™¨æ¨¡å¼</h3> <ul><li>é€‚é…å™¨ç”¨æ¥è§£å†³ä¸¤ä¸ªæ¥å£ä¸å…¼å®¹çš„æƒ…å†µï¼Œä¸éœ€è¦æ”¹å˜å·²æœ‰çš„æ¥å£ï¼Œé€šè¿‡åŒ…è£…ä¸€å±‚çš„æ–¹å¼å®ç°ä¸¤ä¸ªæ¥å£çš„æ­£å¸¸åä½œã€‚</li> <li>ä»¥ä¸‹æ˜¯å¦‚ä½•å®ç°é€‚é…å™¨æ¨¡å¼çš„ä¾‹å­</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Plug</span> <span class="token punctuation">{</span>
  <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'æ¸¯ç‰ˆæ’å¤´'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Target</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>plug <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Plug</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>plug<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' é€‚é…å™¨è½¬äºŒè„šæ’å¤´'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Target</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
target<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// æ¸¯ç‰ˆæ’å¤´ é€‚é…å™¨è½¬äºŒè„šæ’å¤´</span>
</code></pre></div><blockquote><p>åœ¨ <code>Vue</code> ä¸­ï¼Œæˆ‘ä»¬å…¶å®ç»å¸¸ä½¿ç”¨åˆ°é€‚é…å™¨æ¨¡å¼ã€‚æ¯”å¦‚çˆ¶ç»„ä»¶ä¼ é€’ç»™å­ç»„ä»¶ä¸€ä¸ªæ—¶é—´æˆ³å±æ€§ï¼Œç»„ä»¶å†…éƒ¨éœ€è¦å°†æ—¶é—´æˆ³è½¬ä¸ºæ­£å¸¸çš„æ—¥æœŸæ˜¾ç¤ºï¼Œä¸€èˆ¬ä¼šä½¿ç”¨ <code>computed</code> æ¥åšè½¬æ¢è¿™ä»¶äº‹æƒ…ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±ä½¿ç”¨åˆ°äº†é€‚é…å™¨æ¨¡å¼</p></blockquote> <h3 id="_34-4-è£…é¥°æ¨¡å¼"><a href="http://interview.poetries.top/docs/excellent.html#_34-4-%E8%A3%85%E9%A5%B0%E6%A8%A1%E5%BC%8F" class="header-anchor">#</a> 34.4 è£…é¥°æ¨¡å¼</h3> <ul><li>è£…é¥°æ¨¡å¼ä¸éœ€è¦æ”¹å˜å·²æœ‰çš„æ¥å£ï¼Œä½œç”¨æ˜¯ç»™å¯¹è±¡æ·»åŠ åŠŸèƒ½ã€‚å°±åƒæˆ‘ä»¬ç»å¸¸éœ€è¦ç»™æ‰‹æœºæˆ´ä¸ªä¿æŠ¤å¥—é˜²æ‘”ä¸€æ ·ï¼Œä¸æ”¹å˜æ‰‹æœºè‡ªèº«ï¼Œç»™æ‰‹æœºæ·»åŠ äº†ä¿æŠ¤å¥—æä¾›é˜²æ‘”åŠŸèƒ½ã€‚</li> <li>ä»¥ä¸‹æ˜¯å¦‚ä½•å®ç°è£…é¥°æ¨¡å¼çš„ä¾‹å­ï¼Œä½¿ç”¨äº† ES7 ä¸­çš„è£…é¥°å™¨è¯­æ³•</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">readonly</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> descriptor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  descriptor<span class="token punctuation">.</span>writable <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token keyword">return</span> descriptor
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
  @readonly
  name <span class="token operator">=</span> <span class="token string">'yck'</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

t<span class="token punctuation">.</span>yck <span class="token operator">=</span> <span class="token string">'111'</span> <span class="token comment">// ä¸å¯ä¿®æ”¹</span>
</code></pre></div><blockquote><p>åœ¨ <code>React</code> ä¸­ï¼Œè£…é¥°æ¨¡å¼å…¶å®éšå¤„å¯è§</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>
<span class="token keyword">class</span> <span class="token class-name">MyComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span>mapStateToProps<span class="token punctuation">)</span><span class="token punctuation">(</span>MyComponent<span class="token punctuation">)</span>
</code></pre></div><h3 id="_34-5-ä»£ç†æ¨¡å¼"><a href="http://interview.poetries.top/docs/excellent.html#_34-5-%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F" class="header-anchor">#</a> 34.5 ä»£ç†æ¨¡å¼</h3> <ul><li>ä»£ç†æ˜¯ä¸ºäº†æ§åˆ¶å¯¹å¯¹è±¡çš„è®¿é—®ï¼Œä¸è®©å¤–éƒ¨ç›´æ¥è®¿é—®åˆ°å¯¹è±¡ã€‚åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œä¹Ÿæœ‰å¾ˆå¤šä»£ç†çš„åœºæ™¯ã€‚æ¯”å¦‚ä½ éœ€è¦ä¹°ä¸€ä»¶å›½å¤–çš„äº§å“ï¼Œè¿™æ—¶å€™ä½ å¯ä»¥é€šè¿‡ä»£è´­æ¥è´­ä¹°äº§å“ã€‚</li> <li>åœ¨å®é™…ä»£ç ä¸­å…¶å®ä»£ç†çš„åœºæ™¯å¾ˆå¤šï¼Œä¹Ÿå°±ä¸ä¸¾æ¡†æ¶ä¸­çš„ä¾‹å­äº†ï¼Œæ¯”å¦‚äº‹ä»¶ä»£ç†å°±ç”¨åˆ°äº†ä»£ç†æ¨¡å¼</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ul<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">let</span> ul <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#ul'</span><span class="token punctuation">)</span>
    ul<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><blockquote><p>å› ä¸ºå­˜åœ¨å¤ªå¤šçš„ liï¼Œä¸å¯èƒ½æ¯ä¸ªéƒ½å»ç»‘å®šäº‹ä»¶ã€‚è¿™æ—¶å€™å¯ä»¥é€šè¿‡ç»™çˆ¶èŠ‚ç‚¹ç»‘å®šä¸€ä¸ªäº‹ä»¶ï¼Œè®©çˆ¶èŠ‚ç‚¹ä½œä¸ºä»£ç†å»æ‹¿åˆ°çœŸå®ç‚¹å‡»çš„èŠ‚ç‚¹ã€‚</p></blockquote> <h3 id="_34-6-å‘å¸ƒ-è®¢é˜…æ¨¡å¼"><a href="http://interview.poetries.top/docs/excellent.html#_34-6-%E5%8F%91%E5%B8%83-%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F" class="header-anchor">#</a> 34.6 å‘å¸ƒ-è®¢é˜…æ¨¡å¼</h3> <ul><li>å‘å¸ƒ-è®¢é˜…æ¨¡å¼ä¹Ÿå«åšè§‚å¯Ÿè€…æ¨¡å¼ã€‚é€šè¿‡ä¸€å¯¹ä¸€æˆ–è€…ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œå½“å¯¹è±¡å‘ç”Ÿæ”¹å˜æ—¶ï¼Œè®¢é˜…æ–¹éƒ½ä¼šæ”¶åˆ°é€šçŸ¥ã€‚åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œä¹Ÿæœ‰å¾ˆå¤šç±»ä¼¼åœºæ™¯ï¼Œæ¯”å¦‚æˆ‘éœ€è¦åœ¨è´­ç‰©ç½‘ç«™ä¸Šè´­ä¹°ä¸€ä¸ªäº§å“ï¼Œä½†æ˜¯å‘ç°è¯¥äº§å“ç›®å‰å¤„äºç¼ºè´§çŠ¶æ€ï¼Œè¿™æ—¶å€™æˆ‘å¯ä»¥ç‚¹å‡»æœ‰è´§é€šçŸ¥çš„æŒ‰é’®ï¼Œè®©ç½‘ç«™åœ¨äº§å“æœ‰è´§çš„æ—¶å€™é€šè¿‡çŸ­ä¿¡é€šçŸ¥æˆ‘ã€‚</li> <li>åœ¨å®é™…ä»£ç ä¸­å…¶å®å‘å¸ƒ-è®¢é˜…æ¨¡å¼ä¹Ÿå¾ˆå¸¸è§ï¼Œæ¯”å¦‚æˆ‘ä»¬ç‚¹å‡»ä¸€ä¸ªæŒ‰é’®è§¦å‘äº†ç‚¹å‡»äº‹ä»¶å°±æ˜¯ä½¿ç”¨äº†è¯¥æ¨¡å¼</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ul<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">let</span> ul <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#ul'</span><span class="token punctuation">)</span>
    ul<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><blockquote><p>åœ¨ <code>Vue</code> ä¸­ï¼Œå¦‚ä½•å®ç°å“åº”å¼ä¹Ÿæ˜¯ä½¿ç”¨äº†è¯¥æ¨¡å¼ã€‚å¯¹äºéœ€è¦å®ç°å“åº”å¼çš„å¯¹è±¡æ¥è¯´ï¼Œåœ¨ <code>get</code> çš„æ—¶å€™ä¼šè¿›è¡Œä¾èµ–æ”¶é›†ï¼Œå½“æ”¹å˜äº†å¯¹è±¡çš„å±æ€§æ—¶ï¼Œå°±ä¼šè§¦å‘æ´¾å‘æ›´æ–°ã€‚</p></blockquote> <h3 id="_34-7-å¤–è§‚æ¨¡å¼"><a href="http://interview.poetries.top/docs/excellent.html#_34-7-%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F" class="header-anchor">#</a> 34.7 å¤–è§‚æ¨¡å¼</h3> <ul><li>å¤–è§‚æ¨¡å¼æä¾›äº†ä¸€ä¸ªæ¥å£ï¼Œéšè—äº†å†…éƒ¨çš„é€»è¾‘ï¼Œæ›´åŠ æ–¹ä¾¿å¤–éƒ¨è°ƒç”¨ã€‚</li> <li>ä¸ªä¾‹å­æ¥è¯´ï¼Œæˆ‘ä»¬ç°åœ¨éœ€è¦å®ç°ä¸€ä¸ªå…¼å®¹å¤šç§æµè§ˆå™¨çš„æ·»åŠ äº‹ä»¶æ–¹æ³•</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">addEvent</span><span class="token punctuation">(</span><span class="token parameter">elm<span class="token punctuation">,</span> evType<span class="token punctuation">,</span> fn<span class="token punctuation">,</span> useCapture</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>elm<span class="token punctuation">.</span>addEventListener<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    elm<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>evType<span class="token punctuation">,</span> fn<span class="token punctuation">,</span> useCapture<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>elm<span class="token punctuation">.</span>attachEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> r <span class="token operator">=</span> elm<span class="token punctuation">.</span><span class="token function">attachEvent</span><span class="token punctuation">(</span><span class="token string">"on"</span> <span class="token operator">+</span> evType<span class="token punctuation">,</span> fn<span class="token punctuation">)</span>
    <span class="token keyword">return</span> r
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    elm<span class="token punctuation">[</span><span class="token string">"on"</span> <span class="token operator">+</span> evType<span class="token punctuation">]</span> <span class="token operator">=</span> fn
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>å¯¹äºä¸åŒçš„æµè§ˆå™¨ï¼Œæ·»åŠ äº‹ä»¶çš„æ–¹å¼å¯èƒ½ä¼šå­˜åœ¨å…¼å®¹é—®é¢˜ã€‚å¦‚æœæ¯æ¬¡éƒ½éœ€è¦å»è¿™æ ·å†™ä¸€éçš„è¯è‚¯å®šæ˜¯ä¸èƒ½æ¥å—çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†è¿™äº›åˆ¤æ–­é€»è¾‘ç»Ÿä¸€å°è£…åœ¨ä¸€ä¸ªæ¥å£ä¸­ï¼Œå¤–éƒ¨éœ€è¦æ·»åŠ äº‹ä»¶åªéœ€è¦è°ƒç”¨ <code>addEvent</code> å³å¯ã€‚</p></blockquote> <h2 id="_35-å¸¸è§æ•°æ®ç»“æ„"><a href="http://interview.poetries.top/docs/excellent.html#_35-%E5%B8%B8%E8%A7%81%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84" class="header-anchor">#</a> 35 å¸¸è§æ•°æ®ç»“æ„</h2> <h3 id="_35-1-æ—¶é—´å¤æ‚åº¦"><a href="http://interview.poetries.top/docs/excellent.html#_35-1-%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6" class="header-anchor">#</a> 35.1 æ—¶é—´å¤æ‚åº¦</h3> <p>åœ¨è¿›å…¥æ­£é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸‹ä»€ä¹ˆæ˜¯æ—¶é—´å¤æ‚åº¦ã€‚</p> <ul><li>é€šå¸¸ä½¿ç”¨æœ€å·®çš„æ—¶é—´å¤æ‚åº¦æ¥è¡¡é‡ä¸€ä¸ªç®—æ³•çš„å¥½åã€‚</li> <li>å¸¸æ•°æ—¶é—´ <code>O(1)</code> ä»£è¡¨è¿™ä¸ªæ“ä½œå’Œæ•°æ®é‡æ²¡å…³ç³»ï¼Œæ˜¯ä¸€ä¸ªå›ºå®šæ—¶é—´çš„æ“ä½œï¼Œæ¯”å¦‚è¯´å››åˆ™è¿ç®—ã€‚</li> <li>å¯¹äºä¸€ä¸ªç®—æ³•æ¥è¯´ï¼Œå¯èƒ½ä¼šè®¡ç®—å‡ºæ“ä½œæ¬¡æ•°ä¸º <code>aN + 1</code>ï¼Œ<code>N</code> ä»£è¡¨æ•°æ®é‡ã€‚é‚£ä¹ˆè¯¥ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯ <code>O(N)</code>ã€‚å› ä¸ºæˆ‘ä»¬åœ¨è®¡ç®—æ—¶é—´å¤æ‚åº¦çš„æ—¶å€™ï¼Œæ•°æ®é‡é€šå¸¸æ˜¯éå¸¸å¤§çš„ï¼Œè¿™æ—¶å€™ä½é˜¶é¡¹å’Œå¸¸æ•°é¡¹å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚</li> <li>å½“ç„¶å¯èƒ½ä¼šå‡ºç°ä¸¤ä¸ªç®—æ³•éƒ½æ˜¯ <code>O(N)</code> çš„æ—¶é—´å¤æ‚åº¦ï¼Œé‚£ä¹ˆå¯¹æ¯”ä¸¤ä¸ªç®—æ³•çš„å¥½åå°±è¦é€šè¿‡å¯¹æ¯”ä½é˜¶é¡¹å’Œå¸¸æ•°é¡¹äº†</li></ul> <h3 id="_35-2-æ ˆ"><a href="http://interview.poetries.top/docs/excellent.html#_35-2-%E6%A0%88" class="header-anchor">#</a> 35.2 æ ˆ</h3> <p><strong>æ¦‚å¿µ</strong></p> <ul><li>æ ˆæ˜¯ä¸€ä¸ªçº¿æ€§ç»“æ„ï¼Œåœ¨è®¡ç®—æœºä¸­æ˜¯ä¸€ä¸ªç›¸å½“å¸¸è§çš„æ•°æ®ç»“æ„ã€‚</li> <li>æ ˆçš„ç‰¹ç‚¹æ˜¯åªèƒ½åœ¨æŸä¸€ç«¯æ·»åŠ æˆ–åˆ é™¤æ•°æ®ï¼Œéµå¾ªå…ˆè¿›åå‡ºçš„åŸåˆ™</li></ul> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/43.png" alt="" class="medium-zoom-image"></p> <p><strong>å®ç°</strong></p> <blockquote><p>æ¯ç§æ•°æ®ç»“æ„éƒ½å¯ä»¥ç”¨å¾ˆå¤šç§æ–¹å¼æ¥å®ç°ï¼Œå…¶å®å¯ä»¥æŠŠæ ˆçœ‹æˆæ˜¯æ•°ç»„çš„ä¸€ä¸ªå­é›†ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨æ•°ç»„æ¥å®ç°</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Stack</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token function">push</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>stack<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>stack<span class="token punctuation">.</span>length
  <span class="token punctuation">}</span>
  <span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_35-3-åº”ç”¨"><a href="http://interview.poetries.top/docs/excellent.html#_35-3-%E5%BA%94%E7%94%A8" class="header-anchor">#</a> 35.3 åº”ç”¨</h3> <blockquote><p>é€‰å–äº† LeetCode ä¸Šåºå·ä¸º <a href="https://leetcode.com/problems/valid-parentheses/submissions/1" target="_blank" rel="noopener noreferrer">20 çš„é¢˜<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>é¢˜æ„æ˜¯åŒ¹é…æ‹¬å·ï¼Œå¯ä»¥é€šè¿‡æ ˆçš„ç‰¹æ€§æ¥å®Œæˆè¿™é“é¢˜ç›®</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">isValid</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'('</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token string">')'</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token string">'['</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token string">']'</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token string">'{'</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token string">'}'</span><span class="token operator">:</span> <span class="token number">3</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> s<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>map<span class="token punctuation">[</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> last <span class="token operator">=</span> stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>map<span class="token punctuation">[</span>last<span class="token punctuation">]</span> <span class="token operator">+</span> map<span class="token punctuation">[</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>stack<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span>
  <span class="token keyword">return</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>å…¶å®åœ¨ <code>Vue</code> ä¸­å…³äºæ¨¡æ¿è§£æçš„ä»£ç ï¼Œå°±æœ‰åº”ç”¨åˆ°åŒ¹é…å°–æ‹¬å·çš„å†…å®¹</p></blockquote> <h3 id="_35-4-é˜Ÿåˆ—"><a href="http://interview.poetries.top/docs/excellent.html#_35-4-%E9%98%9F%E5%88%97" class="header-anchor">#</a> 35.4 é˜Ÿåˆ—</h3> <p><strong>æ¦‚å¿µ</strong></p> <blockquote><p>é˜Ÿåˆ—æ˜¯ä¸€ä¸ªçº¿æ€§ç»“æ„ï¼Œç‰¹ç‚¹æ˜¯åœ¨æŸä¸€ç«¯æ·»åŠ æ•°æ®ï¼Œåœ¨å¦ä¸€ç«¯åˆ é™¤æ•°æ®ï¼Œéµå¾ªå…ˆè¿›å…ˆå‡ºçš„åŸåˆ™</p></blockquote> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/44.png" alt="" class="medium-zoom-image"></p> <p><strong>å®ç°</strong></p> <blockquote><p>è¿™é‡Œä¼šè®²è§£ä¸¤ç§å®ç°é˜Ÿåˆ—çš„æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯å•é“¾é˜Ÿåˆ—å’Œå¾ªç¯é˜Ÿåˆ—ã€‚</p></blockquote> <p><strong>å•é“¾é˜Ÿåˆ—</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Queue</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>queue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token function">enQueue</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">deQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>queue<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>queue<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token function">getLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>queue<span class="token punctuation">.</span>length
  <span class="token punctuation">}</span>
  <span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>å› ä¸ºå•é“¾é˜Ÿåˆ—åœ¨å‡ºé˜Ÿæ“ä½œçš„æ—¶å€™éœ€è¦ <code>O(n)</code> çš„æ—¶é—´å¤æ‚åº¦ï¼Œæ‰€ä»¥å¼•å…¥äº†å¾ªç¯é˜Ÿåˆ—ã€‚å¾ªç¯é˜Ÿåˆ—çš„å‡ºé˜Ÿæ“ä½œå¹³å‡æ˜¯ <code>O(1)</code> çš„æ—¶é—´å¤æ‚åº¦ã€‚</p></blockquote> <p><strong>å¾ªç¯é˜Ÿåˆ—</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">SqQueue</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">length</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>queue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token comment">// é˜Ÿå¤´</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>first <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token comment">// é˜Ÿå°¾</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>last <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token comment">// å½“å‰é˜Ÿåˆ—å¤§å°</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>size <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>
  <span class="token function">enQueue</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// åˆ¤æ–­é˜Ÿå°¾ + 1 æ˜¯å¦ä¸ºé˜Ÿå¤´</span>
    <span class="token comment">// å¦‚æœæ˜¯å°±ä»£è¡¨éœ€è¦æ‰©å®¹æ•°ç»„</span>
    <span class="token comment">// % this.queue.length æ˜¯ä¸ºäº†é˜²æ­¢æ•°ç»„è¶Šç•Œ</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>first <span class="token operator">===</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>last <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token keyword">this</span><span class="token punctuation">.</span>queue<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>queue<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>last<span class="token punctuation">]</span> <span class="token operator">=</span> item
    <span class="token keyword">this</span><span class="token punctuation">.</span>size<span class="token operator">++</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>last <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>last <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token keyword">this</span><span class="token punctuation">.</span>queue<span class="token punctuation">.</span>length
  <span class="token punctuation">}</span>
  <span class="token function">deQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">'Queue is empty'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>queue<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>first<span class="token punctuation">]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>queue<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>first<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>first <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>first <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token keyword">this</span><span class="token punctuation">.</span>queue<span class="token punctuation">.</span>length
    <span class="token keyword">this</span><span class="token punctuation">.</span>size<span class="token operator">--</span>
    <span class="token comment">// åˆ¤æ–­å½“å‰é˜Ÿåˆ—å¤§å°æ˜¯å¦è¿‡å°</span>
    <span class="token comment">// ä¸ºäº†ä¿è¯ä¸æµªè´¹ç©ºé—´ï¼Œåœ¨é˜Ÿåˆ—ç©ºé—´ç­‰äºæ€»é•¿åº¦å››åˆ†ä¹‹ä¸€æ—¶</span>
    <span class="token comment">// ä¸”ä¸ä¸º 2 æ—¶ç¼©å°æ€»é•¿åº¦ä¸ºå½“å‰çš„ä¸€åŠ</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>size <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">4</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> r
  <span class="token punctuation">}</span>
  <span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">'Queue is empty'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>queue<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>first<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token function">getLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>queue<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
  <span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>first <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>last
  <span class="token punctuation">}</span>
  <span class="token function">resize</span><span class="token punctuation">(</span><span class="token parameter">length</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> q <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      q<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>queue<span class="token punctuation">[</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>first<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token keyword">this</span><span class="token punctuation">.</span>queue<span class="token punctuation">.</span>length<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>queue <span class="token operator">=</span> q
    <span class="token keyword">this</span><span class="token punctuation">.</span>first <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>last <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>size
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_35-5-é“¾è¡¨"><a href="http://interview.poetries.top/docs/excellent.html#_35-5-%E9%93%BE%E8%A1%A8" class="header-anchor">#</a> 35.5 é“¾è¡¨</h3> <p><strong>æ¦‚å¿µ</strong></p> <blockquote><p>é“¾è¡¨æ˜¯ä¸€ä¸ªçº¿æ€§ç»“æ„ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªå¤©ç„¶çš„é€’å½’ç»“æ„ã€‚é“¾è¡¨ç»“æ„å¯ä»¥å……åˆ†åˆ©ç”¨è®¡ç®—æœºå†…å­˜ç©ºé—´ï¼Œå®ç°çµæ´»çš„å†…å­˜åŠ¨æ€ç®¡ç†ã€‚ä½†æ˜¯é“¾è¡¨å¤±å»äº†æ•°ç»„éšæœºè¯»å–çš„ä¼˜ç‚¹ï¼ŒåŒæ—¶é“¾è¡¨ç”±äºå¢åŠ äº†ç»“ç‚¹çš„æŒ‡é’ˆåŸŸï¼Œç©ºé—´å¼€é”€æ¯”è¾ƒå¤§ã€‚</p></blockquote> <p><strong>æ¦‚å¿µ</strong></p> <blockquote><p>é“¾è¡¨æ˜¯ä¸€ä¸ªçº¿æ€§ç»“æ„ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªå¤©ç„¶çš„é€’å½’ç»“æ„ã€‚é“¾è¡¨ç»“æ„å¯ä»¥å……åˆ†åˆ©ç”¨è®¡ç®—æœºå†…å­˜ç©ºé—´ï¼Œå®ç°çµæ´»çš„å†…å­˜åŠ¨æ€ç®¡ç†ã€‚ä½†æ˜¯é“¾è¡¨å¤±å»äº†æ•°ç»„éšæœºè¯»å–çš„ä¼˜ç‚¹ï¼ŒåŒæ—¶é“¾è¡¨ç”±äºå¢åŠ äº†ç»“ç‚¹çš„æŒ‡é’ˆåŸŸï¼Œç©ºé—´å¼€é”€æ¯”è¾ƒå¤§ã€‚</p></blockquote> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/46.png" alt="" class="medium-zoom-image"></p> <p><strong>å®ç°</strong></p> <p><strong>å•å‘é“¾è¡¨</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Node</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> v
    <span class="token keyword">this</span><span class="token punctuation">.</span>next <span class="token operator">=</span> next
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">LinkList</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// é“¾è¡¨é•¿åº¦</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>size <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token comment">// è™šæ‹Ÿå¤´éƒ¨</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dummyNode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">header<span class="token punctuation">,</span> index<span class="token punctuation">,</span> currentIndex</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">===</span> currentIndex<span class="token punctuation">)</span> <span class="token keyword">return</span> header
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>header<span class="token punctuation">.</span>next<span class="token punctuation">,</span> index<span class="token punctuation">,</span> currentIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">addNode</span><span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">checkIndex</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span>
    <span class="token comment">// å½“å¾€é“¾è¡¨æœ«å°¾æ’å…¥æ—¶ï¼Œprev.next ä¸ºç©º</span>
    <span class="token comment">// å…¶ä»–æƒ…å†µæ—¶ï¼Œå› ä¸ºè¦æ’å…¥èŠ‚ç‚¹ï¼Œæ‰€ä»¥æ’å…¥çš„èŠ‚ç‚¹</span>
    <span class="token comment">// çš„ next åº”è¯¥æ˜¯ prev.next</span>
    <span class="token comment">// ç„¶åè®¾ç½® prev.next ä¸ºæ’å…¥çš„èŠ‚ç‚¹</span>
    <span class="token keyword">let</span> prev <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>dummyNode<span class="token punctuation">,</span> index<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    prev<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> prev<span class="token punctuation">.</span>next<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>size<span class="token operator">++</span>
    <span class="token keyword">return</span> prev<span class="token punctuation">.</span>next
  <span class="token punctuation">}</span>
  <span class="token function">insertNode</span><span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addNode</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> index<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">addToFirst</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addNode</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">addToLast</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addNode</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>size<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">removeNode</span><span class="token punctuation">(</span><span class="token parameter">index<span class="token punctuation">,</span> isLast</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">checkIndex</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span>
    index <span class="token operator">=</span> isLast <span class="token operator">?</span> index <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">:</span> index
    <span class="token keyword">let</span> prev <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>dummyNode<span class="token punctuation">,</span> index<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> node <span class="token operator">=</span> prev<span class="token punctuation">.</span>next
    prev<span class="token punctuation">.</span>next <span class="token operator">=</span> node<span class="token punctuation">.</span>next
    node<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>size<span class="token operator">--</span>
    <span class="token keyword">return</span> node
  <span class="token punctuation">}</span>
  <span class="token function">removeFirstNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">removeNode</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">removeLastNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">removeNode</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>size<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">checkIndex</span><span class="token punctuation">(</span><span class="token parameter">index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> index <span class="token operator">&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>size<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">'Index error'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">getNode</span><span class="token punctuation">(</span><span class="token parameter">index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">checkIndex</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>dummyNode<span class="token punctuation">,</span> index<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>next
  <span class="token punctuation">}</span>
  <span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>size <span class="token operator">===</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>
  <span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>size
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_35-6-æ ‘"><a href="http://interview.poetries.top/docs/excellent.html#_35-6-%E6%A0%91" class="header-anchor">#</a> 35.6 æ ‘</h3> <p><strong>äºŒå‰æ ‘</strong></p> <ul><li>æ ‘æ‹¥æœ‰å¾ˆå¤šç§ç»“æ„ï¼ŒäºŒå‰æ ‘æ˜¯æ ‘ä¸­æœ€å¸¸ç”¨çš„ç»“æ„ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªå¤©ç„¶çš„é€’å½’ç»“æ„ã€‚</li> <li>äºŒå‰æ ‘æ‹¥æœ‰ä¸€ä¸ªæ ¹èŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹è‡³å¤šæ‹¥æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œåˆ†åˆ«ä¸ºï¼šå·¦èŠ‚ç‚¹å’Œå³èŠ‚ç‚¹ã€‚æ ‘çš„æœ€åº•éƒ¨èŠ‚ç‚¹ç§°ä¹‹ä¸ºå¶èŠ‚ç‚¹ï¼Œå½“ä¸€é¢—æ ‘çš„å¶æ•°é‡æ•°é‡ä¸ºæ»¡æ—¶ï¼Œè¯¥æ ‘å¯ä»¥ç§°ä¹‹ä¸ºæ»¡äºŒå‰æ ‘ã€‚</li></ul> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/47.png" alt="" class="medium-zoom-image"></p> <p><strong>äºŒåˆ†æœç´¢æ ‘</strong></p> <ul><li>äºŒåˆ†æœç´¢æ ‘ä¹Ÿæ˜¯äºŒå‰æ ‘ï¼Œæ‹¥æœ‰äºŒå‰æ ‘çš„ç‰¹æ€§ã€‚ä½†æ˜¯åŒºåˆ«åœ¨äºäºŒåˆ†æœç´¢æ ‘æ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½æ¯”ä»–çš„å·¦å­æ ‘çš„å€¼å¤§ï¼Œæ¯”å³å­æ ‘çš„å€¼å°ã€‚</li> <li>è¿™ç§å­˜å‚¨æ–¹å¼å¾ˆé€‚åˆäºæ•°æ®æœç´¢ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå½“éœ€è¦æŸ¥æ‰¾ 6 çš„æ—¶å€™ï¼Œå› ä¸ºéœ€è¦æŸ¥æ‰¾çš„å€¼æ¯”æ ¹èŠ‚ç‚¹çš„å€¼å¤§ï¼Œæ‰€ä»¥åªéœ€è¦åœ¨æ ¹èŠ‚ç‚¹çš„å³å­æ ‘ä¸Šå¯»æ‰¾ï¼Œå¤§å¤§æé«˜äº†æœç´¢æ•ˆç‡ã€‚</li></ul> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/48.png" alt="" class="medium-zoom-image"></p> <p><strong>å®ç°</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Node</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
    <span class="token keyword">this</span><span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>right <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">BST</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>root <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>size <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>
  <span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>size
  <span class="token punctuation">}</span>
  <span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>size <span class="token operator">===</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>
  <span class="token function">addNode</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>root <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_addChild</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// æ·»åŠ èŠ‚ç‚¹æ—¶ï¼Œéœ€è¦æ¯”è¾ƒæ·»åŠ çš„èŠ‚ç‚¹å€¼å’Œå½“å‰</span>
  <span class="token comment">// èŠ‚ç‚¹å€¼çš„å¤§å°</span>
  <span class="token function">_addChild</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>node<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>size<span class="token operator">++</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>value <span class="token operator">&gt;</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      node<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_addChild</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>value <span class="token operator">&lt;</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      node<span class="token punctuation">.</span>right <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_addChild</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> node
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>ä»¥ä¸Šæ˜¯æœ€åŸºæœ¬çš„äºŒåˆ†æœç´¢æ ‘å®ç°ï¼Œæ¥ä¸‹æ¥å®ç°æ ‘çš„éå†ã€‚</li> <li>å¯¹äºæ ‘çš„éå†æ¥è¯´ï¼Œæœ‰ä¸‰ç§éå†æ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯å…ˆåºéå†ã€ä¸­åºéå†ã€ååºéå†ã€‚ä¸‰ç§éå†çš„åŒºåˆ«åœ¨äºä½•æ—¶è®¿é—®èŠ‚ç‚¹ã€‚åœ¨éå†æ ‘çš„è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šéå†ä¸‰æ¬¡ï¼Œåˆ†åˆ«æ˜¯éå†åˆ°è‡ªå·±ï¼Œéå†å·¦å­æ ‘å’Œéå†å³å­æ ‘ã€‚å¦‚æœéœ€è¦å®ç°å…ˆåºéå†ï¼Œé‚£ä¹ˆåªéœ€è¦ç¬¬ä¸€æ¬¡éå†åˆ°èŠ‚ç‚¹æ—¶è¿›è¡Œæ“ä½œå³å¯ã€‚</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// å…ˆåºéå†å¯ç”¨äºæ‰“å°æ ‘çš„ç»“æ„</span>
<span class="token comment">// å…ˆåºéå†å…ˆè®¿é—®æ ¹èŠ‚ç‚¹ï¼Œç„¶åè®¿é—®å·¦èŠ‚ç‚¹ï¼Œæœ€åè®¿é—®å³èŠ‚ç‚¹ã€‚</span>
<span class="token function">preTraversal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_pre</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">_pre</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_pre</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_pre</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// ä¸­åºéå†å¯ç”¨äºæ’åº</span>
<span class="token comment">// å¯¹äº BST æ¥è¯´ï¼Œä¸­åºéå†å¯ä»¥å®ç°ä¸€æ¬¡éå†å°±</span>
<span class="token comment">// å¾—åˆ°æœ‰åºçš„å€¼</span>
<span class="token comment">// ä¸­åºéå†è¡¨ç¤ºå…ˆè®¿é—®å·¦èŠ‚ç‚¹ï¼Œç„¶åè®¿é—®æ ¹èŠ‚ç‚¹ï¼Œæœ€åè®¿é—®å³èŠ‚ç‚¹ã€‚</span>
<span class="token function">midTraversal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_mid</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">_mid</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_mid</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_mid</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// ååºéå†å¯ç”¨äºå…ˆæ“ä½œå­èŠ‚ç‚¹</span>
<span class="token comment">// å†æ“ä½œçˆ¶èŠ‚ç‚¹çš„åœºæ™¯</span>
<span class="token comment">// ååºéå†è¡¨ç¤ºå…ˆè®¿é—®å·¦èŠ‚ç‚¹ï¼Œç„¶åè®¿é—®å³èŠ‚ç‚¹ï¼Œæœ€åè®¿é—®æ ¹èŠ‚ç‚¹ã€‚</span>
<span class="token function">backTraversal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_back</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">_back</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_back</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_back</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>ä»¥ä¸Šçš„è¿™å‡ ç§éå†éƒ½å¯ä»¥ç§°ä¹‹ä¸ºæ·±åº¦éå†ï¼Œå¯¹åº”çš„è¿˜æœ‰ç§éå†å«åšå¹¿åº¦éå†ï¼Œä¹Ÿå°±æ˜¯ä¸€å±‚å±‚åœ°éå†æ ‘ã€‚å¯¹äºå¹¿åº¦éå†æ¥è¯´ï¼Œæˆ‘ä»¬éœ€è¦åˆ©ç”¨ä¹‹å‰è®²è¿‡çš„é˜Ÿåˆ—ç»“æ„æ¥å®Œæˆã€‚</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">breadthTraversal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span>
  <span class="token keyword">let</span> q <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Queue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// å°†æ ¹èŠ‚ç‚¹å…¥é˜Ÿ</span>
  q<span class="token punctuation">.</span><span class="token function">enQueue</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">)</span>
  <span class="token comment">// å¾ªç¯åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©º</span>
  <span class="token comment">// ä»£è¡¨æ ‘éå†å®Œæ¯•</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>q<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å°†é˜Ÿé¦–å‡ºé˜Ÿï¼Œåˆ¤æ–­æ˜¯å¦æœ‰å·¦å³å­æ ‘</span>
    <span class="token comment">// æœ‰çš„è¯ï¼Œå°±å…ˆå·¦åå³å…¥é˜Ÿ</span>
    <span class="token keyword">let</span> n <span class="token operator">=</span> q<span class="token punctuation">.</span><span class="token function">deQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>n<span class="token punctuation">.</span>left<span class="token punctuation">)</span> q<span class="token punctuation">.</span><span class="token function">enQueue</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span>left<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>n<span class="token punctuation">.</span>right<span class="token punctuation">)</span> q<span class="token punctuation">.</span><span class="token function">enQueue</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span>right<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>æ¥ä¸‹æ¥å…ˆä»‹ç»å¦‚ä½•åœ¨æ ‘ä¸­å¯»æ‰¾æœ€å°å€¼æˆ–æœ€å¤§æ•°ã€‚å› ä¸ºäºŒåˆ†æœç´¢æ ‘çš„ç‰¹æ€§ï¼Œæ‰€ä»¥æœ€å°å€¼ä¸€å®šåœ¨æ ¹èŠ‚ç‚¹çš„æœ€å·¦è¾¹ï¼Œæœ€å¤§å€¼ç›¸å</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">getMin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getMin</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">)</span><span class="token punctuation">.</span>value
<span class="token punctuation">}</span>
<span class="token function">_getMin</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>node<span class="token punctuation">.</span>left<span class="token punctuation">)</span> <span class="token keyword">return</span> node
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getMin</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">getMax</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getMax</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">)</span><span class="token punctuation">.</span>value
<span class="token punctuation">}</span>
<span class="token function">_getMax</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>node<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token keyword">return</span> node
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getMin</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>å‘ä¸Šå–æ•´å’Œå‘ä¸‹å–æ•´ï¼Œè¿™ä¸¤ä¸ªæ“ä½œæ˜¯ç›¸åçš„ï¼Œæ‰€ä»¥ä»£ç ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œè¿™é‡Œåªä»‹ç»å¦‚ä½•å‘ä¸‹å–æ•´ã€‚æ—¢ç„¶æ˜¯å‘ä¸‹å–æ•´ï¼Œé‚£ä¹ˆæ ¹æ®äºŒåˆ†æœç´¢æ ‘çš„ç‰¹æ€§ï¼Œå€¼ä¸€å®šåœ¨æ ¹èŠ‚ç‚¹çš„å·¦ä¾§ã€‚åªéœ€è¦ä¸€ç›´éå†å·¦å­æ ‘ç›´åˆ°å½“å‰èŠ‚ç‚¹çš„å€¼ä¸å†å¤§äºç­‰äºéœ€è¦çš„å€¼ï¼Œç„¶ååˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦è¿˜æ‹¥æœ‰å³å­æ ‘ã€‚å¦‚æœæœ‰çš„è¯ï¼Œç»§ç»­ä¸Šé¢çš„é€’å½’åˆ¤æ–­ã€‚</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">floor</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> node <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_floor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
  <span class="token keyword">return</span> node <span class="token operator">?</span> node<span class="token punctuation">.</span>value <span class="token operator">:</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span>
<span class="token function">_floor</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>node<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>value <span class="token operator">===</span> v<span class="token punctuation">)</span> <span class="token keyword">return</span> v
  <span class="token comment">// å¦‚æœå½“å‰èŠ‚ç‚¹å€¼è¿˜æ¯”éœ€è¦çš„å€¼å¤§ï¼Œå°±ç»§ç»­é€’å½’</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>value <span class="token operator">&gt;</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_floor</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// åˆ¤æ–­å½“å‰èŠ‚ç‚¹æ˜¯å¦æ‹¥æœ‰å³å­æ ‘</span>
  <span class="token keyword">let</span> right <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_floor</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>right<span class="token punctuation">)</span> <span class="token keyword">return</span> right
  <span class="token keyword">return</span> node
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>æ’åï¼Œè¿™æ˜¯ç”¨äºè·å–ç»™å®šå€¼çš„æ’åæˆ–è€…æ’åç¬¬å‡ çš„èŠ‚ç‚¹çš„å€¼ï¼Œè¿™ä¸¤ä¸ªæ“ä½œä¹Ÿæ˜¯ç›¸åçš„ï¼Œæ‰€ä»¥è¿™ä¸ªåªä»‹ç»å¦‚ä½•è·å–æ’åç¬¬å‡ çš„èŠ‚ç‚¹çš„å€¼ã€‚å¯¹äºè¿™ä¸ªæ“ä½œè€Œè¨€ï¼Œæˆ‘ä»¬éœ€è¦ç•¥å¾®çš„æ”¹é€ ç‚¹ä»£ç ï¼Œè®©æ¯ä¸ªèŠ‚ç‚¹æ‹¥æœ‰ä¸€ä¸ª size å±æ€§ã€‚è¯¥å±æ€§è¡¨ç¤ºè¯¥èŠ‚ç‚¹ä¸‹æœ‰å¤šå°‘å­èŠ‚ç‚¹ï¼ˆåŒ…å«è‡ªèº«ï¼‰</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Node</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
    <span class="token keyword">this</span><span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>right <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token comment">// ä¿®æ”¹ä»£ç </span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>size <span class="token operator">=</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// æ–°å¢ä»£ç </span>
<span class="token function">_getSize</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> node <span class="token operator">?</span> node<span class="token punctuation">.</span>size <span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
<span class="token function">_addChild</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>node<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>value <span class="token operator">&gt;</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ä¿®æ”¹ä»£ç </span>
    node<span class="token punctuation">.</span>size<span class="token operator">++</span>
    node<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_addChild</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>value <span class="token operator">&lt;</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ä¿®æ”¹ä»£ç </span>
    node<span class="token punctuation">.</span>size<span class="token operator">++</span>
    node<span class="token punctuation">.</span>right <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_addChild</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> node
<span class="token punctuation">}</span>
<span class="token function">select</span><span class="token punctuation">(</span><span class="token parameter">k</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> node <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_select</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">,</span> k<span class="token punctuation">)</span>
  <span class="token keyword">return</span> node <span class="token operator">?</span> node<span class="token punctuation">.</span>value <span class="token operator">:</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span>
<span class="token function">_select</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> k</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>node<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span>
  <span class="token comment">// å…ˆè·å–å·¦å­æ ‘ä¸‹æœ‰å‡ ä¸ªèŠ‚ç‚¹</span>
  <span class="token keyword">let</span> size <span class="token operator">=</span> node<span class="token punctuation">.</span>left <span class="token operator">?</span> node<span class="token punctuation">.</span>left<span class="token punctuation">.</span>size <span class="token operator">:</span> <span class="token number">0</span>
  <span class="token comment">// åˆ¤æ–­ size æ˜¯å¦å¤§äº k</span>
  <span class="token comment">// å¦‚æœå¤§äº kï¼Œä»£è¡¨æ‰€éœ€è¦çš„èŠ‚ç‚¹åœ¨å·¦èŠ‚ç‚¹</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>size <span class="token operator">&gt;</span> k<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_select</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">,</span> k<span class="token punctuation">)</span>
  <span class="token comment">// å¦‚æœå°äº kï¼Œä»£è¡¨æ‰€éœ€è¦çš„èŠ‚ç‚¹åœ¨å³èŠ‚ç‚¹</span>
  <span class="token comment">// æ³¨æ„è¿™é‡Œéœ€è¦é‡æ–°è®¡ç®— kï¼Œå‡å»æ ¹èŠ‚ç‚¹é™¤äº†å³å­æ ‘çš„èŠ‚ç‚¹æ•°é‡</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>size <span class="token operator">&lt;</span> k<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_select</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">,</span> k <span class="token operator">-</span> size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> node
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>æ¥ä¸‹æ¥è®²è§£çš„æ˜¯äºŒåˆ†æœç´¢æ ‘ä¸­æœ€éš¾å®ç°çš„éƒ¨åˆ†ï¼šåˆ é™¤èŠ‚ç‚¹ã€‚å› ä¸ºå¯¹äºåˆ é™¤èŠ‚ç‚¹æ¥è¯´ï¼Œä¼šå­˜åœ¨ä»¥ä¸‹å‡ ç§æƒ…å†µ</p></blockquote> <ul><li>éœ€è¦åˆ é™¤çš„èŠ‚ç‚¹æ²¡æœ‰å­æ ‘</li> <li>éœ€è¦åˆ é™¤çš„èŠ‚ç‚¹åªæœ‰ä¸€æ¡å­æ ‘</li> <li>éœ€è¦åˆ é™¤çš„èŠ‚ç‚¹æœ‰å·¦å³ä¸¤æ¡æ ‘</li></ul> <blockquote><p>å¯¹äºå‰ä¸¤ç§æƒ…å†µå¾ˆå¥½è§£å†³ï¼Œä½†æ˜¯ç¬¬ä¸‰ç§æƒ…å†µå°±æœ‰éš¾åº¦äº†ï¼Œæ‰€ä»¥å…ˆæ¥å®ç°ç›¸å¯¹ç®€å•çš„æ“ä½œï¼šåˆ é™¤æœ€å°èŠ‚ç‚¹ï¼Œå¯¹äºåˆ é™¤æœ€å°èŠ‚ç‚¹æ¥è¯´ï¼Œæ˜¯ä¸å­˜åœ¨ç¬¬ä¸‰ç§æƒ…å†µçš„ï¼Œåˆ é™¤æœ€å¤§èŠ‚ç‚¹æ“ä½œæ˜¯å’Œåˆ é™¤æœ€å°èŠ‚ç‚¹ç›¸åçš„ï¼Œæ‰€ä»¥è¿™é‡Œä¹Ÿå°±ä¸å†èµ˜è¿°ã€‚</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">delectMin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>root <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_delectMin</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">_delectMin</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ä¸€ç›´é€’å½’å·¦å­æ ‘</span>
  <span class="token comment">// å¦‚æœå·¦å­æ ‘ä¸ºç©ºï¼Œå°±åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦æ‹¥æœ‰å³å­æ ‘</span>
  <span class="token comment">// æœ‰å³å­æ ‘çš„è¯å°±æŠŠéœ€è¦åˆ é™¤çš„èŠ‚ç‚¹æ›¿æ¢ä¸ºå³å­æ ‘</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>node <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token operator">!</span>node<span class="token punctuation">.</span>left<span class="token punctuation">)</span> <span class="token keyword">return</span> node<span class="token punctuation">.</span>right
  node<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_delectMin</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">)</span>
  <span class="token comment">// æœ€åéœ€è¦é‡æ–°ç»´æŠ¤ä¸‹èŠ‚ç‚¹çš„ `size`</span>
  node<span class="token punctuation">.</span>size <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getSize</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getSize</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
  <span class="token keyword">return</span> node
<span class="token punctuation">}</span>
</code></pre></div><ul><li>æœ€åè®²è§£çš„å°±æ˜¯å¦‚ä½•åˆ é™¤ä»»æ„èŠ‚ç‚¹äº†ã€‚å¯¹äºè¿™ä¸ªæ“ä½œï¼ŒT.Hibbard åœ¨ 1962 å¹´æå‡ºäº†è§£å†³è¿™ä¸ªéš¾é¢˜çš„åŠæ³•ï¼Œä¹Ÿå°±æ˜¯å¦‚ä½•è§£å†³ç¬¬ä¸‰ç§æƒ…å†µã€‚</li> <li>å½“é‡åˆ°è¿™ç§æƒ…å†µæ—¶ï¼Œéœ€è¦å–å‡ºå½“å‰èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹ï¼ˆä¹Ÿå°±æ˜¯å½“å‰èŠ‚ç‚¹å³å­æ ‘çš„æœ€å°èŠ‚ç‚¹ï¼‰æ¥æ›¿æ¢éœ€è¦åˆ é™¤çš„èŠ‚ç‚¹ã€‚ç„¶åå°†éœ€è¦åˆ é™¤èŠ‚ç‚¹çš„å·¦å­æ ‘èµ‹å€¼ç»™åç»§ç»“ç‚¹ï¼Œå³å­æ ‘åˆ é™¤åç»§ç»“ç‚¹åèµ‹å€¼ç»™ä»–ã€‚</li> <li>ä½ å¦‚æœå¯¹äºè¿™ä¸ªè§£å†³åŠæ³•æœ‰ç–‘é—®çš„è¯ï¼Œå¯ä»¥è¿™æ ·è€ƒè™‘ã€‚å› ä¸ºäºŒåˆ†æœç´¢æ ‘çš„ç‰¹æ€§ï¼Œçˆ¶èŠ‚ç‚¹ä¸€å®šæ¯”æ‰€æœ‰å·¦å­èŠ‚ç‚¹å¤§ï¼Œæ¯”æ‰€æœ‰å³å­èŠ‚ç‚¹å°ã€‚é‚£ä¹ˆå½“éœ€è¦åˆ é™¤çˆ¶èŠ‚ç‚¹æ—¶ï¼ŒåŠ¿å¿…éœ€è¦æ‹¿å‡ºä¸€ä¸ªæ¯”çˆ¶èŠ‚ç‚¹å¤§çš„èŠ‚ç‚¹æ¥æ›¿æ¢çˆ¶èŠ‚ç‚¹ã€‚è¿™ä¸ªèŠ‚ç‚¹è‚¯å®šä¸å­˜åœ¨äºå·¦å­æ ‘ï¼Œå¿…ç„¶å­˜åœ¨äºå³å­æ ‘ã€‚ç„¶ååˆéœ€è¦ä¿æŒçˆ¶èŠ‚ç‚¹éƒ½æ˜¯æ¯”å³å­èŠ‚ç‚¹å°çš„ï¼Œé‚£ä¹ˆå°±å¯ä»¥å–å‡ºå³å­æ ‘ä¸­æœ€å°çš„é‚£ä¸ªèŠ‚ç‚¹æ¥æ›¿æ¢çˆ¶èŠ‚ç‚¹ã€‚</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">delect</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>root <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_delect</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">_delect</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>node<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span>
  <span class="token comment">// å¯»æ‰¾çš„èŠ‚ç‚¹æ¯”å½“å‰èŠ‚ç‚¹å°ï¼Œå»å·¦å­æ ‘æ‰¾</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>value <span class="token operator">&lt;</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    node<span class="token punctuation">.</span>right <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_delect</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>value <span class="token operator">&gt;</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¯»æ‰¾çš„èŠ‚ç‚¹æ¯”å½“å‰èŠ‚ç‚¹å¤§ï¼Œå»å³å­æ ‘æ‰¾</span>
    node<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_delect</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// è¿›å…¥è¿™ä¸ªæ¡ä»¶è¯´æ˜å·²ç»æ‰¾åˆ°èŠ‚ç‚¹</span>
    <span class="token comment">// å…ˆåˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦æ‹¥æœ‰æ‹¥æœ‰å·¦å³å­æ ‘ä¸­çš„ä¸€ä¸ª</span>
    <span class="token comment">// æ˜¯çš„è¯ï¼Œå°†å­æ ‘è¿”å›å‡ºå»ï¼Œè¿™é‡Œå’Œ `_delectMin` çš„æ“ä½œä¸€æ ·</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>node<span class="token punctuation">.</span>left<span class="token punctuation">)</span> <span class="token keyword">return</span> node<span class="token punctuation">.</span>right
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>node<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token keyword">return</span> node<span class="token punctuation">.</span>left
    <span class="token comment">// è¿›å…¥è¿™é‡Œï¼Œä»£è¡¨èŠ‚ç‚¹æ‹¥æœ‰å·¦å³å­æ ‘</span>
    <span class="token comment">// å…ˆå–å‡ºå½“å‰èŠ‚ç‚¹çš„åç»§ç»“ç‚¹ï¼Œä¹Ÿå°±æ˜¯å–å½“å‰èŠ‚ç‚¹å³å­æ ‘çš„æœ€å°å€¼</span>
    <span class="token keyword">let</span> min <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getMin</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">)</span>
    <span class="token comment">// å–å‡ºæœ€å°å€¼åï¼Œåˆ é™¤æœ€å°å€¼</span>
    <span class="token comment">// ç„¶åæŠŠåˆ é™¤èŠ‚ç‚¹åçš„å­æ ‘èµ‹å€¼ç»™æœ€å°å€¼èŠ‚ç‚¹</span>
    min<span class="token punctuation">.</span>right <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_delectMin</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">)</span>
    <span class="token comment">// å·¦å­æ ‘ä¸åŠ¨</span>
    min<span class="token punctuation">.</span>left <span class="token operator">=</span> node<span class="token punctuation">.</span>left
    node <span class="token operator">=</span> min
  <span class="token punctuation">}</span>
  <span class="token comment">// ç»´æŠ¤ size</span>
  node<span class="token punctuation">.</span>size <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getSize</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getSize</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
  <span class="token keyword">return</span> node
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_35-7-avl-æ ‘"><a href="http://interview.poetries.top/docs/excellent.html#_35-7-avl-%E6%A0%91" class="header-anchor">#</a> 35.7 AVL æ ‘</h3> <p><strong>æ¦‚å¿µ</strong></p> <blockquote><p>äºŒåˆ†æœç´¢æ ‘å®é™…åœ¨ä¸šåŠ¡ä¸­æ˜¯å—åˆ°é™åˆ¶çš„ï¼Œå› ä¸ºå¹¶ä¸æ˜¯ä¸¥æ ¼çš„ O(logN)ï¼Œåœ¨æç«¯æƒ…å†µä¸‹ä¼šé€€åŒ–æˆé“¾è¡¨ï¼Œæ¯”å¦‚åŠ å…¥ä¸€ç»„å‡åºçš„æ•°å­—å°±ä¼šé€ æˆè¿™ç§æƒ…å†µã€‚</p></blockquote> <blockquote><p>AVL æ ‘æ”¹è¿›äº†äºŒåˆ†æœç´¢æ ‘ï¼Œåœ¨ AVL æ ‘ä¸­ä»»æ„èŠ‚ç‚¹çš„å·¦å³å­æ ‘çš„é«˜åº¦å·®éƒ½ä¸å¤§äº 1ï¼Œè¿™æ ·ä¿è¯äº†æ—¶é—´å¤æ‚åº¦æ˜¯ä¸¥æ ¼çš„ O(logN)ã€‚åŸºäºæ­¤ï¼Œå¯¹ AVL æ ‘å¢åŠ æˆ–åˆ é™¤èŠ‚ç‚¹æ—¶å¯èƒ½éœ€è¦æ—‹è½¬æ ‘æ¥è¾¾åˆ°é«˜åº¦çš„å¹³è¡¡ã€‚</p></blockquote> <p><strong>å®ç°</strong></p> <ul><li>å› ä¸º <code>AVL</code> æ ‘æ˜¯æ”¹è¿›äº†äºŒåˆ†æœç´¢æ ‘ï¼Œæ‰€ä»¥éƒ¨åˆ†ä»£ç æ˜¯äºäºŒåˆ†æœç´¢æ ‘é‡å¤çš„ï¼Œå¯¹äºé‡å¤å†…å®¹ä¸ä½œå†æ¬¡è§£æã€‚</li> <li>å¯¹äº AVL æ ‘æ¥è¯´ï¼Œæ·»åŠ èŠ‚ç‚¹ä¼šæœ‰å››ç§æƒ…å†µ</li></ul> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/49.png" alt="" class="medium-zoom-image"></p> <ul><li>å¯¹äºå·¦å·¦æƒ…å†µæ¥è¯´ï¼Œæ–°å¢åŠ çš„èŠ‚ç‚¹ä½äºèŠ‚ç‚¹ <code>2</code> çš„å·¦ä¾§ï¼Œè¿™æ—¶æ ‘å·²ç»ä¸å¹³è¡¡ï¼Œéœ€è¦æ—‹è½¬ã€‚å› ä¸ºæœç´¢æ ‘çš„ç‰¹æ€§ï¼ŒèŠ‚ç‚¹æ¯”å·¦èŠ‚ç‚¹å¤§ï¼Œæ¯”å³èŠ‚ç‚¹å°ï¼Œæ‰€ä»¥æ—‹è½¬ä»¥åä¹Ÿè¦å®ç°è¿™ä¸ªç‰¹æ€§ã€‚</li> <li>æ—‹è½¬ä¹‹å‰ï¼š<code>new &lt; 2 &lt; C &lt; 3 &lt; B &lt; 5 &lt; A</code>ï¼Œå³æ—‹ä¹‹åèŠ‚ç‚¹ <code>3</code> ä¸ºæ ¹èŠ‚ç‚¹ï¼Œè¿™æ—¶å€™éœ€è¦å°†èŠ‚ç‚¹ 3 çš„å³èŠ‚ç‚¹åŠ åˆ°èŠ‚ç‚¹ 5 çš„å·¦è¾¹ï¼Œæœ€åè¿˜éœ€è¦æ›´æ–°èŠ‚ç‚¹çš„é«˜åº¦ã€‚</li> <li>å¯¹äºå³å³æƒ…å†µæ¥è¯´ï¼Œç›¸åäºå·¦å·¦æƒ…å†µï¼Œæ‰€ä»¥ä¸å†èµ˜è¿°ã€‚</li> <li>å¯¹äºå·¦å³æƒ…å†µæ¥è¯´ï¼Œæ–°å¢åŠ çš„èŠ‚ç‚¹ä½äºèŠ‚ç‚¹ 4 çš„å³ä¾§ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œéœ€è¦é€šè¿‡ä¸¤æ¬¡æ—‹è½¬æ¥è¾¾åˆ°ç›®çš„ã€‚</li> <li>é¦–å…ˆå¯¹èŠ‚ç‚¹çš„å·¦èŠ‚ç‚¹å·¦æ—‹ï¼Œè¿™æ—¶æ ‘æ»¡è¶³å·¦å·¦çš„æƒ…å†µï¼Œå†å¯¹èŠ‚ç‚¹è¿›è¡Œä¸€æ¬¡å³æ—‹å°±å¯ä»¥è¾¾åˆ°ç›®çš„ã€‚</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Node</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
    <span class="token keyword">this</span><span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>right <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">AVL</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>root <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span>
  <span class="token function">addNode</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>root <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_addChild</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">_addChild</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>node<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>value <span class="token operator">&gt;</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      node<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_addChild</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>value <span class="token operator">&lt;</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      node<span class="token punctuation">.</span>right <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_addChild</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      node<span class="token punctuation">.</span>value <span class="token operator">=</span> v
    <span class="token punctuation">}</span>
    node<span class="token punctuation">.</span>height <span class="token operator">=</span>
      <span class="token number">1</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getHeight</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getHeight</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> factor <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getBalanceFactor</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>
    <span class="token comment">// å½“éœ€è¦å³æ—‹æ—¶ï¼Œæ ¹èŠ‚ç‚¹çš„å·¦æ ‘ä¸€å®šæ¯”å³æ ‘é«˜åº¦é«˜</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>factor <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getBalanceFactor</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_rightRotate</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// å½“éœ€è¦å·¦æ—‹æ—¶ï¼Œæ ¹èŠ‚ç‚¹çš„å·¦æ ‘ä¸€å®šæ¯”å³æ ‘é«˜åº¦çŸ®</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>factor <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getBalanceFactor</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_leftRotate</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// å·¦å³æƒ…å†µ</span>
    <span class="token comment">// èŠ‚ç‚¹çš„å·¦æ ‘æ¯”å³æ ‘é«˜ï¼Œä¸”èŠ‚ç‚¹çš„å·¦æ ‘çš„å³æ ‘æ¯”èŠ‚ç‚¹çš„å·¦æ ‘çš„å·¦æ ‘é«˜</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>factor <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getBalanceFactor</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      node<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_leftRotate</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_rightRotate</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// å³å·¦æƒ…å†µ</span>
    <span class="token comment">// èŠ‚ç‚¹çš„å·¦æ ‘æ¯”å³æ ‘çŸ®ï¼Œä¸”èŠ‚ç‚¹çš„å³æ ‘çš„å³æ ‘æ¯”èŠ‚ç‚¹çš„å³æ ‘çš„å·¦æ ‘çŸ®</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>factor <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getBalanceFactor</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      node<span class="token punctuation">.</span>right <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_rightRotate</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_leftRotate</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> node
  <span class="token punctuation">}</span>
  <span class="token function">_getHeight</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>node<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span>
    <span class="token keyword">return</span> node<span class="token punctuation">.</span>height
  <span class="token punctuation">}</span>
  <span class="token function">_getBalanceFactor</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getHeight</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getHeight</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// èŠ‚ç‚¹å³æ—‹</span>
  <span class="token comment">//           5                    2</span>
  <span class="token comment">//         /   \                /   \</span>
  <span class="token comment">//        2     6   ==&gt;       1      5</span>
  <span class="token comment">//       /  \               /       /  \</span>
  <span class="token comment">//      1    3             new     3    6</span>
  <span class="token comment">//     /</span>
  <span class="token comment">//    new</span>
  <span class="token function">_rightRotate</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ—‹è½¬åæ–°æ ¹èŠ‚ç‚¹</span>
    <span class="token keyword">let</span> newRoot <span class="token operator">=</span> node<span class="token punctuation">.</span>left
    <span class="token comment">// éœ€è¦ç§»åŠ¨çš„èŠ‚ç‚¹</span>
    <span class="token keyword">let</span> moveNode <span class="token operator">=</span> newRoot<span class="token punctuation">.</span>right
    <span class="token comment">// èŠ‚ç‚¹ 2 çš„å³èŠ‚ç‚¹æ”¹ä¸ºèŠ‚ç‚¹ 5</span>
    newRoot<span class="token punctuation">.</span>right <span class="token operator">=</span> node
    <span class="token comment">// èŠ‚ç‚¹ 5 å·¦èŠ‚ç‚¹æ”¹ä¸ºèŠ‚ç‚¹ 3</span>
    node<span class="token punctuation">.</span>left <span class="token operator">=</span> moveNode
    <span class="token comment">// æ›´æ–°æ ‘çš„é«˜åº¦</span>
    node<span class="token punctuation">.</span>height <span class="token operator">=</span>
      <span class="token number">1</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getHeight</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getHeight</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">)</span>
    newRoot<span class="token punctuation">.</span>height <span class="token operator">=</span>
      <span class="token number">1</span> <span class="token operator">+</span>
      Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getHeight</span><span class="token punctuation">(</span>newRoot<span class="token punctuation">.</span>left<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getHeight</span><span class="token punctuation">(</span>newRoot<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> newRoot
  <span class="token punctuation">}</span>
  <span class="token comment">// èŠ‚ç‚¹å·¦æ—‹</span>
  <span class="token comment">//           4                    6</span>
  <span class="token comment">//         /   \                /   \</span>
  <span class="token comment">//        2     6   ==&gt;       4      7</span>
  <span class="token comment">//             /  \         /   \      \</span>
  <span class="token comment">//            5     7      2     5      new</span>
  <span class="token comment">//                   \</span>
  <span class="token comment">//                    new</span>
  <span class="token function">_leftRotate</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ—‹è½¬åæ–°æ ¹èŠ‚ç‚¹</span>
    <span class="token keyword">let</span> newRoot <span class="token operator">=</span> node<span class="token punctuation">.</span>right
    <span class="token comment">// éœ€è¦ç§»åŠ¨çš„èŠ‚ç‚¹</span>
    <span class="token keyword">let</span> moveNode <span class="token operator">=</span> newRoot<span class="token punctuation">.</span>left
    <span class="token comment">// èŠ‚ç‚¹ 6 çš„å·¦èŠ‚ç‚¹æ”¹ä¸ºèŠ‚ç‚¹ 4</span>
    newRoot<span class="token punctuation">.</span>left <span class="token operator">=</span> node
    <span class="token comment">// èŠ‚ç‚¹ 4 å³èŠ‚ç‚¹æ”¹ä¸ºèŠ‚ç‚¹ 5</span>
    node<span class="token punctuation">.</span>right <span class="token operator">=</span> moveNode
    <span class="token comment">// æ›´æ–°æ ‘çš„é«˜åº¦</span>
    node<span class="token punctuation">.</span>height <span class="token operator">=</span>
      <span class="token number">1</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getHeight</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getHeight</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">)</span>
    newRoot<span class="token punctuation">.</span>height <span class="token operator">=</span>
      <span class="token number">1</span> <span class="token operator">+</span>
      Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getHeight</span><span class="token punctuation">(</span>newRoot<span class="token punctuation">.</span>left<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getHeight</span><span class="token punctuation">(</span>newRoot<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> newRoot
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_35-8-trie"><a href="http://interview.poetries.top/docs/excellent.html#_35-8-trie" class="header-anchor">#</a> 35.8 Trie</h3> <p><strong>æ¦‚å¿µ</strong></p> <ul><li>åœ¨è®¡ç®—æœºç§‘å­¦ï¼Œtrieï¼Œåˆç§°å‰ç¼€æ ‘æˆ–å­—å…¸æ ‘ï¼Œæ˜¯ä¸€ç§æœ‰åºæ ‘ï¼Œç”¨äºä¿å­˜å…³è”æ•°ç»„ï¼Œå…¶ä¸­çš„é”®é€šå¸¸æ˜¯å­—ç¬¦ä¸²ã€‚</li></ul> <blockquote><p>ç®€å•ç‚¹æ¥è¯´ï¼Œè¿™ä¸ªç»“æ„çš„ä½œç”¨å¤§å¤šæ˜¯ä¸ºäº†æ–¹ä¾¿æœç´¢å­—ç¬¦ä¸²ï¼Œè¯¥æ ‘æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹</p></blockquote> <ul><li>æ ¹èŠ‚ç‚¹ä»£è¡¨ç©ºå­—ç¬¦ä¸²ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ Nï¼ˆå‡å¦‚æœç´¢è‹±æ–‡å­—ç¬¦ï¼Œå°±æœ‰ 26 æ¡ï¼‰ æ¡é“¾æ¥ï¼Œæ¯æ¡é“¾æ¥ä»£è¡¨ä¸€ä¸ªå­—ç¬¦</li> <li>èŠ‚ç‚¹ä¸å­˜å‚¨å­—ç¬¦ï¼Œåªæœ‰è·¯å¾„æ‰å­˜å‚¨ï¼Œè¿™ç‚¹å’Œå…¶ä»–çš„æ ‘ç»“æ„ä¸åŒ</li> <li>ä»æ ¹èŠ‚ç‚¹å¼€å§‹åˆ°ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå°†æ²¿é€”ç»è¿‡çš„å­—ç¬¦è¿æ¥èµ·æ¥å°±æ˜¯è¯¥èŠ‚ç‚¹å¯¹åº”çš„å­—ç¬¦ä¸²</li></ul> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/50.png" alt="" class="medium-zoom-image"></p> <p><strong>å®ç°</strong></p> <blockquote><p>æ€»å¾—æ¥è¯´ <code>Trie</code> çš„å®ç°ç›¸æ¯”åˆ«çš„æ ‘ç»“æ„æ¥è¯´ç®€å•çš„å¾ˆå¤šï¼Œå®ç°å°±ä»¥æœç´¢è‹±æ–‡å­—ç¬¦ä¸ºä¾‹ã€‚</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">TrieNode</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ä»£è¡¨æ¯ä¸ªå­—ç¬¦ç»è¿‡èŠ‚ç‚¹çš„æ¬¡æ•°</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>path <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token comment">// ä»£è¡¨åˆ°è¯¥èŠ‚ç‚¹çš„å­—ç¬¦ä¸²æœ‰å‡ ä¸ª</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>end <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token comment">// é“¾æ¥</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Trie</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ ¹èŠ‚ç‚¹ï¼Œä»£è¡¨ç©ºå­—ç¬¦</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>root <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TrieNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// æ’å…¥å­—ç¬¦ä¸²</span>
  <span class="token function">insert</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>str<span class="token punctuation">)</span> <span class="token keyword">return</span>
    <span class="token keyword">let</span> node <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>root
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> str<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// è·å¾—å­—ç¬¦å…ˆå¯¹åº”çš„ç´¢å¼•</span>
      <span class="token keyword">let</span> index <span class="token operator">=</span> str<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token string">'a'</span><span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment">// å¦‚æœç´¢å¼•å¯¹åº”æ²¡æœ‰å€¼ï¼Œå°±åˆ›å»º</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>node<span class="token punctuation">.</span>next<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        node<span class="token punctuation">.</span>next<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TrieNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      node<span class="token punctuation">.</span>path <span class="token operator">+=</span> <span class="token number">1</span>
      node <span class="token operator">=</span> node<span class="token punctuation">.</span>next<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
    node<span class="token punctuation">.</span>end <span class="token operator">+=</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// æœç´¢å­—ç¬¦ä¸²å‡ºç°çš„æ¬¡æ•°</span>
  <span class="token function">search</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>str<span class="token punctuation">)</span> <span class="token keyword">return</span>
    <span class="token keyword">let</span> node <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>root
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> str<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> index <span class="token operator">=</span> str<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token string">'a'</span><span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment">// å¦‚æœç´¢å¼•å¯¹åº”æ²¡æœ‰å€¼ï¼Œä»£è¡¨æ²¡æœ‰éœ€è¦æœç´ çš„å­—ç¬¦ä¸²</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>node<span class="token punctuation">.</span>next<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">0</span>
      <span class="token punctuation">}</span>
      node <span class="token operator">=</span> node<span class="token punctuation">.</span>next<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> node<span class="token punctuation">.</span>end
  <span class="token punctuation">}</span>
  <span class="token comment">// åˆ é™¤å­—ç¬¦ä¸²</span>
  <span class="token keyword">delete</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span>
    <span class="token keyword">let</span> node <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>root
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> str<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> index <span class="token operator">=</span> str<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token string">'a'</span><span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment">// å¦‚æœç´¢å¼•å¯¹åº”çš„èŠ‚ç‚¹çš„ Path ä¸º 0ï¼Œä»£è¡¨ç»è¿‡è¯¥èŠ‚ç‚¹çš„å­—ç¬¦ä¸²</span>
      <span class="token comment">// å·²ç»ä¸€ä¸ªï¼Œç›´æ¥åˆ é™¤å³å¯</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">--</span>node<span class="token punctuation">.</span>next<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>path <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        node<span class="token punctuation">.</span>next<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span>
        <span class="token keyword">return</span>
      <span class="token punctuation">}</span>
      node <span class="token operator">=</span> node<span class="token punctuation">.</span>next<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
    node<span class="token punctuation">.</span>end <span class="token operator">-=</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_35-9-å¹¶æŸ¥é›†"><a href="http://interview.poetries.top/docs/excellent.html#_35-9-%E5%B9%B6%E6%9F%A5%E9%9B%86" class="header-anchor">#</a> 35.9 å¹¶æŸ¥é›†</h3> <p><strong>æ¦‚å¿µ</strong></p> <ul><li>å¹¶æŸ¥é›†æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ ‘ç»“æ„ï¼Œç”¨äºå¤„ç†ä¸€äº›ä¸äº¤é›†çš„åˆå¹¶åŠæŸ¥è¯¢é—®é¢˜ã€‚è¯¥ç»“æ„ä¸­æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªçˆ¶èŠ‚ç‚¹ï¼Œå¦‚æœåªæœ‰å½“å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹æŒ‡å‘è‡ªå·±ã€‚</li></ul> <blockquote><p>è¿™ä¸ªç»“æ„ä¸­æœ‰ä¸¤ä¸ªé‡è¦çš„æ“ä½œï¼Œåˆ†åˆ«æ˜¯ï¼š</p></blockquote> <ul><li><code>Find</code>ï¼šç¡®å®šå…ƒç´ å±äºå“ªä¸€ä¸ªå­é›†ã€‚å®ƒå¯ä»¥è¢«ç”¨æ¥ç¡®å®šä¸¤ä¸ªå…ƒç´ æ˜¯å¦å±äºåŒä¸€å­é›†ã€‚</li> <li><code>Union</code>ï¼šå°†ä¸¤ä¸ªå­é›†åˆå¹¶æˆåŒä¸€ä¸ªé›†åˆã€‚</li></ul> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/51.png" alt="" class="medium-zoom-image"></p> <p><strong>å®ç°</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">DisjointSet</span> <span class="token punctuation">{</span>
  <span class="token comment">// åˆå§‹åŒ–æ ·æœ¬</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">count</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// åˆå§‹åŒ–æ—¶ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹éƒ½æ˜¯è‡ªå·±</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>parent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span>
    <span class="token comment">// ç”¨äºè®°å½•æ ‘çš„æ·±åº¦ï¼Œä¼˜åŒ–æœç´¢å¤æ‚åº¦</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>rank <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>parent<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i
      <span class="token keyword">this</span><span class="token punctuation">.</span>rank<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¯»æ‰¾å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹æ˜¯å¦ä¸ºè‡ªå·±ï¼Œä¸æ˜¯çš„è¯è¡¨ç¤ºè¿˜æ²¡æ‰¾åˆ°</span>
    <span class="token comment">// å¼€å§‹è¿›è¡Œè·¯å¾„å‹ç¼©ä¼˜åŒ–</span>
    <span class="token comment">// å‡è®¾å½“å‰èŠ‚ç‚¹çˆ¶èŠ‚ç‚¹ä¸º A</span>
    <span class="token comment">// å°†å½“å‰èŠ‚ç‚¹æŒ‚è½½åˆ° A èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ä¸Šï¼Œè¾¾åˆ°å‹ç¼©æ·±åº¦çš„ç›®çš„</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>p <span class="token operator">!=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>parent<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>parent<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>parent<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>parent<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">]</span>
      p <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>parent<span class="token punctuation">[</span>p<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> p
  <span class="token punctuation">}</span>
  <span class="token function">isConnected</span><span class="token punctuation">(</span><span class="token parameter">p<span class="token punctuation">,</span> q</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// åˆå¹¶</span>
  <span class="token function">union</span><span class="token punctuation">(</span><span class="token parameter">p<span class="token punctuation">,</span> q</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ‰¾åˆ°ä¸¤ä¸ªæ•°å­—çš„çˆ¶èŠ‚ç‚¹</span>
    <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
    <span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">===</span> j<span class="token punctuation">)</span> <span class="token keyword">return</span>
    <span class="token comment">// åˆ¤æ–­ä¸¤æ£µæ ‘çš„æ·±åº¦ï¼Œæ·±åº¦å°çš„åŠ åˆ°æ·±åº¦å¤§çš„æ ‘ä¸‹é¢</span>
    <span class="token comment">// å¦‚æœä¸¤æ£µæ ‘æ·±åº¦ç›¸ç­‰ï¼Œé‚£å°±æ— æ‰€è°“æ€ä¹ˆåŠ </span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>rank<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>rank<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>parent<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> j
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>rank<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>rank<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>parent<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> i
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>parent<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> j
      <span class="token keyword">this</span><span class="token punctuation">.</span>rank<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_35-10-å †"><a href="http://interview.poetries.top/docs/excellent.html#_35-10-%E5%A0%86" class="header-anchor">#</a> 35.10 å †</h3> <p><strong>æ¦‚å¿µ</strong></p> <ul><li>å †é€šå¸¸æ˜¯ä¸€ä¸ªå¯ä»¥è¢«çœ‹åšä¸€æ£µæ ‘çš„æ•°ç»„å¯¹è±¡ã€‚</li></ul> <blockquote><p>å †çš„å®ç°é€šè¿‡æ„é€ äºŒå‰å †ï¼Œå®ä¸ºäºŒå‰æ ‘çš„ä¸€ç§ã€‚è¿™ç§æ•°æ®ç»“æ„å…·æœ‰ä»¥ä¸‹æ€§è´¨ã€‚</p></blockquote> <ol><li>ä»»æ„èŠ‚ç‚¹å°äºï¼ˆæˆ–å¤§äºï¼‰å®ƒçš„æ‰€æœ‰å­èŠ‚ç‚¹</li> <li>å †æ€»æ˜¯ä¸€æ£µå®Œå…¨æ ‘ã€‚å³é™¤äº†æœ€åº•å±‚ï¼Œå…¶ä»–å±‚çš„èŠ‚ç‚¹éƒ½è¢«å…ƒç´ å¡«æ»¡ï¼Œä¸”æœ€åº•å±‚ä»å·¦åˆ°å³å¡«å…¥ã€‚</li></ol> <ul><li>å°†æ ¹èŠ‚ç‚¹æœ€å¤§çš„å †å«åšæœ€å¤§å †æˆ–å¤§æ ¹å †ï¼Œæ ¹èŠ‚ç‚¹æœ€å°çš„å †å«åšæœ€å°å †æˆ–å°æ ¹å †ã€‚</li> <li>ä¼˜å…ˆé˜Ÿåˆ—ä¹Ÿå®Œå…¨å¯ä»¥ç”¨å †æ¥å®ç°ï¼Œæ“ä½œæ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚</li></ul> <p><strong>å®ç°å¤§æ ¹å †</strong></p> <ul><li>å †çš„æ¯ä¸ªèŠ‚ç‚¹çš„å·¦è¾¹å­èŠ‚ç‚¹ç´¢å¼•æ˜¯ <code>i * 2 + 1</code>ï¼Œå³è¾¹æ˜¯ <code>i * 2 + 2</code>ï¼Œçˆ¶èŠ‚ç‚¹æ˜¯ <code>(i - 1) /2</code>ã€‚</li> <li>å †æœ‰ä¸¤ä¸ªæ ¸å¿ƒçš„æ“ä½œï¼Œåˆ†åˆ«æ˜¯ <code>shiftUp</code> å’Œ <code>shiftDown</code> ã€‚å‰è€…ç”¨äºæ·»åŠ å…ƒç´ ï¼Œåè€…ç”¨äºåˆ é™¤æ ¹èŠ‚ç‚¹ã€‚</li> <li><code>shiftUp</code> çš„æ ¸å¿ƒæ€è·¯æ˜¯ä¸€è·¯å°†èŠ‚ç‚¹ä¸çˆ¶èŠ‚ç‚¹å¯¹æ¯”å¤§å°ï¼Œå¦‚æœæ¯”çˆ¶èŠ‚ç‚¹å¤§ï¼Œå°±å’Œçˆ¶èŠ‚ç‚¹äº¤æ¢ä½ç½®ã€‚</li> <li><code>shiftDown</code> çš„æ ¸å¿ƒæ€è·¯æ˜¯å…ˆå°†æ ¹èŠ‚ç‚¹å’Œæœ«å°¾äº¤æ¢ä½ç½®ï¼Œç„¶åç§»é™¤æœ«å°¾å…ƒç´ ã€‚æ¥ä¸‹æ¥å¾ªç¯åˆ¤æ–­çˆ¶èŠ‚ç‚¹å’Œä¸¤ä¸ªå­èŠ‚ç‚¹çš„å¤§å°ï¼Œå¦‚æœå­èŠ‚ç‚¹å¤§ï¼Œå°±æŠŠæœ€å¤§çš„å­èŠ‚ç‚¹å’Œçˆ¶èŠ‚ç‚¹äº¤æ¢ã€‚</li></ul> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/52.png" alt="" class="medium-zoom-image"></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">MaxHeap</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>heap <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>heap<span class="token punctuation">.</span>length
  <span class="token punctuation">}</span>
  <span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>
  <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>heap<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_shiftUp</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">removeMax</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_shiftDown</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">getParentIndex</span><span class="token punctuation">(</span><span class="token parameter">k</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">getLeftIndex</span><span class="token punctuation">(</span><span class="token parameter">k</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> k <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
  <span class="token function">_shiftUp</span><span class="token punctuation">(</span><span class="token parameter">k</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¦‚æœå½“å‰èŠ‚ç‚¹æ¯”çˆ¶èŠ‚ç‚¹å¤§ï¼Œå°±äº¤æ¢</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>heap<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>heap<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getParentIndex</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_swap</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getParentIndex</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token comment">// å°†ç´¢å¼•å˜æˆçˆ¶èŠ‚ç‚¹</span>
      k <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getParentIndex</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">_shiftDown</span><span class="token punctuation">(</span><span class="token parameter">k</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// äº¤æ¢é¦–ä½å¹¶åˆ é™¤æœ«å°¾</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_swap</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>heap<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token comment">// åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦æœ‰å·¦å­©å­ï¼Œå› ä¸ºäºŒå‰å †çš„ç‰¹æ€§ï¼Œæœ‰å³å¿…æœ‰å·¦</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getLeftIndex</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getLeftIndex</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span>
      <span class="token comment">// åˆ¤æ–­æ˜¯å¦æœ‰å³å­©å­ï¼Œå¹¶ä¸”å³å­©å­æ˜¯å¦å¤§äºå·¦å­©å­</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>heap<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>heap<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> j<span class="token operator">++</span>
      <span class="token comment">// åˆ¤æ–­çˆ¶èŠ‚ç‚¹æ˜¯å¦å·²ç»æ¯”å­èŠ‚ç‚¹éƒ½å¤§</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>heap<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>heap<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">break</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_swap</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> j<span class="token punctuation">)</span>
      k <span class="token operator">=</span> j
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">_swap</span><span class="token punctuation">(</span><span class="token parameter">left<span class="token punctuation">,</span> right</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> rightValue <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>heap<span class="token punctuation">[</span>right<span class="token punctuation">]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>heap<span class="token punctuation">[</span>right<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>heap<span class="token punctuation">[</span>left<span class="token punctuation">]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>heap<span class="token punctuation">[</span>left<span class="token punctuation">]</span> <span class="token operator">=</span> rightValue
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_36-å¸¸è€ƒç®—æ³•é¢˜è§£æ"><a href="http://interview.poetries.top/docs/excellent.html#_36-%E5%B8%B8%E8%80%83%E7%AE%97%E6%B3%95%E9%A2%98%E8%A7%A3%E6%9E%90" class="header-anchor">#</a> 36 å¸¸è€ƒç®—æ³•é¢˜è§£æ</h2> <blockquote><p>å¯¹äºå¤§éƒ¨åˆ†å…¬å¸çš„é¢è¯•æ¥è¯´ï¼Œæ’åºçš„å†…å®¹å·²ç»è¶³ä»¥åº”ä»˜äº†ï¼Œç”±æ­¤ä¸ºäº†æ›´å¥½çš„ç¬¦åˆå¤§ä¼—éœ€æ±‚ï¼Œæ’åºçš„å†…å®¹æ˜¯æœ€å¤šçš„ã€‚å½“ç„¶å¦‚æœä½ è¿˜æƒ³å†²å‡»æ›´å¥½çš„å…¬å¸ï¼Œé‚£ä¹ˆæ•´ä¸€ä¸ªç« èŠ‚çš„å†…å®¹éƒ½æ˜¯éœ€è¦æŒæ¡çš„ã€‚å¯¹äºå­—èŠ‚è·³åŠ¨è¿™ç±»ååˆ†çœ‹é‡ç®—æ³•çš„å…¬å¸æ¥è¯´ï¼Œè¿™ä¸€ç« èŠ‚æ˜¯è¿œè¿œä¸å¤Ÿçš„ï¼Œå‰‘æŒ‡Offeråº”è¯¥æ˜¯ä½ æ›´å¥½çš„é€‰æ‹©</p></blockquote> <blockquote><p>è¿™ä¸€ç« èŠ‚çš„å†…å®¹ä¿¡æ¯é‡ä¼šå¾ˆå¤§ï¼Œä¸é€‚åˆåœ¨éç”µè„‘ç¯å¢ƒä¸‹é˜…è¯»ï¼Œè¯·å„ä½æ‰“å¼€ä»£ç ç¼–è¾‘å™¨ï¼Œä¸€è¡Œè¡Œçš„æ•²ä»£ç ï¼Œå•çº¯é˜…è¯»æ˜¯å­¦ä¹ ä¸äº†ç®—æ³•çš„</p></blockquote> <blockquote><p>å¦å¤–å­¦ä¹ ç®—æ³•çš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªå¯è§†åŒ–ç•Œé¢ä¼šç›¸å¯¹å‡å°‘ç‚¹å­¦ä¹ çš„éš¾åº¦ï¼Œå…·ä½“å¯ä»¥é˜…è¯» <a href="https://github.com/algorithm-visualizer/algorithm-visualizer" target="_blank" rel="noopener noreferrer">algorithm-visualizer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> è¿™ä¸ªä»“åº“</p></blockquote> <h3 id="_36-1-ä½è¿ç®—"><a href="http://interview.poetries.top/docs/excellent.html#_36-1-%E4%BD%8D%E8%BF%90%E7%AE%97" class="header-anchor">#</a> 36.1 ä½è¿ç®—</h3> <ul><li>åœ¨è¿›å…¥æ­£é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥å­¦ä¹ ä¸€ä¸‹ä½è¿ç®—çš„å†…å®¹ã€‚å› ä¸ºä½è¿ç®—åœ¨ç®—æ³•ä¸­å¾ˆæœ‰ç”¨ï¼Œé€Ÿåº¦å¯ä»¥æ¯”å››åˆ™è¿ç®—å¿«å¾ˆå¤šã€‚</li> <li>åœ¨å­¦ä¹ ä½è¿ç®—ä¹‹å‰åº”è¯¥çŸ¥é“åè¿›åˆ¶å¦‚ä½•è½¬äºŒè¿›åˆ¶ï¼ŒäºŒè¿›åˆ¶å¦‚ä½•è½¬åè¿›åˆ¶ã€‚è¿™é‡Œè¯´æ˜ä¸‹ç®€å•çš„è®¡ç®—æ–¹å¼</li></ul> <ol><li>åè¿›åˆ¶ <code>33</code> å¯ä»¥çœ‹æˆæ˜¯ <code>32 + 1</code> ï¼Œå¹¶ä¸” <code>33</code> åº”è¯¥æ˜¯å…­ä½äºŒè¿›åˆ¶çš„ï¼ˆå› ä¸º <code>33</code> è¿‘ä¼¼ <code>32</code>ï¼Œè€Œ <code>32</code> æ˜¯ <code>2</code> çš„äº”æ¬¡æ–¹ï¼Œæ‰€ä»¥æ˜¯å…­ä½ï¼‰ï¼Œé‚£ä¹ˆ åè¿›åˆ¶ <code>33</code> å°±æ˜¯ <code>100001</code> ï¼Œåªè¦æ˜¯ <code>2</code> çš„æ¬¡æ–¹ï¼Œé‚£ä¹ˆå°±æ˜¯ <code>1</code>å¦åˆ™éƒ½ä¸º <code>0</code></li> <li>é‚£ä¹ˆäºŒè¿›åˆ¶ <code>100001</code> åŒç†ï¼Œé¦–ä½æ˜¯ <code>2^5</code> ï¼Œæœ«ä½æ˜¯ <code>2^0</code> ï¼Œç›¸åŠ å¾—å‡º <code>33</code></li></ol> <p><strong>1. å·¦ç§» &lt;&lt;</strong></p> <div class="language- extra-class"><pre class="language-text"><code>10 &lt;&lt; 1 // -&gt; 20
</code></pre></div><blockquote><p>å·¦ç§»å°±æ˜¯å°†äºŒè¿›åˆ¶å…¨éƒ¨å¾€å·¦ç§»åŠ¨ï¼Œ<code>10</code> åœ¨äºŒè¿›åˆ¶ä¸­è¡¨ç¤ºä¸º <code>1010</code>ï¼Œå·¦ç§»ä¸€ä½åå˜æˆ <code>10100</code> ï¼Œè½¬æ¢ä¸ºåè¿›åˆ¶ä¹Ÿå°±æ˜¯ <code>20</code>ï¼Œæ‰€ä»¥åŸºæœ¬å¯ä»¥æŠŠå·¦ç§»çœ‹æˆä»¥ä¸‹å…¬å¼ <code>a * (2 ^ b)</code></p></blockquote> <p><strong>2. ç®—æ•°å³ç§» &gt;&gt;</strong></p> <div class="language- extra-class"><pre class="language-text"><code>10 &gt;&gt; 1 // -&gt; 5
</code></pre></div><blockquote><p>ç®—æ•°å³ç§»å°±æ˜¯å°†äºŒè¿›åˆ¶å…¨éƒ¨å¾€å³ç§»åŠ¨å¹¶å»é™¤å¤šä½™çš„å³è¾¹ï¼Œ<code>10</code> åœ¨äºŒè¿›åˆ¶ä¸­è¡¨ç¤ºä¸º <code>1010</code> ï¼Œå³ç§»ä¸€ä½åå˜æˆ 101 ï¼Œè½¬æ¢ä¸ºåè¿›åˆ¶ä¹Ÿå°±æ˜¯ <code>5</code>ï¼Œæ‰€ä»¥åŸºæœ¬å¯ä»¥æŠŠå³ç§»çœ‹æˆä»¥ä¸‹å…¬å¼ <code>int v = a / (2 ^ b)</code></p></blockquote> <p>å³ç§»å¾ˆå¥½ç”¨ï¼Œæ¯”å¦‚å¯ä»¥ç”¨åœ¨äºŒåˆ†ç®—æ³•ä¸­å–ä¸­é—´å€¼</p> <div class="language- extra-class"><pre class="language-text"><code>13 &gt;&gt; 1 // -&gt; 6
</code></pre></div><p><strong>3. æŒ‰ä½æ“ä½œ</strong></p> <p><strong>3.1 æŒ‰ä½ä¸</strong></p> <blockquote><p>æ¯ä¸€ä½éƒ½ä¸º 1ï¼Œç»“æœæ‰ä¸º <code>1</code></p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>8 &amp; 7 // -&gt; 0
// 1000 &amp; 0111 -&gt; 0000 -&gt; 0
</code></pre></div><p><strong>3.2 æŒ‰ä½æˆ–</strong></p> <blockquote><p>å…¶ä¸­ä¸€ä½ä¸º <code>1</code>ï¼Œç»“æœå°±æ˜¯ <code>1</code></p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>8 | 7 // -&gt; 15
// 1000 | 0111 -&gt; 1111 -&gt; 15
</code></pre></div><p><strong>3.3 æŒ‰ä½å¼‚æˆ–</strong></p> <blockquote><p>æ¯ä¸€ä½éƒ½ä¸åŒï¼Œç»“æœæ‰ä¸º <code>1</code></p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token number">8</span> <span class="token operator">^</span> <span class="token number">7</span> <span class="token comment">// -&gt; 15</span>
<span class="token number">8</span> <span class="token operator">^</span> <span class="token number">8</span> <span class="token comment">// -&gt; 0</span>
<span class="token comment">// 1000 ^ 0111 -&gt; 1111 -&gt; 15</span>
<span class="token comment">// 1000 ^ 1000 -&gt; 0000 -&gt; 0</span>
</code></pre></div><ul><li>ä»ä»¥ä¸Šä»£ç ä¸­å¯ä»¥å‘ç°æŒ‰ä½å¼‚æˆ–å°±æ˜¯ä¸è¿›ä½åŠ æ³•</li> <li>é¢è¯•é¢˜ï¼šä¸¤ä¸ªæ•°ä¸ä½¿ç”¨å››åˆ™è¿ç®—å¾—å‡ºå’Œ</li></ul> <blockquote><p>è¿™é“é¢˜ä¸­å¯ä»¥æŒ‰ä½å¼‚æˆ–ï¼Œå› ä¸ºæŒ‰ä½å¼‚æˆ–å°±æ˜¯ä¸è¿›ä½åŠ æ³•ï¼Œ<code>8 ^ 8 = 0</code> å¦‚æœè¿›ä½äº†ï¼Œå°±æ˜¯ <code>16</code> äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å°†ä¸¤ä¸ªæ•°è¿›è¡Œå¼‚æˆ–æ“ä½œï¼Œç„¶åè¿›ä½ã€‚é‚£ä¹ˆä¹Ÿå°±æ˜¯è¯´ä¸¤ä¸ªäºŒè¿›åˆ¶éƒ½æ˜¯ <code>1</code> çš„ä½ç½®ï¼Œå·¦è¾¹åº”è¯¥æœ‰ä¸€ä¸ªè¿›ä½ <code>1</code>ï¼Œæ‰€ä»¥å¯ä»¥å¾—å‡ºä»¥ä¸‹å…¬å¼ <code>a + b = (a ^ b) + ((a &amp; b) &lt;&lt; 1)</code>ï¼Œç„¶åé€šè¿‡è¿­ä»£çš„æ–¹å¼æ¨¡æ‹ŸåŠ æ³•</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> b
    <span class="token keyword">if</span> <span class="token punctuation">(</span>b <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> a
    <span class="token keyword">let</span> newA <span class="token operator">=</span> a <span class="token operator">^</span> b
    <span class="token keyword">let</span> newB <span class="token operator">=</span> <span class="token punctuation">(</span>a <span class="token operator">&amp;</span> b<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span>
    <span class="token keyword">return</span> <span class="token function">sum</span><span class="token punctuation">(</span>newA<span class="token punctuation">,</span> newB<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_36-2-æ’åº"><a href="http://interview.poetries.top/docs/excellent.html#_36-2-%E6%8E%92%E5%BA%8F" class="header-anchor">#</a> 36.2 æ’åº</h3> <blockquote><p>ä»¥ä¸‹ä¸¤ä¸ªå‡½æ•°æ˜¯æ’åºä¸­ä¼šç”¨åˆ°çš„é€šç”¨å‡½æ•°ï¼Œå°±ä¸ä¸€ä¸€å†™äº†</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">checkArray</span><span class="token punctuation">(</span><span class="token parameter">array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>array<span class="token punctuation">)</span> <span class="token keyword">return</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">swap</span><span class="token punctuation">(</span><span class="token parameter">array<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> rightValue <span class="token operator">=</span> array<span class="token punctuation">[</span>right<span class="token punctuation">]</span>
    array<span class="token punctuation">[</span>right<span class="token punctuation">]</span> <span class="token operator">=</span> array<span class="token punctuation">[</span>left<span class="token punctuation">]</span>
    array<span class="token punctuation">[</span>left<span class="token punctuation">]</span> <span class="token operator">=</span> rightValue
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_36-2-1-å†’æ³¡æ’åº"><a href="http://interview.poetries.top/docs/excellent.html#_36-2-1-%E5%86%92%E6%B3%A1%E6%8E%92%E5%BA%8F" class="header-anchor">#</a> 36.2.1 å†’æ³¡æ’åº</h4> <blockquote><p>å†’æ³¡æ’åºçš„åŸç†å¦‚ä¸‹ï¼Œä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ï¼ŒæŠŠå½“å‰å…ƒç´ å’Œä¸‹ä¸€ä¸ªç´¢å¼•å…ƒç´ è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœå½“å‰å…ƒç´ å¤§ï¼Œé‚£ä¹ˆå°±äº¤æ¢ä½ç½®ï¼Œé‡å¤æ“ä½œç›´åˆ°æ¯”è¾ƒåˆ°æœ€åä¸€ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆæ­¤æ—¶æœ€åä¸€ä¸ªå…ƒç´ å°±æ˜¯è¯¥æ•°ç»„ä¸­æœ€å¤§çš„æ•°ã€‚ä¸‹ä¸€è½®é‡å¤ä»¥ä¸Šæ“ä½œï¼Œä½†æ˜¯æ­¤æ—¶æœ€åä¸€ä¸ªå…ƒç´ å·²ç»æ˜¯æœ€å¤§æ•°äº†ï¼Œæ‰€ä»¥ä¸éœ€è¦å†æ¯”è¾ƒæœ€åä¸€ä¸ªå…ƒç´ ï¼Œåªéœ€è¦æ¯”è¾ƒåˆ° <code>length - 1</code> çš„ä½ç½®ã€‚</p></blockquote> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/162b895b452b306c" alt="" class="medium-zoom-image"> <img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/104.png" alt="" class="medium-zoom-image"></p> <p>ä»¥ä¸‹æ˜¯å®ç°è¯¥ç®—æ³•çš„ä»£ç </p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">bubble</span><span class="token punctuation">(</span><span class="token parameter">array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">checkArray</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> array<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ä» 0 åˆ° `length - 1` éå†</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> i<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>array<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&gt;</span> array<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token function">swap</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> j<span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> array<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>è¯¥ç®—æ³•çš„æ“ä½œæ¬¡æ•°æ˜¯ä¸€ä¸ªç­‰å·®æ•°åˆ— <code>n + (n - 1) + (n - 2) + 1</code> ï¼Œå»æ‰å¸¸æ•°é¡¹ä»¥åå¾—å‡ºæ—¶é—´å¤æ‚åº¦æ˜¯ <code>O(n * n)</code></p></blockquote> <h4 id="_36-2-2-æ’å…¥æ’åº"><a href="http://interview.poetries.top/docs/excellent.html#_36-2-2-%E6%8F%92%E5%85%A5%E6%8E%92%E5%BA%8F" class="header-anchor">#</a> 36.2.2 æ’å…¥æ’åº</h4> <blockquote><p>æ’å…¥æ’åºçš„åŸç†å¦‚ä¸‹ã€‚ç¬¬ä¸€ä¸ªå…ƒç´ é»˜è®¤æ˜¯å·²æ’åºå…ƒç´ ï¼Œå–å‡ºä¸‹ä¸€ä¸ªå…ƒç´ å’Œå½“å‰å…ƒç´ æ¯”è¾ƒï¼Œå¦‚æœå½“å‰å…ƒç´ å¤§å°±äº¤æ¢ä½ç½®ã€‚é‚£ä¹ˆæ­¤æ—¶ç¬¬ä¸€ä¸ªå…ƒç´ å°±æ˜¯å½“å‰çš„æœ€å°æ•°ï¼Œæ‰€ä»¥ä¸‹æ¬¡å–å‡ºæ“ä½œä»ç¬¬ä¸‰ä¸ªå…ƒç´ å¼€å§‹ï¼Œå‘å‰å¯¹æ¯”ï¼Œé‡å¤ä¹‹å‰çš„æ“ä½œ</p></blockquote> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/162b895c7e59dcd1" alt="" class="medium-zoom-image"></p> <p>ä»¥ä¸‹æ˜¯å®ç°è¯¥ç®—æ³•çš„ä»£ç </p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">insertion</span><span class="token punctuation">(</span><span class="token parameter">array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">checkArray</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> array<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&gt;</span> array<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> j<span class="token operator">--</span><span class="token punctuation">)</span>
      <span class="token function">swap</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> j<span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> array<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>è¯¥ç®—æ³•çš„æ“ä½œæ¬¡æ•°æ˜¯ä¸€ä¸ªç­‰å·®æ•°åˆ— <code>n + (n - 1) + (n - 2) + 1</code> ï¼Œå»æ‰å¸¸æ•°é¡¹ä»¥åå¾—å‡ºæ—¶é—´å¤æ‚åº¦æ˜¯ <code>O(n * n)</code></p></blockquote> <h4 id="_36-2-3-é€‰æ‹©æ’åº"><a href="http://interview.poetries.top/docs/excellent.html#_36-2-3-%E9%80%89%E6%8B%A9%E6%8E%92%E5%BA%8F" class="header-anchor">#</a> 36.2.3 é€‰æ‹©æ’åº</h4> <blockquote><p>é€‰æ‹©æ’åºçš„åŸç†å¦‚ä¸‹ã€‚éå†æ•°ç»„ï¼Œè®¾ç½®æœ€å°å€¼çš„ç´¢å¼•ä¸º 0ï¼Œå¦‚æœå–å‡ºçš„å€¼æ¯”å½“å‰æœ€å°å€¼å°ï¼Œå°±æ›¿æ¢æœ€å°å€¼ç´¢å¼•ï¼Œéå†å®Œæˆåï¼Œå°†ç¬¬ä¸€ä¸ªå…ƒç´ å’Œæœ€å°å€¼ç´¢å¼•ä¸Šçš„å€¼äº¤æ¢ã€‚å¦‚ä¸Šæ“ä½œåï¼Œç¬¬ä¸€ä¸ªå…ƒç´ å°±æ˜¯æ•°ç»„ä¸­çš„æœ€å°å€¼ï¼Œä¸‹æ¬¡éå†å°±å¯ä»¥ä»ç´¢å¼• 1 å¼€å§‹é‡å¤ä¸Šè¿°æ“ä½œ</p></blockquote> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/162bc8ea14567e2e" alt="" class="medium-zoom-image"></p> <p>ä»¥ä¸‹æ˜¯å®ç°è¯¥ç®—æ³•çš„ä»£ç </p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">selection</span><span class="token punctuation">(</span><span class="token parameter">array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">checkArray</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> array<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> minIndex <span class="token operator">=</span> i<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      minIndex <span class="token operator">=</span> array<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&lt;</span> array<span class="token punctuation">[</span>minIndex<span class="token punctuation">]</span> <span class="token operator">?</span> j <span class="token operator">:</span> minIndex<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">swap</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> i<span class="token punctuation">,</span> minIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> array<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>è¯¥ç®—æ³•çš„æ“ä½œæ¬¡æ•°æ˜¯ä¸€ä¸ªç­‰å·®æ•°åˆ—<code>n + (n - 1) + (n - 2) + 1</code> ï¼Œå»æ‰å¸¸æ•°é¡¹ä»¥åå¾—å‡ºæ—¶é—´å¤æ‚åº¦æ˜¯ <code>O(n * n)</code></p></blockquote> <h4 id="_36-2-4-å½’å¹¶æ’åº"><a href="http://interview.poetries.top/docs/excellent.html#_36-2-4-%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F" class="header-anchor">#</a> 36.2.4 å½’å¹¶æ’åº</h4> <blockquote><p>å½’å¹¶æ’åºçš„åŸç†å¦‚ä¸‹ã€‚é€’å½’çš„å°†æ•°ç»„ä¸¤ä¸¤åˆ†å¼€ç›´åˆ°æœ€å¤šåŒ…å«ä¸¤ä¸ªå…ƒç´ ï¼Œç„¶åå°†æ•°ç»„æ’åºåˆå¹¶ï¼Œæœ€ç»ˆåˆå¹¶ä¸ºæ’åºå¥½çš„æ•°ç»„ã€‚å‡è®¾æˆ‘æœ‰ä¸€ç»„æ•°ç»„ <code>[3, 1, 2, 8, 9, 7, 6]</code>ï¼Œä¸­é—´æ•°ç´¢å¼•æ˜¯ <code>3</code>ï¼Œå…ˆæ’åºæ•°ç»„ <code>[3, 1, 2, 8]</code> ã€‚åœ¨è¿™ä¸ªå·¦è¾¹æ•°ç»„ä¸Šï¼Œç»§ç»­æ‹†åˆ†ç›´åˆ°å˜æˆæ•°ç»„åŒ…å«ä¸¤ä¸ªå…ƒç´ ï¼ˆå¦‚æœæ•°ç»„é•¿åº¦æ˜¯å¥‡æ•°çš„è¯ï¼Œä¼šæœ‰ä¸€ä¸ªæ‹†åˆ†æ•°ç»„åªåŒ…å«ä¸€ä¸ªå…ƒç´ ï¼‰ã€‚ç„¶åæ’åºæ•°ç»„ <code>[3, 1]</code> å’Œ <code>[2, 8]</code> ï¼Œç„¶åå†æ’åºæ•°ç»„ <code>[1, 3, 2, 8]</code> ï¼Œè¿™æ ·å·¦è¾¹æ•°ç»„å°±æ’åºå®Œæˆï¼Œç„¶åæŒ‰ç…§ä»¥ä¸Šæ€è·¯æ’åºå³è¾¹æ•°ç»„ï¼Œæœ€åå°†æ•°ç»„ <code>[1, 2, 3, 8]</code> å’Œ <code>[6, 7, 9]</code> æ’åº</p></blockquote> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/162be13c7e30bd86" alt="" class="medium-zoom-image"></p> <p>ä»¥ä¸‹æ˜¯å®ç°è¯¥ç®—æ³•çš„ä»£ç </p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">sort</span><span class="token punctuation">(</span><span class="token parameter">array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">checkArray</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">mergeSort</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> array<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> array<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">mergeSort</span><span class="token punctuation">(</span><span class="token parameter">array<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// å·¦å³ç´¢å¼•ç›¸åŒè¯´æ˜å·²ç»åªæœ‰ä¸€ä¸ªæ•°</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>left <span class="token operator">===</span> right<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token comment">// ç­‰åŒäº `left + (right - left) / 2`</span>
  <span class="token comment">// ç›¸æ¯” `(left + right) / 2` æ¥è¯´æ›´åŠ å®‰å…¨ï¼Œä¸ä¼šæº¢å‡º</span>
  <span class="token comment">// ä½¿ç”¨ä½è¿ç®—æ˜¯å› ä¸ºä½è¿ç®—æ¯”å››åˆ™è¿ç®—å¿«</span>
  <span class="token keyword">let</span> mid <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>left <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>right <span class="token operator">-</span> left<span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">mergeSort</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> left<span class="token punctuation">,</span> mid<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">mergeSort</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> help <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> p1 <span class="token operator">=</span> left<span class="token punctuation">;</span>
  <span class="token keyword">let</span> p2 <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>p1 <span class="token operator">&lt;=</span> mid <span class="token operator">&amp;&amp;</span> p2 <span class="token operator">&lt;=</span> right<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    help<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> array<span class="token punctuation">[</span>p1<span class="token punctuation">]</span> <span class="token operator">&lt;</span> array<span class="token punctuation">[</span>p2<span class="token punctuation">]</span> <span class="token operator">?</span> array<span class="token punctuation">[</span>p1<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">:</span> array<span class="token punctuation">[</span>p2<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>p1 <span class="token operator">&lt;=</span> mid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    help<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> array<span class="token punctuation">[</span>p1<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>p2 <span class="token operator">&lt;=</span> right<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    help<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> array<span class="token punctuation">[</span>p2<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> help<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    array<span class="token punctuation">[</span>left <span class="token operator">+</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> help<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> array<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>ä»¥ä¸Šç®—æ³•ä½¿ç”¨äº†é€’å½’çš„æ€æƒ³ã€‚é€’å½’çš„æœ¬è´¨å°±æ˜¯å‹æ ˆï¼Œæ¯é€’å½’æ‰§è¡Œä¸€æ¬¡å‡½æ•°ï¼Œå°±å°†è¯¥å‡½æ•°çš„ä¿¡æ¯ï¼ˆæ¯”å¦‚å‚æ•°ï¼Œå†…éƒ¨çš„å˜é‡ï¼Œæ‰§è¡Œåˆ°çš„è¡Œæ•°ï¼‰å‹æ ˆï¼Œç›´åˆ°é‡åˆ°ç»ˆæ­¢æ¡ä»¶ï¼Œç„¶åå‡ºæ ˆå¹¶ç»§ç»­æ‰§è¡Œå‡½æ•°ã€‚å¯¹äºä»¥ä¸Šé€’å½’å‡½æ•°çš„è°ƒç”¨è½¨è¿¹å¦‚ä¸‹</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">mergeSort</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token comment">// mid = 3</span>
  <span class="token function">mergeSort</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">// mid = 1</span>
    <span class="token function">mergeSort</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// mid = 0</span>
      <span class="token function">mergeSort</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// é‡åˆ°ç»ˆæ­¢ï¼Œå›é€€åˆ°ä¸Šä¸€æ­¥</span>
    <span class="token function">mergeSort</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// é‡åˆ°ç»ˆæ­¢ï¼Œå›é€€åˆ°ä¸Šä¸€æ­¥</span>
    <span class="token comment">// æ’åº p1 = 0, p2 = mid + 1 = 1</span>
    <span class="token comment">// å›é€€åˆ° `mergeSort(data, 0, 3)` æ‰§è¡Œä¸‹ä¸€ä¸ªé€’å½’</span>
  <span class="token function">mergeSort</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">// mid = 2</span>
    <span class="token function">mergeSort</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">// é‡åˆ°ç»ˆæ­¢ï¼Œå›é€€åˆ°ä¸Šä¸€æ­¥</span>
  <span class="token comment">// æ’åº p1 = 2, p2 = mid + 1 = 3</span>
  <span class="token comment">// å›é€€åˆ° `mergeSort(data, 0, 3)` æ‰§è¡Œåˆå¹¶é€»è¾‘</span>
  <span class="token comment">// æ’åº p1 = 0, p2 = mid + 1 = 2</span>
  <span class="token comment">// æ‰§è¡Œå®Œæ¯•å›é€€</span>
  <span class="token comment">// å·¦è¾¹æ•°ç»„æ’åºå®Œæ¯•ï¼Œå³è¾¹ä¹Ÿæ˜¯å¦‚ä¸Šè½¨è¿¹</span>
</code></pre></div><blockquote><p>è¯¥ç®—æ³•çš„æ“ä½œæ¬¡æ•°æ˜¯å¯ä»¥è¿™æ ·è®¡ç®—ï¼šé€’å½’äº†ä¸¤æ¬¡ï¼Œæ¯æ¬¡æ•°æ®é‡æ˜¯æ•°ç»„çš„ä¸€åŠï¼Œå¹¶ä¸”æœ€åæŠŠæ•´ä¸ªæ•°ç»„è¿­ä»£äº†ä¸€æ¬¡ï¼Œæ‰€ä»¥å¾—å‡ºè¡¨è¾¾å¼ <code>2T(N / 2) + T(N)</code> ï¼ˆ<code>T</code> ä»£è¡¨æ—¶é—´ï¼Œ<code>N</code> ä»£è¡¨æ•°æ®é‡ï¼‰ã€‚æ ¹æ®è¯¥è¡¨è¾¾å¼å¯ä»¥å¥—ç”¨ è¯¥å…¬å¼ å¾—å‡ºæ—¶é—´å¤æ‚åº¦ä¸º <code>O(N * logN)</code></p></blockquote> <h4 id="_36-2-5-å¿«æ’"><a href="http://interview.poetries.top/docs/excellent.html#_36-2-5-%E5%BF%AB%E6%8E%92" class="header-anchor">#</a> 36.2.5 å¿«æ’</h4> <blockquote><p>å¿«æ’çš„åŸç†å¦‚ä¸‹ã€‚éšæœºé€‰å–ä¸€ä¸ªæ•°ç»„ä¸­çš„å€¼ä½œä¸ºåŸºå‡†å€¼ï¼Œä»å·¦è‡³å³å–å€¼ä¸åŸºå‡†å€¼å¯¹æ¯”å¤§å°ã€‚æ¯”åŸºå‡†å€¼å°çš„æ”¾æ•°ç»„å·¦è¾¹ï¼Œå¤§çš„æ”¾å³è¾¹ï¼Œå¯¹æ¯”å®Œæˆåå°†åŸºå‡†å€¼å’Œç¬¬ä¸€ä¸ªæ¯”åŸºå‡†å€¼å¤§çš„å€¼äº¤æ¢ä½ç½®ã€‚ç„¶åå°†æ•°ç»„ä»¥åŸºå‡†å€¼çš„ä½ç½®åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œç»§ç»­é€’å½’ä»¥ä¸Šæ“ä½œ</p></blockquote> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/162cd23e69ca9ea3" alt="" class="medium-zoom-image"></p> <p>ä»¥ä¸‹æ˜¯å®ç°è¯¥ç®—æ³•çš„ä»£ç </p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">sort</span><span class="token punctuation">(</span><span class="token parameter">array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">checkArray</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">quickSort</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> array<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> array<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">quickSort</span><span class="token punctuation">(</span><span class="token parameter">array<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>left <span class="token operator">&lt;</span> right<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">swap</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token punctuation">,</span> right<span class="token punctuation">)</span>
    <span class="token comment">// éšæœºå–å€¼ï¼Œç„¶åå’Œæœ«å°¾äº¤æ¢ï¼Œè¿™æ ·åšæ¯”å›ºå®šå–ä¸€ä¸ªä½ç½®çš„å¤æ‚åº¦ç•¥ä½</span>
    <span class="token keyword">let</span> indexs <span class="token operator">=</span> <span class="token function">part</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>right <span class="token operator">-</span> left <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> left<span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">quickSort</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> left<span class="token punctuation">,</span> indexs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">quickSort</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> indexs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">part</span><span class="token punctuation">(</span><span class="token parameter">array<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> less <span class="token operator">=</span> left <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> more <span class="token operator">=</span> right<span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>left <span class="token operator">&lt;</span> more<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>array<span class="token punctuation">[</span>left<span class="token punctuation">]</span> <span class="token operator">&lt;</span> array<span class="token punctuation">[</span>right<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// å½“å‰å€¼æ¯”åŸºå‡†å€¼å°ï¼Œ`less` å’Œ `left` éƒ½åŠ ä¸€</span>
	   <span class="token operator">++</span>less<span class="token punctuation">;</span>
       <span class="token operator">++</span>left<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>array<span class="token punctuation">[</span>left<span class="token punctuation">]</span> <span class="token operator">&gt;</span> array<span class="token punctuation">[</span>right<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// å½“å‰å€¼æ¯”åŸºå‡†å€¼å¤§ï¼Œå°†å½“å‰å€¼å’Œå³è¾¹çš„å€¼äº¤æ¢</span>
      <span class="token comment">// å¹¶ä¸”ä¸æ”¹å˜ `left`ï¼Œå› ä¸ºå½“å‰æ¢è¿‡æ¥çš„å€¼è¿˜æ²¡æœ‰åˆ¤æ–­è¿‡å¤§å°</span>
      <span class="token function">swap</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token operator">--</span>more<span class="token punctuation">,</span> left<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// å’ŒåŸºå‡†å€¼ç›¸åŒï¼Œåªç§»åŠ¨ä¸‹æ ‡</span>
      left<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// å°†åŸºå‡†å€¼å’Œæ¯”åŸºå‡†å€¼å¤§çš„ç¬¬ä¸€ä¸ªå€¼äº¤æ¢ä½ç½®</span>
  <span class="token comment">// è¿™æ ·æ•°ç»„å°±å˜æˆ `[æ¯”åŸºå‡†å€¼å°, åŸºå‡†å€¼, æ¯”åŸºå‡†å€¼å¤§]`</span>
  <span class="token function">swap</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> right<span class="token punctuation">,</span> more<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>less<span class="token punctuation">,</span> more<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>è¯¥ç®—æ³•çš„å¤æ‚åº¦å’Œå½’å¹¶æ’åºæ˜¯ç›¸åŒçš„ï¼Œä½†æ˜¯é¢å¤–ç©ºé—´å¤æ‚åº¦æ¯”å½’å¹¶æ’åºå°‘ï¼Œåªéœ€ <code>O(logN)</code>ï¼Œå¹¶ä¸”ç›¸æ¯”å½’å¹¶æ’åºæ¥è¯´ï¼Œæ‰€éœ€çš„å¸¸æ•°æ—¶é—´ä¹Ÿæ›´å°‘</p></blockquote> <p><strong>é¢è¯•é¢˜</strong></p> <blockquote><p>Sort Colorsï¼šè¯¥é¢˜ç›®æ¥è‡ª LeetCodeï¼Œé¢˜ç›®éœ€è¦æˆ‘ä»¬å°† <code>[2,0,2,1,1,0]</code>æ’åºæˆ <code>[0,0,1,1,2,2]</code> ï¼Œè¿™ä¸ªé—®é¢˜å°±å¯ä»¥ä½¿ç”¨ä¸‰è·¯å¿«æ’çš„æ€æƒ³ã€‚</p></blockquote> <p>ä»¥ä¸‹æ˜¯ä»£ç å®ç°</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">sortColors</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">nums</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> left <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> right <span class="token operator">=</span> nums<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
  <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token comment">// ä¸‹æ ‡å¦‚æœé‡åˆ° rightï¼Œè¯´æ˜å·²ç»æ’åºå®Œæˆ</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> right<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">swap</span><span class="token punctuation">(</span>nums<span class="token punctuation">,</span> i<span class="token operator">++</span><span class="token punctuation">,</span> <span class="token operator">++</span>left<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      i<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">swap</span><span class="token punctuation">(</span>nums<span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token operator">--</span>right<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div><blockquote><p>Kth Largest Element in an Arrayï¼šè¯¥é¢˜ç›®æ¥è‡ª LeetCodeï¼Œé¢˜ç›®éœ€è¦æ‰¾å‡ºæ•°ç»„ä¸­ç¬¬ K å¤§çš„å…ƒç´ ï¼Œè¿™é—®é¢˜ä¹Ÿå¯ä»¥ä½¿ç”¨å¿«æ’çš„æ€è·¯ã€‚å¹¶ä¸”å› ä¸ºæ˜¯æ‰¾å‡ºç¬¬ K å¤§å…ƒç´ ï¼Œæ‰€ä»¥åœ¨åˆ†ç¦»æ•°ç»„çš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥æ‰¾å‡ºéœ€è¦çš„å…ƒç´ åœ¨å“ªè¾¹ï¼Œç„¶ååªéœ€è¦æ’åºç›¸åº”çš„ä¸€è¾¹æ•°ç»„å°±å¥½ã€‚</p></blockquote> <p>ä»¥ä¸‹æ˜¯ä»£ç å®ç°</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">findKthLargest</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">nums<span class="token punctuation">,</span> k</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> l <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">let</span> r <span class="token operator">=</span> nums<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>
  <span class="token comment">// å¾—å‡ºç¬¬ K å¤§å…ƒç´ çš„ç´¢å¼•ä½ç½®</span>
  k <span class="token operator">=</span> nums<span class="token punctuation">.</span>length <span class="token operator">-</span> k
  <span class="token keyword">while</span> <span class="token punctuation">(</span>l <span class="token operator">&lt;</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// åˆ†ç¦»æ•°ç»„åè·å¾—æ¯”åŸºå‡†æ ‘å¤§çš„ç¬¬ä¸€ä¸ªå…ƒç´ ç´¢å¼•</span>
    <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token function">part</span><span class="token punctuation">(</span>nums<span class="token punctuation">,</span> l<span class="token punctuation">,</span> r<span class="token punctuation">)</span>
    <span class="token comment">// åˆ¤æ–­è¯¥ç´¢å¼•å’Œ k çš„å¤§å°</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      l <span class="token operator">=</span> index <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&gt;</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      r <span class="token operator">=</span> index <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">break</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> nums<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">part</span><span class="token punctuation">(</span><span class="token parameter">array<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> less <span class="token operator">=</span> left <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> more <span class="token operator">=</span> right<span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>left <span class="token operator">&lt;</span> more<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>array<span class="token punctuation">[</span>left<span class="token punctuation">]</span> <span class="token operator">&lt;</span> array<span class="token punctuation">[</span>right<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	   <span class="token operator">++</span>less<span class="token punctuation">;</span>
       <span class="token operator">++</span>left<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>array<span class="token punctuation">[</span>left<span class="token punctuation">]</span> <span class="token operator">&gt;</span> array<span class="token punctuation">[</span>right<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">swap</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token operator">--</span>more<span class="token punctuation">,</span> left<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      left<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">swap</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> right<span class="token punctuation">,</span> more<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> more<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_36-2-6-å †æ’åº"><a href="http://interview.poetries.top/docs/excellent.html#_36-2-6-%E5%A0%86%E6%8E%92%E5%BA%8F" class="header-anchor">#</a> 36.2.6 å †æ’åº</h4> <blockquote><p>å †æ’åºåˆ©ç”¨äº†äºŒå‰å †çš„ç‰¹æ€§æ¥åšï¼ŒäºŒå‰å †é€šå¸¸ç”¨æ•°ç»„è¡¨ç¤ºï¼Œå¹¶ä¸”äºŒå‰å †æ˜¯ä¸€é¢—å®Œå…¨äºŒå‰æ ‘ï¼ˆæ‰€æœ‰å¶èŠ‚ç‚¹ï¼ˆæœ€åº•å±‚çš„èŠ‚ç‚¹ï¼‰éƒ½æ˜¯ä»å·¦å¾€å³é¡ºåºæ’åºï¼Œå¹¶ä¸”å…¶ä»–å±‚çš„èŠ‚ç‚¹éƒ½æ˜¯æ»¡çš„ï¼‰ã€‚äºŒå‰å †åˆåˆ†ä¸ºå¤§æ ¹å †ä¸å°æ ¹å †</p></blockquote> <ul><li>å¤§æ ¹å †æ˜¯æŸä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹çš„å€¼éƒ½æ¯”ä»–å°</li> <li>å°æ ¹å †æ˜¯æŸä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹çš„å€¼éƒ½æ¯”ä»–å¤§</li></ul> <blockquote><p>å †æ’åºçš„åŸç†å°±æ˜¯ç»„æˆä¸€ä¸ªå¤§æ ¹å †æˆ–è€…å°æ ¹å †ã€‚ä»¥å°æ ¹å †ä¸ºä¾‹ï¼ŒæŸä¸ªèŠ‚ç‚¹çš„å·¦è¾¹å­èŠ‚ç‚¹ç´¢å¼•æ˜¯ <code>i * 2 + 1</code>ï¼Œå³è¾¹æ˜¯ <code>i * 2 + 2</code>ï¼Œçˆ¶èŠ‚ç‚¹æ˜¯ <code>(i - 1) /2</code></p></blockquote> <ol><li>é¦–å…ˆéå†æ•°ç»„ï¼Œåˆ¤æ–­è¯¥èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹æ˜¯å¦æ¯”ä»–å°ï¼Œå¦‚æœå°å°±äº¤æ¢ä½ç½®å¹¶ç»§ç»­åˆ¤æ–­ï¼Œç›´åˆ°ä»–çš„çˆ¶èŠ‚ç‚¹æ¯”ä»–å¤§</li> <li>é‡æ–°ä»¥ä¸Šæ“ä½œ <code>1</code>ï¼Œç›´åˆ°æ•°ç»„é¦–ä½æ˜¯æœ€å¤§å€¼</li> <li>ç„¶åå°†é¦–ä½å’Œæœ«å°¾äº¤æ¢ä½ç½®å¹¶å°†æ•°ç»„é•¿åº¦å‡ä¸€ï¼Œè¡¨ç¤ºæ•°ç»„æœ«å°¾å·²æ˜¯æœ€å¤§å€¼ï¼Œä¸éœ€è¦å†æ¯”è¾ƒå¤§å°</li> <li>å¯¹æ¯”å·¦å³èŠ‚ç‚¹å“ªä¸ªå¤§ï¼Œç„¶åè®°ä½å¤§çš„èŠ‚ç‚¹çš„ç´¢å¼•å¹¶ä¸”å’Œçˆ¶èŠ‚ç‚¹å¯¹æ¯”å¤§å°ï¼Œå¦‚æœå­èŠ‚ç‚¹å¤§å°±äº¤æ¢ä½ç½®</li> <li>é‡å¤ä»¥ä¸Šæ“ä½œ <code>3 - 4</code> ç›´åˆ°æ•´ä¸ªæ•°ç»„éƒ½æ˜¯å¤§æ ¹å †ã€‚</li></ol> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/162d2a9ff258dfe1" alt="" class="medium-zoom-image"></p> <p>ä»¥ä¸‹æ˜¯å®ç°è¯¥ç®—æ³•çš„ä»£ç </p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">heap</span><span class="token punctuation">(</span><span class="token parameter">array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">checkArray</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// å°†æœ€å¤§å€¼äº¤æ¢åˆ°é¦–ä½</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">heapInsert</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> size <span class="token operator">=</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
  <span class="token comment">// äº¤æ¢é¦–ä½å’Œæœ«å°¾</span>
  <span class="token function">swap</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">--</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>size <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">heapify</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">swap</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">--</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> array<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">heapInsert</span><span class="token punctuation">(</span><span class="token parameter">array<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// å¦‚æœå½“å‰èŠ‚ç‚¹æ¯”çˆ¶èŠ‚ç‚¹å¤§ï¼Œå°±äº¤æ¢</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>array<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">&gt;</span> array<span class="token punctuation">[</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token punctuation">(</span>index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">swap</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> index<span class="token punctuation">,</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token punctuation">(</span>index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// å°†ç´¢å¼•å˜æˆçˆ¶èŠ‚ç‚¹</span>
    index <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token punctuation">(</span>index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">heapify</span><span class="token punctuation">(</span><span class="token parameter">array<span class="token punctuation">,</span> index<span class="token punctuation">,</span> size</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> left <span class="token operator">=</span> index <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>left <span class="token operator">&lt;</span> size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// åˆ¤æ–­å·¦å³èŠ‚ç‚¹å¤§å°</span>
    <span class="token keyword">let</span> largest <span class="token operator">=</span>
      left <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;</span> size <span class="token operator">&amp;&amp;</span> array<span class="token punctuation">[</span>left<span class="token punctuation">]</span> <span class="token operator">&lt;</span> array<span class="token punctuation">[</span>left <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">?</span> left <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">:</span> left<span class="token punctuation">;</span>
    <span class="token comment">// åˆ¤æ–­å­èŠ‚ç‚¹å’Œçˆ¶èŠ‚ç‚¹å¤§å°</span>
    largest <span class="token operator">=</span> array<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">&lt;</span> array<span class="token punctuation">[</span>largest<span class="token punctuation">]</span> <span class="token operator">?</span> largest <span class="token operator">:</span> index<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>largest <span class="token operator">===</span> index<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token function">swap</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> index<span class="token punctuation">,</span> largest<span class="token punctuation">)</span><span class="token punctuation">;</span>
    index <span class="token operator">=</span> largest<span class="token punctuation">;</span>
    left <span class="token operator">=</span> index <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>ä»¥ä¸Šä»£ç å®ç°äº†å°æ ¹å †ï¼Œå¦‚æœéœ€è¦å®ç°å¤§æ ¹å †ï¼Œåªéœ€è¦æŠŠèŠ‚ç‚¹å¯¹æ¯”åä¸€ä¸‹å°±å¥½ã€‚</li> <li>è¯¥ç®—æ³•çš„å¤æ‚åº¦æ˜¯ <code>O(logN)</code></li></ul> <h3 id="_36-3-é“¾è¡¨"><a href="http://interview.poetries.top/docs/excellent.html#_36-3-%E9%93%BE%E8%A1%A8" class="header-anchor">#</a> 36.3 é“¾è¡¨</h3> <p><strong>åè½¬å•å‘é“¾è¡¨</strong></p> <blockquote><p>è¯¥é¢˜ç›®æ¥è‡ª LeetCodeï¼Œé¢˜ç›®éœ€è¦å°†ä¸€ä¸ªå•å‘é“¾è¡¨åè½¬ã€‚æ€è·¯å¾ˆç®€å•ï¼Œä½¿ç”¨ä¸‰ä¸ªå˜é‡åˆ†åˆ«è¡¨ç¤ºå½“å‰èŠ‚ç‚¹å’Œå½“å‰èŠ‚ç‚¹çš„å‰åèŠ‚ç‚¹ï¼Œè™½ç„¶è¿™é¢˜å¾ˆç®€å•ï¼Œä½†æ˜¯å´æ˜¯ä¸€é“é¢è¯•å¸¸è€ƒé¢˜</p></blockquote> <p>ä»¥ä¸‹æ˜¯å®ç°è¯¥ç®—æ³•çš„ä»£ç </p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">reverseList</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">head</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// åˆ¤æ–­ä¸‹å˜é‡è¾¹ç•Œé—®é¢˜</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>head <span class="token operator">||</span> <span class="token operator">!</span>head<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token keyword">return</span> head
    <span class="token comment">// åˆå§‹è®¾ç½®ä¸ºç©ºï¼Œå› ä¸ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹åè½¬åå°±æ˜¯å°¾éƒ¨ï¼Œå°¾éƒ¨èŠ‚ç‚¹æŒ‡å‘ null</span>
    <span class="token keyword">let</span> pre <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token keyword">let</span> current <span class="token operator">=</span> head
    <span class="token keyword">let</span> next
    <span class="token comment">// åˆ¤æ–­å½“å‰èŠ‚ç‚¹æ˜¯å¦ä¸ºç©º</span>
    <span class="token comment">// ä¸ä¸ºç©ºå°±å…ˆè·å–å½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€èŠ‚ç‚¹</span>
    <span class="token comment">// ç„¶åæŠŠå½“å‰èŠ‚ç‚¹çš„ next è®¾ä¸ºä¸Šä¸€ä¸ªèŠ‚ç‚¹</span>
    <span class="token comment">// ç„¶åæŠŠ current è®¾ä¸ºä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œpre è®¾ä¸ºå½“å‰èŠ‚ç‚¹</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        next <span class="token operator">=</span> current<span class="token punctuation">.</span>next
        current<span class="token punctuation">.</span>next <span class="token operator">=</span> pre
        pre <span class="token operator">=</span> current
        current <span class="token operator">=</span> next
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> pre
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_36-4-æ ‘"><a href="http://interview.poetries.top/docs/excellent.html#_36-4-%E6%A0%91" class="header-anchor">#</a> 36.4 æ ‘</h3> <p><strong>äºŒå‰æ ‘çš„å…ˆåºï¼Œä¸­åºï¼Œååºéå†</strong></p> <ul><li>å…ˆåºéå†è¡¨ç¤ºå…ˆè®¿é—®æ ¹èŠ‚ç‚¹ï¼Œç„¶åè®¿é—®å·¦èŠ‚ç‚¹ï¼Œæœ€åè®¿é—®å³èŠ‚ç‚¹ã€‚</li> <li>ä¸­åºéå†è¡¨ç¤ºå…ˆè®¿é—®å·¦èŠ‚ç‚¹ï¼Œç„¶åè®¿é—®æ ¹èŠ‚ç‚¹ï¼Œæœ€åè®¿é—®å³èŠ‚ç‚¹ã€‚</li> <li>ååºéå†è¡¨ç¤ºå…ˆè®¿é—®å·¦èŠ‚ç‚¹ï¼Œç„¶åè®¿é—®å³èŠ‚ç‚¹ï¼Œæœ€åè®¿é—®æ ¹èŠ‚ç‚¹ã€‚</li></ul> <p><strong>é€’å½’å®ç°</strong></p> <p>é€’å½’å®ç°ç›¸å½“ç®€å•ï¼Œä»£ç å¦‚ä¸‹</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">TreeNode</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>val <span class="token operator">=</span> val<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>right <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> <span class="token function-variable function">traversal</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">root</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å…ˆåº</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token function">traversal</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>left<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ä¸­åº</span>
    <span class="token comment">// console.log(root); </span>
    <span class="token function">traversal</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ååº</span>
    <span class="token comment">// console.log(root);</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>å¯¹äºé€’å½’çš„å®ç°æ¥è¯´ï¼Œåªéœ€è¦ç†è§£æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šè¢«è®¿é—®ä¸‰æ¬¡å°±æ˜ç™½ä¸ºä»€ä¹ˆè¿™æ ·å®ç°äº†ã€‚</p></blockquote> <p><strong>éé€’å½’å®ç°</strong></p> <blockquote><p>éé€’å½’å®ç°ä½¿ç”¨äº†æ ˆçš„ç»“æ„ï¼Œé€šè¿‡æ ˆçš„å…ˆè¿›åå‡ºæ¨¡æ‹Ÿé€’å½’å®ç°ã€‚</p></blockquote> <p>ä»¥ä¸‹æ˜¯å…ˆåºéå†ä»£ç å®ç°</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">pre</span><span class="token punctuation">(</span><span class="token parameter">root</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// å…ˆå°†æ ¹èŠ‚ç‚¹ push</span>
    stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// åˆ¤æ–­æ ˆä¸­æ˜¯å¦ä¸ºç©º</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>stack<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// å¼¹å‡ºæ ˆé¡¶å…ƒç´ </span>
      root <span class="token operator">=</span> stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// å› ä¸ºå…ˆåºéå†æ˜¯å…ˆå·¦åå³ï¼Œæ ˆæ˜¯å…ˆè¿›åå‡ºç»“æ„</span>
      <span class="token comment">// æ‰€ä»¥å…ˆ push å³è¾¹å† push å·¦è¾¹</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>root<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>root<span class="token punctuation">.</span>left<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>left<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ä»¥ä¸‹æ˜¯ä¸­åºéå†ä»£ç å®ç°</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">mid</span><span class="token punctuation">(</span><span class="token parameter">root</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// ä¸­åºéå†æ˜¯å…ˆå·¦å†æ ¹æœ€åå³</span>
    <span class="token comment">// æ‰€ä»¥é¦–å…ˆåº”è¯¥å…ˆæŠŠæœ€å·¦è¾¹èŠ‚ç‚¹éå†åˆ°åº•ä¾æ¬¡ push è¿›æ ˆ</span>
    <span class="token comment">// å½“å·¦è¾¹æ²¡æœ‰èŠ‚ç‚¹æ—¶ï¼Œå°±æ‰“å°æ ˆé¡¶å…ƒç´ ï¼Œç„¶åå¯»æ‰¾å³èŠ‚ç‚¹</span>
    <span class="token comment">// å¯¹äºæœ€å·¦è¾¹çš„å¶èŠ‚ç‚¹æ¥è¯´ï¼Œå¯ä»¥æŠŠå®ƒçœ‹æˆæ˜¯ä¸¤ä¸ª null èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹</span>
    <span class="token comment">// å·¦è¾¹æ‰“å°ä¸å‡ºä¸œè¥¿å°±æŠŠçˆ¶èŠ‚ç‚¹æ‹¿å‡ºæ¥æ‰“å°ï¼Œç„¶åå†çœ‹å³èŠ‚ç‚¹</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>stack<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">||</span> root<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
        root <span class="token operator">=</span> root<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        root <span class="token operator">=</span> stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
        root <span class="token operator">=</span> root<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>ä»¥ä¸‹æ˜¯ååºéå†ä»£ç å®ç°ï¼Œè¯¥ä»£ç ä½¿ç”¨äº†ä¸¤ä¸ªæ ˆæ¥å®ç°éå†ï¼Œç›¸æ¯”ä¸€ä¸ªæ ˆçš„éå†æ¥è¯´è¦å®¹æ˜“ç†è§£å¾ˆå¤š</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">pos</span><span class="token punctuation">(</span><span class="token parameter">root</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> stack1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> stack2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// ååºéå†æ˜¯å…ˆå·¦å†å³æœ€åæ ¹</span>
	<span class="token comment">// æ‰€ä»¥å¯¹äºä¸€ä¸ªæ ˆæ¥è¯´ï¼Œåº”è¯¥å…ˆ push æ ¹èŠ‚ç‚¹</span>
    <span class="token comment">// ç„¶å push å³èŠ‚ç‚¹ï¼Œæœ€å push å·¦èŠ‚ç‚¹</span>
    stack1<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>stack1<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      root <span class="token operator">=</span> stack1<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      stack2<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>root<span class="token punctuation">.</span>left<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        stack1<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>left<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>root<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        stack1<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>stack2<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s2<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>ä¸­åºéå†çš„å‰é©±åç»§èŠ‚ç‚¹</strong></p> <blockquote><p>å®ç°è¿™ä¸ªç®—æ³•çš„å‰ææ˜¯èŠ‚ç‚¹æœ‰ä¸€ä¸ª <code>parent</code> çš„æŒ‡é’ˆæŒ‡å‘çˆ¶èŠ‚ç‚¹ï¼Œæ ¹èŠ‚ç‚¹æŒ‡å‘ <code>null</code> ã€‚</p></blockquote> <p><img src="./é«˜é¢‘è€ƒç‚¹ _ é¢è¯•æŒ‡å—_files/162f61ad8e8588b7" alt="" class="medium-zoom-image"></p> <blockquote><p>å¦‚å›¾æ‰€ç¤ºï¼Œè¯¥æ ‘çš„ä¸­åºéå†ç»“æœæ˜¯ <code>4, 2, 5, 1, 6, 3, 7</code></p></blockquote> <p><strong>å‰é©±èŠ‚ç‚¹</strong></p> <blockquote><p>å¯¹äºèŠ‚ç‚¹ 2 æ¥è¯´ï¼Œä»–çš„å‰é©±èŠ‚ç‚¹å°±æ˜¯ 4 ï¼ŒæŒ‰ç…§ä¸­åºéå†åŸåˆ™ï¼Œå¯ä»¥å¾—å‡ºä»¥ä¸‹ç»“è®º</p></blockquote> <ol><li>å¦‚æœé€‰å–çš„èŠ‚ç‚¹çš„å·¦èŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œå°±æ‰¾è¯¥å·¦èŠ‚ç‚¹æœ€å³çš„èŠ‚ç‚¹ã€‚å¯¹äºèŠ‚ç‚¹ 1 æ¥è¯´ï¼Œä»–æœ‰å·¦èŠ‚ç‚¹ <code>2</code> ï¼Œé‚£ä¹ˆèŠ‚ç‚¹ <code>2</code> çš„æœ€å³èŠ‚ç‚¹å°±æ˜¯ <code>5</code></li> <li>å¦‚æœå·¦èŠ‚ç‚¹ä¸ºç©ºï¼Œä¸”ç›®æ ‡èŠ‚ç‚¹æ˜¯çˆ¶èŠ‚ç‚¹çš„å³èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå‰é©±èŠ‚ç‚¹ä¸ºçˆ¶èŠ‚ç‚¹ã€‚å¯¹äºèŠ‚ç‚¹ 5 æ¥è¯´ï¼Œæ²¡æœ‰å·¦èŠ‚ç‚¹ï¼Œä¸”æ˜¯èŠ‚ç‚¹ <code>2</code> çš„å³èŠ‚ç‚¹ï¼Œæ‰€ä»¥èŠ‚ç‚¹ <code>2</code> æ˜¯å‰é©±èŠ‚ç‚¹</li> <li>å¦‚æœå·¦èŠ‚ç‚¹ä¸ºç©ºï¼Œä¸”ç›®æ ‡èŠ‚ç‚¹æ˜¯çˆ¶èŠ‚ç‚¹çš„å·¦èŠ‚ç‚¹ï¼Œå‘ä¸Šå¯»æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ˜¯çˆ¶èŠ‚ç‚¹çš„å³èŠ‚ç‚¹çš„èŠ‚ç‚¹ã€‚å¯¹äºèŠ‚ç‚¹ <code>6</code> æ¥è¯´ï¼Œæ²¡æœ‰å·¦èŠ‚ç‚¹ï¼Œä¸”æ˜¯èŠ‚ç‚¹ <code>3</code> çš„å·¦èŠ‚ç‚¹ï¼Œæ‰€ä»¥å‘ä¸Šå¯»æ‰¾åˆ°èŠ‚ç‚¹ <code>1</code> ï¼Œå‘ç°èŠ‚ç‚¹ <code>3</code> æ˜¯èŠ‚ç‚¹ <code>1</code> çš„å³èŠ‚ç‚¹ï¼Œæ‰€ä»¥èŠ‚ç‚¹ <code>1</code> æ˜¯èŠ‚ç‚¹ <code>6</code> çš„å‰é©±èŠ‚ç‚¹</li></ol> <p>ä»¥ä¸‹æ˜¯ç®—æ³•å®ç°</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">predecessor</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>node<span class="token punctuation">)</span> <span class="token keyword">return</span> 
  <span class="token comment">// ç»“è®º 1</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">getRight</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> parent <span class="token operator">=</span> node<span class="token punctuation">.</span>parent
    <span class="token comment">// ç»“è®º 2 3 çš„åˆ¤æ–­</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>parent <span class="token operator">&amp;&amp;</span> parent<span class="token punctuation">.</span>right <span class="token operator">===</span> node<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      node <span class="token operator">=</span> parent
      parent <span class="token operator">=</span> node<span class="token punctuation">.</span>parent
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> parent
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">getRight</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>node<span class="token punctuation">)</span> <span class="token keyword">return</span> 
  node <span class="token operator">=</span> node<span class="token punctuation">.</span>right
  <span class="token keyword">while</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span> node <span class="token operator">=</span> node<span class="token punctuation">.</span>right
  <span class="token keyword">return</span> node
<span class="token punctuation">}</span>
</code></pre></div><p><strong>åç»§èŠ‚ç‚¹</strong></p> <ul><li>å¯¹äºèŠ‚ç‚¹ 2 æ¥è¯´ï¼Œä»–çš„åç»§èŠ‚ç‚¹å°±æ˜¯ 5 ï¼ŒæŒ‰ç…§ä¸­åºéå†åŸåˆ™ï¼Œå¯ä»¥å¾—å‡ºä»¥ä¸‹ç»“è®º</li></ul> <ol><li>å¦‚æœæœ‰å³èŠ‚ç‚¹ï¼Œå°±æ‰¾åˆ°è¯¥å³èŠ‚ç‚¹çš„æœ€å·¦èŠ‚ç‚¹ã€‚å¯¹äºèŠ‚ç‚¹ 1 æ¥è¯´ï¼Œä»–æœ‰å³èŠ‚ç‚¹ 3 ï¼Œé‚£ä¹ˆèŠ‚ç‚¹ 3 çš„æœ€å·¦èŠ‚ç‚¹å°±æ˜¯ 6</li> <li>å¦‚æœæ²¡æœ‰å³èŠ‚ç‚¹ï¼Œå°±å‘ä¸Šéå†ç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªèŠ‚ç‚¹æ˜¯çˆ¶èŠ‚ç‚¹çš„å·¦èŠ‚ç‚¹ã€‚å¯¹äºèŠ‚ç‚¹ 5 æ¥è¯´ï¼Œæ²¡æœ‰å³èŠ‚ç‚¹ï¼Œå°±å‘ä¸Šå¯»æ‰¾åˆ°èŠ‚ç‚¹ 2 ï¼Œè¯¥èŠ‚ç‚¹æ˜¯çˆ¶èŠ‚ç‚¹ 1 çš„å·¦èŠ‚ç‚¹ï¼Œæ‰€ä»¥èŠ‚ç‚¹ 1 æ˜¯åç»§èŠ‚ç‚¹</li></ol> <p>ä»¥ä¸‹æ˜¯ç®—æ³•å®ç°</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">successor</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>node<span class="token punctuation">)</span> <span class="token keyword">return</span> 
  <span class="token comment">// ç»“è®º 1</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">getLeft</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// ç»“è®º 2</span>
    <span class="token keyword">let</span> parent <span class="token operator">=</span> node<span class="token punctuation">.</span>parent
    <span class="token comment">// åˆ¤æ–­ parent ä¸ºç©º</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>parent <span class="token operator">&amp;&amp;</span> parent<span class="token punctuation">.</span>left <span class="token operator">===</span> node<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      node <span class="token operator">=</span> parent
      parent <span class="token operator">=</span> node<span class="token punctuation">.</span>parent
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> parent
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">getLeft</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>node<span class="token punctuation">)</span> <span class="token keyword">return</span> 
  node <span class="token operator">=</span> node<span class="token punctuation">.</span>left
  <span class="token keyword">while</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span> node <span class="token operator">=</span> node<span class="token punctuation">.</span>left
  <span class="token keyword">return</span> node
<span class="token punctuation">}</span>
</code></pre></div><p><strong>æ ‘çš„æ·±åº¦</strong></p> <blockquote><p>æ ‘çš„æœ€å¤§æ·±åº¦ï¼šè¯¥é¢˜ç›®æ¥è‡ª Leetcodeï¼Œé¢˜ç›®éœ€è¦æ±‚å‡ºä¸€é¢—äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦</p></blockquote> <p>ä»¥ä¸‹æ˜¯ç®—æ³•å®ç°</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">maxDepth</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">root</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>root<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span> 
    <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token function">maxDepth</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>left<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">maxDepth</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>å¯¹äºè¯¥é€’å½’å‡½æ•°å¯ä»¥è¿™æ ·ç†è§£ï¼šä¸€æ—¦æ²¡æœ‰æ‰¾åˆ°èŠ‚ç‚¹å°±ä¼šè¿”å› 0ï¼Œæ¯å¼¹å‡ºä¸€æ¬¡é€’å½’å‡½æ•°å°±ä¼šåŠ ä¸€ï¼Œæ ‘æœ‰ä¸‰å±‚å°±ä¼šå¾—åˆ°3ã€‚</p></blockquote> <h3 id="_36-5-åŠ¨æ€è§„åˆ’"><a href="http://interview.poetries.top/docs/excellent.html#_36-5-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92" class="header-anchor">#</a> 36.5 åŠ¨æ€è§„åˆ’</h3> <ul><li>åŠ¨æ€è§„åˆ’èƒŒåçš„åŸºæœ¬æ€æƒ³éå¸¸ç®€å•ã€‚å°±æ˜¯å°†ä¸€ä¸ªé—®é¢˜æ‹†åˆ†ä¸ºå­é—®é¢˜ï¼Œä¸€èˆ¬æ¥è¯´è¿™äº›å­é—®é¢˜éƒ½æ˜¯éå¸¸ç›¸ä¼¼çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡åªè§£å†³ä¸€æ¬¡æ¯ä¸ªå­é—®é¢˜æ¥è¾¾åˆ°å‡å°‘è®¡ç®—é‡çš„ç›®çš„ã€‚</li> <li>ä¸€æ—¦å¾—å‡ºæ¯ä¸ªå­é—®é¢˜çš„è§£ï¼Œå°±å­˜å‚¨è¯¥ç»“æœä»¥ä¾¿ä¸‹æ¬¡ä½¿ç”¨ã€‚</li></ul> <p><strong>æ–æ³¢é‚£å¥‘æ•°åˆ—</strong></p> <blockquote><p>æ–æ³¢é‚£å¥‘æ•°åˆ—å°±æ˜¯ä» <code>0</code> å’Œ <code>1</code> å¼€å§‹ï¼Œåé¢çš„æ•°éƒ½æ˜¯å‰ä¸¤ä¸ªæ•°ä¹‹å’Œ</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>0ï¼Œ1ï¼Œ1ï¼Œ2ï¼Œ3ï¼Œ5ï¼Œ8ï¼Œ13ï¼Œ21ï¼Œ34ï¼Œ55ï¼Œ89....
</code></pre></div><blockquote><p>é‚£ä¹ˆæ˜¾ç„¶æ˜“è§ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é€’å½’çš„æ–¹å¼æ¥å®Œæˆæ±‚è§£æ–æ³¢é‚£å¥‘æ•°åˆ—</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">fib</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> n <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> n
  <span class="token keyword">return</span> <span class="token function">fib</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">fib</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">fib</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>ä»¥ä¸Šä»£ç å·²ç»å¯ä»¥å®Œç¾çš„è§£å†³é—®é¢˜ã€‚ä½†æ˜¯ä»¥ä¸Šè§£æ³•å´å­˜åœ¨å¾ˆä¸¥é‡çš„æ€§èƒ½é—®é¢˜ï¼Œå½“ <code>n</code> è¶Šå¤§çš„æ—¶å€™ï¼Œéœ€è¦çš„æ—¶é—´æ˜¯æŒ‡æ•°å¢é•¿çš„ï¼Œè¿™æ—¶å€™å°±å¯ä»¥é€šè¿‡åŠ¨æ€è§„åˆ’æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p></blockquote> <p><strong>åŠ¨æ€è§„åˆ’çš„æœ¬è´¨å…¶å®å°±æ˜¯ä¸¤ç‚¹</strong></p> <ul><li>è‡ªåº•å‘ä¸Šåˆ†è§£å­é—®é¢˜</li> <li>é€šè¿‡å˜é‡å­˜å‚¨å·²ç»è®¡ç®—è¿‡çš„è§£</li></ul> <p><strong>æ ¹æ®ä¸Šé¢ä¸¤ç‚¹ï¼Œæˆ‘ä»¬çš„æ–æ³¢é‚£å¥‘æ•°åˆ—çš„åŠ¨æ€è§„åˆ’æ€è·¯ä¹Ÿå°±å‡ºæ¥äº†</strong></p> <ul><li>æ–æ³¢é‚£å¥‘æ•°åˆ—ä» <code>0</code> å’Œ <code>1</code> å¼€å§‹ï¼Œé‚£ä¹ˆè¿™å°±æ˜¯è¿™ä¸ªå­é—®é¢˜çš„æœ€åº•å±‚</li> <li>é€šè¿‡æ•°ç»„æ¥å­˜å‚¨æ¯ä¸€ä½æ‰€å¯¹åº”çš„æ–æ³¢é‚£å¥‘æ•°åˆ—çš„å€¼</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">fib</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> array <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
  array<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
  array<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    array<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> array<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> array<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> array<span class="token punctuation">[</span>n<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token function">fib</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>0 - 1èƒŒåŒ…é—®é¢˜</strong></p> <blockquote><p>è¯¥é—®é¢˜å¯ä»¥æè¿°ä¸ºï¼šç»™å®šä¸€ç»„ç‰©å“ï¼Œæ¯ç§ç‰©å“éƒ½æœ‰è‡ªå·±çš„é‡é‡å’Œä»·æ ¼ï¼Œåœ¨é™å®šçš„æ€»é‡é‡å†…ï¼Œæˆ‘ä»¬å¦‚ä½•é€‰æ‹©ï¼Œæ‰èƒ½ä½¿å¾—ç‰©å“çš„æ€»ä»·æ ¼æœ€é«˜ã€‚æ¯ä¸ªé—®é¢˜åªèƒ½æ”¾å…¥è‡³å¤šä¸€æ¬¡ã€‚</p></blockquote> <p>å‡è®¾æˆ‘ä»¬æœ‰ä»¥ä¸‹ç‰©å“</p> <table><thead><tr><th>ç‰©å“ ID / é‡é‡</th> <th>ä»·å€¼</th></tr></thead> <tbody><tr><td>1</td> <td>3</td></tr> <tr><td>2</td> <td>7</td></tr> <tr><td>3</td> <td>12</td></tr></tbody></table> <ul><li>å¯¹äºä¸€ä¸ªæ€»å®¹é‡ä¸º 5 çš„èƒŒåŒ…æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥æ”¾å…¥é‡é‡ 2 å’Œ 3 çš„ç‰©å“æ¥è¾¾åˆ°èƒŒåŒ…å†…çš„ç‰©å“æ€»ä»·å€¼æœ€é«˜ã€‚</li> <li>å¯¹äºè¿™ä¸ªé—®é¢˜æ¥è¯´ï¼Œå­é—®é¢˜å°±ä¸¤ä¸ªï¼Œåˆ†åˆ«æ˜¯æ”¾ç‰©å“å’Œä¸æ”¾ç‰©å“ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹è¡¨æ ¼æ¥ç†è§£å­é—®é¢˜</li></ul> <table><thead><tr><th>ç‰©å“ ID / å‰©ä½™å®¹é‡</th> <th>0</th> <th>1</th> <th>2</th> <th>3</th> <th>4</th> <th>5</th></tr></thead> <tbody><tr><td>1</td> <td>0</td> <td>3</td> <td>3</td> <td>3</td> <td>3</td> <td>3</td></tr> <tr><td>2</td> <td>0</td> <td>3</td> <td>7</td> <td>10</td> <td>10</td> <td>10</td></tr> <tr><td>3</td> <td>0</td> <td>3</td> <td>7</td> <td>12</td> <td>15</td> <td>19</td></tr></tbody></table> <blockquote><p>ç›´æ¥æ¥åˆ†æèƒ½æ”¾ä¸‰ç§ç‰©å“çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯æœ€åä¸€è¡Œ</p></blockquote> <ul><li>å½“å®¹é‡å°‘äº 3 æ—¶ï¼Œåªå–ä¸Šä¸€è¡Œå¯¹åº”çš„æ•°æ®ï¼Œå› ä¸ºå½“å‰å®¹é‡ä¸èƒ½å®¹çº³ç‰©å“ 3</li> <li>å½“å®¹é‡ ä¸º 3 æ—¶ï¼Œè€ƒè™‘ä¸¤ç§æƒ…å†µï¼Œåˆ†åˆ«ä¸ºæ”¾å…¥ç‰©å“ 3 å’Œä¸æ”¾ç‰©å“ 3
<ul><li>ä¸æ”¾ç‰©å“ 3 çš„æƒ…å†µä¸‹ï¼Œæ€»ä»·å€¼ä¸º 10</li> <li>æ”¾å…¥ç‰©å“ 3 çš„æƒ…å†µä¸‹ï¼Œæ€»ä»·å€¼ä¸º 12ï¼Œæ‰€ä»¥åº”è¯¥æ”¾å…¥ç‰©å“ 3</li></ul></li> <li>å½“å®¹é‡ ä¸º 4 æ—¶ï¼Œè€ƒè™‘ä¸¤ç§æƒ…å†µï¼Œåˆ†åˆ«ä¸ºæ”¾å…¥ç‰©å“ 3 å’Œä¸æ”¾ç‰©å“ 3
<ul><li>ä¸æ”¾ç‰©å“ 3 çš„æƒ…å†µä¸‹ï¼Œæ€»ä»·å€¼ä¸º 10</li> <li>æ”¾å…¥ç‰©å“ 3 çš„æƒ…å†µä¸‹ï¼Œå’Œæ”¾å…¥ç‰©å“ 1 çš„ä»·å€¼ç›¸åŠ ï¼Œå¾—å‡ºæ€»ä»·å€¼ä¸º 15ï¼Œæ‰€ä»¥åº”è¯¥æ”¾å…¥ç‰©å“ 3</li></ul></li> <li>å½“å®¹é‡ ä¸º 5 æ—¶ï¼Œè€ƒè™‘ä¸¤ç§æƒ…å†µï¼Œåˆ†åˆ«ä¸ºæ”¾å…¥ç‰©å“ 3 å’Œä¸æ”¾ç‰©å“ 3
<ul><li>ä¸æ”¾ç‰©å“ 3 çš„æƒ…å†µä¸‹ï¼Œæ€»ä»·å€¼ä¸º 10</li> <li>æ”¾å…¥ç‰©å“ 3 çš„æƒ…å†µä¸‹ï¼Œå’Œæ”¾å…¥ç‰©å“ 2 çš„ä»·å€¼ç›¸åŠ ï¼Œå¾—å‡ºæ€»ä»·å€¼ä¸º 19ï¼Œæ‰€ä»¥åº”è¯¥æ”¾å…¥ç‰©å“ 3</li></ul></li></ul> <p>ä»¥ä¸‹ä»£ç å¯¹ç…§ä¸Šè¡¨æ›´å®¹æ˜“ç†è§£</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * @param {*} w ç‰©å“é‡é‡
 * @param {*} v ç‰©å“ä»·å€¼
 * @param {*} C æ€»å®¹é‡
 * @returns
 */</span>
<span class="token keyword">function</span> <span class="token function">knapsack</span><span class="token punctuation">(</span><span class="token parameter">w<span class="token punctuation">,</span> v<span class="token punctuation">,</span> <span class="token constant">C</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> length <span class="token operator">=</span> w<span class="token punctuation">.</span>length
  <span class="token keyword">if</span> <span class="token punctuation">(</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span>

  <span class="token comment">// å¯¹ç…§è¡¨æ ¼ï¼Œç”Ÿæˆçš„äºŒç»´æ•°ç»„ï¼Œç¬¬ä¸€ç»´ä»£è¡¨ç‰©å“ï¼Œç¬¬äºŒç»´ä»£è¡¨èƒŒåŒ…å‰©ä½™å®¹é‡</span>
  <span class="token comment">// ç¬¬äºŒç»´ä¸­çš„å…ƒç´ ä»£è¡¨èƒŒåŒ…ç‰©å“æ€»ä»·å€¼</span>
  <span class="token keyword">let</span> array <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token constant">C</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token comment">// å®Œæˆåº•éƒ¨å­é—®é¢˜çš„è§£</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token constant">C</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¯¹ç…§è¡¨æ ¼ç¬¬ä¸€è¡Œï¼Œ array[0] ä»£è¡¨ç‰©å“ 1</span>
    <span class="token comment">// i ä»£è¡¨å‰©ä½™æ€»å®¹é‡</span>
    <span class="token comment">// å½“å‰©ä½™æ€»å®¹é‡å¤§äºç‰©å“ 1 çš„é‡é‡æ—¶ï¼Œè®°å½•ä¸‹èƒŒåŒ…ç‰©å“æ€»ä»·å€¼ï¼Œå¦åˆ™ä»·å€¼ä¸º 0</span>
    array<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i <span class="token operator">&gt;=</span> w<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">?</span> v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// è‡ªåº•å‘ä¸Šå¼€å§‹è§£å†³å­é—®é¢˜ï¼Œä»ç‰©å“ 2 å¼€å§‹</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> <span class="token constant">C</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// è¿™é‡Œæ±‚è§£å­é—®é¢˜ï¼Œåˆ†åˆ«ä¸ºä¸æ”¾å½“å‰ç‰©å“å’Œæ”¾å½“å‰ç‰©å“</span>
      <span class="token comment">// å…ˆæ±‚ä¸æ”¾å½“å‰ç‰©å“çš„èƒŒåŒ…æ€»ä»·å€¼ï¼Œè¿™é‡Œçš„å€¼ä¹Ÿå°±æ˜¯å¯¹åº”è¡¨æ ¼ä¸­ä¸Šä¸€è¡Œå¯¹åº”çš„å€¼</span>
      array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> array<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span>
      <span class="token comment">// åˆ¤æ–­å½“å‰å‰©ä½™å®¹é‡æ˜¯å¦å¯ä»¥æ”¾å…¥å½“å‰ç‰©å“</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">&gt;=</span> w<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å¯ä»¥æ”¾å…¥çš„è¯ï¼Œå°±æ¯”å¤§å°</span>
        <span class="token comment">// æ”¾å…¥å½“å‰ç‰©å“å’Œä¸æ”¾å…¥å½“å‰ç‰©å“ï¼Œå“ªä¸ªèƒŒåŒ…æ€»ä»·å€¼å¤§</span>
        array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> v<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> array<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j <span class="token operator">-</span> w<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> array<span class="token punctuation">[</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token constant">C</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>æœ€é•¿é€’å¢å­åºåˆ—</strong></p> <blockquote><p>æœ€é•¿é€’å¢å­åºåˆ—æ„æ€æ˜¯åœ¨ä¸€ç»„æ•°å­—ä¸­ï¼Œæ‰¾å‡ºæœ€é•¿ä¸€ä¸²é€’å¢çš„æ•°å­—ï¼Œæ¯”å¦‚</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>0, 3, 4, 17, 2, 8, 6, 10
</code></pre></div><blockquote><p>å¯¹äºä»¥ä¸Šè¿™ä¸²æ•°å­—æ¥è¯´ï¼Œæœ€é•¿é€’å¢å­åºåˆ—å°±æ˜¯ <code>0, 3, 4, 8, 10</code>ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹è¡¨æ ¼æ›´æ¸…æ™°çš„ç†è§£</p></blockquote> <table><thead><tr><th>æ•°å­—</th> <th>0</th> <th>3</th> <th>4</th> <th>17</th> <th>2</th> <th>8</th> <th>6</th> <th>10</th></tr></thead> <tbody><tr><td>é•¿åº¦</td> <td>1</td> <td>2</td> <td>3</td> <td>4</td> <td>2</td> <td>4	4</td> <td>5</td> <td></td></tr></tbody></table> <p>é€šè¿‡ä»¥ä¸Šè¡¨æ ¼å¯ä»¥å¾ˆæ¸…æ™°çš„å‘ç°ä¸€ä¸ªè§„å¾‹ï¼Œæ‰¾å‡ºåˆšå¥½æ¯”å½“å‰æ•°å­—å°çš„æ•°ï¼Œå¹¶ä¸”åœ¨å°çš„æ•°ç»„æˆçš„é•¿åº¦åŸºç¡€ä¸ŠåŠ ä¸€ã€‚</p> <p>è¿™ä¸ªé—®é¢˜çš„åŠ¨æ€æ€è·¯è§£æ³•å¾ˆç®€å•ï¼Œç›´æ¥ä¸Šä»£ç </p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">lis</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>n<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span>
  <span class="token comment">// åˆ›å»ºä¸€ä¸ªå’Œå‚æ•°ç›¸åŒå¤§å°çš„æ•°ç»„ï¼Œå¹¶å¡«å……å€¼ä¸º 1</span>
  <span class="token keyword">let</span> array <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token comment">// ä»ç´¢å¼• 1 å¼€å§‹éå†ï¼Œå› ä¸ºæ•°ç»„å·²ç»æ‰€æœ‰éƒ½å¡«å……ä¸º 1 äº†</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ä»ç´¢å¼• 0 éå†åˆ° i</span>
    <span class="token comment">// åˆ¤æ–­ç´¢å¼• i ä¸Šçš„å€¼æ˜¯å¦å¤§äºä¹‹å‰çš„å€¼</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> i<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>n<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&gt;</span> n<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        array<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">+</span> array<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token number">1</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> res
<span class="token punctuation">}</span>
    </span></p></div>  
</body></html>