<!DOCTYPE html>
<!-- saved from url=(0164)http://interview.poetries.top/principle-docs/comprehensive/01-%E8%99%9A%E6%8B%9FDOM%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90.html#%E4%BB%80%E4%B9%88%E6%98%AF-virtual-dom -->
<html lang="en-US" class=" "><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    
    <title>ä»€ä¹ˆæ˜¯ Virtual DOM | é¢è¯•æŒ‡å—</title>
    
    <link rel="icon" href="./è™šæ‹ŸdomåŸç†_files/logo.png">
    <link rel="manifest" href="http://interview.poetries.top/manifest.json">
    <link rel="apple-touch-icon" href="http://interview.poetries.top/icons/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="http://interview.poetries.top/icons/safari-pinned-tab.svg" color="#3eaf7c">
    
    
    
    
    
    
    
    <link rel="preload" href="./è™šæ‹ŸdomåŸç†_files/0.styles.a3a6df6c.css" as="style"><link rel="preload" href="./è™šæ‹ŸdomåŸç†_files/app.25cf4eee.js.ä¸‹è½½" as="script"><link rel="preload" href="./è™šæ‹ŸdomåŸç†_files/5.bc663a4c.js.ä¸‹è½½" as="script"><link rel="preload" href="./è™šæ‹ŸdomåŸç†_files/4.1aaf03c6.js.ä¸‹è½½" as="script"><link rel="preload" href="./è™šæ‹ŸdomåŸç†_files/12.ac0bc851.js.ä¸‹è½½" as="script"><link rel="preload" href="./è™šæ‹ŸdomåŸç†_files/11.3e5297f1.js.ä¸‹è½½" as="script"><link rel="prefetch" href="./è™šæ‹ŸdomåŸç†_files/1.d83c2af0.js.ä¸‹è½½"><link rel="prefetch" href="http://interview.poetries.top/assets/js/10.fdecf69b.js"><link rel="prefetch" href="./è™šæ‹ŸdomåŸç†_files/100.df83f687.js.ä¸‹è½½"><link rel="prefetch" href="./è™šæ‹ŸdomåŸç†_files/101.3986f029.js.ä¸‹è½½"><link rel="prefetch" href="./è™šæ‹ŸdomåŸç†_files/102.1468be32.js.ä¸‹è½½"><link rel="prefetch" href="./è™šæ‹ŸdomåŸç†_files/103.bfef2896.js.ä¸‹è½½"><link rel="prefetch" href="./è™šæ‹ŸdomåŸç†_files/104.1731bbb1.js.ä¸‹è½½"><link rel="prefetch" href="./è™šæ‹ŸdomåŸç†_files/105.710b118c.js.ä¸‹è½½"><link rel="prefetch" href="./è™šæ‹ŸdomåŸç†_files/106.b955d37d.js.ä¸‹è½½"><link rel="prefetch" href="./è™šæ‹ŸdomåŸç†_files/107.6f79a916.js.ä¸‹è½½"><link rel="prefetch" href="./è™šæ‹ŸdomåŸç†_files/108.34ee5a8e.js.ä¸‹è½½"><link rel="prefetch" href="./è™šæ‹ŸdomåŸç†_files/109.f6c05e4d.js.ä¸‹è½½"><link rel="prefetch" href="./è™šæ‹ŸdomåŸç†_files/110.a375ddec.js.ä¸‹è½½"><link rel="prefetch" href="./è™šæ‹ŸdomåŸç†_files/111.bcc5c187.js.ä¸‹è½½"><link rel="prefetch" href="./è™šæ‹ŸdomåŸç†_files/112.afcfef56.js.ä¸‹è½½"><link rel="prefetch" href="./è™šæ‹ŸdomåŸç†_files/113.2e7c6e37.js.ä¸‹è½½"><link rel="prefetch" href="./è™šæ‹ŸdomåŸç†_files/114.9cfdb334.js.ä¸‹è½½"><link rel="prefetch" href="./è™šæ‹ŸdomåŸç†_files/115.063815ec.js.ä¸‹è½½"><link rel="prefetch" href="http://interview.poetries.top/assets/js/116.4e29ee01.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/117.b106fd0d.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/118.e4e784f7.js"><link rel="prefetch" href="./è™šæ‹ŸdomåŸç†_files/119.94fe014a.js.ä¸‹è½½"><link rel="prefetch" href="./è™šæ‹ŸdomåŸç†_files/13.57028e74.js.ä¸‹è½½"><link rel="prefetch" href="./è™šæ‹ŸdomåŸç†_files/14.043c3e8a.js.ä¸‹è½½"><link rel="prefetch" href="http://interview.poetries.top/assets/js/15.a6d0032e.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/16.6094fda8.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/17.f17aa05b.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/18.9732bfb3.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/19.2c38a6bb.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/20.92742304.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/21.28c8a661.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/22.3222a772.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/23.8192ecea.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/24.b5156b88.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/25.034d5e81.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/26.c78d8f63.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/27.cd94c89c.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/28.b2c8e24c.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/29.e9a30c2c.js"><link rel="prefetch" href="./è™šæ‹ŸdomåŸç†_files/3.f5ea6e07.js.ä¸‹è½½"><link rel="prefetch" href="http://interview.poetries.top/assets/js/30.2bd67425.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/31.6333035e.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/32.1a34dfa0.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/33.b5863ac0.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/34.cababd6c.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/35.0b09d4a2.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/36.8f89ed73.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/37.38d590c3.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/38.4799c402.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/39.c9d13f25.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/40.21e1dcb8.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/41.16e0641a.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/42.9ce6fd83.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/43.8936e729.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/44.5ebdd233.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/45.ce59a54c.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/46.b6f1380b.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/47.5fe8aac4.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/48.a31741eb.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/49.16132e72.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/50.ca74d5c9.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/51.f21f79ee.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/52.6ff2b7c5.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/53.003482ca.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/54.136b1210.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/55.5d00c7ca.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/56.e5b5668d.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/57.9275f210.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/58.dcf3e81b.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/59.5cbf4407.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/6.f2ac32df.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/60.ecfb5f55.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/61.8356d65b.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/62.8ca03065.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/63.a0c06a04.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/64.406f4c0f.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/65.9d0c9d57.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/66.ca2ccee4.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/67.b01df864.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/68.e99acf6a.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/69.f7dbb3b1.js"><link rel="prefetch" href="./è™šæ‹ŸdomåŸç†_files/7.26b183c1.js.ä¸‹è½½"><link rel="prefetch" href="http://interview.poetries.top/assets/js/70.b3199540.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/71.d7c346c6.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/72.6afb9cd3.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/73.80370c6b.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/74.eec2a38b.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/75.fdbda41f.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/76.c8a9acd3.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/77.02560728.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/78.f3bcf134.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/79.01333f71.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/8.b6777e86.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/80.a7dfb481.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/81.29a3aa15.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/82.9039f284.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/83.e29f794c.js"><link rel="prefetch" href="./è™šæ‹ŸdomåŸç†_files/84.9aea4d6e.js.ä¸‹è½½"><link rel="prefetch" href="./è™šæ‹ŸdomåŸç†_files/85.6fa07b30.js.ä¸‹è½½"><link rel="prefetch" href="http://interview.poetries.top/assets/js/86.b0a530f1.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/87.a2c892ff.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/88.2c0ab353.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/89.0a6986cd.js"><link rel="prefetch" href="./è™šæ‹ŸdomåŸç†_files/9.7231fa75.js.ä¸‹è½½"><link rel="prefetch" href="http://interview.poetries.top/assets/js/90.80c04201.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/91.19846beb.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/92.09ef3493.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/93.8bad40d8.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/94.f0810e7b.js"><link rel="prefetch" href="http://interview.poetries.top/assets/js/95.3a648c4f.js"><link rel="prefetch" href="./è™šæ‹ŸdomåŸç†_files/96.827e7cb2.js.ä¸‹è½½"><link rel="prefetch" href="./è™šæ‹ŸdomåŸç†_files/97.cc180b8f.js.ä¸‹è½½"><link rel="prefetch" href="./è™šæ‹ŸdomåŸç†_files/98.d2138442.js.ä¸‹è½½"><link rel="prefetch" href="./è™šæ‹ŸdomåŸç†_files/99.7e99e846.js.ä¸‹è½½">
    <link rel="stylesheet" href="./è™šæ‹ŸdomåŸç†_files/0.styles.a3a6df6c.css">
  <style type="text/css">.medium-zoom-overlay{position:fixed;top:0;right:0;bottom:0;left:0;opacity:0;transition:opacity .3s;will-change:opacity}.medium-zoom--opened .medium-zoom-overlay{cursor:pointer;cursor:zoom-out;opacity:1}.medium-zoom-image{cursor:pointer;cursor:zoom-in;transition:transform .3s cubic-bezier(.2,0,.2,1)!important}.medium-zoom-image--hidden{visibility:hidden}.medium-zoom-image--opened{position:relative;cursor:pointer;cursor:zoom-out;will-change:transform}</style>
 <meta name="description" content="å‰ç«¯é¢è¯•æŒ‡å—ï¼Œå‰ç«¯é¢è¯•é¢˜æ•´ç†ï¼ŒæŒ‰æ¨¡å—åˆ†ç±»æ•´ç†æ€»ç»“ï¼Œæ‰“é€ æœ€å…¨é¢çš„å‰ç«¯é¢è¯•é¢˜"><meta name="theme-color" content="#3eaf7c"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png"><meta name="msapplication-TileColor" content="#000000"></head>
  <body class="">
    <div id="app"><div class="theme-container"><header class="navbar" style="background: rgb(255, 255, 255);"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="http://interview.poetries.top/" class="home-link router-link-active"><img src="./åŸç†_files/logo.png" alt="é¢è¯•æŒ‡å—" class="logo"> <span class="site-name can-hide">é¢è¯•æŒ‡å—</span></a> <div class="links" style="background: rgb(255, 255, 255); max-width: 1771px;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value="" class="" placeholder=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div><a href="./index.html" class="nav-link">åŸºç¡€
    </a></div></div><div class="nav-item"><div><a href="./è¿›é˜¶.html" class="nav-link">âœ¨è¿›é˜¶
    </a></div></div><div class="nav-item"><div><a href="./ç²¾é€‰.html" class="nav-link">ğŸ‘ç²¾é€‰
    </a></div></div><div class="nav-item"><div><a href="./é«˜é¢‘.html" class="nav-link">ğŸ”¥é«˜é¢‘
    </a></div></div><div class="nav-item"><div><a href="./æŒ‡å—.html" class="nav-link">æŒ‡å—
    </a></div></div><div class="nav-item"><div><a href="./æ€§èƒ½.html" class="nav-link">æ€§èƒ½
    </a></div></div><div class="nav-item"><div><a href="./ç»¼åˆ.html" class="nav-link">ç»¼åˆ
    </a></div></div><div class="nav-item"><div><a href="./vue.html" class="nav-link">åŸç†
    </a></div></div><div class="nav-item"><div><a href="./æ‰‹å†™.html" class="nav-link">æ‰‹å†™
    </a></div></div><div class="nav-item"><div><a href="./è‡ªæ£€.html" class="nav-link">è‡ªæ£€
    </a></div></div><div class="nav-item"><div><a href="./é¢ç».html" class="nav-link">â­é¢ç»
    </a></div></div><div class="nav-item"><div><a href="./æ¯æ—¥ä¸€é¢˜.html" class="nav-link">ğŸ’¥æ¯æ—¥ä¸€é¢˜
    </a></div></div><div class="nav-item"><div><a href="./è®¾è®¡æ¨¡å¼.html" class="nav-link">è®¾è®¡æ¨¡å¼
  </a></div></div><div class="nav-item"><div><a href="http://interview.poetries.top/algorithm-interview/note/01-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E2%80%94%E2%80%94%E4%BB%8E0%E5%88%B01%E6%8E%8C%E6%8F%A1%E7%AE%97%E6%B3%95%E9%9D%A2%E8%AF%95%E9%9C%80%E8%A6%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%88%E4%B8%80%EF%BC%89.html" class="nav-link">
  </a></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æ‹“å±•é˜…è¯»" class="dropdown-title"><span class="title">æ‹“å±•é˜…è¯»</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display: none;"><li class="dropdown-item"><h4>ä¸“é¢˜</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-base-docs/compute-docs/Linux.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-mobile-docs/h5-docs/1-%E5%A4%A7%E5%8E%82%20H5%20%E5%BC%80%E5%8F%91%E6%A6%82%E8%BF%B0.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-css-inspiration-docs/css-docs/note/01-%E6%B5%8F%E8%A7%88%E5%99%A8.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-vue-docs/learn-vue-base/base/1-Vue%20CLI%203%20%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA%E5%9F%BA%E7%A1%80.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-react-docs/react-web-action/01-%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E7%9A%84%E5%9B%9B%E4%B8%AA%E6%97%B6%E4%BB%A3.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-micro-docs/docs/01-%E5%BE%AE%E5%89%8D%E7%AB%AF%E7%9A%84%E8%AF%9E%E7%94%9F.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-engineering-docs/docs/npm-script.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-nodejs-docs/nodejs-docs/base/01-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-ts-axios-docs/ts-axios/chapter1/" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-algorithm-docs/algorithm/prepare/01-%E5%A6%82%E4%BD%95%E7%B3%BB%E7%BB%9F%E9%AB%98%E6%95%88%E5%9C%B0%E5%AD%A6%E4%B9%A0%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="https://blog.poetries.top/browser-working-principle/guide/part1/lesson01.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
      æµè§ˆå™¨åŸç†
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li><li class="dropdown-subitem"><div><a href="https://blog.poetries.top/http-protocol/notes/base/01-HTTP%E7%9A%84%E5%89%8D%E4%B8%96%E4%BB%8A%E7%94%9F.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
      HTTPåŸºç¡€
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/docs/webpack.html" class="nav-link">webpack
  </a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/docs/npm-script.html" class="nav-link">npmå·¥ä½œæµ
  </a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/docs/canvas.html" class="nav-link">Canvas
  </a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/docs/Taro.html" class="nav-link">TaroåŸç†
  </a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-nodejs-docs/nodejs-docs/base/01-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
      Nodeå­¦ä¹ æŒ‡å—
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-vue-docs/vue-analysis/prepare/" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
      Vueæºç åˆ†æ
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li></ul></li><li class="dropdown-item"><h4>å…¶ä»–</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-blog-docs/blog-docs/javascript/-Ajax%E6%80%BB%E7%BB%93%E7%AF%87.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
      æ—¥å¸¸ç§¯ç´¯
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li><li class="dropdown-subitem"><div><a href="http://blog.poetries.top/archives/" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
      åšæ–‡
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="background: rgb(255, 255, 255);"><nav class="nav-links"><div class="nav-item"><div><a href="http://interview.poetries.top/docs/base.html" class="nav-link">åŸºç¡€
  </a></div></div><div class="nav-item"><div><a href="http://interview.poetries.top/docs/simply.html" class="nav-link">âœ¨è¿›é˜¶
  </a></div></div><div class="nav-item"><div><a href="http://interview.poetries.top/excellent-docs/1-HTML%E6%A8%A1%E5%9D%97.html" class="nav-link">ğŸ‘ç²¾é€‰
  </a></div></div><div class="nav-item"><div><a href="http://interview.poetries.top/docs/excellent.html" class="nav-link">ğŸ”¥é«˜é¢‘
  </a></div></div><div class="nav-item"><div><a href="http://interview.poetries.top/docs/guide.html" class="nav-link">æŒ‡å—
  </a></div></div><div class="nav-item"><div><a href="http://interview.poetries.top/docs/performance.html" class="nav-link">æ€§èƒ½
  </a></div></div><div class="nav-item"><div><a href="http://interview.poetries.top/docs/detail-expain.html" class="nav-link">ç»¼åˆ
  </a></div></div><div class="nav-item"><div><a href="http://interview.poetries.top/principle-docs/comprehensive/01-%E8%99%9A%E6%8B%9FDOM%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90.html" class="nav-link">åŸç†
  </a></div></div><div class="nav-item"><div><a href="http://interview.poetries.top/docs/handwritten.html" class="nav-link">æ‰‹å†™
  </a></div></div><div class="nav-item"><div><a href="http://interview.poetries.top/qa/1-%E5%89%8D%E7%AB%AF100%E9%A2%98%E8%87%AA%E6%A3%80.html" class="nav-link">è‡ªæ£€
  </a></div></div><div class="nav-item"><div><a href="http://interview.poetries.top/interview-exp/%E5%89%8D%E7%AB%AF%E9%9D%A2%E7%BB%8F%E6%B1%87%E6%80%BB.html" class="nav-link">â­é¢ç»
  </a></div></div><div class="nav-item"><div><a href="http://interview.poetries.top/days/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98.html" class="nav-link">ğŸ’¥æ¯æ—¥ä¸€é¢˜
  </a></div></div><div class="nav-item"><div><a href="http://interview.poetries.top/docs/design-pattern.html" class="nav-link">è®¾è®¡æ¨¡å¼
  </a></div></div><div class="nav-item"><div><a href="http://interview.poetries.top/algorithm-interview/note/01-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E2%80%94%E2%80%94%E4%BB%8E0%E5%88%B01%E6%8E%8C%E6%8F%A1%E7%AE%97%E6%B3%95%E9%9D%A2%E8%AF%95%E9%9C%80%E8%A6%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%88%E4%B8%80%EF%BC%89.html" class="nav-link">
  </a></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æ‹“å±•é˜…è¯»" class="dropdown-title"><span class="title">æ‹“å±•é˜…è¯»</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display: none;"><li class="dropdown-item"><h4>ä¸“é¢˜</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-base-docs/compute-docs/Linux.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-mobile-docs/h5-docs/1-%E5%A4%A7%E5%8E%82%20H5%20%E5%BC%80%E5%8F%91%E6%A6%82%E8%BF%B0.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-css-inspiration-docs/css-docs/note/01-%E6%B5%8F%E8%A7%88%E5%99%A8.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-vue-docs/learn-vue-base/base/1-Vue%20CLI%203%20%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA%E5%9F%BA%E7%A1%80.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-react-docs/react-web-action/01-%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E7%9A%84%E5%9B%9B%E4%B8%AA%E6%97%B6%E4%BB%A3.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-micro-docs/docs/01-%E5%BE%AE%E5%89%8D%E7%AB%AF%E7%9A%84%E8%AF%9E%E7%94%9F.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-engineering-docs/docs/npm-script.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-nodejs-docs/nodejs-docs/base/01-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-ts-axios-docs/ts-axios/chapter1/" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-algorithm-docs/algorithm/prepare/01-%E5%A6%82%E4%BD%95%E7%B3%BB%E7%BB%9F%E9%AB%98%E6%95%88%E5%9C%B0%E5%AD%A6%E4%B9%A0%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----></a></div></li><li class="dropdown-subitem"><div><a href="https://blog.poetries.top/browser-working-principle/guide/part1/lesson01.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
      æµè§ˆå™¨åŸç†
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li><li class="dropdown-subitem"><div><a href="https://blog.poetries.top/http-protocol/notes/base/01-HTTP%E7%9A%84%E5%89%8D%E4%B8%96%E4%BB%8A%E7%94%9F.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
      HTTPåŸºç¡€
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/docs/webpack.html" class="nav-link">webpack
  </a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/docs/npm-script.html" class="nav-link">npmå·¥ä½œæµ
  </a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/docs/canvas.html" class="nav-link">Canvas
  </a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/docs/Taro.html" class="nav-link">TaroåŸç†
  </a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-nodejs-docs/nodejs-docs/base/01-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
      Nodeå­¦ä¹ æŒ‡å—
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-vue-docs/vue-analysis/prepare/" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
      Vueæºç åˆ†æ
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li></ul></li><li class="dropdown-item"><h4>å…¶ä»–</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><div><a href="http://interview.poetries.top/fe-blog-docs/blog-docs/javascript/-Ajax%E6%80%BB%E7%BB%93%E7%AF%87.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
      æ—¥å¸¸ç§¯ç´¯
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li><li class="dropdown-subitem"><div><a href="http://blog.poetries.top/archives/" target="_blank" rel="noopener noreferrer" class="nav-link external"><div>
      åšæ–‡
      <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></a></div></li></ul></li></ul></div></div> <!----></nav> <div style="padding-left:1.5rem;"><div class="qr"><img src="./è™šæ‹ŸdomåŸç†_files/qr.ee193d28.jpg" alt="poetries" width="120" height="120" loading="lazy"> <p class="we-intro">
    å…³æ³¨å…¬ä¼—å·ï¼Œè·å–æ›´å¤šèµ„è®¯
  </p></div></div> 
  <ul class="sidebar-links"><li><section class="sidebar-group depth-0">
    <p class="sidebar-heading"><span>Vue</span> <!----></p> 
    <ul class="sidebar-links sidebar-group-items"><li>
      <a href="./vue.html" class="sidebar-link">ä»æºç è§£è¯»Vueç”Ÿå‘½å‘¨æœŸ</a></li>
      <li><a href="./ç»„ä»¶çš„æœ¬è´¨.html" class="sidebar-link">ç»„ä»¶çš„æœ¬è´¨</a></li>
      <li><a href="./ç»„ä»¶è®¾è®¡.html" class="sidebar-link">æœ‰çŠ¶æ€ç»„ä»¶çš„è®¾è®¡</a></li>
      <li><a href="./è®¾è®¡vnode.html" class="sidebar-link">è®¾è®¡ VNode</a></li>
      <li><a href="./vnodeçš„hå‡½æ•°.html" class="sidebar-link">è¾…åŠ©åˆ›å»º VNode çš„ h å‡½æ•°</a></li>
      <li><a href="./è‡ªå®šä¹‰æ¸²æŸ“.html" class="sidebar-link">è‡ªå®šä¹‰æ¸²æŸ“å™¨å’Œå¼‚æ­¥æ¸²æŸ“</a></li>
      <li><a href="./æ¸²æŸ“å™¨çš„æŒ‚è½½.html" class="sidebar-link">æ¸²æŸ“å™¨ä¹‹æŒ‚è½½</a></li>
      <li><a href="./æ¸²æŸ“diff.html" class="sidebar-link">æ¸²æŸ“å™¨çš„æ ¸å¿ƒ Diff ç®—æ³•</a></li>
      <li><a href="./æ¸²æŸ“å™¨patch.html" class="sidebar-link">æ¸²æŸ“å™¨ä¹‹patch</a></li>
      <li><a href="./vueå“åº”å¼.html" class="sidebar-link">å›¾è§£ Vue å“åº”å¼åŸç†</a></li>
      <li><a href="./vueå¼‚æ­¥æ›´æ–°.html" class="sidebar-link">å›¾è§£ Vue å¼‚æ­¥æ›´æ–°</a></li>
      <li><a href="./vueè¿è¡Œæœºåˆ¶.html" class="sidebar-link">å‰–æ Vue å†…éƒ¨è¿è¡Œæœºåˆ¶</a></li>
      <li><a href="./æ¨¡æ‹Ÿå“åº”å¼.html" class="sidebar-link">vueå“åº”å¼åŸç†æ¨¡æ‹Ÿ</a></li>
      <li><a href="./vuex.html" class="sidebar-link">vueçŠ¶æ€ç®¡ç†ä¹‹vuex</a></li>
    </ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>React</span> <!----></p> 
      <ul class="sidebar-links sidebar-group-items">
        <li><a href="./react.html" class="sidebar-link">React</a></li>
        <li><a href="./dva.html" class="sidebar-link">Dvaæ€»ç»“</a></li>
        <li><a href="./MobX.html" class="sidebar-link">MobXæ€»ç»“</a></li>
        <li><a href="./redux.html" class="sidebar-link">æµ…æredux</a></li>
        <li><a href="./reduxä¸­é—´ä»¶.html" class="sidebar-link">Reduxä¹‹æµ…æä¸­é—´ä»¶</a></li>
        <li><a href="./reduxæºç .html" class="sidebar-link">Reduxä¹‹æºç åˆ†æ</a></li>
        <li><a href="./reduxå¼‚æ­¥action.html" class="sidebar-link">Reduxä¹‹å¼‚æ­¥ActionåŠæ“ä½œ</a></li>
      </ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Webpack</span> <!----></p> 
        <ul class="sidebar-links sidebar-group-items">
          <li><a href="./webpackæ‰“åŒ…åŸç†.html" class="sidebar-link">Webpack4æ‰“åŒ…æœºåˆ¶åŸç†è§£æ</a></li>
          <li><a href="./çƒ­æ›´æ–°.html" class="sidebar-link">webpackä¸­çš„HMRçƒ­æ›´æ–°åŸç†å‰–æ</a></li>
          <li><a href="./webpack4åŸç†.html" class="sidebar-link">ä»æºç çª¥æ¢Webpack4.xåŸç†</a></li>
          <li><a href="./å®ç°webpackæ‰“åŒ….html" class="sidebar-link">å®ç°webpackå°å‹æ‰“åŒ…å·¥å…·</a></li>
          <li><a href="./babelåŸç†.html" class="sidebar-link">BabelåŸç†åŠå…¶ä½¿ç”¨</a></li>
        </ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>ç»¼åˆ</span> <!----></p>
           <ul class="sidebar-links sidebar-group-items">
             <li><a href="./è™šæ‹ŸdomåŸç†.html" class="active sidebar-link">è™šæ‹ŸDOMåŸç†åˆ†æ</a></li>
             <li><a href="./settimeoutæŒ‡å—.html" class="active sidebar-link">setTimeout</a></li>
             <li class="sidebar-sub-header"><a href="./promise.html" class="sidebar-link">æµ…æPromiseåŸç†</a></li>
        <a href="./æµè§ˆå™¨å¦‚ä½•æ¸²æŸ“.html" class="sidebar-link">æµè§ˆå™¨æ¸²æŸ“åŸç†</a></li>
        <li><a href="./mvvm.html" class="sidebar-link">å‰ç«¯é¢è¯•ä¹‹MVVMæµ…æ</a></li>
        <li><a href="./ç»„ä»¶åŒ–.html" class="sidebar-link">å‰ç«¯é¢è¯•ä¹‹ç»„ä»¶åŒ–</a></li>
        <li><a href="./è™šæ‹Ÿdom1.html" class="sidebar-link">è™šæ‹ŸDOMï¼ˆä¸€ï¼‰</a></li>
        <li><a href="./è™šæ‹Ÿdom2.html" class="sidebar-link">è™šæ‹ŸDOMï¼ˆäºŒï¼‰</a></li>
        <li><a href="./performance.html" class="sidebar-link">å‰ç«¯æ€§èƒ½ä¹‹Performance</a></li>
      </ul></section></li></ul> 
</aside> <main class="page"> <div id="container" class="theme-default-content pay-content"><div class="content__default"><h2 id="ä»€ä¹ˆæ˜¯-virtual-dom"><a href="http://interview.poetries.top/principle-docs/comprehensive/01-%E8%99%9A%E6%8B%9FDOM%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90.html#%E4%BB%80%E4%B9%88%E6%98%AF-virtual-dom" class="header-anchor">#</a> ä»€ä¹ˆæ˜¯ Virtual DOM</h2> <ol><li><code>Virtual DOM</code>(è™šæ‹Ÿ DOM)ï¼Œæ˜¯ç”±æ™®é€šçš„ <code>JS</code> å¯¹è±¡æ¥æè¿° <code>DOM</code> å¯¹è±¡ï¼Œå› ä¸ºä¸æ˜¯çœŸå®çš„ <code>DOM</code> å¯¹è±¡ï¼Œæ‰€ä»¥å« <code>Virtual DOM</code></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span> 
<span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> element<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  s <span class="token operator">+=</span> key <span class="token operator">+</span> <span class="token string">','</span> 
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>

<span class="token comment">// æ‰“å°ç»“æœ align,title,lang,translate,dir,hidden,accessKey,draggable,spellcheck,aut ocapitalize,contentEditable,isContentEditable,inputMode,offsetParent,off setTop,offsetLeft,offsetWidth,offsetHeight,style,innerText,outerText,onc opy,oncut,onpaste,onabort,onblur,oncancel,oncanplay,oncanplaythrough,onc hange,onclick,onclose,oncontextmenu,oncuechange,ondblclick,ondrag,ondrag end,ondragenter,ondragleave,ondragover,ondragstart,ondrop,ondurationchan ge,onemptied,onended,onerror,onfocus,oninput,oninvalid,onkeydown,onkeypr ess,onkeyup,onload,onloadeddata,onloadedmetadata,onloadstart,onmousedown ,onmouseenter,onmouseleave,onmousemove,onmouseout,onmouseover,onmouseup, onmousewheel,onpause,onplay,onplaying,onprogress,onratechange,onreset,on resize,onscroll,onseeked,onseeking,onselect,onstalled,onsubmit,onsuspend ,ontimeupdate,ontoggle,onvolumechange,onwaiting,onwheel,onauxclick,ongot pointercapture,onlostpointercapture,onpointerdown,onpointermove,onpointe rup,onpointercancel,onpointerover,onpointerout,onpointerenter,onpointerl eave,onselectstart,onselectionchange,onanimationend,onanimationiteration ,onanimationstart,ontransitionend,dataset,nonce,autofocus,tabIndex,click ,focus,blur,enterKeyHint,onformdata,onpointerrawupdate,attachInternals,n amespaceURI,prefix,localName,tagName,id,className,classList,slot,part,at tributes,shadowRoot,assignedSlot,innerHTML,outerHTML,scrollTop,scrollLef t,scrollWidth,scrollHeight,clientTop,clientLeft,clientWidth,clientHeight ,attributeStyleMap,onbeforecopy,onbeforecut,onbeforepaste,onsearch,eleme ntTiming,previousElementSibling,nextElementSibling,children,firstElement Child,lastElementChild,childElementCount,onfullscreenchange,onfullscreen error,onwebkitfullscreenchange,onwebkitfullscreenerror,setPointerCapture ,releasePointerCapture,hasPointerCapture,hasAttributes,getAttributeNames ,getAttribute,getAttributeNS,setAttribute,setAttributeNS,removeAttribute ,removeAttributeNS,hasAttribute,hasAttributeNS,toggleAttribute,getAttrib uteNode,getAttributeNodeNS,setAttributeNode,setAttributeNodeNS,removeAtt ributeNode,closest,matches,webkitMatchesSelector,attachShadow,getElement sByTagName,getElementsByTagNameNS,getElementsByClassName,insertAdjacentE lement,insertAdjacentText,insertAdjacentHTML,requestPointerLock,getClien tRects,getBoundingClientRect,scrollIntoView,scroll,scrollTo,scrollBy,scr ollIntoViewIfNeeded,animate,computedStyleMap,before,after,replaceWith,re move,prepend,append,querySelector,querySelectorAll,requestFullscreen,web kitRequestFullScreen,webkitRequestFullscreen,createShadowRoot,getDestina tionInsertionPoints,ELEMENT_NODE,ATTRIBUTE_NODE,TEXT_NODE,CDATA_SECTION_ NODE,ENTITY_REFERENCE_NODE,ENTITY_NODE,PROCESSING_INSTRUCTION_NODE,COMME NT_NODE,DOCUMENT_NODE,DOCUMENT_TYPE_NODE,DOCUMENT_FRAGMENT_NODE,NOTATION _NODE,DOCUMENT_POSITION_DISCONNECTED,DOCUMENT_POSITION_PRECEDING,DOCUMEN T_POSITION_FOLLOWING,DOCUMENT_POSITION_CONTAINS,DOCUMENT_POSITION_CONTAI NED_BY,DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC,nodeType,nodeName,baseU RI,isConnected,ownerDocument,parentNode,parentElement,childNodes,firstCh ild,lastChild,previousSibling,nextSibling,nodeValue,textContent,hasChild Nodes,getRootNode,normalize,cloneNode,isEqualNode,isSameNode,compareDocu mentPosition,contains,lookupPrefix,lookupNamespaceURI,isDefaultNamespace ,insertBefore,appendChild,replaceChild,removeChild,addEventListener,remo veEventListener,dispatchEvent</span>
</code></pre></div><ol start="2"><li>å¯ä»¥ä½¿ç”¨ <code>Virtual DOM</code> æ¥æè¿°çœŸå® <code>DOM</code></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  sel<span class="token operator">:</span> <span class="token string">"div"</span><span class="token punctuation">,</span>
  data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  children<span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
  text<span class="token operator">:</span> <span class="token string">"Hello Virtual DOM"</span><span class="token punctuation">,</span>
  elm<span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
  key<span class="token operator">:</span> <span class="token keyword">undefined</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="ä¸ºä»€ä¹ˆä½¿ç”¨-virtual-dom"><a href="http://interview.poetries.top/principle-docs/comprehensive/01-%E8%99%9A%E6%8B%9FDOM%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90.html#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8-virtual-dom" class="header-anchor">#</a> ä¸ºä»€ä¹ˆä½¿ç”¨ Virtual DOM</h2> <ul><li>æ‰‹åŠ¨æ“ä½œ <code>DOM</code> æ¯”è¾ƒéº»çƒ¦ï¼Œè¿˜éœ€è¦è€ƒè™‘æµè§ˆå™¨å…¼å®¹æ€§é—®é¢˜ï¼Œè™½ç„¶æœ‰ <code>jQuery</code> ç­‰åº“ç®€åŒ– <code>DOM</code> æ“ä½œï¼Œä½†æ˜¯éšç€é¡¹ç›®çš„å¤æ‚ DOM æ“ä½œå¤æ‚æå‡</li> <li>ä¸ºäº†ç®€åŒ– <code>DOM</code> çš„å¤æ‚æ“ä½œäºæ˜¯å‡ºç°äº†å„ç§ <code>MVVM</code> æ¡†æ¶ï¼Œ<code>MVVM</code> æ¡†æ¶è§£å†³äº†è§†å›¾å’ŒçŠ¶æ€çš„åŒæ­¥é—®é¢˜</li> <li>ä¸ºäº†ç®€åŒ–è§†å›¾çš„æ“ä½œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¨¡æ¿å¼•æ“ï¼Œä½†æ˜¯æ¨¡æ¿å¼•æ“æ²¡æœ‰è§£å†³è·Ÿè¸ªçŠ¶æ€å˜åŒ–çš„é—®é¢˜ï¼Œäºæ˜¯<code>Virtual DOM</code> å‡ºç°äº†</li> <li><code>Virtual DOM</code> çš„å¥½å¤„æ˜¯å½“çŠ¶æ€æ”¹å˜æ—¶ä¸éœ€è¦ç«‹å³æ›´æ–° DOMï¼Œåªéœ€è¦åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæ ‘æ¥æè¿°<code>DOM</code>ï¼Œ<code>Virtual DOM</code> å†…éƒ¨å°†å¼„æ¸…æ¥šå¦‚ä½•æœ‰æ•ˆ(<code>diff</code>)çš„æ›´æ–° <code>DOM</code></li> <li>è™šæ‹Ÿ <code>DOM</code> å¯ä»¥ç»´æŠ¤ç¨‹åºçš„çŠ¶æ€ï¼Œè·Ÿè¸ªä¸Šä¸€æ¬¡çš„çŠ¶æ€</li> <li>é€šè¿‡æ¯”è¾ƒå‰åä¸¤æ¬¡çŠ¶æ€çš„å·®å¼‚æ›´æ–°çœŸå® <code>DOM</code></li></ul> <h2 id="è™šæ‹Ÿ-dom-çš„ä½œç”¨"><a href="http://interview.poetries.top/principle-docs/comprehensive/01-%E8%99%9A%E6%8B%9FDOM%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90.html#%E8%99%9A%E6%8B%9F-dom-%E7%9A%84%E4%BD%9C%E7%94%A8" class="header-anchor">#</a> è™šæ‹Ÿ DOM çš„ä½œç”¨</h2> <ul><li>ç»´æŠ¤è§†å›¾å’ŒçŠ¶æ€çš„å…³ç³»</li> <li>å¤æ‚è§†å›¾æƒ…å†µä¸‹æå‡æ¸²æŸ“æ€§èƒ½</li> <li>é™¤äº†æ¸²æŸ“ <code>DOM</code> ä»¥å¤–ï¼Œè¿˜å¯ä»¥å®ç° <code>SSR(Nuxt.js/Next.js)</code>ã€åŸç”Ÿåº”ç”¨(<code>Weex/React Native</code>)ã€å°ç¨‹åº(<code>mpvue/uni-app</code>)ç­‰</li></ul> <p><img src="./è™šæ‹ŸdomåŸç†_files/20210328112610.png" alt="" class="medium-zoom-image"></p> <h2 id="virtual-dom-åº“"><a href="http://interview.poetries.top/principle-docs/comprehensive/01-%E8%99%9A%E6%8B%9FDOM%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90.html#virtual-dom-%E5%BA%93" class="header-anchor">#</a> Virtual DOM åº“</h2> <ul><li><a href="https://github.com/snabbdom/snabbdom" target="_blank" rel="noopener noreferrer">Snabbdom<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <ul><li><code>Vue 2.x</code> å†…éƒ¨ä½¿ç”¨çš„ <code>Virtual DOM</code> å°±æ˜¯æ”¹é€ çš„ <code>Snabbdom</code></li> <li>é€šè¿‡æ¨¡å—å¯æ‰©å±•</li> <li>æºç ä½¿ç”¨ <code>TypeScript</code> å¼€å‘</li> <li>æœ€å¿«çš„ <code>Virtual DOM</code> ä¹‹ä¸€</li></ul></li> <li><a href="https://github.com/Matt-Esch/virtual-dom" target="_blank" rel="noopener noreferrer">virtual-dom<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="snabbdom-åŸºæœ¬ä½¿ç”¨"><a href="http://interview.poetries.top/principle-docs/comprehensive/01-%E8%99%9A%E6%8B%9FDOM%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90.html#snabbdom-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8" class="header-anchor">#</a> Snabbdom åŸºæœ¬ä½¿ç”¨</h2> <h3 id="åˆ›å»ºé¡¹ç›®"><a href="http://interview.poetries.top/principle-docs/comprehensive/01-%E8%99%9A%E6%8B%9FDOM%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90.html#%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE" class="header-anchor">#</a> åˆ›å»ºé¡¹ç›®</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># åˆ›å»ºé¡¹ç›®ç›®å½•</span>
md snabbdom-demo
<span class="token comment"># è¿›å…¥é¡¹ç›®ç›®å½•</span>
<span class="token builtin class-name">cd</span> snabbdom-demo
<span class="token comment"># åˆ›å»º package.json yarn init -y</span>
<span class="token comment"># æœ¬åœ°å®‰è£… parcel</span>
<span class="token function">yarn</span> <span class="token function">add</span> parcel-bundler
</code></pre></div><p>é…ç½® <code>package.json</code> çš„ <code>scripts</code></p> <div class="language- extra-class"><pre class="language-text"><code>"scripts": {
"dev": "parcel index.html --open", "build": "parcel build index.html"
}
</code></pre></div><p>åˆ›å»ºç›®å½•ç»“æ„</p> <p><img src="./è™šæ‹ŸdomåŸç†_files/20210328123653.png" alt="" class="medium-zoom-image"></p> <div class="language- extra-class"><pre class="language-text"><code>yarn add snabbdom
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>import{init,h,thunk}from'snabbdom'
</code></pre></div><blockquote><p><code>snabbdom</code> çš„æ ¸å¿ƒä»…æä¾›æœ€åŸºæœ¬çš„åŠŸèƒ½ï¼Œåªå¯¼å‡ºäº†ä¸‰ä¸ªå‡½æ•° <code>init()</code>ã€<code>h()</code>ã€<code>thunk()</code></p></blockquote> <ul><li><code>init()</code> æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼Œè¿”å› <code>patch()</code></li> <li><code>h()</code> è¿”å›è™šæ‹ŸèŠ‚ç‚¹ <code>VNode</code>ï¼Œè¿™ä¸ªå‡½æ•°æˆ‘ä»¬åœ¨ä½¿ç”¨ <code>Vue.js</code> çš„æ—¶å€™è§è¿‡</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  router<span class="token punctuation">,</span>
  store<span class="token punctuation">,</span>
  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token parameter">h</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
</code></pre></div><ul><li><code>thunk()</code> æ˜¯ä¸€ç§ä¼˜åŒ–ç­–ç•¥ï¼Œå¯ä»¥åœ¨å¤„ç†ä¸å¯å˜æ•°æ®æ—¶ä½¿ç”¨</li></ul> <blockquote><p>æ³¨æ„:å¯¼å…¥æ—¶å€™ä¸èƒ½ä½¿ç”¨ <code>import snabbdom from 'snabbdom'</code>ã€‚åŸå› :<code>node_modules/src/snabbdom.ts</code> æœ«å°¾å¯¼å‡ºä½¿ç”¨çš„è¯­æ³•æ˜¯ <code>export</code> å¯¼å‡º <code>API</code>ï¼Œæ²¡æœ‰ä½¿ç”¨ <code>export default</code> å¯¼å‡ºé»˜è®¤è¾“å‡º</p></blockquote> <p><img src="./è™šæ‹ŸdomåŸç†_files/20210328124133.png" alt="" class="medium-zoom-image"></p> <h3 id="åŸºæœ¬ä½¿ç”¨"><a href="http://interview.poetries.top/principle-docs/comprehensive/01-%E8%99%9A%E6%8B%9FDOM%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90.html#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8" class="header-anchor">#</a> åŸºæœ¬ä½¿ç”¨</h3> <p><strong>ä¾‹å­1</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> h<span class="token punctuation">,</span> init <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'snabbdom'</span>

<span class="token comment">// 1. hello world</span>
<span class="token comment">// å‚æ•°ï¼šæ•°ç»„ï¼Œæ¨¡å—</span>
<span class="token comment">// è¿”å›å€¼ï¼špatchå‡½æ•°ï¼Œä½œç”¨å¯¹æ¯”ä¸¤ä¸ªvnodeçš„å·®å¼‚æ›´æ–°åˆ°çœŸå®DOM</span>
<span class="token keyword">let</span> patch <span class="token operator">=</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">// ç¬¬ä¸€ä¸ªå‚æ•°ï¼šæ ‡ç­¾+é€‰æ‹©å™¨</span>
<span class="token comment">// ç¬¬äºŒä¸ªå‚æ•°ï¼šå¦‚æœæ˜¯å­—ç¬¦ä¸²çš„è¯å°±æ˜¯æ ‡ç­¾ä¸­çš„å†…å®¹</span>
<span class="token keyword">let</span> vnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div#container.cls'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> 
  hook<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">init</span> <span class="token punctuation">(</span><span class="token parameter">vnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>elm<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">create</span> <span class="token punctuation">(</span><span class="token parameter">emptyVnode<span class="token punctuation">,</span> vnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>elm<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'Hello World'</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> app <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
<span class="token comment">// ç¬¬ä¸€ä¸ªå‚æ•°ï¼šå¯ä»¥æ˜¯DOMå…ƒç´ ï¼Œå†…éƒ¨ä¼šæŠŠDOMå…ƒç´ è½¬æ¢æˆVNode</span>
<span class="token comment">// ç¬¬äºŒä¸ªå‚æ•°ï¼šVNode</span>
<span class="token comment">// è¿”å›å€¼ï¼šVNde</span>
<span class="token keyword">let</span> oldVnode <span class="token operator">=</span> <span class="token function">patch</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>

<span class="token comment">// å‡è®¾çš„æ—¶åˆ»</span>
vnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token string">'Hello Snabbdom'</span><span class="token punctuation">)</span>

<span class="token function">patch</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>
</code></pre></div><p><strong>ä¾‹å­2</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 2. divä¸­æ”¾ç½®å­å…ƒç´  h1,p</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> h<span class="token punctuation">,</span> init <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'snabbdom'</span>

<span class="token keyword">let</span> patch <span class="token operator">=</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> vnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div#container'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'h1'</span><span class="token punctuation">,</span> <span class="token string">'Hello Snabbdom'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token string">'è¿™æ˜¯ä¸€ä¸ªpæ ‡ç­¾'</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> app <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> oldVnode <span class="token operator">=</span> <span class="token function">patch</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  vnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div#container'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'h1'</span><span class="token punctuation">,</span> <span class="token string">'Hello World'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token string">'Hello P'</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token function">patch</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>

  <span class="token comment">// æ¸…ç©ºé¡µé¢å…ƒç´  -- é”™è¯¯</span>
  <span class="token comment">// patch(oldVnode, null)</span>
  <span class="token function">patch</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'!'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>ä¾‹å­3 debug-patchVnode</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> h<span class="token punctuation">,</span> init <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'snabbdom'</span>

<span class="token keyword">let</span> patch <span class="token operator">=</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// é¦–æ¬¡æ¸²æŸ“</span>
<span class="token keyword">let</span> vnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token string">'Hello World'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> app <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> oldVnode <span class="token operator">=</span> <span class="token function">patch</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>

<span class="token comment">// patchVnode çš„æ‰§è¡Œè¿‡ç¨‹</span>
vnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token string">'Hello Snabbdom'</span><span class="token punctuation">)</span>
<span class="token function">patch</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>
</code></pre></div><p><strong>ä¾‹å­4 debug-updateChildren</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> h<span class="token punctuation">,</span> init <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'snabbdom'</span>

<span class="token keyword">let</span> patch <span class="token operator">=</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// é¦–æ¬¡æ¸²æŸ“</span>
<span class="token keyword">let</span> vnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token string">'é¦–é¡µ'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token string">'è§†é¢‘'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token string">'å¾®åš'</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> app <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> oldVnode <span class="token operator">=</span> <span class="token function">patch</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>

<span class="token comment">// updateChildren çš„æ‰§è¡Œè¿‡ç¨‹</span>
vnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token string">'é¦–é¡µ'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token string">'å¾®åš'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token string">'è§†é¢‘'</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token function">patch</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>
</code></pre></div><p><strong>ä¾‹å­5 debug-updateChildren-key</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> h<span class="token punctuation">,</span> init <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'snabbdom'</span>

<span class="token keyword">let</span> patch <span class="token operator">=</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// é¦–æ¬¡æ¸²æŸ“</span>
<span class="token keyword">let</span> vnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token string">'a'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'é¦–é¡µ'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token string">'b'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'è§†é¢‘'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token string">'c'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'å¾®åš'</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> app <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> oldVnode <span class="token operator">=</span> <span class="token function">patch</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>

<span class="token comment">// updateChildren çš„æ‰§è¡Œè¿‡ç¨‹</span>
vnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token string">'a'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'é¦–é¡µ'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token string">'c'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'å¾®åš'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token string">'b'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'è§†é¢‘'</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token function">patch</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>
</code></pre></div><h3 id="æ¨¡å—"><a href="http://interview.poetries.top/principle-docs/comprehensive/01-%E8%99%9A%E6%8B%9FDOM%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90.html#%E6%A8%A1%E5%9D%97" class="header-anchor">#</a> æ¨¡å—</h3> <blockquote><p><code>Snabbdom</code> çš„æ ¸å¿ƒåº“å¹¶ä¸èƒ½å¤„ç†å…ƒç´ çš„<code>å±æ€§/æ ·å¼/äº‹ä»¶</code>ç­‰ï¼Œå¦‚æœéœ€è¦å¤„ç†çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨æ¨¡å—</p></blockquote> <p><strong>å¸¸ç”¨æ¨¡å—</strong></p> <p>å®˜æ–¹æä¾›äº† 6 ä¸ªæ¨¡å—</p> <ul><li><code>attributes</code> <ul><li>è®¾ç½® <code>DOM</code> å…ƒç´ çš„å±æ€§ï¼Œä½¿ç”¨ <code>setAttribute ()</code></li> <li>å¤„ç†å¸ƒå°”ç±»å‹çš„å±æ€§</li></ul></li> <li><code>props</code> <ul><li>å’Œ <code>attributes</code> æ¨¡å—ç›¸ä¼¼ï¼Œè®¾ç½® <code>DOM</code> å…ƒç´ çš„å±æ€§ <code>element[attr] = value</code></li> <li>ä¸å¤„ç†å¸ƒå°”ç±»å‹çš„å±æ€§</li></ul></li> <li><code>class</code> <ul><li>åˆ‡æ¢ç±»æ ·å¼</li> <li>æ³¨æ„:ç»™å…ƒç´ è®¾ç½®ç±»æ ·å¼æ˜¯é€šè¿‡ <code>sel</code> é€‰æ‹©å™¨</li></ul></li> <li><code>dataset</code> <ul><li>è®¾ç½® <code>data-*</code> çš„è‡ªå®šä¹‰å±æ€§ <code>eventlisteners</code></li> <li>æ³¨å†Œå’Œç§»é™¤äº‹ä»¶</li></ul></li> <li><code>style</code> <ul><li>è®¾ç½®è¡Œå†…æ ·å¼ï¼Œæ”¯æŒåŠ¨ç”»</li> <li><code>delayed/remove/destroy</code></li></ul></li></ul> <p><strong>æ¨¡å—ä½¿ç”¨</strong></p> <blockquote><p>æ¨¡å—ä½¿ç”¨æ­¥éª¤:</p></blockquote> <ul><li>å¯¼å…¥éœ€è¦çš„æ¨¡å—</li> <li><code>init()</code> ä¸­æ³¨å†Œæ¨¡å—</li> <li>ä½¿ç”¨ <code>h()</code> å‡½æ•°åˆ›å»º <code>VNode</code> çš„æ—¶å€™ï¼Œå¯ä»¥æŠŠç¬¬äºŒä¸ªå‚æ•°è®¾ç½®ä¸ºå¯¹è±¡ï¼Œå…¶ä»–å‚æ•°å¾€åç§»</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> init<span class="token punctuation">,</span> h <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'snabbdom'</span>
<span class="token comment">// 1. å¯¼å…¥æ¨¡å—</span>
<span class="token keyword">import</span> style <span class="token keyword">from</span> <span class="token string">'snabbdom/modules/style'</span>
<span class="token keyword">import</span> eventlisteners <span class="token keyword">from</span> <span class="token string">'snabbdom/modules/eventlisteners'</span>
<span class="token comment">// 2. æ³¨å†Œæ¨¡å—</span>
<span class="token keyword">let</span> patch <span class="token operator">=</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  style<span class="token punctuation">,</span>
  eventlisteners
<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">// 3. ä½¿ç”¨ h() å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥æ¨¡å—éœ€è¦çš„æ•°æ®ï¼ˆå¯¹è±¡ï¼‰</span>
<span class="token keyword">let</span> vnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  style<span class="token operator">:</span> <span class="token punctuation">{</span>
    backgroundColor<span class="token operator">:</span> <span class="token string">'red'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  on<span class="token operator">:</span> <span class="token punctuation">{</span>
    click<span class="token operator">:</span> eventHandler
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'h1'</span><span class="token punctuation">,</span> <span class="token string">'Hello Snabbdom'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token string">'è¿™æ˜¯pæ ‡ç­¾'</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">eventHandler</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ç‚¹å‡»æˆ‘äº†'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> app <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> oldVnode <span class="token operator">=</span> <span class="token function">patch</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>


vnode <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token string">'hello'</span><span class="token punctuation">)</span>
<span class="token function">patch</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>
</code></pre></div><h2 id="snabbdom-æºç è§£æ"><a href="http://interview.poetries.top/principle-docs/comprehensive/01-%E8%99%9A%E6%8B%9FDOM%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90.html#snabbdom-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90" class="header-anchor">#</a> Snabbdom æºç è§£æ</h2> <h3 id="snabbdom-çš„æ ¸å¿ƒ"><a href="http://interview.poetries.top/principle-docs/comprehensive/01-%E8%99%9A%E6%8B%9FDOM%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90.html#snabbdom-%E7%9A%84%E6%A0%B8%E5%BF%83" class="header-anchor">#</a> Snabbdom çš„æ ¸å¿ƒ</h3> <ul><li>ä½¿ç”¨ <code>h()</code> å‡½æ•°åˆ›å»º JavaScript å¯¹è±¡(<code>VNode</code>)æè¿°çœŸå® DOM</li> <li><code>init()</code> è®¾ç½®æ¨¡å—ï¼Œåˆ›å»º <code>patch()</code></li> <li><code>patch()</code> æ¯”è¾ƒæ–°æ—§ä¸¤ä¸ª <code>VNode</code></li> <li>æŠŠå˜åŒ–çš„å†…å®¹æ›´æ–°åˆ°çœŸå® <code>DOM</code> æ ‘ä¸Š</li></ul> <p><strong>Snabbdom æºç </strong></p> <blockquote><p>æºç åœ°å€: https://github.com/snabbdom/snabbdom</p></blockquote> <p>src ç›®å½•ç»“æ„</p> <p><img src="./è™šæ‹ŸdomåŸç†_files/20210328125857.png" alt="" class="medium-zoom-image"></p> <h3 id="h-å‡½æ•°"><a href="http://interview.poetries.top/principle-docs/comprehensive/01-%E8%99%9A%E6%8B%9FDOM%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90.html#h-%E5%87%BD%E6%95%B0" class="header-anchor">#</a> h å‡½æ•°</h3> <ul><li><code>h()</code> å‡½æ•°ä»‹ç»: åœ¨ä½¿ç”¨ <code>Vue</code> çš„æ—¶å€™è§è¿‡ <code>h()</code> å‡½æ•°</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  router<span class="token punctuation">,</span>
  store<span class="token punctuation">,</span>
  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token parameter">h</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
</code></pre></div><ul><li><code>h()</code> å‡½æ•°æœ€æ—©è§äº <code>hyperscript</code>ï¼Œä½¿ç”¨ JavaScript åˆ›å»ºè¶…æ–‡æœ¬</li> <li>Snabbdom ä¸­çš„ <code>h()</code> å‡½æ•°ä¸æ˜¯ç”¨æ¥åˆ›å»ºè¶…æ–‡æœ¬ï¼Œè€Œæ˜¯åˆ›å»º <code>VNode</code></li></ul> <p><strong>å‡½æ•°é‡è½½</strong></p> <ul><li>æ¦‚å¿µ</li> <li>å‚æ•°ä¸ªæ•°æˆ–ç±»å‹ä¸åŒçš„å‡½æ•°</li> <li><code>JavaScript</code> ä¸­æ²¡æœ‰é‡è½½çš„æ¦‚å¿µ</li> <li><code>TypeScript</code> ä¸­æœ‰é‡è½½ï¼Œä¸è¿‡é‡è½½çš„å®ç°è¿˜æ˜¯é€šè¿‡ä»£ç è°ƒæ•´å‚æ•°</li> <li>é‡è½½çš„ç¤ºæ„</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">add</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">add</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b <span class="token operator">+</span> c<span class="token punctuation">)</span> 
<span class="token punctuation">}</span>
<span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>æºç ä½ç½®:<code>src/h.ts</code></p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// hå‡½æ•°çš„é‡è½½</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">h</span> <span class="token punctuation">(</span><span class="token parameter">sel<span class="token operator">:</span> string</span><span class="token punctuation">)</span><span class="token operator">:</span> VNode
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">h</span> <span class="token punctuation">(</span><span class="token parameter">sel<span class="token operator">:</span> string<span class="token punctuation">,</span> data<span class="token operator">:</span> VNodeData <span class="token operator">|</span> <span class="token keyword">null</span></span><span class="token punctuation">)</span><span class="token operator">:</span> VNode
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">h</span> <span class="token punctuation">(</span><span class="token parameter">sel<span class="token operator">:</span> string<span class="token punctuation">,</span> children<span class="token operator">:</span> VNodeChildren</span><span class="token punctuation">)</span><span class="token operator">:</span> VNode
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">h</span> <span class="token punctuation">(</span><span class="token parameter">sel<span class="token operator">:</span> string<span class="token punctuation">,</span> data<span class="token operator">:</span> VNodeData <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span> children<span class="token operator">:</span> VNodeChildren</span><span class="token punctuation">)</span><span class="token operator">:</span> VNode
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">h</span> <span class="token punctuation">(</span><span class="token parameter">sel<span class="token operator">:</span> any<span class="token punctuation">,</span> b<span class="token operator">?</span><span class="token operator">:</span> any<span class="token punctuation">,</span> c<span class="token operator">?</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span><span class="token operator">:</span> VNode <span class="token punctuation">{</span>
  <span class="token keyword">let</span> data<span class="token operator">:</span> VNodeData <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">let</span> children<span class="token operator">:</span> any
  <span class="token keyword">let</span> text<span class="token operator">:</span> any
  <span class="token keyword">let</span> i<span class="token operator">:</span> number
  <span class="token comment">// å¤„ç†å‚æ•°ï¼Œå®ç°é‡è½½çš„æœºåˆ¶</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¤„ç†ä¸‰ä¸ªå‚æ•°çš„æƒ…å†µ</span>
    <span class="token comment">// selã€dataã€children/text</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>b <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      data <span class="token operator">=</span> b
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>is<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      children <span class="token operator">=</span> c
      <span class="token comment">// å¦‚æœ c æ˜¯å­—ç¬¦ä¸²æˆ–è€…æ•°å­—</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>is<span class="token punctuation">.</span><span class="token function">primitive</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      text <span class="token operator">=</span> c
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">&amp;&amp;</span> c<span class="token punctuation">.</span>sel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      children <span class="token operator">=</span> <span class="token punctuation">[</span>c<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>b <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> b <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¤„ç†ä¸¤ä¸ªå‚æ•°çš„æƒ…å†µ</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>is<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      children <span class="token operator">=</span> b
      <span class="token comment">// å¦‚æœ b æ˜¯å­—ç¬¦ä¸²æˆ–è€…æ•°å­—</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>is<span class="token punctuation">.</span><span class="token function">primitive</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      text <span class="token operator">=</span> b
      <span class="token comment">// å¦‚æœ b æ˜¯ VNode</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>b <span class="token operator">&amp;&amp;</span> b<span class="token punctuation">.</span>sel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      children <span class="token operator">=</span> <span class="token punctuation">[</span>b<span class="token punctuation">]</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> data <span class="token operator">=</span> b <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>children <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¤„ç† children ä¸­çš„åŸå§‹å€¼(string/number)</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> children<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// å¦‚æœ child æ˜¯ string/numberï¼Œåˆ›å»ºæ–‡æœ¬èŠ‚ç‚¹</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>is<span class="token punctuation">.</span><span class="token function">primitive</span><span class="token punctuation">(</span>children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> children<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">vnode</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>
    sel<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'s'</span> <span class="token operator">&amp;&amp;</span> sel<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'v'</span> <span class="token operator">&amp;&amp;</span> sel<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'g'</span> <span class="token operator">&amp;&amp;</span>
    <span class="token punctuation">(</span>sel<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">3</span> <span class="token operator">||</span> sel<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'.'</span> <span class="token operator">||</span> sel<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'#'</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¦‚æœæ˜¯ svgï¼Œæ·»åŠ å‘½åç©ºé—´</span>
    <span class="token function">addNS</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> children<span class="token punctuation">,</span> sel<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// è¿”å› VNode</span>
  <span class="token keyword">return</span> <span class="token function">vnode</span><span class="token punctuation">(</span>sel<span class="token punctuation">,</span> data<span class="token punctuation">,</span> children<span class="token punctuation">,</span> text<span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// å¯¼å‡ºæ¨¡å—</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> h<span class="token punctuation">;</span>
</code></pre></div><h3 id="vnode"><a href="http://interview.poetries.top/principle-docs/comprehensive/01-%E8%99%9A%E6%8B%9FDOM%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90.html#vnode" class="header-anchor">#</a> VNode</h3> <blockquote><p>ä¸€ä¸ª <code>VNode</code> å°±æ˜¯ä¸€ä¸ªè™šæ‹ŸèŠ‚ç‚¹ç”¨æ¥æè¿°ä¸€ä¸ª <code>DOM</code> å…ƒç´ ï¼Œå¦‚æœè¿™ä¸ª <code>VNode</code> æœ‰ <code>children</code> å°±æ˜¯ <code>Virtual DOM</code></p></blockquote> <p>æºç ä½ç½®: <code>src/vnode.ts</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">VNodeData</span> <span class="token punctuation">{</span>
  props<span class="token operator">?</span><span class="token operator">:</span> Props
  attrs<span class="token operator">?</span><span class="token operator">:</span> Attrs
  <span class="token keyword">class</span><span class="token operator">?</span><span class="token operator">:</span> Classes
  style<span class="token operator">?</span><span class="token operator">:</span> VNodeStyle
  dataset<span class="token operator">?</span><span class="token operator">:</span> Dataset
  on<span class="token operator">?</span><span class="token operator">:</span> On
  hero<span class="token operator">?</span><span class="token operator">:</span> Hero
  attachData<span class="token operator">?</span><span class="token operator">:</span> AttachData
  hook<span class="token operator">?</span><span class="token operator">:</span> Hooks
  key<span class="token operator">?</span><span class="token operator">:</span> Key
  ns<span class="token operator">?</span><span class="token operator">:</span> string <span class="token comment">// for SVGs</span>
  fn<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> VNode <span class="token comment">// for thunks</span>
  args<span class="token operator">?</span><span class="token operator">:</span> any<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// for thunks</span>
  is<span class="token operator">?</span><span class="token operator">:</span> string <span class="token comment">// for custom elements v1</span>
  <span class="token punctuation">[</span>key<span class="token operator">:</span> string<span class="token punctuation">]</span><span class="token operator">:</span> any <span class="token comment">// for any other 3rd party module</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">VNode</span> <span class="token punctuation">{</span>
  <span class="token comment">// é€‰æ‹©å™¨</span>
  sel<span class="token operator">:</span> string <span class="token operator">|</span> <span class="token keyword">undefined</span>
  <span class="token comment">// èŠ‚ç‚¹æ•°æ®:å±æ€§/æ ·å¼/äº‹ä»¶ç­‰</span>
  data<span class="token operator">:</span> VNodeData <span class="token operator">|</span> <span class="token keyword">undefined</span>
  <span class="token comment">// å­èŠ‚ç‚¹ï¼Œå’Œ text åªèƒ½äº’æ–¥</span>
  children<span class="token operator">:</span> Array<span class="token operator">&lt;</span>VNode <span class="token operator">|</span> string<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token keyword">undefined</span>
  <span class="token comment">// è®°å½• vnode å¯¹åº”çš„çœŸå® DOM</span>
  elm<span class="token operator">:</span> Node <span class="token operator">|</span> <span class="token keyword">undefined</span>
  <span class="token comment">// èŠ‚ç‚¹ä¸­çš„å†…å®¹ï¼Œå’Œ children åªèƒ½äº’æ–¥</span>
  text<span class="token operator">:</span> string <span class="token operator">|</span> <span class="token keyword">undefined</span>
  <span class="token comment">// ä¼˜åŒ–ç”¨</span>
  key<span class="token operator">:</span> Key <span class="token operator">|</span> <span class="token keyword">undefined</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">vnode</span> <span class="token punctuation">(</span><span class="token parameter">sel<span class="token operator">:</span> string <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
  data<span class="token operator">:</span> any <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
  children<span class="token operator">:</span> Array<span class="token operator">&lt;</span>VNode <span class="token operator">|</span> string<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
  text<span class="token operator">:</span> string <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
  elm<span class="token operator">:</span> Element <span class="token operator">|</span> Text <span class="token operator">|</span> <span class="token keyword">undefined</span></span><span class="token punctuation">)</span><span class="token operator">:</span> VNode <span class="token punctuation">{</span>
  <span class="token keyword">const</span> key <span class="token operator">=</span> data <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> <span class="token keyword">undefined</span> <span class="token operator">:</span> data<span class="token punctuation">.</span>key
  <span class="token keyword">return</span> <span class="token punctuation">{</span> sel<span class="token punctuation">,</span> data<span class="token punctuation">,</span> children<span class="token punctuation">,</span> text<span class="token punctuation">,</span> elm<span class="token punctuation">,</span> key <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="snabbdom"><a href="http://interview.poetries.top/principle-docs/comprehensive/01-%E8%99%9A%E6%8B%9FDOM%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90.html#snabbdom" class="header-anchor">#</a> snabbdom</h3> <ul><li><code>patch(oldVnode, newVnode)</code></li> <li>æ‰“è¡¥ä¸ï¼ŒæŠŠæ–°èŠ‚ç‚¹ä¸­å˜åŒ–çš„å†…å®¹æ¸²æŸ“åˆ°çœŸå® <code>DOM</code>ï¼Œæœ€åè¿”å›æ–°èŠ‚ç‚¹ä½œä¸ºä¸‹ä¸€æ¬¡å¤„ç†çš„æ—§èŠ‚ç‚¹</li> <li>å¯¹æ¯”æ–°æ—§ <code>VNode</code> æ˜¯å¦ç›¸åŒèŠ‚ç‚¹(èŠ‚ç‚¹çš„ <code>key</code> å’Œ <code>sel</code> ç›¸åŒ)</li> <li>å¦‚æœä¸æ˜¯ç›¸åŒèŠ‚ç‚¹ï¼Œåˆ é™¤ä¹‹å‰çš„å†…å®¹ï¼Œé‡æ–°æ¸²æŸ“</li> <li>å¦‚æœæ˜¯ç›¸åŒèŠ‚ç‚¹ï¼Œå†åˆ¤æ–­æ–°çš„ <code>VNode</code> æ˜¯å¦æœ‰ <code>text</code>ï¼Œå¦‚æœæœ‰å¹¶ä¸”å’Œ <code>oldVnode</code> çš„ <code>text</code> ä¸åŒï¼Œç›´æ¥æ›´ æ–°æ–‡æœ¬å†…å®¹</li> <li>å¦‚æœæ–°çš„ <code>VNode</code> æœ‰ <code>children</code>ï¼Œåˆ¤æ–­å­èŠ‚ç‚¹æ˜¯å¦æœ‰å˜åŒ–ï¼Œåˆ¤æ–­å­èŠ‚ç‚¹çš„è¿‡ç¨‹ä½¿ç”¨çš„å°±æ˜¯ <code>diff</code> ç®—æ³•</li> <li><code>diff</code> è¿‡ç¨‹åªè¿›è¡ŒåŒå±‚çº§æ¯”è¾ƒ</li></ul> <p><img src="./è™šæ‹ŸdomåŸç†_files/20210329091820.png" alt="" class="medium-zoom-image"></p> <h3 id="init"><a href="http://interview.poetries.top/principle-docs/comprehensive/01-%E8%99%9A%E6%8B%9FDOM%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90.html#init" class="header-anchor">#</a> init</h3> <ul><li>åŠŸèƒ½: <code>init(modules, domApi)</code>ï¼Œè¿”å› <code>patch()</code>å‡½æ•°(é«˜é˜¶å‡½æ•°)</li> <li>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨é«˜é˜¶å‡½æ•°?
<ul><li>å› ä¸º <code>patch()</code> å‡½æ•°å†å¤–éƒ¨ä¼šè°ƒç”¨å¤šæ¬¡ï¼Œæ¯æ¬¡è°ƒç”¨ä¾èµ–ä¸€äº›å‚æ•°ï¼Œæ¯”å¦‚: <code>modules/domApi/cbs</code></li> <li>é€šè¿‡é«˜é˜¶å‡½æ•°è®© <code>init()</code> å†…éƒ¨å½¢æˆé—­åŒ…ï¼Œè¿”å›çš„ <code>patch()</code> å¯ä»¥è®¿é—®åˆ° <code>modules/domApi/cbs</code>ï¼Œè€Œ ä¸éœ€è¦é‡æ–°åˆ›å»º</li></ul></li> <li><code>init()</code> åœ¨è¿”å› <code>patch()</code> ä¹‹å‰ï¼Œé¦–å…ˆæ”¶é›†äº†æ‰€æœ‰æ¨¡å—ä¸­çš„é’©å­å‡½æ•°å­˜å‚¨åˆ° <code>cbs</code> å¯¹è±¡ä¸­</li></ul> <blockquote><p>æºç ä½ç½®:<code>src/init.ts</code></p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">init</span> <span class="token punctuation">(</span><span class="token parameter">modules<span class="token operator">:</span> Array<span class="token operator">&lt;</span>Partial<span class="token operator">&lt;</span>Module<span class="token operator">&gt;&gt;</span><span class="token punctuation">,</span> domApi<span class="token operator">?</span><span class="token operator">:</span> <span class="token constant">DOMAPI</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> i<span class="token operator">:</span> number
  <span class="token keyword">let</span> j<span class="token operator">:</span> number
  <span class="token keyword">const</span> cbs<span class="token operator">:</span> ModuleHooks <span class="token operator">=</span> <span class="token punctuation">{</span>
    create<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    update<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    remove<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    destroy<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    pre<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    post<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> api<span class="token operator">:</span> <span class="token constant">DOMAPI</span> <span class="token operator">=</span> domApi <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> domApi <span class="token operator">:</span> htmlDomApi

  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> hooks<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cbs<span class="token punctuation">[</span>hooks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> modules<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> hook <span class="token operator">=</span> modules<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>hooks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>hook <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">(</span>cbs<span class="token punctuation">[</span>hooks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token keyword">as</span> any<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>hook<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token operator">...</span>

  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">patch</span> <span class="token punctuation">(</span><span class="token parameter">oldVnode<span class="token operator">:</span> VNode <span class="token operator">|</span> Element<span class="token punctuation">,</span> vnode<span class="token operator">:</span> VNode</span><span class="token punctuation">)</span><span class="token operator">:</span> VNode <span class="token punctuation">{</span>
    <span class="token keyword">let</span> i<span class="token operator">:</span> number<span class="token punctuation">,</span> elm<span class="token operator">:</span> Node<span class="token punctuation">,</span> parent<span class="token operator">:</span> Node
    <span class="token keyword">const</span> insertedVnodeQueue<span class="token operator">:</span> VNodeQueue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cbs<span class="token punctuation">.</span>pre<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> cbs<span class="token punctuation">.</span>pre<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isVnode</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      oldVnode <span class="token operator">=</span> <span class="token function">emptyNodeAt</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      elm <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>elm<span class="token operator">!</span>
      parent <span class="token operator">=</span> api<span class="token punctuation">.</span><span class="token function">parentNode</span><span class="token punctuation">(</span>elm<span class="token punctuation">)</span> <span class="token keyword">as</span> Node

      <span class="token function">createElm</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        api<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> vnode<span class="token punctuation">.</span>elm<span class="token operator">!</span><span class="token punctuation">,</span> api<span class="token punctuation">.</span><span class="token function">nextSibling</span><span class="token punctuation">(</span>elm<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token function">removeVnodes</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token punctuation">[</span>oldVnode<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> insertedVnodeQueue<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      insertedVnodeQueue<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token operator">!</span><span class="token punctuation">.</span>hook<span class="token operator">!</span><span class="token punctuation">.</span>insert<span class="token operator">!</span><span class="token punctuation">(</span>insertedVnodeQueue<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cbs<span class="token punctuation">.</span>post<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> cbs<span class="token punctuation">.</span>post<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> vnode
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="patch"><a href="http://interview.poetries.top/principle-docs/comprehensive/01-%E8%99%9A%E6%8B%9FDOM%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90.html#patch" class="header-anchor">#</a> patch</h3> <ul><li>åŠŸèƒ½:
<ul><li>ä¼ å…¥æ–°æ—§ <code>VNode</code>ï¼Œå¯¹æ¯”å·®å¼‚ï¼ŒæŠŠå·®å¼‚æ¸²æŸ“åˆ° <code>DOM</code></li> <li>è¿”å›æ–°çš„ <code>VNode</code>ï¼Œä½œä¸ºä¸‹ä¸€æ¬¡ <code>patch()</code> çš„ <code>oldVnode</code></li></ul></li> <li>æ‰§è¡Œè¿‡ç¨‹:
<ul><li>é¦–å…ˆæ‰§è¡Œæ¨¡å—ä¸­çš„é’©å­å‡½æ•° <code>pre</code></li> <li>å¦‚æœ <code>oldVnode</code> å’Œ <code>vnode</code> ç›¸åŒ(<code>key</code> å’Œ <code>sel</code> ç›¸åŒ)
<ul><li>è°ƒç”¨ <code>patchVnode()</code>ï¼Œæ‰¾èŠ‚ç‚¹çš„å·®å¼‚å¹¶æ›´æ–° <code>DOM</code></li></ul></li> <li>å¦‚æœ <code>oldVnode</code> æ˜¯ <code>DOM</code> å…ƒç´ 
<ul><li>æŠŠ <code>DOM</code> å…ƒç´ è½¬æ¢æˆ <code>oldVnode</code></li> <li>è°ƒç”¨ <code>createElm()</code> æŠŠ <code>vnode</code> è½¬æ¢ä¸ºçœŸå® <code>DOM</code>ï¼Œè®°å½•åˆ° <code>vnode.elm</code></li> <li>æŠŠåˆšåˆ›å»ºçš„ <code>DOM</code> å…ƒç´ æ’å…¥åˆ° <code>parent</code> ä¸­</li> <li>ç§»é™¤è€èŠ‚ç‚¹</li> <li>è§¦å‘ç”¨æˆ·è®¾ç½®çš„ <code>create</code> é’©å­å‡½æ•°</li></ul></li></ul></li></ul> <p>æºç ä½ç½®:<code>src/snabbdom.ts</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">patch</span> <span class="token punctuation">(</span><span class="token parameter">oldVnode<span class="token operator">:</span> VNode <span class="token operator">|</span> Element<span class="token punctuation">,</span> vnode<span class="token operator">:</span> VNode</span><span class="token punctuation">)</span><span class="token operator">:</span> VNode <span class="token punctuation">{</span>
  <span class="token keyword">let</span> i<span class="token operator">:</span> number<span class="token punctuation">,</span> elm<span class="token operator">:</span> Node<span class="token punctuation">,</span> parent<span class="token operator">:</span> Node
  <span class="token comment">// ä¿å­˜æ–°æ’å…¥èŠ‚ç‚¹çš„é˜Ÿåˆ—ï¼Œä¸ºäº†è§¦å‘é’©å­å‡½æ•°</span>
  <span class="token keyword">const</span> insertedVnodeQueue<span class="token operator">:</span> VNodeQueue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token comment">// æ‰§è¡Œæ¨¡å—çš„ pre é’©å­å‡½æ•°</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cbs<span class="token punctuation">.</span>pre<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> cbs<span class="token punctuation">.</span>pre<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// å¦‚æœ oldVnode ä¸æ˜¯ VNodeï¼Œåˆ›å»º VNode å¹¶è®¾ç½® elm</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isVnode</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// æŠŠ DOM å…ƒç´ è½¬æ¢æˆç©ºçš„ VNode</span>
    oldVnode <span class="token operator">=</span> <span class="token function">emptyNodeAt</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// å¦‚æœæ–°æ—§èŠ‚ç‚¹æ˜¯ç›¸åŒèŠ‚ç‚¹(key å’Œ sel ç›¸åŒ)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ‰¾èŠ‚ç‚¹çš„å·®å¼‚å¹¶æ›´æ–° DOM</span>
    <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¦‚æœæ–°æ—§èŠ‚ç‚¹ä¸åŒï¼Œvnode åˆ›å»ºå¯¹åº”çš„ DOM</span>
    <span class="token comment">// è·å–å½“å‰çš„ DOM å…ƒç´ </span>
    elm <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>elm<span class="token operator">!</span>
    parent <span class="token operator">=</span> api<span class="token punctuation">.</span><span class="token function">parentNode</span><span class="token punctuation">(</span>elm<span class="token punctuation">)</span> <span class="token keyword">as</span> Node
    <span class="token comment">// è§¦å‘ init/create é’©å­å‡½æ•°,åˆ›å»º DOM</span>
    <span class="token function">createElm</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// å¦‚æœçˆ¶èŠ‚ç‚¹ä¸ä¸ºç©ºï¼ŒæŠŠ vnode å¯¹åº”çš„ DOM æ’å…¥åˆ°æ–‡æ¡£ä¸­</span>
      api<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> vnode<span class="token punctuation">.</span>elm<span class="token operator">!</span><span class="token punctuation">,</span> api<span class="token punctuation">.</span><span class="token function">nextSibling</span><span class="token punctuation">(</span>elm<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token comment">// ç§»é™¤è€èŠ‚ç‚¹</span>
      <span class="token function">removeVnodes</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token punctuation">[</span>oldVnode<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// æ‰§è¡Œç”¨æˆ·è®¾ç½®çš„ insert é’©å­å‡½æ•° </span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> insertedVnodeQueue<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    insertedVnodeQueue<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token operator">!</span><span class="token punctuation">.</span>hook<span class="token operator">!</span><span class="token punctuation">.</span>insert<span class="token operator">!</span><span class="token punctuation">(</span>insertedVnodeQueue<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// æ‰§è¡Œæ¨¡å—çš„ post é’©å­å‡½æ•°</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cbs<span class="token punctuation">.</span>post<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> cbs<span class="token punctuation">.</span>post<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// è¿”å› vnode</span>
  <span class="token keyword">return</span> vnode
<span class="token punctuation">}</span>
</code></pre></div><h3 id="createelm"><a href="http://interview.poetries.top/principle-docs/comprehensive/01-%E8%99%9A%E6%8B%9FDOM%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90.html#createelm" class="header-anchor">#</a> createElm</h3> <ul><li><p>åŠŸèƒ½:</p> <ul><li><code>createElm(vnode, insertedVnodeQueue)</code>ï¼Œè¿”å›åˆ›å»ºçš„ <code>DOM</code> å…ƒç´ </li> <li>åˆ›å»º <code>vnode</code> å¯¹åº”çš„ <code>DOM</code> å…ƒç´ </li></ul></li> <li><p>æ‰§è¡Œè¿‡ç¨‹:</p></li> <li><p>é¦–å…ˆè§¦å‘ç”¨æˆ·è®¾ç½®çš„ <code>init</code> é’©å­å‡½æ•°</p></li> <li><p>å¦‚æœé€‰æ‹©å™¨æ˜¯<code>!</code>ï¼Œåˆ›å»ºè¯„è®ºèŠ‚ç‚¹</p></li> <li><p>å¦‚æœé€‰æ‹©å™¨ä¸ºç©ºï¼Œåˆ›å»ºæ–‡æœ¬èŠ‚ç‚¹</p></li> <li><p>å¦‚æœé€‰æ‹©å™¨ä¸ä¸ºç©º</p> <ul><li>è§£æé€‰æ‹©å™¨ï¼Œè®¾ç½®æ ‡ç­¾çš„ <code>id</code> å’Œ <code>class</code> å±æ€§</li> <li>æ‰§è¡Œæ¨¡å—çš„ <code>create</code> é’©å­å‡½æ•°</li> <li>å¦‚æœ <code>vnode</code> æœ‰ <code>children</code>ï¼Œåˆ›å»ºå­ <code>vnode</code> å¯¹åº”çš„ <code>DOM</code>ï¼Œè¿½åŠ åˆ° <code>DOM</code> æ ‘</li> <li>å¦‚æœ <code>vnode</code> çš„ <code>text</code> å€¼æ˜¯ <code>string/number</code>ï¼Œåˆ›å»ºæ–‡æœ¬èŠ‚ç‚¹å¹¶è¿½å‡»åˆ° <code>DOM</code> æ ‘</li> <li>æ‰§è¡Œç”¨æˆ·è®¾ç½®çš„ <code>create</code> é’©å­å‡½æ•°</li> <li>å¦‚æœæœ‰ç”¨æˆ·è®¾ç½®çš„ <code>insert</code> é’©å­å‡½æ•°ï¼ŒæŠŠ <code>vnode</code> æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createElm</span> <span class="token punctuation">(</span><span class="token parameter">vnode<span class="token operator">:</span> VNode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token operator">:</span> VNodeQueue</span><span class="token punctuation">)</span><span class="token operator">:</span> Node <span class="token punctuation">{</span>
  <span class="token keyword">let</span> i<span class="token operator">:</span> any
  <span class="token keyword">let</span> data <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data
  <span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ‰§è¡Œç”¨æˆ·è®¾ç½®çš„ init é’©å­å‡½æ•°</span>
    <span class="token keyword">const</span> init <span class="token operator">=</span> data<span class="token punctuation">.</span>hook<span class="token operator">?.</span>init
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>init<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">init</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span>
      data <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> children <span class="token operator">=</span> vnode<span class="token punctuation">.</span>children
  <span class="token keyword">const</span> sel <span class="token operator">=</span> vnode<span class="token punctuation">.</span>sel
  <span class="token keyword">if</span> <span class="token punctuation">(</span>sel <span class="token operator">===</span> <span class="token string">'!'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¦‚æœé€‰æ‹©å™¨æ˜¯!ï¼Œåˆ›å»ºè¯„è®ºèŠ‚ç‚¹</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vnode<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token punctuation">}</span>
    vnode<span class="token punctuation">.</span>elm <span class="token operator">=</span> api<span class="token punctuation">.</span><span class="token function">createComment</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>text<span class="token operator">!</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>sel <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Parse selector</span>
    <span class="token comment">// å¦‚æœé€‰æ‹©å™¨ä¸ä¸ºç©º</span>
    <span class="token comment">// è§£æé€‰æ‹©å™¨</span>
    <span class="token comment">// Parse selector</span>
    <span class="token keyword">const</span> hashIdx <span class="token operator">=</span> sel<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'#'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> dotIdx <span class="token operator">=</span> sel<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">,</span> hashIdx<span class="token punctuation">)</span>
    <span class="token keyword">const</span> hash <span class="token operator">=</span> hashIdx <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> hashIdx <span class="token operator">:</span> sel<span class="token punctuation">.</span>length
    <span class="token keyword">const</span> dot <span class="token operator">=</span> dotIdx <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> dotIdx <span class="token operator">:</span> sel<span class="token punctuation">.</span>length
    <span class="token keyword">const</span> tag <span class="token operator">=</span> hashIdx <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> dotIdx <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">?</span> sel<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> dot<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">:</span> sel
    <span class="token keyword">const</span> elm <span class="token operator">=</span> vnode<span class="token punctuation">.</span>elm <span class="token operator">=</span> <span class="token function">isDef</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> data<span class="token punctuation">.</span>ns<span class="token punctuation">)</span>
      <span class="token operator">?</span> api<span class="token punctuation">.</span><span class="token function">createElementNS</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> tag<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
      <span class="token operator">:</span> api<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>tag<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>hash <span class="token operator">&lt;</span> dot<span class="token punctuation">)</span> elm<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> sel<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>hash <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> dot<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>dotIdx <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> elm<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> sel<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>dot <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// æ‰§è¡Œæ¨¡å—çš„ create é’©å­å‡½æ•°</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cbs<span class="token punctuation">.</span>create<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> cbs<span class="token punctuation">.</span>create<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>emptyNode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>
    <span class="token comment">// å¦‚æœ vnode ä¸­æœ‰å­èŠ‚ç‚¹ï¼Œåˆ›å»ºå­ vnode å¯¹åº”çš„ DOM å…ƒç´ å¹¶è¿½åŠ åˆ° DOM æ ‘ä¸Š</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>is<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> children<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> ch <span class="token operator">=</span> children<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ch <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          api<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> <span class="token function">createElm</span><span class="token punctuation">(</span>ch <span class="token keyword">as</span> VNode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>is<span class="token punctuation">.</span><span class="token function">primitive</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// å¦‚æœ vnode çš„ text å€¼æ˜¯ string/numberï¼Œåˆ›å»ºæ–‡æœ¬èŠ‚ç‚¹å¹¶è¿½åŠ åˆ° DOM æ ‘</span>
      api<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> api<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> hook <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data<span class="token operator">!</span><span class="token punctuation">.</span>hook
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>hook<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// æ‰§è¡Œç”¨æˆ·ä¼ å…¥çš„é’©å­ create</span>
      hook<span class="token punctuation">.</span>create<span class="token operator">?.</span><span class="token punctuation">(</span>emptyNode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>hook<span class="token punctuation">.</span>insert<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// æŠŠ vnode æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ï¼Œä¸ºåç»­æ‰§è¡Œ insert é’©å­åšå‡†å¤‡</span>
        insertedVnodeQueue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¦‚æœé€‰æ‹©å™¨ä¸ºç©ºï¼Œåˆ›å»ºæ–‡æœ¬èŠ‚ç‚¹</span>
    vnode<span class="token punctuation">.</span>elm <span class="token operator">=</span> api<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>text<span class="token operator">!</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// è¿”å›æ–°åˆ›å»ºçš„ DOM</span>
  <span class="token keyword">return</span> vnode<span class="token punctuation">.</span>elm
<span class="token punctuation">}</span>
</code></pre></div><h3 id="patchvnode"><a href="http://interview.poetries.top/principle-docs/comprehensive/01-%E8%99%9A%E6%8B%9FDOM%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90.html#patchvnode" class="header-anchor">#</a> patchVnode</h3> <ul><li>åŠŸèƒ½:
<ul><li><code>patchVnode(oldVnode, vnode, insertedVnodeQueue)</code></li> <li>å¯¹æ¯” <code>oldVnode</code> å’Œ <code>vnode</code> çš„å·®å¼‚ï¼ŒæŠŠå·®å¼‚æ¸²æŸ“åˆ° <code>DOM</code></li></ul></li> <li>æ‰§è¡Œè¿‡ç¨‹:
<ul><li>é¦–å…ˆæ‰§è¡Œç”¨æˆ·è®¾ç½®çš„ <code>prepatch</code> é’©å­å‡½æ•°</li> <li>æ‰§è¡Œ <code>create</code> é’©å­å‡½æ•°
<ul><li>é¦–å…ˆæ‰§è¡Œæ¨¡å—çš„ <code>create</code>é’©å­å‡½æ•°</li> <li>ç„¶åæ‰§è¡Œç”¨æˆ·è®¾ç½®çš„ <code>create</code> é’©å­å‡½æ•°</li></ul></li> <li>å¦‚æœ <code>vnode.text</code> æœªå®šä¹‰
<ul><li>å¦‚æœ <code>oldVnode.children</code> å’Œ <code>vnode.children</code> éƒ½æœ‰å€¼
<ul><li>è°ƒç”¨ <code>updateChildren()</code></li> <li>ä½¿ç”¨ <code>diff</code> ç®—æ³•å¯¹æ¯”å­èŠ‚ç‚¹ï¼Œæ›´æ–°å­èŠ‚ç‚¹</li></ul></li> <li>å¦‚æœ <code>vnode.children</code> æœ‰å€¼ï¼Œ <code>oldVnode.children</code> æ— å€¼
<ul><li>æ¸…ç©º <code>DOM</code> å…ƒç´ </li> <li>è°ƒç”¨ <code>addVnodes()</code> ï¼Œæ‰¹é‡æ·»åŠ å­èŠ‚ç‚¹</li></ul></li> <li>å¦‚æœ <code>oldVnode.children</code> æœ‰å€¼ï¼Œ <code>vnode.children</code> æ— å€¼
<ul><li>è°ƒç”¨ <code>removeVnodes()</code> ï¼Œæ‰¹é‡ç§»é™¤å­èŠ‚ç‚¹</li></ul></li> <li>å¦‚æœ <code>oldVnode.text</code> æœ‰å€¼
<ul><li>æ¸…ç©º <code>DOM</code> å…ƒç´ çš„å†…å®¹</li></ul></li></ul></li> <li>å¦‚æœè®¾ç½®äº† <code>vnode.text</code> å¹¶ä¸”å’Œå’Œ <code>oldVnode.text</code> ä¸ç­‰
<ul><li>å¦‚æœè€èŠ‚ç‚¹æœ‰å­èŠ‚ç‚¹ï¼Œå…¨éƒ¨ç§»é™¤</li> <li>è®¾ç½® <code>DOM</code> å…ƒç´ çš„ <code>textContent</code> ä¸º <code>vnode.text</code></li></ul></li> <li>æœ€åæ‰§è¡Œç”¨æˆ·è®¾ç½®çš„ <code>postpatch</code> é’©å­å‡½æ•°</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">patchVnode</span> <span class="token punctuation">(</span><span class="token parameter">oldVnode<span class="token operator">:</span> VNode<span class="token punctuation">,</span> vnode<span class="token operator">:</span> VNode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token operator">:</span> VNodeQueue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> hook <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data<span class="token operator">?.</span>hook
  <span class="token comment">// é¦–å…ˆæ‰§è¡Œç”¨æˆ·è®¾ç½®çš„ prepatch é’©å­å‡½æ•°</span>
  hook<span class="token operator">?.</span>prepatch<span class="token operator">?.</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>
  <span class="token keyword">const</span> elm <span class="token operator">=</span> vnode<span class="token punctuation">.</span>elm <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>elm<span class="token operator">!</span>
  <span class="token keyword">const</span> oldCh <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>children <span class="token keyword">as</span> VNode<span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">const</span> ch <span class="token operator">=</span> vnode<span class="token punctuation">.</span>children <span class="token keyword">as</span> VNode<span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token comment">// å¦‚æœæ–°è€ vnode ç›¸åŒè¿”å›</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVnode <span class="token operator">===</span> vnode<span class="token punctuation">)</span> <span class="token keyword">return</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>data <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ‰§è¡Œæ¨¡å—çš„ update é’©å­å‡½æ•°</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cbs<span class="token punctuation">.</span>update<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> cbs<span class="token punctuation">.</span>update<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>
    <span class="token comment">// æ‰§è¡Œç”¨æˆ·è®¾ç½®çš„ update é’©å­å‡½æ•°</span>
    vnode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>hook<span class="token operator">?.</span>update<span class="token operator">?.</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// å¦‚æœ vnode.text æœªå®šä¹‰</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¦‚æœæ–°è€èŠ‚ç‚¹éƒ½æœ‰ children</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// ä½¿ç”¨ diff ç®—æ³•å¯¹æ¯”å­èŠ‚ç‚¹ï¼Œæ›´æ–°å­èŠ‚ç‚¹</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCh <span class="token operator">!==</span> ch<span class="token punctuation">)</span> <span class="token function">updateChildren</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> ch<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// å¦‚æœæ–°èŠ‚ç‚¹æœ‰ childrenï¼Œè€èŠ‚ç‚¹æ²¡æœ‰ children</span>
      <span class="token comment">// å¦‚æœè€èŠ‚ç‚¹æœ‰textï¼Œæ¸…ç©ºdom å…ƒç´ çš„å†…å®¹</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> api<span class="token punctuation">.</span><span class="token function">setTextContent</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
      <span class="token comment">// æ‰¹é‡æ·»åŠ å­èŠ‚ç‚¹</span>
      <span class="token function">addVnodes</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> ch<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> ch<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// å¦‚æœè€èŠ‚ç‚¹æœ‰childrenï¼Œæ–°èŠ‚ç‚¹æ²¡æœ‰children</span>
      <span class="token comment">// æ‰¹é‡ç§»é™¤å­èŠ‚ç‚¹</span>
      <span class="token function">removeVnodes</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> oldCh<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// å¦‚æœè€èŠ‚ç‚¹æœ‰ textï¼Œæ¸…ç©º DOM å…ƒç´ </span>
      api<span class="token punctuation">.</span><span class="token function">setTextContent</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>text <span class="token operator">!==</span> vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¦‚æœæ²¡æœ‰è®¾ç½® vnode.text</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// å¦‚æœè€èŠ‚ç‚¹æœ‰ childrenï¼Œç§»é™¤</span>
      <span class="token function">removeVnodes</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> oldCh<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// è®¾ç½® DOM å…ƒç´ çš„ textContent ä¸º vnode.text</span>
    api<span class="token punctuation">.</span><span class="token function">setTextContent</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> vnode<span class="token punctuation">.</span>text<span class="token operator">!</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// æœ€åæ‰§è¡Œç”¨æˆ·è®¾ç½®çš„ postpatch é’©å­å‡½æ•°</span>
  hook<span class="token operator">?.</span>postpatch<span class="token operator">?.</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="updatechildren"><a href="http://interview.poetries.top/principle-docs/comprehensive/01-%E8%99%9A%E6%8B%9FDOM%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90.html#updatechildren" class="header-anchor">#</a> updateChildren</h3> <ul><li>åŠŸèƒ½:
<ul><li><code>diff</code> ç®—æ³•çš„æ ¸å¿ƒï¼Œå¯¹æ¯”æ–°æ—§èŠ‚ç‚¹çš„ <code>children</code>ï¼Œæ›´æ–° <code>DOM</code></li></ul></li> <li>æ‰§è¡Œè¿‡ç¨‹:</li> <li>è¦å¯¹æ¯”ä¸¤æ£µæ ‘çš„å·®å¼‚ï¼Œæˆ‘ä»¬å¯ä»¥å–ç¬¬ä¸€æ£µæ ‘çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ä¾æ¬¡å’Œç¬¬äºŒè¯¾æ ‘çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹æ¯” è¾ƒï¼Œä½†æ˜¯è¿™æ ·çš„æ—¶é—´å¤æ‚åº¦ä¸º <code>O(n^3)</code></li> <li>åœ¨ <code>DOM</code> æ“ä½œçš„æ—¶å€™æˆ‘ä»¬å¾ˆå°‘å¾ˆå°‘ä¼šæŠŠä¸€ä¸ªçˆ¶èŠ‚ç‚¹ç§»åŠ¨/æ›´æ–°åˆ°æŸä¸€ä¸ªå­èŠ‚ç‚¹</li> <li>å› æ­¤åªéœ€è¦æ‰¾åŒçº§åˆ«çš„å­èŠ‚ç‚¹ä¾æ¬¡æ¯”è¾ƒï¼Œç„¶åå†æ‰¾ä¸‹ä¸€çº§åˆ«çš„èŠ‚ç‚¹æ¯”è¾ƒï¼Œè¿™æ ·ç®—æ³•çš„æ—¶é—´å¤ æ‚åº¦ä¸º <code>O(n)</code></li></ul> <p><img src="./è™šæ‹ŸdomåŸç†_files/20210329092027.png" alt="" class="medium-zoom-image"></p> <ul><li>åœ¨è¿›è¡ŒåŒçº§åˆ«èŠ‚ç‚¹æ¯”è¾ƒçš„æ—¶å€™ï¼Œé¦–å…ˆä¼šå¯¹æ–°è€èŠ‚ç‚¹æ•°ç»„çš„å¼€å§‹å’Œç»“å°¾èŠ‚ç‚¹è®¾ç½®æ ‡è®°ç´¢å¼•ï¼Œé å†çš„è¿‡ç¨‹ä¸­ç§»åŠ¨ç´¢å¼•</li> <li>åœ¨å¯¹å¼€å§‹å’Œç»“æŸèŠ‚ç‚¹æ¯”è¾ƒçš„æ—¶å€™ï¼Œæ€»å…±æœ‰å››ç§æƒ…å†µ
<ul><li><code>oldStartVnode / newStartVnode</code> (æ—§å¼€å§‹èŠ‚ç‚¹ / æ–°å¼€å§‹èŠ‚ç‚¹)</li> <li><code>oldEndVnode / newEndVnode</code> (æ—§ç»“æŸèŠ‚ç‚¹ / æ–°ç»“æŸèŠ‚ç‚¹)</li> <li><code>oldStartVnode / oldEndVnode</code> (æ—§å¼€å§‹èŠ‚ç‚¹ / æ–°ç»“æŸèŠ‚ç‚¹)</li> <li><code>oldEndVnode / newStartVnode</code> (æ—§ç»“æŸèŠ‚ç‚¹ / æ–°å¼€å§‹èŠ‚ç‚¹)</li></ul></li></ul> <p><img src="./è™šæ‹ŸdomåŸç†_files/20210329092301.png" alt="" class="medium-zoom-image"></p> <ul><li>å¼€å§‹èŠ‚ç‚¹å’Œç»“æŸèŠ‚ç‚¹æ¯”è¾ƒï¼Œè¿™ä¸¤ç§æƒ…å†µç±»ä¼¼
<ul><li><code>oldStartVnode / newStartVnode</code> (æ—§å¼€å§‹èŠ‚ç‚¹ / æ–°å¼€å§‹èŠ‚ç‚¹)</li> <li><code>oldEndVnode / newEndVnode</code> (æ—§ç»“æŸèŠ‚ç‚¹ / æ–°ç»“æŸèŠ‚ç‚¹)</li></ul></li> <li>å¦‚æœ <code>oldStartVnode</code> å’Œ <code>newStartVnode</code> æ˜¯ <code>sameVnode</code> (<code>key</code> å’Œ <code>sel</code> ç›¸åŒ)
<ul><li>è°ƒç”¨ <code>patchVnode()</code> å¯¹æ¯”å’Œæ›´æ–°èŠ‚ç‚¹</li> <li>æŠŠæ—§å¼€å§‹å’Œæ–°å¼€å§‹ç´¢å¼•å¾€åç§»åŠ¨ <code>oldStartIdx++ / oldEndIdx++</code></li></ul></li></ul> <p><img src="./è™šæ‹ŸdomåŸç†_files/20210329092430.png" alt="" class="medium-zoom-image"></p> <ul><li><code>oldStartVnode / newEndVnode</code> (æ—§å¼€å§‹èŠ‚ç‚¹ / æ–°ç»“æŸèŠ‚ç‚¹) ç›¸åŒ
<ul><li>è°ƒç”¨ <code>patchVnode()</code> å¯¹æ¯”å’Œæ›´æ–°èŠ‚ç‚¹</li> <li>æŠŠ <code>oldStartVnode</code> å¯¹åº”çš„ <code>DOM</code> å…ƒç´ ï¼Œç§»åŠ¨åˆ°å³è¾¹
<ul><li>æ›´æ–°ç´¢å¼•</li></ul></li></ul></li></ul> <p><img src="./è™šæ‹ŸdomåŸç†_files/20210329092820.png" alt="" class="medium-zoom-image"></p> <ul><li><code>oldEndVnode / newStartVnode</code> (æ—§ç»“æŸèŠ‚ç‚¹ / æ–°å¼€å§‹èŠ‚ç‚¹) ç›¸åŒ
<ul><li>è°ƒç”¨ <code>patchVnode()</code> å¯¹æ¯”å’Œæ›´æ–°èŠ‚ç‚¹</li> <li>æŠŠ <code>oldEndVnode</code> å¯¹åº”çš„ <code>DOM</code> å…ƒç´ ï¼Œç§»åŠ¨åˆ°å·¦è¾¹</li> <li>æ›´æ–°ç´¢å¼•</li></ul></li></ul> <p><img src="./è™šæ‹ŸdomåŸç†_files/20210329093025.png" alt="" class="medium-zoom-image"></p> <ul><li>å¦‚æœä¸æ˜¯ä»¥ä¸Šå››ç§æƒ…å†µ
<ul><li>éå†æ–°èŠ‚ç‚¹ï¼Œä½¿ç”¨ <code>newStartNode</code> çš„ <code>key</code> åœ¨è€èŠ‚ç‚¹æ•°ç»„ä¸­æ‰¾ç›¸åŒèŠ‚ç‚¹</li> <li>å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œè¯´æ˜ <code>newStartNode</code> æ˜¯æ–°èŠ‚ç‚¹
<ul><li>åˆ›å»ºæ–°èŠ‚ç‚¹å¯¹åº”çš„ DOM å…ƒç´ ï¼Œæ’å…¥åˆ° DOM æ ‘ä¸­</li></ul></li> <li>å¦‚æœæ‰¾åˆ°äº†
<ul><li>åˆ¤æ–­æ–°èŠ‚ç‚¹å’Œæ‰¾åˆ°çš„è€èŠ‚ç‚¹çš„ <code>sel</code> é€‰æ‹©å™¨æ˜¯å¦ç›¸åŒ</li> <li>å¦‚æœä¸ç›¸åŒï¼Œè¯´æ˜èŠ‚ç‚¹è¢«ä¿®æ”¹äº†
<ul><li>é‡æ–°åˆ›å»ºå¯¹åº”çš„ <code>DOM</code> å…ƒç´ ï¼Œæ’å…¥åˆ° DOM æ ‘ä¸­</li></ul></li> <li>å¦‚æœç›¸åŒï¼ŒæŠŠ <code>elmToMove</code> å¯¹åº”çš„ DOM å…ƒç´ ï¼Œç§»åŠ¨åˆ°å·¦è¾¹</li></ul></li></ul></li></ul> <p><img src="./è™šæ‹ŸdomåŸç†_files/20210329093137.png" alt="" class="medium-zoom-image"></p> <ul><li>å¾ªç¯ç»“æŸ
<ul><li>å½“è€èŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹å…ˆéå†å®Œ (<code>oldStartIdx &gt; oldEndIdx</code>)ï¼Œå¾ªç¯ç»“æŸ</li> <li>æ–°èŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹å…ˆéå†å®Œ (<code>newStartIdx &gt; newEndIdx</code>)ï¼Œå¾ªç¯ç»“æŸ</li></ul></li> <li>å¦‚æœè€èŠ‚ç‚¹çš„æ•°ç»„å…ˆéå†å®Œ(<code>oldStartIdx &gt; oldEndIdx</code>)ï¼Œè¯´æ˜æ–°èŠ‚ç‚¹æœ‰å‰©ä½™ï¼ŒæŠŠå‰©ä½™èŠ‚ç‚¹æ‰¹é‡æ’å…¥åˆ°å³è¾¹</li></ul> <p><img src="./è™šæ‹ŸdomåŸç†_files/20210329093302.png" alt="" class="medium-zoom-image"></p> <ul><li>å¦‚æœæ–°èŠ‚ç‚¹çš„æ•°ç»„å…ˆéå†å®Œ(<code>newStartIdx &gt; newEndIdx</code>)ï¼Œè¯´æ˜è€èŠ‚ç‚¹æœ‰å‰©ä½™ï¼ŒæŠŠå‰©ä½™èŠ‚ç‚¹æ‰¹ é‡åˆ é™¤</li></ul> <p><img src="./è™šæ‹ŸdomåŸç†_files/20210329093414.png" alt="" class="medium-zoom-image"></p></div> 
 </body></html>